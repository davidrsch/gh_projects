{
  "version": 3,
  "sources": ["../../src/webviews/client/services/GroupDataService.ts", "../../src/webviews/client/components/FieldsMenu.ts", "../../src/webviews/client/components/GroupByMenu.ts", "../../src/webviews/client/components/SortByMenu.ts", "../../src/webviews/client/components/FieldSumMenu.ts", "../../src/webviews/client/components/menuManager.ts", "../../src/webviews/client/renderers/RoadmapRenderer.ts", "../../src/webviews/client/utils.ts", "../../src/webviews/client/renderers/GroupRenderer.ts", "../../src/webviews/client/icons/iconRegistry.ts", "../../src/webviews/client/renderers/strategies.ts", "../../src/webviews/client/renderers/cellRenderer.ts", "../../src/webviews/client/utils/domUtils.ts", "../../src/webviews/client/viewFetcherUtils.ts", "../../src/webviews/client/utils/tableSorting.ts", "../../src/webviews/client/components/SlicePanel.ts", "../../src/webviews/client/components/ActiveTabMenu.ts", "../../src/webviews/client/components/initActiveTabMenus.ts", "../../src/webviews/client/roadmapViewFetcher.ts"],
  "sourcesContent": ["export class GroupDataService {\r\n  public static groupItems(items: any[], field: any): any[] {\r\n    // Normalize options: Single Select uses .options, Iteration uses .configuration.iterations\r\n    let options: any[] = [];\r\n    const dType = (field.dataType || \"\").toLowerCase();\r\n    if (dType === \"single_select\") {\r\n      options = field.options || [];\r\n    } else if (dType === \"iteration\") {\r\n      options = (field.configuration && field.configuration.iterations) || [];\r\n    }\r\n    // If we have explicit options (single select/iteration), use them to group.\r\n    if (options && options.length > 0) {\r\n      const groups: any[] = options.map((opt: any) => ({\r\n        option: opt,\r\n        items: [],\r\n      }));\r\n      const unassigned: any[] = [];\r\n\r\n      items.forEach((item, index) => {\r\n        const fv = item.fieldValues.find(\r\n          (v: any) =>\r\n            String(v.fieldId) === String(field.id) ||\r\n            v.fieldName === field.name,\r\n        );\r\n        let placed = false;\r\n\r\n        if (fv) {\r\n          // Match logic\r\n          let matchId: string | null = null;\r\n          let matchName: string | null = null;\r\n\r\n          if (dType === \"single_select\") {\r\n            matchId = fv.optionId || (fv.option && fv.option.id);\r\n            matchName = fv.name || (fv.option && fv.option.name);\r\n          } else if (dType === \"iteration\") {\r\n            matchId =\r\n              fv.iterationId || (fv.iteration && fv.iteration.id) || fv.id;\r\n            matchName = fv.title || (fv.iteration && fv.iteration.title);\r\n          }\r\n\r\n          if (matchId || matchName) {\r\n            const group = groups.find(\r\n              (g: any) =>\r\n                (matchId && String(g.option.id) === String(matchId)) ||\r\n                (matchName &&\r\n                  (String(g.option.name) === String(matchName) ||\r\n                    String(g.option.title) === String(matchName))),\r\n            );\r\n            if (group) {\r\n              group.items.push({ item, index });\r\n              placed = true;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!placed) {\r\n          unassigned.push({ item, index });\r\n        }\r\n      });\r\n\r\n      if (unassigned.length > 0) {\r\n        groups.push({\r\n          option: { name: \"Unassigned\", title: \"Unassigned\", color: \"GRAY\" },\r\n          items: unassigned,\r\n        });\r\n      }\r\n\r\n      \r\n\r\n      return groups.filter((g: any) => g.items.length > 0);\r\n    }\r\n\r\n    // Fallback grouping: build groups based on actual item values (useful for assignees, repository, date, number, etc.)\r\n    const map = new Map<string, { option: any; items: any[] }>();\r\n    const unassignedFallback: any[] = [];\r\n\r\n    items.forEach((item, index) => {\r\n      const fv = item.fieldValues.find(\r\n        (v: any) =>\r\n          String(v.fieldId) === String(field.id) || v.fieldName === field.name,\r\n      );\r\n      let val: any = null;\r\n      if (fv) {\r\n        // Text/title/number/date straightforward\r\n        if (fv.text !== undefined) val = fv.text;\r\n        else if (fv.title !== undefined) val = fv.title;\r\n        else if (fv.number !== undefined) val = fv.number;\r\n        else if (fv.date !== undefined) val = fv.date;\r\n        // single_select / option\r\n        else if (fv.option)\r\n          val = fv.option.name || fv.option.title || fv.option.id;\r\n        // iteration\r\n        else if (fv.iteration) val = fv.iteration.title || fv.iteration.id;\r\n        // parent_issue - try parent/parentIssue/issue/item/value/raw\r\n        else if (\r\n          fv.parent ||\r\n          fv.parentIssue ||\r\n          fv.issue ||\r\n          fv.item ||\r\n          fv.value\r\n        ) {\r\n          const p =\r\n            fv.parent || fv.parentIssue || fv.issue || fv.item || fv.value;\r\n          if (p) {\r\n            // Prefer number, then id, then url, then title\r\n            val =\r\n              p.number ||\r\n              p.id ||\r\n              (p.raw && (p.raw.number || p.raw.id)) ||\r\n              p.url ||\r\n              p.title ||\r\n              p.name ||\r\n              null;\r\n          }\r\n        }\r\n        // assignees\r\n        else if (fv.assignees)\r\n          val = Array.isArray(fv.assignees)\r\n            ? fv.assignees.map((a: any) => a.login || a.name).join(\", \")\r\n            : fv.assignees;\r\n        // repository\r\n        else if (fv.repository)\r\n          val =\r\n            fv.repository.nameWithOwner ||\r\n            fv.repository.name ||\r\n            fv.repository.full_name ||\r\n            fv.repository.id;\r\n        // milestone\r\n        else if (fv.milestone)\r\n          val = fv.milestone.title || fv.milestone.id || fv.milestone.name;\r\n        else val = fv.value !== undefined ? fv.value : null;\r\n      }\r\n\r\n      if (val === null || val === undefined || val === \"\") {\r\n        unassignedFallback.push({ item, index });\r\n        return;\r\n      }\r\n\r\n      // Normalize string values for grouping to avoid excessive fragmentation\r\n      let displayVal: any = val;\r\n      if (typeof val === \"string\") {\r\n        // Trim and use first line to represent multi-line text fields\r\n        try {\r\n          displayVal = String(val).trim();\r\n          const lines = displayVal.split(/\\r?\\n/);\r\n          if (lines.length > 0) displayVal = lines[0].trim();\r\n          // Limit length for display/key purposes\r\n          if (displayVal.length > 120) displayVal = displayVal.slice(0, 120);\r\n        } catch (e) {}\r\n      }\r\n\r\n      const key = String(typeof displayVal === \"string\" ? displayVal.toLowerCase() : displayVal);\r\n      if (!map.has(key)) {\r\n        map.set(key, { option: { id: key, name: String(displayVal), title: String(displayVal) }, items: [] });\r\n      }\r\n      map.get(key)!.items.push({ item, index });\r\n    });\r\n\r\n    const groupsArr = Array.from(map.values());\r\n    if (unassignedFallback.length > 0) {\r\n      groupsArr.push({\r\n        option: { name: \"Unassigned\", title: \"Unassigned\", color: \"GRAY\" },\r\n        items: unassignedFallback,\r\n      });\r\n    }\r\n    \r\n    return groupsArr;\r\n  }\r\n}\r\n", "/**\r\n * Fields Menu\r\n * Dropdown used from table plus-column. Shows project fields split into Visible / Hidden sections\r\n * First item is a \"+ New field\" button. Visible fields show a leading checkmark.\r\n */\r\n\r\nexport interface FieldItem {\r\n  id: string;\r\n  name: string;\r\n  iconClass?: string;\r\n  dataType?: string;\r\n  locked?: boolean;\r\n}\r\n\r\nexport interface FieldsMenuOptions {\r\n  fields: FieldItem[];\r\n  visibleFieldIds: Set<string>;\r\n  onToggleVisibility?: (fieldId: string, visible: boolean) => void;\r\n  onCreateField?: () => void;\r\n}\r\n\r\nexport class FieldsMenu {\r\n  private options: FieldsMenuOptions;\r\n  private menuElement: HTMLElement | null = null;\r\n  private backdropElement: HTMLElement | null = null;\r\n  private anchorElementRef: HTMLElement | null = null;\r\n  private anchorRectRef: DOMRect | undefined = undefined;\r\n\r\n  constructor(options: FieldsMenuOptions) {\r\n    this.options = options;\r\n  }\r\n\r\n  public show(anchorElement: HTMLElement, anchorRect?: DOMRect) {\r\n    this.hide();\r\n    this.anchorElementRef = anchorElement;\r\n    this.anchorRectRef = anchorRect;\r\n\r\n    // Backdrop to detect outside clicks\r\n    // Remove existing field/group submenus so only one is visible\r\n    try {\r\n      document.querySelectorAll('[data-menu-type=\"fields-menu\"], [data-menu-type=\"group-by-menu\"]').forEach((n) => n.remove());\r\n    } catch (e) { }\r\n\r\n    this.backdropElement = document.createElement(\"div\");\r\n    this.backdropElement.style.position = \"fixed\";\r\n    this.backdropElement.style.top = \"0\";\r\n    this.backdropElement.style.left = \"0\";\r\n    this.backdropElement.style.right = \"0\";\r\n    this.backdropElement.style.bottom = \"0\";\r\n    this.backdropElement.style.zIndex = \"998\";\r\n    this.backdropElement.addEventListener(\"click\", () => this.hide());\r\n    this.backdropElement.dataset.menuType = 'fields-menu';\r\n    document.body.appendChild(this.backdropElement);\r\n\r\n    // Create menu offscreen first so we can measure size and pick best placement\r\n    this.menuElement = document.createElement(\"div\");\r\n    this.menuElement.className = \"fields-menu\";\r\n    this.menuElement.dataset.menuType = 'fields-menu';\r\n    this.menuElement.style.position = \"absolute\";\r\n    this.menuElement.style.visibility = \"hidden\";\r\n    this.menuElement.style.left = \"0px\";\r\n    this.menuElement.style.top = \"0px\";\r\n    this.menuElement.style.background = \"var(--vscode-menu-background)\";\r\n    this.menuElement.style.border = \"1px solid var(--vscode-menu-border)\";\r\n    this.menuElement.style.borderRadius = \"4px\";\r\n    this.menuElement.style.boxShadow = \"0 2px 8px rgba(0,0,0,0.15)\";\r\n    this.menuElement.style.minWidth = \"220px\";\r\n    this.menuElement.style.padding = \"6px 0\";\r\n    // When there are many fields, allow the menu to scroll vertically instead of growing off-screen\r\n    this.menuElement.style.maxHeight = \"60vh\";\r\n    this.menuElement.style.overflowY = \"auto\";\r\n    this.menuElement.style.boxSizing = \"border-box\";\r\n    this.menuElement.style.zIndex = \"1000\";\r\n    this.menuElement.style.fontSize = \"13px\";\r\n\r\n    // Append hidden, build, measure, then position\r\n    document.body.appendChild(this.menuElement);\r\n    this.buildMenu();\r\n\r\n    let rect = anchorRect as DOMRect | undefined;\r\n    if (!rect) rect = anchorElement.getBoundingClientRect();\r\n    try { console.debug('FieldsMenu.show anchorRect', { top: rect.top, left: rect.left, right: rect.right, height: rect.height }); } catch (e) { }\r\n    const menuRect = this.menuElement.getBoundingClientRect();\r\n    const margin = 8;\r\n    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n    const vh = window.innerHeight || document.documentElement.clientHeight;\r\n\r\n    // Vertical placement: prefer below, otherwise above, else clamp\r\n    let top = rect.bottom + margin;\r\n    if (rect.bottom + menuRect.height + margin > vh) {\r\n      // try above\r\n      if (rect.top - menuRect.height - margin >= 0) {\r\n        top = rect.top - menuRect.height - margin;\r\n      } else {\r\n        // clamp within viewport\r\n        top = Math.max(\r\n          margin,\r\n          Math.min(vh - menuRect.height - margin, rect.bottom + margin),\r\n        );\r\n      }\r\n    }\r\n\r\n    // Horizontal placement: align left by default, but if called from a parent ActiveTabMenu\r\n    // open to the right of the parent menu so it behaves like a submenu.\r\n    let left = rect.left;\r\n    try {\r\n      // Anchor placement relative to the clicked row\r\n      const anchorRect = rect;\r\n      // Prefer opening to the right of the anchor row; fall back to left\r\n      left = Math.round(anchorRect.right + 4);\r\n      if (left + menuRect.width > vw) {\r\n        left = Math.round(anchorRect.left - menuRect.width - 4);\r\n        if (left < margin) left = Math.max(margin, vw - menuRect.width - margin);\r\n      }\r\n    } catch (e) {\r\n      left = rect.left;\r\n    }\r\n    // Clamp left\r\n    left = Math.max(margin, Math.min(left, vw - menuRect.width - margin));\r\n\r\n    // If the menu is taller than the viewport, clamp top and let menu scroll (maxHeight already set)\r\n    // Center vertically on the anchor row where possible\r\n    let finalTop = Math.round(rect.top + (rect.height - menuRect.height) / 2);\r\n    finalTop = Math.max(margin, Math.min(finalTop, Math.max(margin, vh - menuRect.height - margin)));\r\n    this.menuElement.style.top = `${Math.round(finalTop)}px`;\r\n    this.menuElement.style.left = `${Math.round(left)}px`;\r\n    this.menuElement.style.visibility = \"visible\";\r\n    try { console.debug('FieldsMenu positioned', { top: Math.round(finalTop), left: Math.round(left) }); } catch (e) { }\r\n    return { el: this.menuElement, refresh: this.refresh.bind(this) };\r\n  }\r\n\r\n  public refresh() {\r\n    if (!this.menuElement) return;\r\n    // rebuild content\r\n    this.menuElement.innerHTML = '';\r\n    this.buildMenu();\r\n    // reposition if we still have anchor info\r\n    try {\r\n      let rect = this.anchorRectRef as DOMRect | undefined;\r\n      if (!rect && this.anchorElementRef) rect = this.anchorElementRef.getBoundingClientRect();\r\n      if (!rect) return;\r\n      const menuRect = this.menuElement.getBoundingClientRect();\r\n      const margin = 8;\r\n      const vw = window.innerWidth || document.documentElement.clientWidth;\r\n      const vh = window.innerHeight || document.documentElement.clientHeight;\r\n\r\n      let left = Math.round(rect.right + 4);\r\n      if (left + menuRect.width > vw) {\r\n        left = Math.round(rect.left - menuRect.width - 4);\r\n        if (left < margin) left = Math.max(margin, vw - menuRect.width - margin);\r\n      }\r\n      left = Math.max(margin, Math.min(left, vw - menuRect.width - margin));\r\n\r\n      let finalTop = Math.round(rect.top + (rect.height - menuRect.height) / 2);\r\n      finalTop = Math.max(margin, Math.min(finalTop, Math.max(margin, vh - menuRect.height - margin)));\r\n      this.menuElement.style.top = `${Math.round(finalTop)}px`;\r\n      this.menuElement.style.left = `${Math.round(left)}px`;\r\n    } catch (e) { }\r\n  }\r\n\r\n  public hide() {\r\n    if (this.menuElement) {\r\n      this.menuElement.remove();\r\n      this.menuElement = null;\r\n    }\r\n    if (this.backdropElement) {\r\n      this.backdropElement.remove();\r\n      this.backdropElement = null;\r\n    }\r\n  }\r\n\r\n  private buildMenu() {\r\n    if (!this.menuElement) return;\r\n\r\n    // Header\r\n    const title = document.createElement(\"div\");\r\n    title.style.display = \"flex\";\r\n    title.style.alignItems = \"center\";\r\n    title.style.padding = \"6px 12px\";\r\n    title.style.fontWeight = \"600\";\r\n    title.style.color = \"var(--vscode-descriptionForeground)\";\r\n    title.style.fontSize = \"12px\";\r\n    title.style.textTransform = \"uppercase\";\r\n\r\n    const icon = document.createElement(\"i\");\r\n    icon.className = \"octicon octicon-note\";\r\n    icon.style.marginRight = \"8px\";\r\n    title.appendChild(icon);\r\n\r\n    const label = document.createElement(\"span\");\r\n    label.textContent = \"Fields\";\r\n    title.appendChild(label);\r\n\r\n    this.menuElement.appendChild(title);\r\n    this.addSeparator();\r\n\r\n    // + New field\r\n    const newField = document.createElement(\"div\");\r\n    newField.style.display = \"flex\";\r\n    newField.style.alignItems = \"center\";\r\n    newField.style.padding = \"6px 12px\";\r\n    newField.style.cursor = \"pointer\";\r\n    newField.style.color = \"var(--vscode-menu-foreground)\";\r\n    newField.innerHTML = `<span style=\"margin-right:8px;font-weight:700\">+</span><span>New field</span>`;\r\n    newField.addEventListener(\"mouseenter\", () => {\r\n      newField.style.background = \"var(--vscode-menu-selectionBackground)\";\r\n      newField.style.color = \"var(--vscode-menu-selectionForeground)\";\r\n    });\r\n    newField.addEventListener(\"mouseleave\", () => {\r\n      newField.style.background = \"transparent\";\r\n      newField.style.color = \"var(--vscode-menu-foreground)\";\r\n    });\r\n    newField.addEventListener(\"click\", () => {\r\n      this.options.onCreateField?.();\r\n      this.hide();\r\n    });\r\n    this.menuElement.appendChild(newField);\r\n\r\n    this.addSeparator();\r\n\r\n    const visible = this.options.fields.filter((f) =>\r\n      this.options.visibleFieldIds.has(f.id),\r\n    );\r\n    const hidden = this.options.fields.filter(\r\n      (f) => !this.options.visibleFieldIds.has(f.id),\r\n    );\r\n\r\n    this.addSectionHeader(\"Visible fields\");\r\n    if (visible.length === 0) this.addEmptyRow(\"No visible fields\");\r\n    else visible.forEach((f) => this.addFieldRow(f, true));\r\n\r\n    this.addSeparator();\r\n\r\n    this.addSectionHeader(\"Hidden fields\");\r\n    if (hidden.length === 0) this.addEmptyRow(\"No hidden fields\");\r\n    else hidden.forEach((f) => this.addFieldRow(f, false));\r\n  }\r\n\r\n  private addSectionHeader(text: string) {\r\n    if (!this.menuElement) return;\r\n    const h = document.createElement(\"div\");\r\n    h.textContent = text;\r\n    h.style.padding = \"6px 12px\";\r\n    h.style.fontSize = \"11px\";\r\n    h.style.fontWeight = \"600\";\r\n    h.style.color = \"var(--vscode-descriptionForeground)\";\r\n    h.style.textTransform = \"uppercase\";\r\n    this.menuElement.appendChild(h);\r\n  }\r\n  private addEmptyRow(text: string) {\r\n    if (!this.menuElement) return;\r\n    const r = document.createElement(\"div\");\r\n    r.textContent = text;\r\n    r.style.padding = \"6px 12px\";\r\n    r.style.color = \"var(--vscode-menu-foreground)\";\r\n    r.style.opacity = \"0.8\";\r\n    this.menuElement.appendChild(r);\r\n  }\r\n\r\n  private addFieldRow(field: FieldItem, visible: boolean) {\r\n    if (!this.menuElement) return;\r\n    const row = document.createElement(\"div\");\r\n    row.style.display = \"flex\";\r\n    row.style.alignItems = \"center\";\r\n    row.style.padding = \"6px 12px\";\r\n    row.style.cursor = field.locked ? \"default\" : \"pointer\";\r\n    row.style.color = \"var(--vscode-menu-foreground)\";\r\n    if (field.locked) {\r\n      row.style.opacity = \"0.6\";\r\n    }\r\n\r\n    if (visible) {\r\n      const c = document.createElement(\"span\");\r\n      c.textContent = \"\u2713\";\r\n      c.style.marginRight = \"8px\";\r\n      c.style.color = \"var(--vscode-menu-selectionForeground)\";\r\n      row.appendChild(c);\r\n    } else {\r\n      const s = document.createElement(\"span\");\r\n      s.style.display = \"inline-block\";\r\n      s.style.width = \"14px\";\r\n      s.style.marginRight = \"8px\";\r\n      row.appendChild(s);\r\n    }\r\n\r\n    // Determine icon SVG based on field dataType or provided iconClass. Use placeholder tokens for octicon paths so user can replace them later.\r\n    const iconHtml = this.getIconForField(field);\r\n    const icon = document.createElement(\"span\");\r\n    icon.innerHTML = iconHtml;\r\n    icon.style.marginRight = \"8px\";\r\n    icon.style.display = \"inline-flex\";\r\n    icon.style.alignItems = \"center\";\r\n    row.appendChild(icon);\r\n    const label = document.createElement(\"span\");\r\n    label.textContent = field.name;\r\n    label.style.flex = \"1\";\r\n    label.style.whiteSpace = \"nowrap\";\r\n    label.style.overflow = \"hidden\";\r\n    label.style.textOverflow = \"ellipsis\";\r\n    row.appendChild(label);\r\n\r\n    if (!field.locked) {\r\n      row.addEventListener(\"mouseenter\", () => {\r\n        row.style.background = \"var(--vscode-menu-selectionBackground)\";\r\n        row.style.color = \"var(--vscode-menu-selectionForeground)\";\r\n      });\r\n      row.addEventListener(\"mouseleave\", () => {\r\n        row.style.background = \"transparent\";\r\n        row.style.color = \"var(--vscode-menu-foreground)\";\r\n      });\r\n      row.addEventListener(\"click\", () => {\r\n        const newVisible = !visible;\r\n        this.options.onToggleVisibility?.(field.id, newVisible);\r\n        if (newVisible) this.options.visibleFieldIds.add(field.id);\r\n        else this.options.visibleFieldIds.delete(field.id);\r\n        this.menuElement && ((this.menuElement.innerHTML = \"\"), this.buildMenu());\r\n      });\r\n    }\r\n\r\n    this.menuElement.appendChild(row);\r\n  }\r\n\r\n  private addSeparator() {\r\n    if (!this.menuElement) return;\r\n    const s = document.createElement(\"div\");\r\n    s.style.height = \"1px\";\r\n    s.style.background = \"var(--vscode-menu-separatorBackground)\";\r\n    s.style.margin = \"6px 0\";\r\n    this.menuElement.appendChild(s);\r\n  }\r\n\r\n  /**\r\n   * Return inline SVG HTML for the given field using the icon registry.\r\n   */\r\n  private getIconForField(field: FieldItem): string {\r\n    const dataType = (field.dataType || \"\").toString().toLowerCase();\r\n\r\n    // If getIconNameForDataType is available from the icon registry, use it\r\n    if (\r\n      typeof (window as any).getIconNameForDataType === \"function\" &&\r\n      typeof (window as any).getIconSvg === \"function\"\r\n    ) {\r\n      const iconName = (window as any).getIconNameForDataType(dataType);\r\n      return (window as any).getIconSvg(iconName);\r\n    }\r\n\r\n    // Fallback: use provided CSS iconClass if available\r\n    if (field.iconClass) {\r\n      return `<i class=\"${field.iconClass}\"></i>`;\r\n    }\r\n\r\n    // Ultimate fallback: empty span\r\n    return \"<span></span>\";\r\n  }\r\n}\r\n\r\nexport default FieldsMenu;\r\n", "import { GroupDataService } from '../services/GroupDataService';\r\n\r\nexport interface GroupByMenuOptions {\r\n  fields: { id: string; name: string; iconClass?: string; dataType?: string }[];\r\n  items?: any[];\r\n  current?: string | null;\r\n  title?: string; // Dynamic title: \"Column by\", \"Swimlanes\", \"Group by\"\r\n  onSelect?: (fieldName: string | null) => void;\r\n}\r\n\r\nexport class GroupByMenu {\r\n  private options: GroupByMenuOptions;\r\n  private menuEl: HTMLElement | null = null;\r\n  private backdropEl: HTMLElement | null = null;\r\n  private anchor: HTMLElement | null = null;\r\n  private anchorRect: DOMRect | undefined = undefined;\r\n\r\n  constructor(options: GroupByMenuOptions) {\r\n    this.options = options;\r\n  }\r\n\r\n  public show(anchor: HTMLElement, anchorRect?: DOMRect): { el: HTMLElement | null; refresh: () => void } {\r\n    this.hide();\r\n    this.anchor = anchor;\r\n    this.anchorRect = anchorRect;\r\n\r\n    this.backdropEl = document.createElement('div');\r\n    this.backdropEl.style.position = 'fixed';\r\n    this.backdropEl.style.top = '0';\r\n    this.backdropEl.style.left = '0';\r\n    this.backdropEl.style.right = '0';\r\n    this.backdropEl.style.bottom = '0';\r\n    this.backdropEl.style.zIndex = '998';\r\n    this.backdropEl.addEventListener('click', () => this.hide());\r\n    document.body.appendChild(this.backdropEl);\r\n\r\n    // Remove any existing submenus first\r\n    try {\r\n      document.querySelectorAll('[data-menu-type=\"fields-menu\"], [data-menu-type=\"group-by-menu\"]').forEach((n) => n.remove());\r\n    } catch (e) { }\r\n\r\n    this.menuEl = document.createElement('div');\r\n    this.menuEl.className = 'group-by-menu';\r\n    this.menuEl.dataset.menuType = 'group-by-menu';\r\n    this.menuEl.style.position = 'absolute';\r\n    this.menuEl.style.background = 'var(--vscode-menu-background)';\r\n    this.menuEl.style.border = '1px solid var(--vscode-menu-border)';\r\n    this.menuEl.style.borderRadius = '4px';\r\n    this.menuEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';\r\n    this.menuEl.style.minWidth = '180px';\r\n    this.menuEl.style.maxHeight = '60vh';\r\n    this.menuEl.style.overflowY = 'auto';\r\n    this.menuEl.style.boxSizing = 'border-box';\r\n    this.menuEl.style.padding = '4px 0';\r\n    this.menuEl.style.zIndex = '1000';\r\n    this.menuEl.style.fontSize = '13px';\r\n    document.body.appendChild(this.menuEl);\r\n\r\n    this.buildMenuContent();\r\n    this.positionMenu();\r\n    return { el: this.menuEl, refresh: this.refresh.bind(this) };\r\n  }\r\n\r\n  private buildMenuContent() {\r\n    if (!this.menuEl) return;\r\n    this.menuEl.innerHTML = '';\r\n\r\n    const title = document.createElement('div');\r\n    title.textContent = this.options.title || 'Group by';\r\n    title.style.padding = '6px 12px';\r\n    title.style.fontWeight = '600';\r\n    title.style.color = 'var(--vscode-descriptionForeground)';\r\n    title.style.fontSize = '12px';\r\n    this.menuEl.appendChild(title);\r\n\r\n    this.addSeparator();\r\n\r\n    // \"No grouping\" option\r\n    const noneRow = document.createElement('div');\r\n    noneRow.style.display = 'flex';\r\n    noneRow.style.alignItems = 'center';\r\n    noneRow.style.padding = '6px 12px';\r\n    noneRow.style.cursor = 'pointer';\r\n\r\n    const noneCheck = document.createElement('span');\r\n    noneCheck.style.display = 'inline-flex';\r\n    noneCheck.style.width = '14px';\r\n    noneCheck.style.marginRight = '8px';\r\n    noneCheck.style.alignItems = 'center';\r\n    noneCheck.style.justifyContent = 'center';\r\n    if (!this.options.current) {\r\n      noneCheck.textContent = '\u2713';\r\n      noneCheck.style.color = 'var(--vscode-menu-selectionForeground)';\r\n    }\r\n    noneRow.appendChild(noneCheck);\r\n\r\n    const noneLabel = document.createElement('span');\r\n    noneLabel.textContent = 'No grouping';\r\n    noneRow.appendChild(noneLabel);\r\n\r\n    noneRow.addEventListener('mouseenter', () => {\r\n      noneRow.style.background = 'var(--vscode-menu-selectionBackground)';\r\n      noneRow.style.color = 'var(--vscode-menu-selectionForeground)';\r\n    });\r\n    noneRow.addEventListener('mouseleave', () => {\r\n      noneRow.style.background = 'transparent';\r\n      noneRow.style.color = 'var(--vscode-menu-foreground)';\r\n    });\r\n    noneRow.addEventListener('click', () => {\r\n      this.options.current = null;\r\n      this.options.onSelect?.(null);\r\n      this.refresh();\r\n    });\r\n    this.menuEl.appendChild(noneRow);\r\n\r\n    this.addSeparator();\r\n\r\n    // Determine candidate fields\r\n    let candidateFields = this.options.fields || [];\r\n    try {\r\n      if (this.options.items && Array.isArray(this.options.items) && this.options.items.length > 0) {\r\n        candidateFields = (this.options.fields || []).filter((f: any) => {\r\n          try {\r\n            const groups = GroupDataService.groupItems(this.options.items || [], f);\r\n            return Array.isArray(groups) && groups.length > 0;\r\n          } catch (e) {\r\n            return false;\r\n          }\r\n        });\r\n      }\r\n    } catch (e) { }\r\n\r\n    (candidateFields || []).forEach(f => {\r\n      const r = document.createElement('div');\r\n      r.style.display = 'flex';\r\n      r.style.alignItems = 'center';\r\n      r.style.padding = '6px 12px';\r\n      r.style.cursor = 'pointer';\r\n\r\n      // leading checkmark\r\n      const check = document.createElement('span');\r\n      check.style.display = 'inline-flex';\r\n      check.style.width = '14px';\r\n      check.style.marginRight = '8px';\r\n      check.style.alignItems = 'center';\r\n      check.style.justifyContent = 'center';\r\n      const currentVal = this.options.current ? String(this.options.current).toLowerCase() : null;\r\n      const matchesCurrent = currentVal && (String(f.id).toLowerCase() === currentVal || String(f.name || '').toLowerCase() === currentVal);\r\n      if (matchesCurrent) {\r\n        check.textContent = '\u2713';\r\n        check.style.color = 'var(--vscode-menu-selectionForeground)';\r\n      }\r\n      r.appendChild(check);\r\n\r\n      // left icon (field type)\r\n      const left = document.createElement('span');\r\n      left.style.display = 'inline-flex';\r\n      left.style.alignItems = 'center';\r\n      left.style.justifyContent = 'center';\r\n      left.style.marginRight = '8px';\r\n      try {\r\n        const dt = (f.dataType || '').toString().toLowerCase();\r\n        if (typeof (window as any).getIconNameForDataType === 'function' && typeof (window as any).getIconSvg === 'function') {\r\n          const iconName = (window as any).getIconNameForDataType(dt);\r\n          left.innerHTML = (window as any).getIconSvg(iconName) || '';\r\n          left.querySelectorAll && left.querySelectorAll('svg').forEach((s: any) => s.setAttribute && s.setAttribute('fill', 'currentColor'));\r\n        } else if (f.iconClass) {\r\n          left.innerHTML = `<i class=\"${f.iconClass}\"></i>`;\r\n        }\r\n      } catch (e) { }\r\n      r.appendChild(left);\r\n\r\n      const label = document.createElement('div');\r\n      label.textContent = f.name;\r\n      label.style.flex = '1';\r\n      r.appendChild(label);\r\n\r\n      // Hover effects\r\n      r.addEventListener('mouseenter', () => {\r\n        r.style.background = 'var(--vscode-menu-selectionBackground)';\r\n        r.style.color = 'var(--vscode-menu-selectionForeground)';\r\n      });\r\n      r.addEventListener('mouseleave', () => {\r\n        r.style.background = 'transparent';\r\n        r.style.color = 'var(--vscode-menu-foreground)';\r\n      });\r\n\r\n      // Click: update current and refresh (don't close)\r\n      r.addEventListener('click', () => {\r\n        this.options.current = String(f.name);\r\n        this.options.onSelect?.(String(f.name));\r\n        this.refresh();\r\n      });\r\n\r\n      this.menuEl!.appendChild(r);\r\n    });\r\n  }\r\n\r\n  private positionMenu() {\r\n    if (!this.menuEl) return;\r\n\r\n    let rectAnchor = this.anchorRect;\r\n    if (!rectAnchor && this.anchor) rectAnchor = this.anchor.getBoundingClientRect();\r\n    if (!rectAnchor) return;\r\n\r\n    const mrect = this.menuEl.getBoundingClientRect();\r\n    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n    const vh = window.innerHeight || document.documentElement.clientHeight;\r\n    const margin = 8;\r\n\r\n    let top = Math.round(rectAnchor.top + (rectAnchor.height - mrect.height) / 2);\r\n    const maxTop = Math.max(margin, vh - mrect.height - margin);\r\n    top = Math.max(margin, Math.min(top, maxTop));\r\n\r\n    let left = Math.round(rectAnchor.right + 4);\r\n    if (left + mrect.width > vw) {\r\n      left = Math.round(rectAnchor.left - mrect.width - 4);\r\n      if (left < margin) {\r\n        left = Math.max(margin, vw - mrect.width - margin);\r\n      }\r\n    }\r\n\r\n    this.menuEl.style.top = `${top}px`;\r\n    this.menuEl.style.left = `${left}px`;\r\n  }\r\n\r\n  // Refresh content without closing/repositioning\r\n  public refresh() {\r\n    if (this.menuEl) {\r\n      this.buildMenuContent();\r\n    }\r\n  }\r\n\r\n  private addSeparator() {\r\n    if (!this.menuEl) return;\r\n    const s = document.createElement('div');\r\n    s.style.height = '1px';\r\n    s.style.background = 'var(--vscode-menu-separatorBackground)';\r\n    s.style.margin = '6px 0';\r\n    this.menuEl.appendChild(s);\r\n  }\r\n\r\n  public hide() {\r\n    if (this.menuEl) { this.menuEl.remove(); this.menuEl = null; }\r\n    if (this.backdropEl) { this.backdropEl.remove(); this.backdropEl = null; }\r\n  }\r\n}\r\n\r\nexport default GroupByMenu;\r\n\r\n", "export interface SortByMenuOptions {\r\n    fields: { id: string; name: string; iconClass?: string; dataType?: string }[];\r\n    current?: string | null; // Current sort field ID or null for no sorting\r\n    onSelect?: (fieldId: string | null) => void;\r\n}\r\n\r\nfunction getIconSvg(iconName: string, size: number = 14): string {\r\n    if ((window as any).getIconSvg) return (window as any).getIconSvg(iconName as any, { size });\r\n    return \"\";\r\n}\r\n\r\nfunction getIconNameForDataType(dataType: string): string {\r\n    if ((window as any).getIconNameForDataType) return (window as any).getIconNameForDataType(dataType);\r\n    return \"note\";\r\n}\r\n\r\nexport class SortByMenu {\r\n    private options: SortByMenuOptions;\r\n    private menuEl: HTMLElement | null = null;\r\n    private backdropEl: HTMLElement | null = null;\r\n    private anchor: HTMLElement | null = null;\r\n    private anchorRect: DOMRect | undefined = undefined;\r\n\r\n    constructor(options: SortByMenuOptions) {\r\n        this.options = options;\r\n    }\r\n\r\n    public show(anchor: HTMLElement, anchorRect?: DOMRect): { el: HTMLElement | null; refresh: () => void } {\r\n        this.hide();\r\n        this.anchor = anchor;\r\n        this.anchorRect = anchorRect;\r\n\r\n        this.backdropEl = document.createElement('div');\r\n        this.backdropEl.style.position = 'fixed';\r\n        this.backdropEl.style.top = '0';\r\n        this.backdropEl.style.left = '0';\r\n        this.backdropEl.style.right = '0';\r\n        this.backdropEl.style.bottom = '0';\r\n        this.backdropEl.style.zIndex = '998';\r\n        this.backdropEl.addEventListener('click', () => this.hide());\r\n        document.body.appendChild(this.backdropEl);\r\n\r\n        // Remove any existing submenus first\r\n        try {\r\n            document.querySelectorAll('[data-menu-type=\"sort-by-menu\"]').forEach((n) => n.remove());\r\n        } catch (e) { }\r\n\r\n        this.menuEl = document.createElement('div');\r\n        this.menuEl.className = 'sort-by-menu';\r\n        this.menuEl.dataset.menuType = 'sort-by-menu';\r\n        this.menuEl.style.position = 'absolute';\r\n        this.menuEl.style.background = 'var(--vscode-menu-background)';\r\n        this.menuEl.style.border = '1px solid var(--vscode-menu-border)';\r\n        this.menuEl.style.borderRadius = '4px';\r\n        this.menuEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';\r\n        this.menuEl.style.minWidth = '180px';\r\n        this.menuEl.style.maxHeight = '60vh';\r\n        this.menuEl.style.overflowY = 'auto';\r\n        this.menuEl.style.boxSizing = 'border-box';\r\n        this.menuEl.style.padding = '4px 0';\r\n        this.menuEl.style.zIndex = '1000';\r\n        this.menuEl.style.fontSize = '13px';\r\n        document.body.appendChild(this.menuEl);\r\n\r\n        this.buildMenuContent();\r\n        this.positionMenu();\r\n        return { el: this.menuEl, refresh: this.refresh.bind(this) };\r\n    }\r\n\r\n    private buildMenuContent() {\r\n        if (!this.menuEl) return;\r\n        this.menuEl.innerHTML = '';\r\n\r\n        const title = document.createElement('div');\r\n        title.textContent = 'Sort by';\r\n        title.style.padding = '6px 12px';\r\n        title.style.fontWeight = '600';\r\n        title.style.color = 'var(--vscode-descriptionForeground)';\r\n        title.style.fontSize = '12px';\r\n        this.menuEl.appendChild(title);\r\n\r\n        this.addSeparator();\r\n\r\n        // \"No sorting\" option\r\n        this.addSortRow(null, 'No sorting', null, !this.options.current);\r\n\r\n        this.addSeparator();\r\n\r\n        // All fields\r\n        (this.options.fields || []).forEach(f => {\r\n            const iconName = getIconNameForDataType(f.dataType || '');\r\n            const isActive = this.options.current === f.id || this.options.current === f.name;\r\n            this.addSortRow(f.id, f.name, iconName, isActive);\r\n        });\r\n    }\r\n\r\n    private addSortRow(id: string | null, label: string, iconName: string | null, isActive: boolean) {\r\n        if (!this.menuEl) return;\r\n\r\n        const row = document.createElement('div');\r\n        row.style.display = 'flex';\r\n        row.style.alignItems = 'center';\r\n        row.style.padding = '6px 12px';\r\n        row.style.cursor = 'pointer';\r\n\r\n        // Checkmark\r\n        const check = document.createElement('span');\r\n        check.style.display = 'inline-flex';\r\n        check.style.width = '14px';\r\n        check.style.marginRight = '8px';\r\n        check.style.alignItems = 'center';\r\n        check.style.justifyContent = 'center';\r\n        if (isActive) {\r\n            check.textContent = '\u2713';\r\n            check.style.color = 'var(--vscode-menu-selectionForeground)';\r\n        }\r\n        row.appendChild(check);\r\n\r\n        // Icon\r\n        if (iconName) {\r\n            const iconEl = document.createElement('span');\r\n            iconEl.style.display = 'inline-flex';\r\n            iconEl.style.alignItems = 'center';\r\n            iconEl.style.justifyContent = 'center';\r\n            iconEl.style.marginRight = '8px';\r\n            try {\r\n                iconEl.innerHTML = getIconSvg(iconName, 14);\r\n                iconEl.querySelectorAll('svg').forEach((s: any) => s.setAttribute && s.setAttribute('fill', 'currentColor'));\r\n            } catch (e) { }\r\n            row.appendChild(iconEl);\r\n        }\r\n\r\n        // Label\r\n        const labelEl = document.createElement('span');\r\n        labelEl.textContent = label;\r\n        labelEl.style.flex = '1';\r\n        row.appendChild(labelEl);\r\n\r\n        // Hover effects\r\n        row.addEventListener('mouseenter', () => {\r\n            row.style.background = 'var(--vscode-menu-selectionBackground)';\r\n            row.style.color = 'var(--vscode-menu-selectionForeground)';\r\n        });\r\n        row.addEventListener('mouseleave', () => {\r\n            row.style.background = 'transparent';\r\n            row.style.color = 'var(--vscode-menu-foreground)';\r\n        });\r\n\r\n        // Click: select sort field and refresh\r\n        row.addEventListener('click', () => {\r\n            this.options.current = id;\r\n            if (this.options.onSelect) {\r\n                this.options.onSelect(id);\r\n            }\r\n            this.refresh();\r\n        });\r\n\r\n        this.menuEl.appendChild(row);\r\n    }\r\n\r\n    private positionMenu() {\r\n        if (!this.menuEl) return;\r\n\r\n        let rectAnchor = this.anchorRect;\r\n        if (!rectAnchor && this.anchor) rectAnchor = this.anchor.getBoundingClientRect();\r\n        if (!rectAnchor) return;\r\n\r\n        const mrect = this.menuEl.getBoundingClientRect();\r\n        const vw = window.innerWidth || document.documentElement.clientWidth;\r\n        const vh = window.innerHeight || document.documentElement.clientHeight;\r\n        const margin = 8;\r\n\r\n        let top = Math.round(rectAnchor.top + (rectAnchor.height - mrect.height) / 2);\r\n        const maxTop = Math.max(margin, vh - mrect.height - margin);\r\n        top = Math.max(margin, Math.min(top, maxTop));\r\n\r\n        let left = Math.round(rectAnchor.right + 4);\r\n        if (left + mrect.width > vw) {\r\n            left = Math.round(rectAnchor.left - mrect.width - 4);\r\n            if (left < margin) {\r\n                left = Math.max(margin, vw - mrect.width - margin);\r\n            }\r\n        }\r\n\r\n        this.menuEl.style.top = `${top}px`;\r\n        this.menuEl.style.left = `${left}px`;\r\n    }\r\n\r\n    public refresh() {\r\n        if (this.menuEl) {\r\n            this.buildMenuContent();\r\n        }\r\n    }\r\n\r\n    private addSeparator() {\r\n        if (!this.menuEl) return;\r\n        const s = document.createElement('div');\r\n        s.style.height = '1px';\r\n        s.style.background = 'var(--vscode-menu-separatorBackground)';\r\n        s.style.margin = '6px 0';\r\n        this.menuEl.appendChild(s);\r\n    }\r\n\r\n    public hide() {\r\n        if (this.menuEl) { this.menuEl.remove(); this.menuEl = null; }\r\n        if (this.backdropEl) { this.backdropEl.remove(); this.backdropEl = null; }\r\n    }\r\n}\r\n\r\nexport default SortByMenu;\r\n", "export interface FieldSumMenuOptions {\r\n  fields: { id: string; name: string; dataType?: string; iconClass?: string }[];\r\n  current: string[]; // array of ids (or '__count__')\r\n  title?: string;\r\n  onChange?: (selected: string[]) => void;\r\n}\r\n\r\nexport class FieldSumMenu {\r\n  private options: FieldSumMenuOptions;\r\n  private menuEl: HTMLElement | null = null;\r\n  private backdropEl: HTMLElement | null = null;\r\n  private anchor: HTMLElement | null = null;\r\n\r\n  constructor(options: FieldSumMenuOptions) {\r\n    this.options = options;\r\n  }\r\n\r\n  public show(anchor: HTMLElement, anchorRect?: DOMRect): { el: HTMLElement | null; refresh: () => void } {\r\n    this.hide();\r\n    this.anchor = anchor;\r\n\r\n    this.backdropEl = document.createElement('div');\r\n    this.backdropEl.style.position = 'fixed';\r\n    this.backdropEl.style.top = '0';\r\n    this.backdropEl.style.left = '0';\r\n    this.backdropEl.style.right = '0';\r\n    this.backdropEl.style.bottom = '0';\r\n    this.backdropEl.style.zIndex = '998';\r\n    this.backdropEl.addEventListener('click', () => this.hide());\r\n    document.body.appendChild(this.backdropEl);\r\n\r\n    this.menuEl = document.createElement('div');\r\n    this.menuEl.className = 'field-sum-menu';\r\n    this.menuEl.dataset.menuType = 'field-sum-menu';\r\n    this.menuEl.style.position = 'absolute';\r\n    this.menuEl.style.background = 'var(--vscode-menu-background)';\r\n    this.menuEl.style.border = '1px solid var(--vscode-menu-border)';\r\n    this.menuEl.style.borderRadius = '4px';\r\n    this.menuEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';\r\n    this.menuEl.style.minWidth = '200px';\r\n    this.menuEl.style.maxHeight = '60vh';\r\n    this.menuEl.style.overflowY = 'auto';\r\n    this.menuEl.style.padding = '4px 0';\r\n    this.menuEl.style.zIndex = '1000';\r\n    this.menuEl.style.fontSize = '13px';\r\n    document.body.appendChild(this.menuEl);\r\n\r\n    this.buildMenu();\r\n    this.positionMenu(anchorRect);\r\n    return { el: this.menuEl, refresh: this.refresh.bind(this) };\r\n  }\r\n\r\n  private buildMenu() {\r\n    if (!this.menuEl) return;\r\n    this.menuEl.innerHTML = '';\r\n\r\n    const title = document.createElement('div');\r\n    title.textContent = this.options.title || 'Field sum';\r\n    title.style.padding = '6px 12px';\r\n    title.style.fontWeight = '600';\r\n    title.style.color = 'var(--vscode-descriptionForeground)';\r\n    title.style.fontSize = '12px';\r\n    this.menuEl.appendChild(title);\r\n\r\n    const addRow = (id: string, label: string, icon?: string, selected?: boolean) => {\r\n      const r = document.createElement('div');\r\n      r.style.display = 'flex';\r\n      r.style.alignItems = 'center';\r\n      r.style.padding = '6px 12px';\r\n      r.style.cursor = 'pointer';\r\n\r\n      const check = document.createElement('span');\r\n      check.style.display = 'inline-flex';\r\n      check.style.width = '14px';\r\n      check.style.marginRight = '8px';\r\n      check.style.alignItems = 'center';\r\n      check.style.justifyContent = 'center';\r\n      if (selected) { check.textContent = '\u2713'; check.style.color = 'var(--vscode-menu-selectionForeground)'; }\r\n      r.appendChild(check);\r\n\r\n      if (icon) {\r\n        const left = document.createElement('span');\r\n        left.style.display = 'inline-flex'; left.style.marginRight = '8px';\r\n        try { left.innerHTML = (window as any).getIconSvg?.(icon) || ''; left.querySelectorAll && left.querySelectorAll('svg').forEach((s: any) => s.setAttribute && s.setAttribute('fill','currentColor')); } catch (e) {}\r\n        r.appendChild(left);\r\n      }\r\n\r\n      const lbl = document.createElement('div');\r\n      lbl.textContent = label;\r\n      lbl.style.flex = '1';\r\n      r.appendChild(lbl);\r\n\r\n      r.addEventListener('mouseenter', () => { r.style.background = 'var(--vscode-menu-selectionBackground)'; r.style.color = 'var(--vscode-menu-selectionForeground)'; });\r\n      r.addEventListener('mouseleave', () => { r.style.background = 'transparent'; r.style.color = 'var(--vscode-menu-foreground)'; });\r\n\r\n      r.addEventListener('click', (ev) => {\r\n        ev.stopPropagation();\r\n        const cur = new Set(this.options.current || []);\r\n        if (cur.has(id)) cur.delete(id); else cur.add(id);\r\n        this.options.current = Array.from(cur);\r\n        try { if (typeof this.options.onChange === 'function') this.options.onChange(this.options.current); } catch (e) {}\r\n        // keep menu open but update checks\r\n        this.refresh();\r\n      });\r\n\r\n      this.menuEl!.appendChild(r);\r\n    };\r\n\r\n    // Count option\r\n    const currentSet = new Set(this.options.current || []);\r\n    addRow('__count__', 'Count', 'check', currentSet.has('__count__'));\r\n\r\n    // Numeric fields\r\n    (this.options.fields || []).forEach(f => {\r\n      const dt = String(f.dataType || '').toLowerCase();\r\n      if (dt === 'number' || dt === 'numeric' || dt.includes('num')) {\r\n        addRow(String(f.id), f.name, 'number', currentSet.has(String(f.id)));\r\n      }\r\n    });\r\n  }\r\n\r\n  private positionMenu(anchorRect?: DOMRect) {\r\n    if (!this.menuEl || !this.anchor) return;\r\n    let rect = anchorRect;\r\n    if (!rect) rect = this.anchor.getBoundingClientRect();\r\n\r\n    const menuRect = this.menuEl.getBoundingClientRect();\r\n    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n    const vh = window.innerHeight || document.documentElement.clientHeight;\r\n    let left = rect.right + 4;\r\n    if (left + menuRect.width > vw) {\r\n      left = rect.left - menuRect.width - 4;\r\n      if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n    }\r\n    this.menuEl.style.top = `${Math.round(rect.bottom + 4)}px`;\r\n    this.menuEl.style.left = `${Math.round(left)}px`;\r\n  }\r\n\r\n  public refresh() {\r\n    if (this.menuEl) this.buildMenu();\r\n  }\r\n\r\n  public hide() {\r\n    if (this.menuEl) { this.menuEl.remove(); this.menuEl = null; }\r\n    if (this.backdropEl) { this.backdropEl.remove(); this.backdropEl = null; }\r\n  }\r\n}\r\n\r\nexport default FieldSumMenu;\r\n", "export type RefreshFn = (() => void) | null;\r\n\r\nclass MenuManager {\r\n  private static menus = new Set<HTMLElement>();\r\n  private static refreshMap = new WeakMap<HTMLElement, RefreshFn>();\r\n\r\n  // Close and remove all registered menus\r\n  public static closeAll() {\r\n    try {\r\n      for (const el of Array.from(MenuManager.menus)) {\r\n        try {\r\n          // Remove any DOM elements that share the same data-menu-type (backdrops, helpers)\r\n          try {\r\n            const type = (el && el.dataset && el.dataset.menuType) || null;\r\n            if (type) {\r\n              const nodes = Array.from(document.querySelectorAll(`[data-menu-type=\"${type}\"]`));\r\n              for (const n of nodes) {\r\n                try { n.remove(); } catch (e) { }\r\n              }\r\n            }\r\n          } catch (e) { }\r\n\r\n          if (el && el.parentElement) el.parentElement.removeChild(el);\r\n        } catch (e) { }\r\n        MenuManager.refreshMap.delete(el);\r\n      }\r\n    } catch (e) { }\r\n    MenuManager.menus.clear();\r\n  }\r\n\r\n  // Register a menu element with an optional refresh callback\r\n  public static register(menuEl: HTMLElement, refreshFn?: RefreshFn) {\r\n    if (!menuEl) return;\r\n    MenuManager.menus.add(menuEl);\r\n    if (refreshFn) MenuManager.refreshMap.set(menuEl, refreshFn);\r\n  }\r\n\r\n  // Unregister without removing from DOM\r\n  public static unregister(menuEl: HTMLElement) {\r\n    if (!menuEl) return;\r\n    MenuManager.menus.delete(menuEl);\r\n    MenuManager.refreshMap.delete(menuEl);\r\n  }\r\n\r\n  // Refresh/reposition all registered menus by calling their refresh callbacks\r\n  public static refreshAll() {\r\n    try {\r\n      for (const el of Array.from(MenuManager.menus)) {\r\n        const fn = MenuManager.refreshMap.get(el);\r\n        try { if (fn) fn(); } catch (e) { }\r\n      }\r\n    } catch (e) { }\r\n  }\r\n}\r\n\r\nexport default MenuManager;\r\n", "import MenuManager from '../components/menuManager';\r\nimport { escapeHtml, normalizeColor, addAlpha } from \"../utils\";\r\nimport { GroupDataService } from \"../services/GroupDataService\";\r\nimport { buildGroupHeaderElement } from \"./GroupRenderer\";\r\nimport { getIconSvg, getIconNameForDataType } from \"../icons/iconRegistry\";\r\nimport { renderCell } from \"../renderers/cellRenderer\";\r\nimport { setLoadingState, setErrorState } from \"../utils/domUtils\";\r\n\r\nexport type ZoomLevel = \"month\" | \"quarter\" | \"year\";\r\n\r\nexport class RoadmapRenderer {\r\n    private zoomLevel: ZoomLevel = \"month\";\r\n    private activeMarkers: string[] = [\"milestones\"]; // Toggles for \"Milestones\", Iteration IDs, Date Field IDs\r\n    private activeSortFieldId: string | null = null; // null = \"No sorting\"\r\n    private startDateFieldId: string | null = null;\r\n    private endDateFieldId: string | null = null;\r\n    private initializedFields: boolean = false;\r\n    private collapsedGroups: Set<string> = new Set();\r\n    private dayWidth: number = 24; // px per day\r\n    private listWidth: number = 320; // px for the left list\r\n    private scrollSyncing: boolean = false;\r\n    private container: HTMLElement | null = null;\r\n    private lastSnapshot: any = null;\r\n\r\n    constructor(\r\n        private items: any[],\r\n        private allFields: any[],\r\n        private visibleFieldIds: string[],\r\n        private onFilter: (filter: string) => void,\r\n        private onAction: (action: string, item: any, args: any) => void,\r\n        private groupDivisors?: string[] | null,\r\n    ) {\r\n        this.updateZoomSettings();\r\n    }\r\n\r\n    public updateData(items: any[], fields: any[], visibleIds: string[]) {\r\n        this.items = items;\r\n        this.allFields = fields;\r\n        this.visibleFieldIds = visibleIds;\r\n    }\r\n\r\n    // Public accessors for menu integration\r\n    public getActiveMarkers(): string[] {\r\n        return [...this.activeMarkers];\r\n    }\r\n\r\n    public setActiveMarkers(markers: string[]) {\r\n        this.activeMarkers = [...markers];\r\n        if (this.container && this.lastSnapshot) {\r\n            this.renderRoadmap(this.container, this.lastSnapshot);\r\n        }\r\n    }\r\n\r\n    public toggleMarker(markerId: string, active: boolean) {\r\n        if (active) {\r\n            if (!this.activeMarkers.includes(markerId)) {\r\n                this.activeMarkers.push(markerId);\r\n            }\r\n        } else {\r\n            this.activeMarkers = this.activeMarkers.filter(m => m !== markerId);\r\n        }\r\n        if (this.container && this.lastSnapshot) {\r\n            this.renderRoadmap(this.container, this.lastSnapshot);\r\n        }\r\n    }\r\n\r\n    public getActiveSortFieldId(): string | null {\r\n        return this.activeSortFieldId;\r\n    }\r\n\r\n    public setActiveSortFieldId(fieldId: string | null) {\r\n        this.activeSortFieldId = fieldId;\r\n        if (this.container && this.lastSnapshot) {\r\n            this.renderRoadmap(this.container, this.lastSnapshot);\r\n        }\r\n    }\r\n\r\n    private updateZoomSettings() {\r\n        switch (this.zoomLevel) {\r\n            case \"month\":\r\n                this.dayWidth = 24; // dense week\r\n                break;\r\n            case \"quarter\":\r\n                this.dayWidth = 8; // month view\r\n                break;\r\n            case \"year\":\r\n                this.dayWidth = 2; // year view\r\n                break;\r\n            default:\r\n                this.dayWidth = 24;\r\n        }\r\n    }\r\n\r\n    public renderRoadmap(container: HTMLElement, snapshot: any) {\r\n        this.container = container;\r\n        this.lastSnapshot = snapshot;\r\n        container.innerHTML = \"\";\r\n\r\n        this.ensureStyles();\r\n\r\n        container.className = \"roadmap-root\";\r\n        container.style.display = \"flex\";\r\n        container.style.flexDirection = \"column\";\r\n        container.style.height = \"100%\";\r\n        container.style.background = \"var(--vscode-editor-background)\";\r\n\r\n        // 1. Header with Controls\r\n        const controlHeader = this.createControlHeader();\r\n        container.appendChild(controlHeader);\r\n\r\n        // 2. Main Content Area (Split Pane)\r\n        const splitPane = document.createElement(\"div\");\r\n        splitPane.className = \"roadmap-split-pane\";\r\n        splitPane.style.display = \"flex\";\r\n        splitPane.style.flex = \"1\";\r\n        splitPane.style.overflow = \"hidden\";\r\n        splitPane.style.borderTop = \"1px solid var(--vscode-panel-border)\";\r\n        container.appendChild(splitPane);\r\n\r\n        // 3. Left Side: Items List\r\n        const listContainer = document.createElement(\"div\");\r\n        listContainer.className = \"roadmap-list-container\";\r\n        listContainer.style.width = this.listWidth + \"px\";\r\n        listContainer.style.display = \"flex\";\r\n        listContainer.style.flexDirection = \"column\";\r\n        listContainer.style.background = \"var(--vscode-sideBar-background)\";\r\n        listContainer.style.borderRight = \"1px solid var(--vscode-panel-border)\";\r\n        listContainer.style.flexShrink = \"0\";\r\n        splitPane.appendChild(listContainer);\r\n\r\n        const listHeader = document.createElement(\"div\");\r\n        listHeader.className = \"roadmap-list-header\";\r\n        listHeader.style.height = \"32px\";\r\n        listHeader.style.borderBottom = \"1px solid var(--vscode-panel-border)\";\r\n        listHeader.style.padding = \"0 12px\";\r\n        listHeader.style.display = \"flex\";\r\n        listHeader.style.alignItems = \"center\";\r\n        listHeader.style.fontWeight = \"600\";\r\n        listHeader.style.fontSize = \"11px\";\r\n        listHeader.style.textTransform = \"uppercase\";\r\n        listHeader.style.background = \"var(--vscode-sideBar-background)\";\r\n        listHeader.style.color = \"var(--vscode-descriptionForeground)\";\r\n        listHeader.textContent = \"Items\";\r\n        listContainer.appendChild(listHeader);\r\n\r\n        const listView = document.createElement(\"div\");\r\n        listView.className = \"roadmap-list-view\";\r\n        listView.style.flex = \"1\";\r\n        listView.style.overflowY = \"auto\";\r\n        listView.style.overflowX = \"hidden\";\r\n        listContainer.appendChild(listView);\r\n\r\n        // 4. Right Side: Timeline\r\n        const timelineContainer = document.createElement(\"div\");\r\n        timelineContainer.className = \"roadmap-timeline-container\";\r\n        timelineContainer.style.flex = \"1\";\r\n        timelineContainer.style.display = \"flex\";\r\n        timelineContainer.style.flexDirection = \"column\";\r\n        timelineContainer.style.overflow = \"hidden\";\r\n        splitPane.appendChild(timelineContainer);\r\n\r\n        const gridHeader = this.createTimelineHeader();\r\n        timelineContainer.appendChild(gridHeader);\r\n\r\n        const gridView = document.createElement(\"div\");\r\n        gridView.className = \"roadmap-grid-view\";\r\n        gridView.style.flex = \"1\";\r\n        gridView.style.overflow = \"auto\";\r\n        timelineContainer.appendChild(gridView);\r\n\r\n        // Sync Scrolling\r\n        listView.addEventListener(\"scroll\", () => {\r\n            if (!this.scrollSyncing) {\r\n                this.scrollSyncing = true;\r\n                gridView.scrollTop = listView.scrollTop;\r\n                this.scrollSyncing = false;\r\n            }\r\n        });\r\n        gridView.addEventListener(\"scroll\", () => {\r\n            if (!this.scrollSyncing) {\r\n                this.scrollSyncing = true;\r\n                listView.scrollTop = gridView.scrollTop;\r\n                this.scrollSyncing = false;\r\n            }\r\n        });\r\n\r\n        // 5. Determine Grouping and Sorting\r\n        const groupByFields = snapshot?.details?.groupByFields?.nodes || [];\r\n        const groupingField = this.allFields.find(f =>\r\n            groupByFields.some((v: any) => String(v.id) === String(f.id) || v.name === f.name)\r\n        );\r\n\r\n        let itemsToRender = [...this.items];\r\n\r\n        // Apply Sorting before grouping\r\n        if (this.activeSortFieldId) {\r\n            const sortField = this.allFields.find(f => String(f.id) === String(this.activeSortFieldId));\r\n            if (sortField) {\r\n                const isDateType = [\"date\", \"iteration\", \"milestone\"].includes((sortField.dataType || sortField.type || \"\").toLowerCase());\r\n                itemsToRender.sort((a, b) => {\r\n                    if (isDateType) {\r\n                        const valA = this.getDateFieldValue(a, \"start\")?.getTime() || 0;\r\n                        const valB = this.getDateFieldValue(b, \"start\")?.getTime() || 0;\r\n                        return valA - valB;\r\n                    }\r\n                    const valA = a.fieldValues.find((v: any) => String(v.fieldId) === String(sortField.id))?.value || \"\";\r\n                    const valB = b.fieldValues.find((v: any) => String(v.fieldId) === String(sortField.id))?.value || \"\";\r\n                    if (typeof valA === \"string\" && typeof valB === \"string\") return valA.localeCompare(valB);\r\n                    if (typeof valA === \"number\" && typeof valB === \"number\") return valA - valB;\r\n                    return 0;\r\n                });\r\n            }\r\n        }\r\n\r\n        const groups = groupingField\r\n            ? GroupDataService.groupItems(itemsToRender, groupingField)\r\n            : [{ option: { name: \"\", id: \"none\" }, items: itemsToRender.map((it, idx) => ({ item: it, index: idx })) }];\r\n\r\n        if (!this.initializedFields) {\r\n            this.initDefaultDateFields();\r\n            this.initializedFields = true;\r\n        }\r\n\r\n        this.renderGroups(listView, gridView, groups, groupingField);\r\n    }\r\n\r\n    private initDefaultDateFields() {\r\n        const iterOrDateFields = this.allFields.filter(f => {\r\n            const type = (f.dataType || f.type || \"\").toLowerCase();\r\n            return type === \"iteration\" || type === \"date\";\r\n        });\r\n        if (!this.startDateFieldId) {\r\n            const startField = iterOrDateFields.find(f => f.name.toLowerCase().includes(\"start\")) || iterOrDateFields[0];\r\n            if (startField) this.startDateFieldId = startField.id;\r\n        }\r\n        if (!this.endDateFieldId) {\r\n            const endField = iterOrDateFields.find(f => f.name.toLowerCase().includes(\"end\")) || iterOrDateFields[1] || iterOrDateFields[0];\r\n            if (endField) this.endDateFieldId = endField.id;\r\n        }\r\n    }\r\n\r\n    private ensureStyles() {\r\n        if (document.getElementById(\"roadmap-styles\")) return;\r\n        const style = document.createElement(\"style\");\r\n        style.id = \"roadmap-styles\";\r\n        style.textContent = `\r\n            .roadmap-root, .roadmap-root * {\r\n                box-sizing: border-box;\r\n            }\r\n            .roadmap-root {\r\n                font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif;\r\n                color: var(--vscode-foreground);\r\n            }\r\n            .roadmap-list-row, .roadmap-grid-row {\r\n                transition: background 0.1s;\r\n                border-bottom: 1px solid var(--vscode-panel-border);\r\n            }\r\n            .roadmap-list-row:hover, .roadmap-grid-row:hover {\r\n                background: var(--vscode-list-hoverBackground);\r\n            }\r\n            .roadmap-list-row {\r\n                border-right: 1px solid var(--vscode-panel-border);\r\n            }\r\n            .roadmap-bar {\r\n                transition: filter 0.2s, box-shadow 0.2s;\r\n            }\r\n            .roadmap-bar:hover {\r\n                filter: brightness(1.1);\r\n                cursor: pointer;\r\n            }\r\n            .roadmap-grid-view::-webkit-scrollbar {\r\n                width: 12px;\r\n                height: 12px;\r\n            }\r\n            .roadmap-grid-view::-webkit-scrollbar-thumb {\r\n                background: var(--vscode-scrollbarSlider-background);\r\n                border-radius: 6px;\r\n                border: 3px solid transparent;\r\n                background-clip: content-box;\r\n            }\r\n            .roadmap-grid-view::-webkit-scrollbar-thumb:hover {\r\n                background: var(--vscode-scrollbarSlider-hoverBackground);\r\n            }\r\n            .roadmap-list-group-header, .roadmap-grid-group-header {\r\n                z-index: 10;\r\n                position: sticky;\r\n                top: 0;\r\n                background: var(--vscode-sideBar-background); /* Added background */\r\n            }\r\n            .roadmap-grid-header {\r\n                height: 32px;\r\n                flex: 0 0 auto;\r\n                border-bottom: 1px solid var(--vscode-panel-border);\r\n                background: var(--vscode-sideBar-background);\r\n                position: sticky;\r\n                top: 0;\r\n                z-index: 20;\r\n                overflow: hidden;\r\n            }\r\n            .gh-count-pill {\r\n                font-weight: 500;\r\n            }\r\n            .roadmap-marker-label {\r\n                position: absolute;\r\n                top: 4px;\r\n                padding: 2px 6px;\r\n                background: #f1f8ff;\r\n                color: #0366d6;\r\n                border: 1px solid #0366d6;\r\n                border-radius: 4px;\r\n                font-size: 10px;\r\n                white-space: nowrap;\r\n                transform: translateX(-50%);\r\n                z-index: 110;\r\n            }\r\n            .roadmap-marker-circle {\r\n                position: absolute;\r\n                top: 32px;\r\n                left: -4px;\r\n                width: 8px;\r\n                height: 8px;\r\n                border-radius: 50%;\r\n                background: #0366d6;\r\n                z-index: 105;\r\n                transform: translateY(-50%);\r\n            }\r\n            .roadmap-marker-triangle {\r\n                position: absolute;\r\n                top: 0;\r\n                left: -6px;\r\n                width: 0;\r\n                height: 0;\r\n                border-left: 6px solid transparent;\r\n                border-right: 6px solid transparent;\r\n                border-top: 8px solid var(--vscode-descriptionForeground);\r\n                z-index: 105;\r\n            }\r\n        `;\r\n        document.head.appendChild(style);\r\n    }\r\n\r\n    private createControlHeader(): HTMLElement {\r\n        const header = document.createElement(\"div\");\r\n        header.className = \"roadmap-controls\";\r\n        header.style.height = \"48px\";\r\n        header.style.display = \"flex\";\r\n        header.style.alignItems = \"center\";\r\n        header.style.padding = \"0 16px\";\r\n        header.style.background = \"var(--vscode-editor-background)\";\r\n\r\n        const leftLabel = document.createElement(\"div\");\r\n        leftLabel.style.fontWeight = \"600\";\r\n        leftLabel.style.fontSize = \"14px\";\r\n        leftLabel.textContent = \"Roadmap\";\r\n        header.appendChild(leftLabel);\r\n\r\n        const spacer = document.createElement(\"div\");\r\n        spacer.style.flex = \"1\";\r\n        header.appendChild(spacer);\r\n\r\n        const btnStyleBase = `\r\n            background: transparent;\r\n            border: 1px solid transparent;\r\n            color: var(--vscode-foreground);\r\n            border-radius: 6px;\r\n            padding: 4px 8px;\r\n            font-size: 13px;\r\n            cursor: pointer;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 6px;\r\n            height: 32px;\r\n            transition: all 0.2s;\r\n        `;\r\n\r\n        const createControlBtn = (label: string, icon: string, onClick: (e: MouseEvent) => void, hasDropdown = false) => {\r\n            const btn = document.createElement(\"button\");\r\n            btn.style.cssText = btnStyleBase;\r\n            const iconSvg = icon ? getIconSvg(icon as any, { size: 16, fill: \"var(--vscode-descriptionForeground)\" }) : \"\";\r\n            const dropdownSvg = hasDropdown ? getIconSvg(\"triangle-down\", { size: 12, fill: \"var(--vscode-descriptionForeground)\" }) : \"\";\r\n            btn.innerHTML = `${iconSvg} <span style=\"font-weight: 500;\">${label}</span> ${dropdownSvg}`;\r\n            btn.onclick = onClick;\r\n            btn.onmouseenter = () => {\r\n                btn.style.background = \"var(--vscode-toolbar-hoverBackground)\";\r\n                btn.style.borderColor = \"var(--vscode-panel-border)\";\r\n            };\r\n            btn.onmouseleave = () => {\r\n                btn.style.background = \"transparent\";\r\n                btn.style.borderColor = \"transparent\";\r\n            };\r\n            return btn;\r\n        };\r\n\r\n        const tools = document.createElement(\"div\");\r\n        tools.style.display = \"flex\";\r\n        tools.style.alignItems = \"center\";\r\n        tools.style.gap = \"4px\";\r\n        header.appendChild(tools);\r\n\r\n        tools.appendChild(createControlBtn(\"Markers\", \"location\", (e) => this.showMarkersMenu(e), true));\r\n        tools.appendChild(createControlBtn(\"Sort\", \"arrow-up-down\", (e) => this.showSortMenu(e), true));\r\n        tools.appendChild(createControlBtn(\"Date fields\", \"calendar\", (e) => this.showDateFieldsMenu(e), true));\r\n\r\n        const zoomLabel = this.zoomLevel.charAt(0).toUpperCase() + this.zoomLevel.slice(1);\r\n        tools.appendChild(createControlBtn(zoomLabel, \"zoom-in\", (e) => this.showZoomMenu(e), true));\r\n\r\n        const todayBtn = document.createElement(\"button\");\r\n        todayBtn.style.cssText = btnStyleBase;\r\n        todayBtn.style.fontWeight = \"600\";\r\n        todayBtn.style.marginRight = \"4px\";\r\n        todayBtn.textContent = \"Today\";\r\n        todayBtn.onclick = () => {\r\n            const gridView = this.container?.querySelector(\".roadmap-grid-view\") as HTMLElement;\r\n            if (gridView) {\r\n                const today = new Date();\r\n                const start = this.getTimelineStart();\r\n                const todayOffset = Math.ceil((today.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) * this.dayWidth;\r\n                gridView.scrollLeft = todayOffset - (gridView.clientWidth / 2);\r\n            }\r\n        };\r\n        tools.appendChild(todayBtn);\r\n\r\n        const navGroup = document.createElement(\"div\");\r\n        navGroup.style.display = \"flex\";\r\n        navGroup.style.gap = \"2px\";\r\n\r\n        const prevBtn = createControlBtn(\"\", \"chevron-left\", () => {\r\n            const gridView = this.container?.querySelector(\".roadmap-grid-view\") as HTMLElement;\r\n            if (gridView) gridView.scrollLeft -= 200;\r\n        });\r\n        const nextBtn = createControlBtn(\"\", \"chevron-right\", () => {\r\n            const gridView = this.container?.querySelector(\".roadmap-grid-view\") as HTMLElement;\r\n            if (gridView) gridView.scrollLeft += 200;\r\n        });\r\n        navGroup.appendChild(prevBtn);\r\n        navGroup.appendChild(nextBtn);\r\n        tools.appendChild(navGroup);\r\n\r\n        return header;\r\n    }\r\n\r\n    public showMarkersMenu(e: MouseEvent): { el: HTMLElement | null; refresh: () => void } | null {\r\n        const options: { id: string; label: string; icon?: string }[] = [{ id: \"milestones\", label: \"Milestones\", icon: \"milestone\" }];\r\n        this.allFields.forEach(f => {\r\n            const type = (f.dataType || f.type || \"\").toLowerCase();\r\n            if (type === \"iteration\" || type === \"date\") {\r\n                options.push({ id: f.id, label: f.name, icon: getIconNameForDataType(type) });\r\n            }\r\n        });\r\n        const created = this.showDropdown(e.currentTarget as HTMLElement, options, this.activeMarkers, (id) => {\r\n            if (this.activeMarkers.includes(id)) this.activeMarkers = this.activeMarkers.filter(m => m !== id);\r\n            else this.activeMarkers.push(id);\r\n            this.renderRoadmap(this.container!, this.lastSnapshot);\r\n            try { window.dispatchEvent(new CustomEvent('roadmap:markersChanged')); } catch (e) { }\r\n        }, true);\r\n        return created || null;\r\n    }\r\n\r\n    private showSortMenu(e: MouseEvent): { el: HTMLElement | null; refresh: () => void } | null {\r\n        const options: { id: string | null; label: string; icon?: string }[] = [{ id: null, label: \"No sorting\" }];\r\n        this.allFields.forEach(f => {\r\n            const icon = getIconNameForDataType(f.dataType || f.type);\r\n            options.push({ id: f.id, label: f.name, icon });\r\n        });\r\n        const created = this.showDropdown(e.currentTarget as HTMLElement, options, [this.activeSortFieldId], (id) => {\r\n            this.activeSortFieldId = id;\r\n            this.renderRoadmap(this.container!, this.lastSnapshot);\r\n        });\r\n        return created || null;\r\n    }\r\n\r\n    private showDateFieldsMenu(e: MouseEvent) {\r\n        const iterAndDateFields = this.allFields.filter(f => {\r\n            const type = (f.dataType || f.type || \"\").toLowerCase();\r\n            return type === \"iteration\" || type === \"date\";\r\n        });\r\n        const menu = document.createElement(\"div\");\r\n        menu.className = \"roadmap-dropdown-menu\";\r\n        menu.style.cssText = `position: fixed; z-index: 1000; background: var(--vscode-menu-background); border: 1px solid var(--vscode-menu-border); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; padding: 8px 0; font-size: 13px; max-height: 400px; overflow-y: auto;`;\r\n\r\n        const renderSection = (title: string, currentId: string | null, onSelect: (id: string) => void, isLast = false) => {\r\n            const header = document.createElement(\"div\");\r\n            header.style.padding = \"4px 12px\"; header.style.fontWeight = \"600\"; header.style.color = \"var(--vscode-descriptionForeground)\"; header.style.fontSize = \"11px\";\r\n            header.textContent = title;\r\n            menu.appendChild(header);\r\n\r\n            iterAndDateFields.forEach(f => {\r\n                const item = document.createElement(\"div\");\r\n                item.style.padding = \"6px 12px 6px 32px\"; item.style.cursor = \"pointer\"; item.style.position = \"relative\"; item.style.display = \"flex\"; item.style.alignItems = \"center\";\r\n                item.onmouseenter = () => item.style.background = \"var(--vscode-menu-selectionBackground)\";\r\n                item.onmouseleave = () => item.style.background = \"transparent\";\r\n\r\n                const typeArr = (f.dataType || f.type || \"\").toLowerCase();\r\n                const icon = getIconNameForDataType(typeArr);\r\n                const sectionLower = title.toLowerCase();\r\n                const suffix = sectionLower.includes(\"start\") ? \"start\" : \"end\";\r\n                const label = typeArr === \"iteration\" ? `${f.name} ${suffix}` : f.name;\r\n\r\n                item.innerHTML = `\r\n                    <div class=\"roadmap-dropdown-check\" style=\"position:absolute; left:10px; display:${f.id === currentId ? \"block\" : \"none\"}\">\r\n                        ${getIconSvg(\"check\", { size: 14, fill: \"var(--vscode-menu-foreground)\" })}\r\n                    </div>\r\n                    <div style=\"margin-right:8px; display:flex; align-items:center;\">\r\n                        ${getIconSvg(icon as any, { size: 14, fill: \"var(--vscode-descriptionForeground)\" })}\r\n                    </div>\r\n                    <span>${label}</span>\r\n                `;\r\n                item.onclick = () => {\r\n                    onSelect(f.id);\r\n                    // update renderer state and keep the menu open so the user can change both Start/End without reopening\r\n                    this.renderRoadmap(this.container!, this.lastSnapshot);\r\n                    try {\r\n                        window.dispatchEvent(new CustomEvent('roadmap:dateFieldsChanged'));\r\n                    } catch (e) { }\r\n                            // Re-render the menu sections so checkmarks and labels update live\r\n                    try {\r\n                        if (menu) {\r\n                            menu.innerHTML = '';\r\n                            renderSection('Start date', this.startDateFieldId, (id: string) => this.startDateFieldId = id);\r\n                            renderSection('End date', this.endDateFieldId, (id: string) => this.endDateFieldId = id, true);\r\n\r\n                            // reposition menu in case size changed\r\n                            const rect = anchorRect;\r\n                            const menuRect = menu.getBoundingClientRect();\r\n                            const vw = window.innerWidth || document.documentElement.clientWidth;\r\n                            let left = rect.right + 4;\r\n                            if (left + menuRect.width > vw) {\r\n                                left = rect.left - menuRect.width - 4;\r\n                                if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n                            }\r\n                            menu.style.left = `${Math.round(left)}px`;\r\n                            menu.style.top = `${Math.round(rect.bottom + 4)}px`;\r\n                        }\r\n                    } catch (e) { }\r\n                };\r\n                menu.appendChild(item);\r\n            });\r\n\r\n            if (!isLast) {\r\n                const divider = document.createElement(\"div\");\r\n                divider.style.height = \"1px\"; divider.style.background = \"var(--vscode-menu-border)\"; divider.style.margin = \"4px 0\";\r\n                menu.appendChild(divider);\r\n            }\r\n        };\r\n\r\n        renderSection(\"Start date\", this.startDateFieldId, (id) => this.startDateFieldId = id);\r\n        renderSection(\"End date\", this.endDateFieldId, (id) => this.endDateFieldId = id, true);\r\n\r\n        const anchor = (e.currentTarget as HTMLElement);\r\n        // If the anchor has been removed from the DOM (parent menus sometimes recreate controls),\r\n        // fall back to the pointer coordinates so the menu doesn't appear at 0,0.\r\n        const getAnchorRectOrFallback = (): { top: number; bottom: number; left: number; right: number } => {\r\n            try {\r\n                if (anchor && typeof (anchor as any).getBoundingClientRect === 'function') {\r\n                    return (anchor as any).getBoundingClientRect();\r\n                }\r\n            } catch (e) { }\r\n            return { top: (e as MouseEvent).clientY || 4, bottom: (e as MouseEvent).clientY || 4, left: (e as MouseEvent).clientX || 4, right: (e as MouseEvent).clientX || 4 };\r\n        };\r\n\r\n        menu.dataset.menuType = 'roadmap-dropdown';\r\n        // append first so measurements (width/height) are accurate\r\n        document.body.appendChild(menu);\r\n        let anchorRect = getAnchorRectOrFallback();\r\n        // If anchor rect seems invalid (very small), try fallback ancestors or clientRects\r\n        try {\r\n            if (anchorRect && Math.abs((anchorRect.right || 0) - (anchorRect.left || 0)) < 2) {\r\n                const clientRects = (anchor && (anchor.getClientRects && anchor.getClientRects())) || null;\r\n                if (clientRects && clientRects.length > 0) anchorRect = clientRects[0] as DOMRect;\r\n                else if (anchor && (anchor.closest || anchor.parentElement)) {\r\n                    const anc = anchor.closest && anchor.closest('.roadmap-controls') ? anchor.closest('.roadmap-controls') as HTMLElement : anchor.parentElement;\r\n                    if (anc) anchorRect = anc.getBoundingClientRect();\r\n                }\r\n            }\r\n        } catch (e) { }\r\n        // position below the anchor by default, then prefer to open to the right of the parent menu\r\n        menu.style.top = (anchorRect.bottom + 4) + \"px\";\r\n        const menuRect = menu.getBoundingClientRect();\r\n        const vw = window.innerWidth || document.documentElement.clientWidth;\r\n        let left = anchorRect.right + 4;\r\n        if (left + menuRect.width > vw) {\r\n            // try opening to the left of the parent menu\r\n            left = anchorRect.left - menuRect.width - 4;\r\n            if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, anchorRect.right - menuRect.width));\r\n        }\r\n        menu.style.left = `${Math.round(left)}px`;\r\n\r\n        const closer = (ev: MouseEvent) => {\r\n            if (!menu.contains(ev.target as Node)) {\r\n                if (document.body.contains(menu)) document.body.removeChild(menu);\r\n                window.removeEventListener(\"mousedown\", closer);\r\n            }\r\n        };\r\n        setTimeout(() => window.addEventListener(\"mousedown\", closer), 0);\r\n        try {\r\n            MenuManager.register(menu, () => {\r\n                try {\r\n                                    const rect = anchorRect;\r\n                                    const menuRect = menu.getBoundingClientRect();\r\n                                    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n                                    let left = rect.right + 4;\r\n                                    if (left + menuRect.width > vw) {\r\n                                        left = rect.left - menuRect.width - 4;\r\n                                        if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n                                    }\r\n                                    menu.style.left = `${Math.round(left)}px`;\r\n                                    menu.style.top = `${Math.round(rect.bottom + 4)}px`;\r\n                        } catch (e) { }\r\n            });\r\n        } catch (e) { }\r\n            return { el: menu, refresh: () => {\r\n                try {\r\n                    const rect = anchorRect;\r\n                    const menuRect = menu.getBoundingClientRect();\r\n                    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n                    let left = rect.right + 4;\r\n                    if (left + menuRect.width > vw) {\r\n                        left = rect.left - menuRect.width - 4;\r\n                        if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n                    }\r\n                    menu.style.left = `${Math.round(left)}px`;\r\n                    menu.style.top = `${Math.round(rect.bottom + 4)}px`;\r\n                } catch (e) { }\r\n            } };\r\n    }\r\n\r\n    private showZoomMenu(e: MouseEvent): { el: HTMLElement | null; refresh: () => void } | null {\r\n        const options: { id: ZoomLevel; label: string }[] = [\r\n            { id: \"month\", label: \"Month\" },\r\n            { id: \"quarter\", label: \"Quarter\" },\r\n            { id: \"year\", label: \"Year\" }\r\n        ];\r\n\r\n        const menu = document.createElement(\"div\");\r\n        menu.className = \"roadmap-dropdown-menu\";\r\n        menu.style.cssText = `position: fixed; z-index: 1000; background: var(--vscode-menu-background); border: 1px solid var(--vscode-menu-border); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 160px; padding: 4px 0; font-size: 13px;`;\r\n\r\n        options.forEach(opt => {\r\n            const item = document.createElement(\"div\");\r\n            item.style.padding = \"6px 12px 6px 32px\"; item.style.cursor = \"pointer\"; item.style.position = \"relative\"; item.style.display = \"flex\"; item.style.alignItems = \"center\";\r\n            item.onmouseenter = () => item.style.background = \"var(--vscode-menu-selectionBackground)\";\r\n            item.onmouseleave = () => item.style.background = \"transparent\";\r\n\r\n            const isSelected = this.zoomLevel === opt.id;\r\n            item.innerHTML = `\r\n                <div class=\"roadmap-dropdown-check\" style=\"position:absolute; left:10px; display:${isSelected ? \"block\" : \"none\"}\">\r\n                    ${getIconSvg(\"check\", { size: 14, fill: \"var(--vscode-menu-foreground)\" })}\r\n                </div>\r\n                <span style=\"flex:1\">${opt.label}</span>\r\n            `;\r\n\r\n            item.onclick = () => {\r\n                this.zoomLevel = opt.id;\r\n                this.updateZoomSettings();\r\n                this.renderRoadmap(this.container!, this.lastSnapshot);\r\n                try { window.dispatchEvent(new CustomEvent('roadmap:zoomChanged')); } catch (e) { }\r\n                if (document.body.contains(menu)) document.body.removeChild(menu);\r\n            };\r\n            menu.appendChild(item);\r\n        });\r\n\r\n        const anchor = (e.currentTarget as HTMLElement);\r\n        const rect = (anchor && document.body.contains(anchor)) ? anchor.getBoundingClientRect() : { top: (e as MouseEvent).clientY || 4, bottom: (e as MouseEvent).clientY || 4, left: (e as MouseEvent).clientX || 4, right: (e as MouseEvent).clientX || 4 };\r\n        menu.dataset.menuType = 'roadmap-dropdown';\r\n        menu.style.top = (rect.bottom + 4) + \"px\";\r\n        document.body.appendChild(menu);\r\n        try { MenuManager.register(menu, () => {\r\n            try {\r\n                const r = (anchor && document.body.contains(anchor)) ? anchor.getBoundingClientRect() : rect;\r\n                const menuRect = menu.getBoundingClientRect();\r\n                const vw = window.innerWidth || document.documentElement.clientWidth;\r\n                let left = r.right + 4;\r\n                if (left + menuRect.width > vw) {\r\n                    left = r.left - menuRect.width - 4;\r\n                    if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, r.right - menuRect.width));\r\n                }\r\n                menu.style.left = `${Math.round(left)}px`;\r\n                menu.style.top = `${Math.round(r.bottom + 4)}px`;\r\n            } catch (e) { }\r\n        }); } catch (e) { }\r\n        const menuRect = menu.getBoundingClientRect();\r\n        const vw = window.innerWidth || document.documentElement.clientWidth;\r\n        let left = rect.right + 4;\r\n        if (left + menuRect.width > vw) {\r\n            left = rect.left - menuRect.width - 4;\r\n            if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n        }\r\n        menu.style.left = `${Math.round(left)}px`;\r\n\r\n        const closer = (ev: MouseEvent) => {\r\n            if (!menu.contains(ev.target as Node)) {\r\n                if (document.body.contains(menu)) document.body.removeChild(menu);\r\n                window.removeEventListener(\"mousedown\", closer);\r\n            }\r\n        };\r\n        setTimeout(() => window.addEventListener(\"mousedown\", closer), 0);\r\n        return { el: menu, refresh: () => {\r\n            try {\r\n                const r = (anchor && document.body.contains(anchor)) ? anchor.getBoundingClientRect() : rect;\r\n                const menuRect = menu.getBoundingClientRect();\r\n                const vw2 = window.innerWidth || document.documentElement.clientWidth;\r\n                let left = r.right + 4;\r\n                if (left + menuRect.width > vw2) {\r\n                    left = r.left - menuRect.width - 4;\r\n                    if (left < 4) left = Math.max(4, Math.min(vw2 - menuRect.width - 4, r.right - menuRect.width));\r\n                }\r\n                menu.style.left = `${Math.round(left)}px`;\r\n                menu.style.top = `${Math.round(r.bottom + 4)}px`;\r\n            } catch (e) { }\r\n        } };\r\n    }\r\n\r\n    private showDropdown(anchor: HTMLElement, options: { id: any; label: string; icon?: string }[], activeIds: any[], onSelect: (id: any) => void, multi = false): { el: HTMLElement; refresh: () => void } {\r\n        const menu = document.createElement(\"div\");\r\n        menu.className = \"roadmap-dropdown-menu\";\r\n        menu.style.cssText = `position: fixed; z-index: 1000; background: var(--vscode-menu-background); border: 1px solid var(--vscode-menu-border); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 180px; padding: 4px 0; font-size: 13px; max-height: 400px; overflow-y: auto;`;\r\n\r\n        options.forEach(opt => {\r\n            const item = document.createElement(\"div\");\r\n            item.style.padding = \"6px 12px 6px 32px\"; item.style.cursor = \"pointer\"; item.style.position = \"relative\"; item.style.display = \"flex\"; item.style.alignItems = \"center\";\r\n            item.onmouseenter = () => item.style.background = \"var(--vscode-menu-selectionBackground)\";\r\n            item.onmouseleave = () => item.style.background = \"transparent\";\r\n\r\n            const isSelected = activeIds.includes(opt.id);\r\n            item.innerHTML = `\r\n                <div class=\"roadmap-dropdown-check\" style=\"position:absolute; left:10px; display:${isSelected ? \"block\" : \"none\"}\">\r\n                    ${getIconSvg(\"check\", { size: 14, fill: \"var(--vscode-menu-foreground)\" })}\r\n                </div>\r\n                ${opt.icon ? `<div style=\"margin-right:8px; display:flex; align-items:center;\">${getIconSvg(opt.icon as any, { size: 14, fill: \"var(--vscode-descriptionForeground)\" })}</div>` : \"\"}\r\n                <span>${opt.label}</span>\r\n            `;\r\n\r\n            item.onclick = (ev) => {\r\n                onSelect(opt.id);\r\n                if (!multi) {\r\n                    if (document.body.contains(menu)) document.body.removeChild(menu);\r\n                } else {\r\n                    const check = item.querySelector(\".roadmap-dropdown-check\") as HTMLElement;\r\n                    if (check) check.style.display = check.style.display === \"none\" ? \"block\" : \"none\";\r\n                }\r\n                ev.stopPropagation();\r\n            };\r\n            menu.appendChild(item);\r\n        });\r\n\r\n        const rect = anchor.getBoundingClientRect();\r\n        menu.style.top = (rect.bottom + 4) + \"px\";\r\n\r\n        // append first so getBoundingClientRect() returns a real width\r\n        document.body.appendChild(menu);\r\n        const menuRect = menu.getBoundingClientRect();\r\n        const vw = window.innerWidth || document.documentElement.clientWidth;\r\n        let left = rect.right + 4;\r\n        if (left + menuRect.width > vw) {\r\n            left = rect.left - menuRect.width - 4;\r\n            if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n        }\r\n        menu.style.left = `${Math.round(left)}px`;\r\n\r\n        const closer = (ev: MouseEvent) => {\r\n            if (!menu.contains(ev.target as Node)) {\r\n                if (document.body.contains(menu)) document.body.removeChild(menu);\r\n                window.removeEventListener(\"mousedown\", closer);\r\n            }\r\n        };\r\n        setTimeout(() => window.addEventListener(\"mousedown\", closer), 0);\r\n        try { MenuManager.register(menu, () => {\r\n            try {\r\n                const rect = anchor.getBoundingClientRect();\r\n                const menuRect = menu.getBoundingClientRect();\r\n                const vw = window.innerWidth || document.documentElement.clientWidth;\r\n                let left = rect.right + 4;\r\n                if (left + menuRect.width > vw) {\r\n                    left = rect.left - menuRect.width - 4;\r\n                    if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n                }\r\n                menu.style.left = `${Math.round(left)}px`;\r\n                menu.style.top = `${Math.round(rect.bottom + 4)}px`;\r\n            } catch (e) { }\r\n        }); } catch (e) { }\r\n        return { el: menu, refresh: () => {\r\n            try {\r\n                const rect = anchor.getBoundingClientRect();\r\n                const menuRect = menu.getBoundingClientRect();\r\n                const vw = window.innerWidth || document.documentElement.clientWidth;\r\n                let left = rect.right + 4;\r\n                if (left + menuRect.width > vw) {\r\n                    left = rect.left - menuRect.width - 4;\r\n                    if (left < 4) left = Math.max(4, Math.min(vw - menuRect.width - 4, rect.right - menuRect.width));\r\n                }\r\n                menu.style.left = `${Math.round(left)}px`;\r\n                menu.style.top = `${Math.round(rect.bottom + 4)}px`;\r\n            } catch (e) { }\r\n        } };\r\n    }\r\n\r\n    private getTimelineStart(): Date {\r\n        const dates = this.items.flatMap(it => [this.getDateFieldValue(it, \"start\"), this.getDateFieldValue(it, \"end\")]).filter(d => !!d);\r\n        let start = dates.length ? new Date(Math.min(...dates.map(d => d.getTime()))) : new Date();\r\n        start.setMonth(start.getMonth() - 1);\r\n        start.setDate(1);\r\n        start.setHours(0, 0, 0, 0);\r\n        return start;\r\n    }\r\n\r\n    private createTimelineHeader(): HTMLElement {\r\n        const header = document.createElement(\"div\");\r\n        header.className = \"roadmap-grid-header\";\r\n        header.style.height = \"32px\";\r\n        header.style.borderBottom = \"1px solid var(--vscode-panel-border)\";\r\n        header.style.position = \"sticky\";\r\n        header.style.top = \"0\";\r\n        header.style.zIndex = \"20\";\r\n        header.style.background = \"var(--vscode-sideBar-background)\";\r\n        header.style.display = \"flex\";\r\n        header.style.overflow = \"hidden\";\r\n        return header;\r\n    }\r\n\r\n    private renderGroups(listView: HTMLElement, gridView: HTMLElement, groups: any[], groupingField: any) {\r\n        listView.innerHTML = \"\";\r\n        gridView.innerHTML = \"\";\r\n\r\n        const gridContent = document.createElement(\"div\");\r\n        gridContent.className = \"roadmap-grid-content\";\r\n        gridContent.style.position = \"relative\";\r\n        gridView.appendChild(gridContent);\r\n\r\n        const start = this.getTimelineStart();\r\n        const dates = this.items.flatMap(it => [this.getDateFieldValue(it, \"start\"), this.getDateFieldValue(it, \"end\")]).filter(d => !!d);\r\n\r\n        let end = dates.length ? new Date(Math.max(...dates.map(d => d.getTime()))) : new Date();\r\n        const futureMonths = this.zoomLevel === \"year\" ? 12 : 6;\r\n        end.setMonth(end.getMonth() + futureMonths);\r\n        end.setDate(1);\r\n        end.setHours(0, 0, 0, 0);\r\n\r\n        const totalWidth = this.calculateOffset(end, start);\r\n        gridContent.style.width = totalWidth + \"px\";\r\n\r\n        const gridHeader = this.container?.querySelector(\".roadmap-grid-header\") as HTMLElement;\r\n        gridHeader.innerHTML = \"\";\r\n        const headerScroll = document.createElement(\"div\");\r\n        headerScroll.style.width = totalWidth + \"px\";\r\n        headerScroll.style.flexShrink = \"0\";\r\n        headerScroll.style.display = \"flex\";\r\n        headerScroll.style.height = \"100%\";\r\n        gridHeader.appendChild(headerScroll);\r\n\r\n        const gridLines = document.createElement(\"div\");\r\n        gridLines.className = \"roadmap-grid-lines\";\r\n        gridLines.style.position = \"absolute\";\r\n        gridLines.style.top = \"0\"; gridLines.style.left = \"0\"; gridLines.style.height = \"100%\"; gridLines.style.width = \"100%\"; gridLines.style.pointerEvents = \"none\"; gridLines.style.zIndex = \"0\";\r\n        gridContent.appendChild(gridLines);\r\n\r\n        let iter = new Date(start);\r\n        while (iter < end) {\r\n            const mStart = new Date(iter);\r\n            const mEnd = new Date(iter.getFullYear(), iter.getMonth() + 1, 1);\r\n            const mStartOffset = this.calculateOffset(mStart, start);\r\n            const mEndOffset = this.calculateOffset(mEnd, start);\r\n            const mWidth = mEndOffset - mStartOffset;\r\n\r\n            const m = document.createElement(\"div\");\r\n            m.className = \"roadmap-month-label\";\r\n            m.style.flex = `0 0 ${mWidth}px`;\r\n            m.style.borderRight = \"1px solid var(--vscode-panel-border)\";\r\n            m.style.background = \"var(--vscode-sideBar-background)\";\r\n            m.style.fontSize = \"12px\"; m.style.padding = \"7px 12px\"; m.style.fontWeight = \"600\"; m.style.color = \"var(--vscode-foreground)\";\r\n            let label = (this.zoomLevel === \"year\") ? iter.toLocaleDateString(\"default\", { month: \"short\" }) : iter.toLocaleDateString(\"default\", { month: \"long\", year: \"numeric\" });\r\n            if (this.zoomLevel === \"year\" && iter.getMonth() === 0) label = iter.getFullYear().toString();\r\n            m.textContent = label;\r\n            headerScroll.appendChild(m);\r\n\r\n            const line = document.createElement(\"div\");\r\n            line.style.position = \"absolute\";\r\n            line.style.left = mStartOffset + \"px\";\r\n            line.style.height = \"100%\"; line.style.borderLeft = \"1px solid var(--vscode-panel-border)\"; line.style.opacity = \"0.2\";\r\n            gridLines.appendChild(line);\r\n            iter = mEnd;\r\n        }\r\n\r\n        this.renderMarkers(gridContent, start, end);\r\n        gridView.onscroll = () => { gridHeader.scrollLeft = gridView.scrollLeft; };\r\n\r\n        const rowHeight = 40;\r\n        let globalIndex = 1;\r\n\r\n        groups.forEach(group => {\r\n            const groupId = String(group.option.id || \"unassigned\");\r\n            const isCollapsed = this.collapsedGroups.has(groupId);\r\n\r\n            if (groupingField) {\r\n                // Use buildGroupHeaderElement directly without wrapping in another container\r\n                // This fixes the duplicate header issue\r\n                const listGroupHeader = buildGroupHeaderElement(this.allFields, this.items, group, groupingField, { groupDivisors: this.groupDivisors });\r\n                listGroupHeader.classList.add(\"roadmap-list-group-header\");\r\n                // Apply roadmap-specific styles to the element\r\n                listGroupHeader.style.position = \"sticky\";\r\n                listGroupHeader.style.top = \"0\";\r\n                listGroupHeader.style.zIndex = \"10\";\r\n                listGroupHeader.style.borderBottom = \"1px solid var(--vscode-panel-border)\";\r\n                listGroupHeader.style.height = \"32px\";\r\n                listGroupHeader.style.padding = \"0 8px\";\r\n\r\n                // Wire toggle for collapse/expand\r\n                const toggle = listGroupHeader.querySelector('.group-toggle') as HTMLElement | null;\r\n                if (toggle) {\r\n                    // Update toggle icon based on collapsed state\r\n                    if (isCollapsed) {\r\n                        toggle.innerHTML = getIconSvg(\"triangle-right\", { size: 16, fill: \"var(--vscode-descriptionForeground)\" });\r\n                    }\r\n                    toggle.addEventListener('click', (e) => {\r\n                        e.stopPropagation();\r\n                        if (isCollapsed) this.collapsedGroups.delete(groupId); else this.collapsedGroups.add(groupId);\r\n                        this.renderRoadmap(this.container!, this.lastSnapshot);\r\n                    });\r\n                }\r\n\r\n                // Allow clicking the entire header to toggle\r\n                listGroupHeader.style.cursor = \"pointer\";\r\n                listGroupHeader.addEventListener('click', () => {\r\n                    if (isCollapsed) this.collapsedGroups.delete(groupId); else this.collapsedGroups.add(groupId);\r\n                    this.renderRoadmap(this.container!, this.lastSnapshot);\r\n                });\r\n\r\n                listView.appendChild(listGroupHeader);\r\n\r\n                // Create an empty grid header (timeline area) - height matched to list header\r\n                const gridGroupHeader = document.createElement(\"div\");\r\n                gridGroupHeader.className = \"roadmap-grid-group-header\";\r\n                gridGroupHeader.style.height = \"32px\";\r\n                gridGroupHeader.style.borderBottom = \"1px solid var(--vscode-panel-border)\";\r\n                gridGroupHeader.style.background = \"var(--vscode-sideBar-background)\";\r\n                // Wire click on grid header to toggle as well\r\n                gridGroupHeader.addEventListener('click', () => {\r\n                    if (isCollapsed) this.collapsedGroups.delete(groupId); else this.collapsedGroups.add(groupId);\r\n                    this.renderRoadmap(this.container!, this.lastSnapshot);\r\n                });\r\n                gridContent.appendChild(gridGroupHeader);\r\n            }\r\n\r\n            if (!isCollapsed) {\r\n                group.items.forEach((gi: any) => {\r\n                    const item = gi.item;\r\n                    const listRow = document.createElement(\"div\");\r\n                    listRow.className = \"roadmap-list-row\";\r\n                    listRow.style.height = rowHeight + \"px\"; listRow.style.display = \"flex\"; listRow.style.alignItems = \"center\"; listRow.style.padding = \"0\";\r\n\r\n                    const rowNum = document.createElement(\"div\");\r\n                    rowNum.style.width = \"40px\"; rowNum.style.textAlign = \"center\"; rowNum.style.fontSize = \"11px\"; rowNum.style.color = \"var(--vscode-descriptionForeground)\";\r\n                    rowNum.textContent = String(globalIndex++);\r\n                    listRow.appendChild(rowNum);\r\n\r\n                    const contentWrapper = document.createElement(\"div\");\r\n                    contentWrapper.style.display = \"flex\"; contentWrapper.style.alignItems = \"center\"; contentWrapper.style.flex = \"1\"; contentWrapper.style.overflow = \"hidden\"; contentWrapper.style.padding = \"0 8px\"; contentWrapper.style.gap = \"8px\";\r\n\r\n                    const titleField = this.allFields.find(f => f.name.toLowerCase() === \"title\");\r\n                    const titleFv = item.fieldValues.find((v: any) => v.fieldId === titleField?.id) || { value: item.title, type: \"title\" };\r\n                    const assigneesField = this.allFields.find(f => (f.dataType || f.type || \"\").toLowerCase() === \"assignees\");\r\n                    const assigneesFv = item.fieldValues.find((v: any) => v.fieldId === assigneesField?.id);\r\n\r\n                    contentWrapper.innerHTML = `<div style=\"display:flex; align-items:center; gap:8px; overflow:hidden; flex:1;\">${renderCell(titleFv, titleField, item, this.items)}</div>`;\r\n                    listRow.appendChild(contentWrapper);\r\n                    listView.appendChild(listRow);\r\n\r\n                    const gridRow = document.createElement(\"div\");\r\n                    gridRow.className = \"roadmap-grid-row\";\r\n                    gridRow.style.height = rowHeight + \"px\"; gridRow.style.position = \"relative\";\r\n                    gridContent.appendChild(gridRow);\r\n\r\n                    listRow.onmouseenter = () => gridRow.style.background = \"var(--vscode-list-hoverBackground)\";\r\n                    listRow.onmouseleave = () => gridRow.style.background = \"transparent\";\r\n                    gridRow.onmouseenter = () => listRow.style.background = \"var(--vscode-list-hoverBackground)\";\r\n                    gridRow.onmouseleave = () => listRow.style.background = \"transparent\";\r\n\r\n                    const iStart = this.getDateFieldValue(item, \"start\");\r\n                    const iEnd = this.getDateFieldValue(item, \"end\");\r\n                    if (iStart) {\r\n                        const startOffset = this.calculateOffset(iStart, start);\r\n                        const duration = iEnd ? Math.max(1, Math.round((iEnd.getTime() - iStart.getTime()) / (1000 * 60 * 60 * 24))) : 14;\r\n                        const barWidth = Math.max(40, duration * this.dayWidth);\r\n                        const bar = document.createElement(\"div\");\r\n                        bar.className = \"roadmap-bar\";\r\n                        bar.style.position = \"absolute\"; bar.style.left = startOffset + \"px\"; bar.style.top = \"6px\"; bar.style.height = \"28px\"; bar.style.minWidth = barWidth + \"px\"; bar.style.background = \"var(--vscode-sideBar-background)\"; bar.style.border = \"1px solid var(--vscode-panel-border)\"; bar.style.borderRadius = \"14px\"; bar.style.display = \"flex\"; bar.style.alignItems = \"center\"; bar.style.zIndex = \"2\"; bar.style.fontSize = \"12px\"; bar.style.overflow = \"hidden\";\r\n\r\n                        const iStartStr = iStart.toLocaleDateString([], { month: 'short', day: 'numeric', year: 'numeric' });\r\n                        const iEndStr = iEnd ? iEnd.toLocaleDateString([], { month: 'short', day: 'numeric', year: 'numeric' }) : \"No end date\";\r\n                        bar.title = `${item.title || \"Item\"} (${iStartStr} - ${iEndStr})`;\r\n\r\n                        const stickyContent = document.createElement(\"div\");\r\n                        // Use a flexible container so content can grow or shrink with the bar\r\n                        stickyContent.style.position = \"relative\";\r\n                        stickyContent.style.padding = \"0 8px\";\r\n                        stickyContent.style.display = \"flex\";\r\n                        stickyContent.style.alignItems = \"center\";\r\n                        stickyContent.style.gap = \"6px\";\r\n                        stickyContent.style.whiteSpace = \"nowrap\";\r\n                        stickyContent.style.flex = \"1 1 auto\";\r\n                        stickyContent.style.minWidth = \"0\";\r\n\r\n                        // For the bar, we only show avatars if available, otherwise just title\r\n                        // This matches \"avatar should appear ONLY on the line element\" (interpreted as no text for assignees on the bar)\r\n                        const avatarOnlyRenderer = (fv: any, field: any) => {\r\n                            try {\r\n                                if (!fv || (field?.dataType || field?.type)?.toLowerCase() !== \"assignees\") return renderCell(fv, field, item, this.items);\r\n                                const assignees = fv.assignees || [];\r\n                                if (assignees.length === 0) return \"\";\r\n                                // Safely parse rendered HTML and extract avatar node (img/svg) if present\r\n                                const html = renderCell(fv, field, item, this.items);\r\n                                const tmp = document.createElement('div');\r\n                                tmp.innerHTML = html;\r\n                                const avatarEl = tmp.querySelector('img') || tmp.querySelector('svg') || tmp.querySelector('.avatar') || tmp.firstElementChild;\r\n                                if (avatarEl) return `<div style=\"display:flex; align-items:center;\">${(avatarEl as HTMLElement).outerHTML}</div>`;\r\n                            } catch (e) { }\r\n                            return '';\r\n                        };\r\n\r\n                        stickyContent.innerHTML = `<div style=\"flex:1; min-width:0; display:flex; align-items:center; gap:6px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;\">${renderCell(titleFv, titleField, item, this.items)}</div>${assigneesFv ? `<div style=\"margin-left:auto; display:flex;\">${avatarOnlyRenderer(assigneesFv, assigneesField)}</div>` : \"\"}`;\r\n\r\n                        // Render content inside the date-span `bar` (original behavior)\r\n                        // so the DOM structure and visuals remain unchanged.\r\n                        stickyContent.style.position = 'relative';\r\n                        stickyContent.style.left = '0';\r\n                        stickyContent.style.width = '100%';\r\n                        stickyContent.style.boxSizing = 'border-box';\r\n                        bar.appendChild(stickyContent);\r\n\r\n                        if (item.url) bar.onclick = () => this.onAction(\"openUrl\", item, {});\r\n                        gridRow.appendChild(bar);\r\n                        // Use minWidth on the bar to represent the date-span without forcing an inline width mutation\r\n                    }\r\n                });\r\n\r\n                const addItemRow = document.createElement(\"div\");\r\n                addItemRow.style.height = \"32px\"; addItemRow.style.display = \"flex\"; addItemRow.style.alignItems = \"center\"; addItemRow.style.padding = \"0 8px\"; addItemRow.style.cursor = \"pointer\"; addItemRow.style.color = \"var(--vscode-descriptionForeground)\";\r\n                const plusIcon = getIconSvg(\"plus\", { size: 16, fill: \"currentColor\" });\r\n                addItemRow.innerHTML = `<div style=\"width:40px; display:flex; justify-content:center;\">${plusIcon}</div><span style=\"font-size:13px; opacity: 0.8;\">Add item</span>`;\r\n                addItemRow.onclick = () => this.onAction(\"addItem\", { groupId: group.option.id }, {});\r\n                listView.appendChild(addItemRow);\r\n\r\n                const gridAddRow = document.createElement(\"div\");\r\n                gridAddRow.className = \"roadmap-grid-row\";\r\n                gridAddRow.style.height = \"32px\"; gridAddRow.style.borderBottom = \"1px solid var(--vscode-panel-border)\";\r\n                gridContent.appendChild(gridAddRow);\r\n                addItemRow.onmouseenter = () => gridAddRow.style.background = \"var(--vscode-list-hoverBackground)\";\r\n                addItemRow.onmouseleave = () => gridAddRow.style.background = \"transparent\";\r\n            }\r\n        });\r\n    }\r\n\r\n    private getDateFieldValue(item: any, type: \"start\" | \"end\"): Date | null {\r\n        const fieldId = type === \"start\" ? this.startDateFieldId : this.endDateFieldId;\r\n        const field = fieldId ? this.allFields.find(f => String(f.id) === String(fieldId)) : null;\r\n        if (!field) return null;\r\n\r\n        const fv = item.fieldValues.find((v: any) => String(v.fieldId) === String(field.id));\r\n        if (!fv) return null;\r\n\r\n        let date: Date | null = null;\r\n        if (fv.date) {\r\n            date = new Date(fv.date);\r\n        } else if (fv.iterationId && field.configuration?.iterations) {\r\n            const iter = field.configuration.iterations.find((i: any) => i.id === fv.iterationId);\r\n            if (iter) {\r\n                date = new Date(iter.startDate);\r\n                if (type === \"end\") {\r\n                    date.setDate(date.getDate() + (iter.duration || 14));\r\n                }\r\n            }\r\n        }\r\n\r\n        if (date) {\r\n            date.setHours(0, 0, 0, 0); // Normalize to midnight\r\n        }\r\n        return date;\r\n    }\r\n\r\n    private calculateOffset(date: Date, start: Date): number {\r\n        const d = new Date(date);\r\n        d.setHours(0, 0, 0, 0);\r\n        const s = new Date(start);\r\n        s.setHours(0, 0, 0, 0);\r\n        const diff = d.getTime() - s.getTime();\r\n        return Math.round(diff / (1000 * 60 * 60 * 24)) * this.dayWidth;\r\n    }\r\n\r\n    public applyFilter(matchedIds: Set<string>) {\r\n        if (!this.container) return;\r\n        const rows = this.container.querySelectorAll(\"[data-gh-item-id]\");\r\n        rows.forEach(r => {\r\n            const el = r as HTMLElement; const id = el.getAttribute(\"data-gh-item-id\");\r\n            if (id) el.style.display = matchedIds.has(id) ? \"flex\" : \"none\";\r\n        });\r\n    }\r\n\r\n    private renderMarkers(gridContent: HTMLElement, start: Date, end: Date) {\r\n        // 1. Today Marker (Always active for now, or tied to milestones toggle)\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        if (today >= start && today <= end) {\r\n            const todayOffset = this.calculateOffset(today, start);\r\n            const markerLine = document.createElement(\"div\");\r\n            markerLine.style.position = \"absolute\"; markerLine.style.left = (todayOffset - 1) + \"px\"; markerLine.style.top = \"0\"; markerLine.style.height = \"100%\"; markerLine.style.width = \"2px\"; markerLine.style.background = \"#fd8c73\"; markerLine.style.zIndex = \"100\"; markerLine.style.pointerEvents = \"none\";\r\n            gridContent.appendChild(markerLine);\r\n            const nub = document.createElement(\"div\");\r\n            nub.style.position = \"absolute\"; nub.style.top = \"-4px\"; nub.style.left = \"-3px\"; nub.style.width = \"8px\"; nub.style.height = \"8px\"; nub.style.borderRadius = \"50%\"; nub.style.background = \"#fd8c73\";\r\n            markerLine.appendChild(nub);\r\n        }\r\n\r\n        // 2. Milestone Markers\r\n        if (this.activeMarkers.includes(\"milestones\")) {\r\n            const milestoneField = this.allFields.find(f => {\r\n                const type = (f.dataType || f.type || \"\").toLowerCase();\r\n                return type === \"milestone\" || f.name.toLowerCase() === \"milestone\";\r\n            });\r\n            const milestones = new Map<string, Date>();\r\n\r\n            this.items.forEach(item => {\r\n                const fv = item.fieldValues.find((v: any) => v.fieldId === milestoneField?.id);\r\n                if (fv?.milestone?.dueDate) {\r\n                    milestones.set(fv.milestone.id, new Date(fv.milestone.dueDate));\r\n                }\r\n            });\r\n\r\n            milestones.forEach((date) => {\r\n                date.setHours(0, 0, 0, 0);\r\n                if (date >= start && date <= end) {\r\n                    const offset = this.calculateOffset(date, start);\r\n                    const line = document.createElement(\"div\");\r\n                    line.style.position = \"absolute\"; line.style.left = offset + \"px\"; line.style.top = \"0\"; line.style.height = \"100%\"; line.style.borderLeft = \"1px dashed var(--vscode-descriptionForeground)\"; line.style.zIndex = \"10\"; line.style.pointerEvents = \"none\";\r\n                    gridContent.appendChild(line);\r\n\r\n                    const diamond = document.createElement(\"div\");\r\n                    diamond.style.position = \"absolute\"; diamond.style.top = \"0\"; diamond.style.left = \"-4px\"; diamond.style.width = \"8px\"; diamond.style.height = \"8px\"; diamond.style.background = \"var(--vscode-descriptionForeground)\"; diamond.style.transform = \"rotate(45deg)\"; diamond.style.zIndex = \"11\";\r\n                    line.appendChild(diamond);\r\n                }\r\n            });\r\n        }\r\n\r\n        // 3. Iteration Boundaries and Date Field Markers\r\n        this.activeMarkers.forEach(markerId => {\r\n            const field = this.allFields.find(f => String(f.id) === String(markerId));\r\n            if (!field) return;\r\n\r\n            const type = (field.dataType || field.type || \"\").toLowerCase();\r\n            if (type === \"iteration\" && field.configuration?.iterations) {\r\n                field.configuration.iterations.forEach((iter: any) => {\r\n                    const iStart = new Date(iter.startDate);\r\n                    iStart.setHours(0, 0, 0, 0);\r\n                    if (iStart >= start && iStart <= end) {\r\n                        const offset = this.calculateOffset(iStart, start);\r\n                        const line = document.createElement(\"div\");\r\n                        line.style.position = \"absolute\"; line.style.left = offset + \"px\"; line.style.top = \"0\"; line.style.height = \"100%\"; line.style.borderLeft = \"2px solid #0366d6\"; line.style.opacity = \"0.7\"; line.style.zIndex = \"10\"; line.style.pointerEvents = \"none\";\r\n                        gridContent.appendChild(line);\r\n\r\n                        const circle = document.createElement(\"div\");\r\n                        circle.className = \"roadmap-marker-circle\";\r\n                        line.appendChild(circle);\r\n\r\n                        const label = document.createElement(\"div\");\r\n                        label.className = \"roadmap-marker-label\";\r\n                        const iStartStr = iStart.toLocaleDateString([], { month: \"short\", day: \"numeric\" });\r\n                        const iEnd = new Date(iStart);\r\n                        iEnd.setDate(iEnd.getDate() + (iter.duration || 14));\r\n                        const iEndStr = iEnd.toLocaleDateString([], { month: \"short\", day: \"numeric\" });\r\n                        label.textContent = `${iter.title || iter.name || \"Iteration\"} (${iStartStr} - ${iEndStr})`;\r\n                        line.appendChild(label);\r\n                    }\r\n                });\r\n            } else if (type === \"date\") {\r\n                const uniqueDates = new Set<string>();\r\n                this.items.forEach(item => {\r\n                    const fv = item.fieldValues.find((v: any) => String(v.fieldId) === String(field.id));\r\n                    if (fv?.date) uniqueDates.add(fv.date);\r\n                });\r\n\r\n                uniqueDates.forEach(dateStr => {\r\n                    const d = new Date(dateStr);\r\n                    d.setHours(0, 0, 0, 0);\r\n                    if (!isNaN(d.getTime()) && d >= start && d <= end) {\r\n                        const offset = this.calculateOffset(d, start);\r\n                        const line = document.createElement(\"div\");\r\n                        line.style.position = \"absolute\"; line.style.left = offset + \"px\"; line.style.top = \"0\"; line.style.height = \"100%\"; line.style.borderLeft = \"1px solid var(--vscode-descriptionForeground)\"; line.style.opacity = \"0.4\"; line.style.zIndex = \"10\"; line.style.pointerEvents = \"none\";\r\n                        gridContent.appendChild(line);\r\n\r\n                        const triangle = document.createElement(\"div\");\r\n                        triangle.className = \"roadmap-marker-triangle\";\r\n                        line.appendChild(triangle);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n}\r\n", "export function escapeHtml(s: any): string {\r\n  return s\r\n    ? String(s)\r\n        .replace(/&/g, \"&amp;\")\r\n        .replace(/</g, \"&lt;\")\r\n        .replace(/>/g, \"&gt;\")\r\n    : \"\";\r\n}\r\n\r\nexport function normalizeColor(color: any): string | null {\r\n  if (!color) return null;\r\n  let n = String(color).trim();\r\n  if (\r\n    /^#?[0-9a-f]{3}$/i.test(n) ||\r\n    /^#?[0-9a-f]{6}$/i.test(n) ||\r\n    /^#?[0-9a-f]{8}$/i.test(n)\r\n  ) {\r\n    let b = n[0] === \"#\" ? n.slice(1) : n;\r\n    return \"#\" + (b.length === 8 ? b.substring(0, 6) : b);\r\n  }\r\n  let s = {\r\n    GRAY: \"#848d97\",\r\n    RED: \"#f85149\",\r\n    ORANGE: \"#db6d28\",\r\n    YELLOW: \"#d29922\",\r\n    GREEN: \"#3fb950\",\r\n    BLUE: \"#2f81f7\",\r\n    PURPLE: \"#a371f7\",\r\n    PINK: \"#db61a2\",\r\n    BLACK: \"#000000\",\r\n    WHITE: \"#ffffff\",\r\n  };\r\n  let u = n.toUpperCase();\r\n  return (s as any)[u] || null;\r\n}\r\n\r\nexport function addAlpha(color: any, alpha: any): string | null {\r\n  if (!color) return null;\r\n  let s = color.replace(\"#\", \"\");\r\n  let u = (b: any) => parseInt(b, 16);\r\n  if (s.length === 3) {\r\n    let b = u(s[0] + s[0]),\r\n      S = u(s[1] + s[1]),\r\n      v = u(s[2] + s[2]);\r\n    return \"rgba(\" + b + \",\" + S + \",\" + v + \",\" + alpha + \")\";\r\n  }\r\n  if (s.length === 6 || s.length === 8) {\r\n    let b = s.length === 8 ? s.substring(0, 6) : s,\r\n      S = u(s.substring(0, 2)),\r\n      v = u(b.substring(2, 4)),\r\n      C = u(b.substring(4, 6));\r\n    return \"rgba(\" + S + \",\" + v + \",\" + C + \",\" + alpha + \")\";\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getContrastColor(color: any): string {\r\n  if (!color) return \"#333333\";\r\n  let n = color.replace(\"#\", \"\");\r\n  let s = (C: any) => parseInt(C, 16);\r\n  let u, b, S;\r\n  if (n.length === 3)\r\n    ((u = s(n[0] + n[0])), (b = s(n[1] + n[1])), (S = s(n[2] + n[2])));\r\n  else if (n.length === 6 || n.length === 8) {\r\n    let C = n.length === 8 ? n.substring(0, 6) : n;\r\n    ((u = s(C.substring(0, 2))),\r\n      (b = s(C.substring(2, 4))),\r\n      (S = s(C.substring(4, 6))));\r\n  } else return \"#333333\";\r\n  return 0.2126 * (u / 255) + 0.7152 * (b / 255) + 0.0722 * (S / 255) > 0.6\r\n    ? \"#111111\"\r\n    : \"#ffffff\";\r\n}\r\n", "import { normalizeColor, escapeHtml, addAlpha } from \"../utils\";\r\nimport { RowRenderer } from \"./RowRenderer\";\r\n\r\nexport class GroupRenderer {\r\n  constructor(private fields: any[], private allItems: any[], private groupDivisors?: string[] | null) { }\r\n\r\n  private getIconSvg(iconName: string, size: number = 14): string {\r\n    if ((window as any).getIconSvg) {\r\n      return (window as any).getIconSvg(iconName as any, { size });\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  public renderGroup(\r\n    tbody: HTMLTableSectionElement,\r\n    group: any,\r\n    groupingField: any,\r\n    rowRenderer: RowRenderer,\r\n  ) {\r\n    const trHeader = document.createElement(\"tr\");\r\n    trHeader.className = \"group-header\";\r\n    const tdHeader = document.createElement(\"td\");\r\n    tdHeader.colSpan = this.fields.length + 1;\r\n    tdHeader.style.padding = \"8px\";\r\n    tdHeader.style.background = \"var(--vscode-editor-background)\";\r\n    tdHeader.style.fontWeight = \"600\";\r\n    tdHeader.style.borderTop = \"1px solid var(--vscode-editorGroup-border)\";\r\n    tdHeader.style.borderBottom = \"1px solid var(--vscode-editorGroup-border)\";\r\n    tdHeader.style.position = \"sticky\";\r\n    tdHeader.style.top = \"32px\";\r\n    tdHeader.style.zIndex = \"9\";\r\n    tdHeader.style.boxShadow = \"0 1px 2px rgba(0,0,0,0.1)\";\r\n\r\n    const headerContent = document.createElement(\"div\");\r\n    headerContent.style.display = \"flex\";\r\n    headerContent.style.alignItems = \"center\";\r\n    headerContent.style.gap = \"8px\";\r\n\r\n    const built = buildGroupHeaderElement(this.fields, this.allItems, group, groupingField, { groupDivisors: this.groupDivisors });\r\n    const iconExpanded = this.getIconSvg(\"triangle-down\", 16);\r\n    const iconCollapsed = this.getIconSvg(\"triangle-right\", 16);\r\n\r\n    // Apply sticky styles directly to the built element to preserve wrapper structure\r\n    // This ensures the same DOM structure across table, board, and roadmap views\r\n    built.style.position = \"sticky\";\r\n    built.style.left = \"0\";\r\n    built.style.zIndex = \"12\";\r\n    built.style.background = tdHeader.style.background;\r\n    built.style.paddingRight = \"8px\";\r\n\r\n    // Append the built element directly (preserve wrapper) instead of moving children\r\n    headerContent.appendChild(built);\r\n\r\n    const toggleEl = built.querySelector('.group-toggle') as HTMLElement | null;\r\n\r\n    // Note: Avatar handling and \"Unassigned\" rename are now handled in buildGroupHeaderElement()\r\n    // to ensure consistency across table, board, and roadmap views.\r\n\r\n\r\n\r\n    tdHeader.appendChild(headerContent);\r\n    trHeader.appendChild(tdHeader);\r\n    tbody.appendChild(trHeader);\r\n\r\n    // Render Items\r\n    const groupRows: HTMLTableRowElement[] = [];\r\n    // Use a sanitized class name for group toggling (avoid spaces/special chars)\r\n    const rawId = group && group.option && group.option.id ? String(group.option.id) : String(Math.random()).replace(\"0.\", \"_\");\r\n    const safeId = rawId.replace(/\\s+/g, \"-\").replace(/[^A-Za-z0-9_\\-]/g, \"_\");\r\n    group.items.forEach((groupItem: any) => {\r\n      const tr = rowRenderer.createRow(groupItem.item, groupItem.index);\r\n      try {\r\n        tr.classList.add(\"group-row-\" + safeId); // Add class for group toggling\r\n      } catch (e) { }\r\n      tbody.appendChild(tr);\r\n      groupRows.push(tr);\r\n    });\r\n\r\n    // Toggle Logic\r\n    let isCollapsed = false;\r\n    const setCollapsed = (collapsed: boolean) => {\r\n      isCollapsed = collapsed;\r\n      if (toggleEl) toggleEl.innerHTML = isCollapsed ? iconCollapsed : iconExpanded;\r\n      groupRows.forEach((row) => {\r\n        row.style.display = isCollapsed ? \"none\" : \"table-row\";\r\n      });\r\n      try {\r\n        if (isCollapsed) trHeader.classList.add(\"collapsed\");\r\n        else trHeader.classList.remove(\"collapsed\");\r\n      } catch (e) { }\r\n    };\r\n\r\n    if (toggleEl) {\r\n      toggleEl.addEventListener(\"click\", (ev) => {\r\n        ev.stopPropagation();\r\n        setCollapsed(!isCollapsed);\r\n      });\r\n    }\r\n\r\n    // Allow clicking the whole header to toggle collapse/expand for easier interaction and tests\r\n    tdHeader.addEventListener(\"click\", (ev) => {\r\n      // Ignore clicks on controls inside header (e.g., links, buttons)\r\n      const target = ev.target as HTMLElement;\r\n      if (target && (target.tagName === \"BUTTON\" || target.closest(\"button\") || target.closest(\"a\"))) return;\r\n      setCollapsed(!isCollapsed);\r\n    });\r\n  }\r\n\r\n  // Consumers should use the shared `buildGroupHeaderElement` directly when needed.\r\n}\r\n\r\nfunction createEl(tag = \"div\") { return document.createElement(tag); }\r\n\r\nfunction renderColorDot(option: any): HTMLElement {\r\n  const colorDot = createEl(\"div\");\r\n  colorDot.className = \"group-color-dot\";\r\n  colorDot.style.width = \"12px\";\r\n  colorDot.style.height = \"12px\";\r\n  colorDot.style.borderRadius = \"50%\";\r\n  colorDot.style.backgroundColor = normalizeColor(option?.color) || \"gray\";\r\n  colorDot.style.marginRight = \"8px\";\r\n  return colorDot;\r\n}\r\n\r\nfunction renderNameSpan(option: any, groupingField?: any): HTMLElement {\r\n  const nameSpan = createEl(\"span\");\r\n  nameSpan.className = \"group-name\";\r\n  nameSpan.style.fontWeight = \"600\";\r\n  nameSpan.style.marginRight = \"8px\";\r\n  const name = option && (option.name || option.title || option.label) ? String(option.name || option.title || option.label) : \"Unassigned\";\r\n  nameSpan.textContent = name;\r\n  return nameSpan;\r\n}\r\n\r\nfunction renderCountPill(count: number, option: any): HTMLElement {\r\n  const countPill = createEl(\"span\");\r\n  const color = normalizeColor(option?.color) || \"#848d97\";\r\n  countPill.className = \"gh-count-pill\";\r\n  countPill.style.background = addAlpha(color, 0.12) || \"transparent\";\r\n  countPill.style.color = color;\r\n  countPill.style.border = \"1px solid rgba(0,0,0,0.04)\";\r\n  countPill.style.borderRadius = \"10px\";\r\n  countPill.style.padding = \"2px 8px\";\r\n  countPill.style.fontSize = \"11px\";\r\n  countPill.style.fontWeight = \"600\";\r\n  countPill.textContent = String(count || 0);\r\n  return countPill;\r\n}\r\n\r\nfunction renderEstimateElement(fields: any[], itemsArr: any[]): HTMLElement | null {\r\n  if (!Array.isArray(fields)) return null;\r\n  const estimateField =\r\n    fields.find((f: any) => (f.dataType || f.type || \"\").toString().toLowerCase() === \"number\" && String(f.name || \"\").toLowerCase().includes(\"estimate\"),)\r\n    || fields.find((f: any) => (f.dataType || f.type || \"\").toString().toLowerCase() === \"number\");\r\n  if (!estimateField) return null;\r\n  const estimateFieldId = estimateField.id;\r\n  let sum = 0;\r\n  for (const gi of itemsArr || []) {\r\n    const it = gi && (gi.item || gi);\r\n    if (!it || !Array.isArray(it.fieldValues)) continue;\r\n    const fv = it.fieldValues.find((v: any) => (v.fieldId && String(v.fieldId) === String(estimateFieldId)) || (v.fieldName && String(v.fieldName).toLowerCase().includes(\"estimate\")) || v.type === \"number\",\r\n    );\r\n    if (fv) {\r\n      const num = Number(fv.number != null ? fv.number : fv.value != null ? fv.value : NaN);\r\n      if (!isNaN(num)) sum += num;\r\n    }\r\n  }\r\n  if (sum > 0) {\r\n    const el = createEl(\"div\");\r\n    el.style.display = \"inline-block\";\r\n    el.style.padding = \"2px 8px\";\r\n    el.style.borderRadius = \"999px\";\r\n    el.style.border = \"1px solid var(--vscode-panel-border)\";\r\n    el.style.background = \"var(--vscode-input-background)\";\r\n    el.style.color = \"var(--vscode-foreground)\";\r\n    el.style.fontSize = \"12px\";\r\n    el.style.lineHeight = \"18px\";\r\n    el.style.marginLeft = \"8px\";\r\n    el.textContent = \"Estimate: \" + String(sum);\r\n    return el;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction renderNumericFieldSum(field: any, itemsArr: any[]): HTMLElement | null {\r\n  if (!field) return null;\r\n  const fieldId = field.id || field.name;\r\n  let sum = 0;\r\n  for (const gi of itemsArr || []) {\r\n    const it = gi && (gi.item || gi);\r\n    if (!it || !Array.isArray(it.fieldValues)) continue;\r\n    const fv = it.fieldValues.find((v: any) => (v.fieldId && String(v.fieldId) === String(fieldId)) || (v.fieldName && String(v.fieldName) === String(field.name)) || v.type === \"number\");\r\n    if (fv) {\r\n      const num = Number(fv.number != null ? fv.number : fv.value != null ? fv.value : NaN);\r\n      if (!isNaN(num)) sum += num;\r\n    }\r\n  }\r\n  if (sum !== 0) {\r\n    const el = createEl(\"div\");\r\n    el.style.display = \"inline-block\";\r\n    el.style.padding = \"2px 8px\";\r\n    el.style.borderRadius = \"999px\";\r\n    el.style.border = \"1px solid var(--vscode-panel-border)\";\r\n    el.style.background = \"var(--vscode-input-background)\";\r\n    el.style.color = \"var(--vscode-foreground)\";\r\n    el.style.fontSize = \"12px\";\r\n    el.style.lineHeight = \"18px\";\r\n    el.style.marginLeft = \"8px\";\r\n    el.textContent = String(field.name || fieldId) + \": \" + String(sum);\r\n    return el;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction getEffectiveGroupDivisorsForFields(fields: any[]): string[] | null {\r\n  try {\r\n    const vs = (window as any).__viewStates || {};\r\n    for (const k of Object.keys(vs)) {\r\n      try {\r\n        const st = vs[k];\r\n        if (!st || !st.fields) continue;\r\n        const stIds = (st.fields || []).map((f: any) => String(f.id));\r\n        const fIds = (fields || []).map((f: any) => String(f.id));\r\n        const common = fIds.filter((id: string) => stIds.indexOf(id) >= 0).length;\r\n        if (common > 0) {\r\n          // found a likely matching view state\r\n          return st.groupDivisors === undefined ? null : st.groupDivisors;\r\n        }\r\n      } catch (e) { }\r\n    }\r\n  } catch (e) { }\r\n  return null;\r\n}\r\n\r\nfunction extractParentFromItem(it: any, groupingField: any): any {\r\n  if (!it) return null;\r\n  const candidates: any[] = [];\r\n  if (Array.isArray(it.fieldValues)) candidates.push(it.fieldValues);\r\n  if (it.content && Array.isArray(it.content.fieldValues)) candidates.push(it.content.fieldValues);\r\n  if (it.raw && it.raw.itemContent && Array.isArray(it.raw.itemContent.fieldValues)) candidates.push(it.raw.itemContent.fieldValues);\r\n  for (const cvs of candidates) {\r\n    const pfv = cvs.find((v: any) => String(v.fieldId) === String(groupingField?.id) || String(v.fieldName) === String(groupingField?.name) || String(v.type) === \"parent_issue\");\r\n    if (pfv) return pfv.parent || pfv.parentIssue || pfv.issue || pfv.item || pfv.value || null;\r\n  }\r\n  return it.parent || it.parentIssue || it.issue || it.item || it.value || null;\r\n}\r\n\r\nfunction renderParentProgress(group: any, groupingField: any, allItems: any[]): HTMLElement | null {\r\n  if (!groupingField || String((groupingField.dataType || groupingField.type) || \"\").toLowerCase() !== \"parent_issue\") return null;\r\n  try {\r\n    let parentMeta: any = null;\r\n    if (group && group.option) parentMeta = group.option.parent || group.option.parentIssue || group.option.issue || parentMeta;\r\n    if (!parentMeta && group.items && group.items.length > 0) {\r\n      const firstRaw = group.items[0];\r\n      const first = firstRaw && firstRaw.item ? firstRaw.item : firstRaw;\r\n      parentMeta = extractParentFromItem(first, groupingField) || parentMeta;\r\n    }\r\n    if (!parentMeta) return null;\r\n    const identifiers: string[] = [];\r\n    const pushIf = (v: any) => { if (v !== undefined && v !== null && v !== \"\") identifiers.push(String(v)); };\r\n    pushIf(parentMeta && parentMeta.number); pushIf(parentMeta && parentMeta.id); pushIf(parentMeta && parentMeta.url); pushIf(parentMeta && parentMeta.title);\r\n    if (group && group.option) { pushIf(group.option.id); pushIf(group.option.name); pushIf(group.option.title); }\r\n    const found = (allItems || []).find((A: any) => {\r\n      const d = (A && (A.content || (A.raw && A.raw.itemContent))) || A || null; if (!d) return false;\r\n      const M: string[] = []; const tryPush = (x: any) => { if (x !== undefined && x !== null && x !== \"\") M.push(String(x)); };\r\n      tryPush(d.number); tryPush(d.id); tryPush(d.url); tryPush(d.title); tryPush(d.name);\r\n      if (d.raw) { tryPush(d.raw.number); tryPush(d.raw.id); tryPush(d.raw.url); }\r\n      if (d.itemContent && typeof d.itemContent === 'object') { tryPush(d.itemContent.number); tryPush(d.itemContent.id); tryPush(d.itemContent.url); tryPush(d.itemContent.title); tryPush(d.itemContent.name); }\r\n      for (const o of identifiers) { for (const m of M) { if (o && m && String(o) === String(m)) return true; } }\r\n      return false;\r\n    });\r\n    // Progress bar calculation - don't require finding the parent in allItems,\r\n    // we can calculate progress directly from group items\r\n    let done = 0, total = 0; const itemsList = group.items || [];\r\n    const isDoneByHeuristics = (it: any) => {\r\n      try {\r\n        const content = it && (it.content || (it.raw && it.raw.itemContent));\r\n        if (content) {\r\n          const state = (content.state || (content.merged ? \"MERGED\" : undefined) || \"\").toString().toUpperCase(); if (state === \"CLOSED\" || state === \"MERGED\") return true;\r\n        }\r\n        if (Array.isArray(it.fieldValues)) {\r\n          const ss = it.fieldValues.find((v: any) => v && v.type === \"single_select\" && v.option && v.option.name && [\"done\", \"closed\", \"completed\", \"finished\"].includes(String(v.option.name).toLowerCase())); if (ss) return true;\r\n          const percentFV = it.fieldValues.find((v: any) => v && (String(v.fieldName || \"\").toLowerCase().includes(\"progress\") || String(v.fieldName || \"\").toLowerCase().includes(\"percent\")));\r\n          if (percentFV && percentFV.number != null) { const pct = Number(percentFV.number || 0); if (pct >= 100) return true; }\r\n        }\r\n      } catch (e) { }\r\n      return false;\r\n    };\r\n    for (const gi of itemsList) { const it = gi.item || gi; if (!it) continue; total++; if (isDoneByHeuristics(it)) done++; }\r\n    if (total > 0) { const pct = Math.round((done / total) * 100); const progWrapper = createEl(\"div\"); progWrapper.className = \"group-progress\"; progWrapper.style.display = \"inline-flex\"; progWrapper.style.alignItems = \"center\"; progWrapper.style.gap = \"8px\"; progWrapper.style.marginLeft = \"8px\"; const bar = createEl(\"div\"); bar.style.display = \"inline-block\"; bar.style.width = \"120px\"; bar.style.height = \"12px\"; bar.style.background = \"transparent\"; bar.style.border = \"1px solid var(--vscode-focusBorder)\"; bar.style.borderRadius = \"6px\"; bar.style.overflow = \"hidden\"; const fill = createEl(\"div\"); fill.style.height = \"100%\"; fill.style.width = String(pct) + \"%\"; fill.style.background = \"var(--vscode-focusBorder)\"; bar.appendChild(fill); progWrapper.appendChild(bar); return progWrapper; }\r\n  } catch (e) { }\r\n  return null;\r\n}\r\n\r\nfunction renderIterationElement(group: any, groupingField: any): HTMLElement | null {\r\n  if (!groupingField) return null;\r\n  try {\r\n    const dtype = String((groupingField.dataType || groupingField.type) || \"\").toLowerCase(); if (dtype !== \"iteration\") return null;\r\n    const opt = group.option || {}; let iterText: string | null = null; const start = opt.startDate || (opt.start && opt.startDate) || null; const duration = opt.duration || opt.length || null;\r\n    if (start && duration) { try { const s = new Date(start); const days = Number(duration) || 0; const e = new Date(s.getTime() + days * 24 * 60 * 60 * 1000); const sStr = s.toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" }); const eStr = e.toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" }); iterText = `${sStr} \u2014 ${eStr}`; } catch (e) { iterText = null; } }\r\n    if (!iterText) iterText = opt.title || opt.name ? String(opt.title || opt.name) : null;\r\n    if (iterText) { const iterEl = createEl(\"div\"); iterEl.style.color = \"var(--vscode-descriptionForeground)\"; iterEl.style.fontSize = \"12px\"; iterEl.style.marginLeft = \"8px\"; iterEl.textContent = String(iterText).slice(0, 120); return iterEl; }\r\n  } catch (e) { }\r\n  return null;\r\n}\r\n\r\nfunction getIconSvg(iconName: string, size: number = 14): string {\r\n  if ((window as any).getIconSvg) return (window as any).getIconSvg(iconName as any, { size });\r\n  return \"\";\r\n}\r\n\r\nexport function buildGroupHeaderElement(fields: any[], allItems: any[], group: any, groupingField: any, options?: { hideToggle?: boolean; viewKey?: string; groupDivisors?: string[] | null }): HTMLElement {\r\n  // Normalize grouping field: callers may pass a minimal field or an option-like object.\r\n  const groupingFieldDef = (groupingField && (groupingField.dataType || groupingField.type))\r\n    ? groupingField\r\n    : (Array.isArray(fields) ? fields.find((f: any) => String(f.id) === String(groupingField?.id) || String(f.name) === String(groupingField?.name)) : groupingField) || groupingField;\r\n  const header = document.createElement(\"div\");\r\n  // Provide both the legacy `group-header` class and the newer `group-header-div`\r\n  // so table/board/roadmap styles/selectors match the same element.\r\n  header.className = \"group-header group-header-div\";\r\n  header.style.display = \"flex\";\r\n  header.style.alignItems = \"center\";\r\n  header.style.padding = \"8px\";\r\n  header.style.background = \"var(--vscode-sideBar-background)\";\r\n\r\n  // Toggle placeholder (only render if hideToggle is not set)\r\n  if (!options?.hideToggle) {\r\n    const toggleSpan = document.createElement(\"span\");\r\n    toggleSpan.className = \"group-toggle\";\r\n    toggleSpan.style.cursor = \"pointer\";\r\n    toggleSpan.style.marginRight = \"8px\";\r\n    // Provide a visible default icon so board/roadmap show the toggle correctly\r\n    try { toggleSpan.innerHTML = getIconSvg('triangle-down', 16); } catch (e) { }\r\n    header.appendChild(toggleSpan);\r\n  }\r\n\r\n  // Color / Name / Count (use shared renderers)\r\n  const colorDot = renderColorDot(group.option || {});\r\n  // also add board-specific class for backward compatibility\r\n  colorDot.classList.add('board-card-color-dot');\r\n  header.appendChild(colorDot);\r\n  const nameSpan = renderNameSpan(group.option || {}, groupingFieldDef);\r\n  // add board title class for compatibility\r\n  nameSpan.classList.add('board-card-title');\r\n  header.appendChild(nameSpan);\r\n  // Determine group divisors configuration: explicit array = render selected pills; undefined/null = render nothing\r\n  let effectiveDivisors: string[] | null | undefined = undefined;\r\n  try {\r\n    if (options && Object.prototype.hasOwnProperty.call(options, 'groupDivisors')) {\r\n      effectiveDivisors = options!.groupDivisors;\r\n    } else if (options && options.viewKey) {\r\n      try {\r\n        const vs = (window as any).__viewStates || {};\r\n        effectiveDivisors = vs[options.viewKey] ? vs[options.viewKey].groupDivisors : undefined;\r\n      } catch (e) { effectiveDivisors = undefined; }\r\n    }\r\n  } catch (e) { effectiveDivisors = undefined; }\r\n\r\n  if (Array.isArray(effectiveDivisors)) {\r\n    // Only render Count if explicitly selected (__count__)\r\n    if (effectiveDivisors.find((x: any) => String(x) === '__count__')) {\r\n      const countPill = renderCountPill((group.items && group.items.length) || 0, group.option || {});\r\n      countPill.classList.add('board-card-count');\r\n      header.appendChild(countPill);\r\n    }\r\n    // For each selected numeric field, render a summed pill\r\n    try {\r\n      const numericFields = (fields || []).filter((f: any) => String((f.dataType || f.type || '').toLowerCase()) === 'number' || String(f.name || '').toLowerCase().includes('estimate'));\r\n      for (const sel of effectiveDivisors) {\r\n        if (String(sel) === '__count__') continue;\r\n        const f = numericFields.find((nf: any) => String(nf.id) === String(sel) || String(nf.name) === String(sel));\r\n        if (f) {\r\n          const el = renderNumericFieldSum(f, group.items || []);\r\n          if (el) {\r\n            el.classList.add('board-card-estimate');\r\n            header.appendChild(el);\r\n          }\r\n        }\r\n      }\r\n    } catch (e) { }\r\n  }\r\n\r\n  // Avatar handling: if option has avatar data or groupingField is assignees,\r\n  // try to replace the color dot with an avatar image (works for table/board/roadmap)\r\n  try {\r\n    const opt = group && group.option ? group.option : {};\r\n    const shouldShowAvatar = opt && (opt.avatarUrl || opt.avatar || opt.imageUrl || opt.login)\r\n      || (opt && opt.name && String((groupingFieldDef && (groupingFieldDef.dataType || groupingFieldDef.type) || \"\").toLowerCase()) === \"assignees\");\r\n    if (shouldShowAvatar) {\r\n      let avatarUrl = opt.avatarUrl || opt.avatar || opt.imageUrl || null;\r\n      if (!avatarUrl && Array.isArray(group.items)) {\r\n        for (const gi of group.items || []) {\r\n          const it = gi && (gi.item || gi);\r\n          if (!it || !Array.isArray(it.fieldValues)) continue;\r\n          const fv = it.fieldValues.find((v: any) => v && (v.type === \"assignees\" || String(v.fieldId) === String(groupingFieldDef && groupingFieldDef.id)));\r\n          if (fv && fv.assignees && Array.isArray(fv.assignees)) {\r\n            const match = fv.assignees.find((a: any) => String(a.login || a.name) === String(opt.name || opt.id));\r\n            if (match && (match.avatarUrl || match.avatar)) { avatarUrl = match.avatarUrl || match.avatar; break; }\r\n          }\r\n        }\r\n      }\r\n      if (avatarUrl && colorDot && colorDot.parentNode) {\r\n        const avatarEl = document.createElement(\"span\");\r\n        avatarEl.innerHTML = '<span title=\"' + escapeHtml((opt && (opt.login || opt.name)) || \"Assignee\") + '\" style=\"display:inline-block;width:20px;height:20px;border-radius:50%;overflow:hidden;background-size:cover;background-position:center;background-image:url(' + escapeHtml(avatarUrl) + ');border:2px solid var(--vscode-editor-background)\"></span>';\r\n        colorDot.parentNode.replaceChild(avatarEl, colorDot);\r\n      }\r\n    }\r\n  } catch (e) { }\r\n\r\n  // If this group corresponds to 'Unassigned', rename to 'No <fieldname>' for all views\r\n  try {\r\n    if (group && group.option && (group.option.name === \"Unassigned\" || group.option.title === \"Unassigned\")) {\r\n      if (nameSpan) nameSpan.textContent = \"No \" + (groupingFieldDef && (groupingFieldDef.name || groupingFieldDef.title) ? (groupingFieldDef.name || groupingFieldDef.title) : \"value\");\r\n    }\r\n  } catch (e) { }\r\n\r\n  try {\r\n    const parentEl = renderParentProgress(group, groupingFieldDef, allItems);\r\n    if (parentEl) header.appendChild(parentEl);\r\n  } catch (e) { }\r\n\r\n  try {\r\n    const iterEl = renderIterationElement(group, groupingFieldDef);\r\n    if (iterEl) header.appendChild(iterEl);\r\n  } catch (e) { }\r\n  return header;\r\n}\r\n", "/**\r\n * Icon Registry\r\n * Central registry for all GitHub-style Octicon SVGs used in webviews.\r\n * Uses official GitHub Octicons SVG paths for consistency.\r\n */\r\n\r\n/**\r\n * All available icon names in the registry\r\n */\r\nexport type IconName =\r\n  // View layouts\r\n  | \"table\"\r\n  | \"project\"\r\n  | \"board\"\r\n  | \"roadmap\"\r\n  // Field types\r\n  | \"list\"\r\n  | \"people\"\r\n  | \"tag\"\r\n  | \"single-select\"\r\n  | \"issue-tracks\"\r\n  | \"issue-tracked-by\"\r\n  | \"iterations\"\r\n  | \"number\"\r\n  | \"calendar\"\r\n  | \"pull-request\"\r\n  | \"milestone\"\r\n  | \"repo\"\r\n  | \"typography\"\r\n  // Issues and pull requests\r\n  | \"issue-opened\"\r\n  | \"issue-closed\"\r\n  | \"issue-draft\"\r\n  | \"git-pull-request\"\r\n  | \"git-pull-request-closed\"\r\n  | \"git-pull-request-draft\"\r\n  | \"git-merge\"\r\n  | \"blocked\"\r\n  // Sorting and grouping\r\n  | \"sort-asc\"\r\n  | \"sort-desc\"\r\n  | \"rows\"\r\n  | \"columns\"\r\n  | \"sliceby\"\r\n  // Navigation and actions\r\n  | \"eye-closed\"\r\n  | \"arrow-left\"\r\n  | \"arrow-right\"\r\n  | \"chevron-left\"\r\n  | \"chevron-right\"\r\n  | \"arrow-both\"\r\n  | \"triangle-down\"\r\n  | \"triangle-right\"\r\n  | \"note\"\r\n  | \"location\"\r\n  | \"search\"\r\n  | \"zoom-in\"\r\n  | \"check\"\r\n  | \"plus\"\r\n  | \"arrow-up-down\"\r\n  | \"sort\";\r\n\r\n\r\n  /**\r\n   * SVG path data (d attribute) or full inner HTML for multi-path icons\r\n   */\r\ninterface IconDefinition {\r\n  path: string;\r\n  /**\r\n   * ViewBox dimensions (default: \"0 0 16 16\")\r\n   */\r\n  viewBox?: string;\r\n  /**\r\n   * Whether this is full inner HTML (multiple paths/elements) vs single path\r\n   */\r\n  isInnerHTML?: boolean;\r\n}\r\n\r\n/**\r\n * Registry of all icon definitions with official GitHub Octicons SVG paths\r\n */\r\nconst ICON_DEFINITIONS: Record<IconName, IconDefinition> = {\r\n  // View layouts\r\n  table: {\r\n    path: \"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25ZM6.5 6.5v8h7.75a.25.25 0 0 0 .25-.25V6.5Zm8-1.5V1.75a.25.25 0 0 0-.25-.25H6.5V5Zm-13 1.5v7.75c0 .138.112.25.25.25H5v-8ZM5 5V1.5H1.75a.25.25 0 0 0-.25.25V5Z\",\r\n  },\r\n  project: {\r\n    path: \"M1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75C0 .784.784 0 1.75 0ZM1.5 1.75v12.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25ZM11.75 3a.75.75 0 0 1 .75.75v7.5a.75.75 0 0 1-1.5 0v-7.5a.75.75 0 0 1 .75-.75Zm-8.25.75a.75.75 0 0 1 1.5 0v5.5a.75.75 0 0 1-1.5 0ZM8 3a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 3Z\",\r\n  },\r\n  board: {\r\n    // Same as project icon\r\n    path: \"M1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75C0 .784.784 0 1.75 0ZM1.5 1.75v12.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25ZM11.75 3a.75.75 0 0 1 .75.75v7.5a.75.75 0 0 1-1.5 0v-7.5a.75.75 0 0 1 .75-.75Zm-8.25.75a.75.75 0 0 1 1.5 0v5.5a.75.75 0 0 1-1.5 0ZM8 3a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 3Z\",\r\n  },\r\n  roadmap: {\r\n    path: '<path d=\"M4.75 7a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5ZM5 4.75A.75.75 0 0 1 5.75 4h5.5a.75.75 0 0 1 0 1.5h-5.5A.75.75 0 0 1 5 4.75ZM6.75 10a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5Z\" /><path d=\"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25Z\" />',\r\n    isInnerHTML: true,\r\n  },\r\n\r\n  // Field types\r\n  list: {\r\n    path: \"M5.75 2.5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm1-6a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM2 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z\",\r\n  },\r\n  people: {\r\n    path: \"M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4 4 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.549-.514 3.507 3.507 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 5.5.75.75 0 0 1 11 4Zm-5.5-.5a2 2 0 1 0-.001 3.999A2 2 0 0 0 5.5 3.5Z\",\r\n  },\r\n  tag: {\r\n    path: '<path d=\"M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  \"single-select\": {\r\n    path: '<path d=\"m5.06 7.356 2.795 2.833c.08.081.21.081.29 0l2.794-2.833c.13-.131.038-.356-.145-.356H5.206c-.183 0-.275.225-.145.356Z\"></path><path d=\"M1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 13.25 15H2.75A1.75 1.75 0 0 1 1 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  \"issue-tracks\": {\r\n    path: '<path d=\"M1.5 8a6.5 6.5 0 0 1 13 0A.75.75 0 0 0 16 8a8 8 0 1 0-8 8 .75.75 0 0 0 0-1.5A6.5 6.5 0 0 1 1.5 8Z\"></path><path d=\"M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm3.573 5.823-2.896-2.896a.25.25 0 0 1 0-.354l2.896-2.896a.25.25 0 0 1 .427.177V11.5h3.25a.75.75 0 0 1 0 1.5H12v2.146a.25.25 0 0 1-.427.177Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  \"issue-tracked-by\": {\r\n    path: '<path d=\"M1.5 8a6.5 6.5 0 0 1 13 0A.75.75 0 0 0 16 8a8 8 0 1 0-8 8 .75.75 0 0 0 0-1.5A6.5 6.5 0 0 1 1.5 8Z\"></path><path d=\"M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm1.5 1.75a.75.75 0 0 1 .75-.75h5a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1-.75-.75Zm2.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  iterations: {\r\n    path: \"M2.5 7.25a4.75 4.75 0 0 1 9.5 0 .75.75 0 0 0 1.5 0 6.25 6.25 0 1 0-6.25 6.25H12v2.146c0 .223.27.335.427.177l2.896-2.896a.25.25 0 0 0 0-.354l-2.896-2.896a.25.25 0 0 0-.427.177V12H7.25A4.75 4.75 0 0 1 2.5 7.25Z\",\r\n  },\r\n  number: {\r\n    path: \"M9 4.75A.75.75 0 0 1 9.75 4h4a.75.75 0 0 1 .53 1.28l-1.89 1.892c.312.076.604.18.867.319.742.391 1.244 1.063 1.244 2.005 0 .653-.231 1.208-.629 1.627-.386.408-.894.653-1.408.777-1.01.243-2.225.063-3.124-.527a.751.751 0 0 1 .822-1.254c.534.35 1.32.474 1.951.322.306-.073.53-.201.67-.349.129-.136.218-.32.218-.596 0-.308-.123-.509-.444-.678-.373-.197-.98-.318-1.806-.318a.75.75 0 0 1-.53-1.28l1.72-1.72H9.75A.75.75 0 0 1 9 4.75Zm-3.587 5.763c-.35-.05-.77.113-.983.572a.75.75 0 1 1-1.36-.632c.508-1.094 1.589-1.565 2.558-1.425 1 .145 1.872.945 1.872 2.222 0 1.433-1.088 2.192-1.79 2.681-.308.216-.571.397-.772.573H7a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75c0-.69.3-1.211.67-1.61.348-.372.8-.676 1.15-.92.8-.56 1.18-.904 1.18-1.474 0-.473-.267-.69-.587-.737ZM5.604.089A.75.75 0 0 1 6 .75v4.77h.711a.75.75 0 0 1 0 1.5H3.759a.75.75 0 0 1 0-1.5H4.5V2.15l-.334.223a.75.75 0 0 1-.832-1.248l1.5-1a.75.75 0 0 1 .77-.037Z\",\r\n  },\r\n  calendar: {\r\n    path: \"M4.75 0a.75.75 0 0 1 .75.75V2h5V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 13.25 16H2.75A1.75 1.75 0 0 1 1 14.25V3.75C1 2.784 1.784 2 2.75 2H4V.75A.75.75 0 0 1 4.75 0ZM2.5 7.5v6.75c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25V7.5Zm10.75-4H2.75a.25.25 0 0 0-.25.25V6h11V3.75a.25.25 0 0 0-.25-.25Z\",\r\n  },\r\n  \"pull-request\": {\r\n    path: \"M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z\",\r\n  },\r\n  milestone: {\r\n    path: \"M7.75 0a.75.75 0 0 1 .75.75V3h3.634c.414 0 .814.147 1.13.414l2.07 1.75a1.75 1.75 0 0 1 0 2.672l-2.07 1.75a1.75 1.75 0 0 1-1.13.414H8.5v5.25a.75.75 0 0 1-1.5 0V10H2.75A1.75 1.75 0 0 1 1 8.25v-3.5C1 3.784 1.784 3 2.75 3H7V.75A.75.75 0 0 1 7.75 0Zm4.384 8.5a.25.25 0 0 0 .161-.06l2.07-1.75a.248.248 0 0 0 0-.38l-2.07-1.75a.25.25 0 0 0-.161-.06H2.75a.25.25 0 0 0-.25.25v3.5c0 .138.112.25.25.25h9.384Z\",\r\n  },\r\n  repo: {\r\n    path: \"M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.249.249 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z\",\r\n  },\r\n  typography: {\r\n    path: \"M6.71 10H2.332l-.874 2.498a.75.75 0 0 1-1.415-.496l3.39-9.688a1.217 1.217 0 0 1 2.302.018l3.227 9.681a.75.75 0 0 1-1.423.474Zm3.13-4.358C10.53 4.374 11.87 4 13 4c1.5 0 3 .939 3 2.601v5.649a.75.75 0 0 1-1.448.275C13.995 12.82 13.3 13 12.5 13c-.77 0-1.514-.231-2.078-.709-.577-.488-.922-1.199-.922-2.041 0-.694.265-1.411.887-1.944C11 7.78 11.88 7.5 13 7.5h1.5v-.899c0-.54-.5-1.101-1.5-1.101-.869 0-1.528.282-1.84.858a.75.75 0 1 1-1.32-.716ZM6.21 8.5 4.574 3.594 2.857 8.5Zm8.29.5H13c-.881 0-1.375.22-1.637.444-.253.217-.363.5-.363.806 0 .408.155.697.39.896.249.21.63.354 1.11.354.732 0 1.26-.209 1.588-.449.35-.257.412-.495.412-.551Z\",\r\n  },\r\n\r\n  // Issues and pull requests\r\n  \"issue-opened\": {\r\n    path: '<path d=\"M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z\"></path><path d=\"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  \"issue-closed\": {\r\n    path: '<path d=\"M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z\"></path><path d=\"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  \"issue-draft\": {\r\n    path: '<path d=\"M14.307 11.655a.75.75 0 0 1 .165 1.048 8.05 8.05 0 0 1-1.769 1.77.75.75 0 0 1-.883-1.214 6.552 6.552 0 0 0 1.44-1.439.75.75 0 0 1 1.047-.165Zm-2.652-9.962a.75.75 0 0 1 1.048-.165 8.05 8.05 0 0 1 1.77 1.769.75.75 0 0 1-1.214.883 6.552 6.552 0 0 0-1.439-1.44.75.75 0 0 1-.165-1.047ZM6.749.097a8.074 8.074 0 0 1 2.502 0 .75.75 0 1 1-.233 1.482 6.558 6.558 0 0 0-2.036 0A.751.751 0 0 1 6.749.097ZM.955 6.125a.75.75 0 0 1 .624.857 6.558 6.558 0 0 0 0 2.036.75.75 0 1 1-1.482.233 8.074 8.074 0 0 1 0-2.502.75.75 0 0 1 .858-.624Zm14.09 0a.75.75 0 0 1 .858.624c.13.829.13 1.673 0 2.502a.75.75 0 1 1-1.482-.233 6.558 6.558 0 0 0 0-2.036.75.75 0 0 1 .624-.857Zm-8.92 8.92a.75.75 0 0 1 .857-.624 6.558 6.558 0 0 0 2.036 0 .75.75 0 1 1 .233 1.482c-.829.13-1.673.13-2.502 0a.75.75 0 0 1-.624-.858Zm-4.432-3.39a.75.75 0 0 1 1.048.165 6.552 6.552 0 0 0 1.439 1.44.751.751 0 0 1-.883 1.212 8.05 8.05 0 0 1-1.77-1.769.75.75 0 0 1 .166-1.048Zm2.652-9.962A.75.75 0 0 1 4.18 2.74a6.556 6.556 0 0 0-1.44 1.44.751.751 0 0 1-1.212-.883 8.05 8.05 0 0 1 1.769-1.77.75.75 0 0 1 1.048.166Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  \"git-pull-request\": {\r\n    path: \"M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z\",\r\n  },\r\n  \"git-pull-request-closed\": {\r\n    path: \"M3.25 1A2.25 2.25 0 0 1 4 5.372v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.251 2.251 0 0 1 3.25 1Zm9.5 5.5a.75.75 0 0 1 .75.75v3.378a2.251 2.251 0 1 1-1.5 0V7.25a.75.75 0 0 1 .75-.75Zm-2.03-5.273a.75.75 0 0 1 1.06 0l.97.97.97-.97a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.97.97.97.97a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-.97-.97-.97.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l.97-.97-.97-.97a.75.75 0 0 1 0-1.06ZM2.5 3.25a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0ZM3.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm9.5 0a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z\",\r\n  },\r\n  \"git-pull-request-draft\": {\r\n    path: \"M3.25 1A2.25 2.25 0 0 1 4 5.372v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.251 2.251 0 0 1 3.25 1Zm9.5 14a2.25 2.25 0 1 1 0-4.5 2.25 2.25 0 0 1 0 4.5ZM2.5 3.25a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0ZM3.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm9.5 0a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM14 7.5a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0Zm0-4.25a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0Z\",\r\n  },\r\n  \"git-merge\": {\r\n    path: \"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z\",\r\n  },\r\n  blocked: {\r\n    path: \"M4.467.22a.749.749 0 0 1 .53-.22h6.006c.199 0 .389.079.53.22l4.247 4.247c.141.14.22.331.22.53v6.006a.749.749 0 0 1-.22.53l-4.247 4.247a.749.749 0 0 1-.53.22H4.997a.749.749 0 0 1-.53-.22L.22 11.533a.749.749 0 0 1-.22-.53V4.997c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.308v5.384L5.308 14.5h5.384l3.808-3.808V5.308L10.692 1.5ZM4 7.75A.75.75 0 0 1 4.75 7h6.5a.75.75 0 0 1 0 1.5h-6.5A.75.75 0 0 1 4 7.75Z\",\r\n  },\r\n\r\n  // Sorting and grouping\r\n  \"sort-asc\": {\r\n    path: \"m12.927 2.573 3 3A.25.25 0 0 1 15.75 6H13.5v6.75a.75.75 0 0 1-1.5 0V6H9.75a.25.25 0 0 1-.177-.427l3-3a.25.25 0 0 1 .354 0ZM0 12.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75Zm0-4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0-4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Z\",\r\n  },\r\n  \"sort-desc\": {\r\n    path: \"M0 4.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Zm0 4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0 4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75ZM13.5 10h2.25a.25.25 0 0 1 .177.427l-3 3a.25.25 0 0 1-.354 0l-3-3A.25.25 0 0 1 9.75 10H12V3.75a.75.75 0 0 1 1.5 0V10Z\",\r\n  },\r\n  rows: {\r\n    path: \"M16 10.75v2.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25v-2.5C0 9.784.784 9 1.75 9h12.5c.966 0 1.75.784 1.75 1.75Zm0-8v2.5A1.75 1.75 0 0 1 14.25 7H1.75A1.75 1.75 0 0 1 0 5.25v-2.5C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75Zm-1.75-.25H1.75a.25.25 0 0 0-.25.25v2.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25v-2.5a.25.25 0 0 0-.25-.25Zm0 8H1.75a.25.25 0 0 0-.25.25v2.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25v-2.5a.25.25 0 0 0-.25-.25Z\",\r\n  },\r\n  columns: {\r\n    path: \"M2.75 0h2.5C6.216 0 7 .784 7 1.75v12.5A1.75 1.75 0 0 1 5.25 16h-2.5A1.75 1.75 0 0 1 1 14.25V1.75C1 .784 1.784 0 2.75 0Zm8 0h2.5C14.216 0 15 .784 15 1.75v12.5A1.75 1.75 0 0 1 13.25 16h-2.5A1.75 1.75 0 0 1 9 14.25V1.75C9 .784 9.784 0 10.75 0ZM2.5 1.75v12.5c0 .138.112.25.25.25h2.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25Zm8 0v12.5c0 .138.112.25.25.25h2.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25Z\"\r\n  },\r\n  sliceby: {\r\n    path: \"M14.5 1.5H6.5V5H10C10.4142 5 10.75 5.33579 10.75 5.75C10.75 6.16421 10.4142 6.5 10 6.5H6.5V7.75C6.5 8.16421 6.16421 8.5 5.75 8.5C5.33579 8.5 5 8.16421 5 7.75V6.5H1.5V14.5H5V12.75C5 12.3358 5.33579 12 5.75 12C6.16421 12 6.5 12.3358 6.5 12.75V14.5H14.5V1.5ZM5 1.5V5H1.5V1.5H5ZM0 14.5V5.75V1.5C0 0.671573 0.671573 0 1.5 0H5.75H14.5C15.3284 0 16 0.671573 16 1.5V14.5C16 15.3284 15.3284 16 14.5 16H5.75H1.5C0.671573 16 0 15.3284 0 14.5ZM9.62012 9.58516C10.8677 9.59206 11.8826 8.58286 11.8826 7.33544V6.32279C11.8826 5.90857 12.2184 5.57279 12.6326 5.57279C13.0468 5.57279 13.3826 5.90857 13.3826 6.32279V7.33544C13.3826 9.4147 11.6909 11.0966 9.61182 11.0851L9.3826 11.0839L9.3826 12.9995C9.3826 13.2178 9.12245 13.3312 8.96248 13.1827L6.07989 10.506C5.97337 10.4071 5.97337 10.2385 6.07989 10.1396L8.96248 7.46291C9.12245 7.31438 9.3826 7.42782 9.3826 7.64611V9.58384L9.62012 9.58516Z\",\r\n  },\r\n\r\n  // Navigation and actions\r\n  \"eye-closed\": {\r\n    path: \"M.143 2.31a.75.75 0 0 1 1.047-.167l14.5 10.5a.75.75 0 1 1-.88 1.214l-2.248-1.628C11.346 13.19 9.792 14 8 14c-1.981 0-3.67-.992-4.933-2.078C1.797 10.832.88 9.577.43 8.9a1.619 1.619 0 0 1 0-1.797c.353-.533.995-1.42 1.868-2.305L.31 3.357A.75.75 0 0 1 .143 2.31Zm1.536 5.622A.12.12 0 0 0 1.657 8c0 .021.006.045.022.068.412.621 1.242 1.75 2.366 2.717C5.175 11.758 6.527 12.5 8 12.5c1.195 0 2.31-.488 3.29-1.191L9.063 9.695A2 2 0 0 1 6.058 7.52L3.529 5.688a14.207 14.207 0 0 0-1.85 2.244ZM8 3.5c-.516 0-1.017.09-1.499.251a.75.75 0 1 1-.473-1.423A6.207 6.207 0 0 1 8 2c1.981 0 3.67.992 4.933 2.078 1.27 1.091 2.187 2.345 2.637 3.023a1.62 1.62 0 0 1 0 1.798c-.11.166-.248.365-.41.587a.75.75 0 1 1-1.21-.887c.148-.201.272-.382.371-.53a.119.119 0 0 0 0-.137c-.412-.621-1.242-1.75-2.366-2.717C10.825 4.242 9.473 3.5 8 3.5Z\",\r\n  },\r\n  \"arrow-left\": {\r\n    path: \"M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06Z\",\r\n  },\r\n  \"arrow-right\": {\r\n    path: \"M8.22 2.97a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l2.97-2.97H3.75a.75.75 0 0 1 0-1.5h7.44L8.22 4.03a.75.75 0 0 1 0-1.06Z\",\r\n  },\r\n  \"triangle-down\": {\r\n    path: \"M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z\",\r\n  },\r\n  \"triangle-right\": {\r\n    path: \"M8.573 4.604a.25.25 0 01.427-.177l3.396 3.396a.25.25 0 010 .354l-3.396 3.396a.25.25 0 01-.427-.177V4.604z\",\r\n  },\r\n  note: {\r\n    path: \"M0 3.75C0 2.784.784 2 1.75 2h12.5c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 14.25 14H1.75A1.75 1.75 0 0 1 0 12.25Zm1.75-.25a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25ZM3.5 6.25a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5h-7a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h4a.75.75 0 0 0 0-1.5h-4Z\",\r\n  },\r\n  \"chevron-left\": {\r\n    path: \"M9.78 12.78a.75.75 0 0 1-1.06 0L4.47 8.53a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L6.06 8l3.72 3.72a.75.75 0 0 1 0 1.06Z\",\r\n  },\r\n  \"chevron-right\": {\r\n    path: \"M6.22 3.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L9.94 8 6.22 4.28a.75.75 0 0 1 0-1.06Z\",\r\n  },\r\n  \"arrow-both\": {\r\n    path: \"M3.72 3.72a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.56 7h10.88l-2.22-2.22a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l3.5 3.5a.75.75 0 0 1 0 1.06l-3.5 3.5a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l2.22-2.22H2.56l2.22 2.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215l-3.5-3.5a.75.75 0 0 1 0-1.06Z\",\r\n  },\r\n  location: {\r\n    path: \"m12.596 11.596-3.535 3.536a1.5 1.5 0 0 1-2.122 0l-3.535-3.536a6.5 6.5 0 1 1 9.192-9.193 6.5 6.5 0 0 1 0 9.193Zm-1.06-8.132v-.001a5 5 0 1 0-7.072 7.072L8 14.07l3.536-3.534a5 5 0 0 0 0-7.072ZM8 9a2 2 0 1 1-.001-3.999A2 2 0 0 1 8 9Z\",\r\n  },\r\n  \"zoom-in\": {\r\n    path: '<path d=\"M3.75 7.5a.75.75 0 0 1 .75-.75h2.25V4.5a.75.75 0 0 1 1.5 0v2.25h2.25a.75.75 0 0 1 0 1.5H8.25v2.25a.75.75 0 0 1-1.5 0V8.25H4.5a.75.75 0 0 1-.75-.75Z\"></path><path d=\"M7.5 0a7.5 7.5 0 0 1 5.807 12.247l2.473 2.473a.749.749 0 1 1-1.06 1.06l-2.473-2.473A7.5 7.5 0 1 1 7.5 0Zm-6 7.5a6 6 0 1 0 12 0 6 6 0 0 0-12 0Z\"></path>',\r\n    isInnerHTML: true,\r\n  },\r\n  check: {\r\n    path: \"M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z\",\r\n  },\r\n  plus: {\r\n    path: \"M8 0a.75.75 0 0 1 .75.75v6.5h6.5a.75.75 0 0 1 0 1.5h-6.5v6.5a.75.75 0 0 1-1.5 0v-6.5h-6.5a.75.75 0 0 1 0-1.5h6.5v-6.5A.75.75 0 0 1 8 0Z\",\r\n  },\r\n  search: {\r\n    path: \"M10.68 11.74a6 6 0 1 1 1.06-1.06l2.74 2.74a.75.75 0 1 1-1.06 1.06l-2.74-2.74ZM12 7a5 5 0 1 1-10 0 5 5 0 0 1 10 0Z\",\r\n  },\r\n  \"arrow-up-down\": {\r\n    path: \"M8 2.5a.75.75 0 0 1 .53.22l3.5 3.5a.75.75 0 0 1-1.06 1.06L9 5.06v5.88l1.97-1.97a.75.75 0 0 1 1.06 1.06l-3.5 3.5a.75.75 0 0 1-1.06 0l-3.5-3.5a.75.75 0 1 1 1.06-1.06L7 10.94V5.06L5.03 7.03a.75.75 0 0 1-1.06-1.06l3.5-3.5A.75.75 0 0 1 8 2.5Z\",\r\n  },\r\n  sort: {\r\n    path: \"M0 4.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Zm0 4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0 4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75ZM13.5 10h2.25a.25.25 0 0 1 .177.427l-3 3a.25.25 0 0 1-.354 0l-3-3A.25.25 0 0 1 9.75 10H12V3.75a.75.75 0 0 1 1.5 0V10Z\",\r\n  }\r\n};\r\n\r\n/**\r\n * Options for customizing icon rendering\r\n */\r\nexport interface IconOptions {\r\n  /**\r\n   * Icon size (width and height in pixels, default: 14)\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Additional CSS class names\r\n   */\r\n  className?: string;\r\n  /**\r\n   * Color fill (default: currentColor)\r\n   */\r\n  fill?: string;\r\n  /**\r\n   * ARIA label for accessibility (makes icon visible to screen readers)\r\n   */\r\n  ariaLabel?: string;\r\n  /**\r\n   * Title text for tooltip\r\n   */\r\n  title?: string;\r\n}\r\n\r\n/**\r\n * Get an inline SVG string for the specified icon\r\n * @param name - The icon name from the registry\r\n * @param options - Optional customization options\r\n * @returns HTML string containing the SVG element\r\n */\r\nexport function getIconSvg(name: IconName, options: IconOptions = {}): string {\r\n  const icon = ICON_DEFINITIONS[name];\r\n  if (!icon) {\r\n    console.warn(`Icon \"${name}\" not found in registry`);\r\n    return \"\";\r\n  }\r\n\r\n  const size = options.size ?? 14;\r\n  const className = options.className\r\n    ? `octicon octicon-${name} ${options.className}`\r\n    : `octicon octicon-${name}`;\r\n  const fill = options.fill ?? \"currentColor\";\r\n  const viewBox = icon.viewBox ?? \"0 0 16 16\";\r\n  const ariaHidden = options.ariaLabel ? \"false\" : \"true\";\r\n  const ariaLabel = options.ariaLabel\r\n    ? ` aria-label=\"${escapeHtml(options.ariaLabel)}\"`\r\n    : \"\";\r\n  const title = options.title\r\n    ? `<title>${escapeHtml(options.title)}</title>`\r\n    : \"\";\r\n\r\n  // Build SVG string\r\n  let innerContent: string;\r\n  if (icon.isInnerHTML) {\r\n    innerContent = icon.path;\r\n  } else {\r\n    innerContent = `<path d=\"${icon.path}\"/>`;\r\n  }\r\n\r\n  return `<svg class=\"${className}\" viewBox=\"${viewBox}\" width=\"${size}\" height=\"${size}\" fill=\"${fill}\" aria-hidden=\"${ariaHidden}\"${ariaLabel} focusable=\"false\">${title}${innerContent}</svg>`;\r\n}\r\n\r\n/**\r\n * Create a DOM element for the specified icon\r\n * @param name - The icon name from the registry\r\n * @param options - Optional customization options\r\n * @returns HTMLElement containing the icon\r\n */\r\nexport function createIconElement(\r\n  name: IconName,\r\n  options: IconOptions = {},\r\n): HTMLElement {\r\n  const wrapper = document.createElement(\"span\");\r\n  wrapper.innerHTML = getIconSvg(name, options);\r\n  return wrapper.firstElementChild as HTMLElement;\r\n}\r\n\r\n/**\r\n * Helper function to escape HTML special characters\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  return text\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n}\r\n\r\n/**\r\n * Map field data types to icon names\r\n * @param dataType - The field data type\r\n * @returns The corresponding icon name\r\n */\r\nexport function getIconNameForDataType(dataType: string): IconName {\r\n  const normalized = (dataType || \"\").toLowerCase();\r\n\r\n  switch (normalized) {\r\n    case \"title\":\r\n      return \"list\";\r\n    case \"assignees\":\r\n    case \"reviewers\":\r\n      return \"people\";\r\n    case \"single_select\":\r\n      return \"single-select\";\r\n    case \"labels\":\r\n      return \"tag\";\r\n    case \"parent_issue\":\r\n      return \"issue-tracks\";\r\n    case \"sub_issues_progress\":\r\n      return \"issue-tracked-by\";\r\n    case \"iteration\":\r\n      return \"iterations\";\r\n    case \"number\":\r\n    case \"numeric\":\r\n      return \"number\";\r\n    case \"date\":\r\n      return \"calendar\";\r\n    case \"linked_pull_request\":\r\n    case \"linked_pull_requests\":\r\n    case \"pull_request\":\r\n      return \"pull-request\";\r\n    case \"milestone\":\r\n      return \"milestone\";\r\n    case \"repository\":\r\n      return \"repo\";\r\n    case \"text\":\r\n    case \"string\":\r\n      return \"typography\";\r\n    default:\r\n      return \"tag\"; // fallback\r\n  }\r\n}\r\n", "import {\r\n  escapeHtml,\r\n  normalizeColor,\r\n  getContrastColor,\r\n  addAlpha,\r\n} from \"../../client/utils\";\r\nimport { getIconSvg } from \"../icons/iconRegistry\";\r\n\r\nexport interface CellRendererStrategy {\r\n  render(value: any, field: any, item: any, allItems: any): string;\r\n}\r\n\r\nexport class TitleRenderer implements CellRendererStrategy {\r\n  render(value: any, field: any, item: any, allItems: any): string {\r\n    let t =\r\n      (value &&\r\n        value.title &&\r\n        ((value.title.raw && value.title.raw.text) ||\r\n          (value.title.content &&\r\n            (value.title.content.title || value.title.content.name)) ||\r\n          (typeof value.title == \"string\" && value.title))) ||\r\n      (value && value.content && (value.content.title || value.content.name)) ||\r\n      (value && value.raw && value.raw.text) ||\r\n      \"\";\r\n    let o =\r\n      (value &&\r\n        value.title &&\r\n        value.title.content &&\r\n        value.title.content.number) ||\r\n      (value &&\r\n        value.raw &&\r\n        value.raw.itemContent &&\r\n        value.raw.itemContent.number) ||\r\n      (item && item.content && item.content.number) ||\r\n      \"\";\r\n    let l =\r\n      (value &&\r\n        value.title &&\r\n        value.title.content &&\r\n        value.title.content.url) ||\r\n      (value &&\r\n        value.raw &&\r\n        value.raw.itemContent &&\r\n        value.raw.itemContent.url) ||\r\n      (item && item.content && item.content.url) ||\r\n      \"\";\r\n    let r = null;\r\n    if (item && Array.isArray(item.fieldValues)) {\r\n      let w = item.fieldValues.find(\r\n        (x: any) =>\r\n          x &&\r\n          x.type === \"single_select\" &&\r\n          ((x.raw &&\r\n            x.raw.field &&\r\n            String(x.raw.field.name || \"\").toLowerCase() === \"status\") ||\r\n            (x.fieldName &&\r\n              String(x.fieldName || \"\").toLowerCase() === \"status\") ||\r\n            (x.field &&\r\n              x.field.name &&\r\n              String(x.field.name || \"\").toLowerCase() === \"status\")),\r\n      );\r\n      w &&\r\n        (r =\r\n          (w.option && (w.option.color || w.option.id || w.option.name)) ||\r\n          (w.raw && w.raw.color) ||\r\n          null);\r\n    }\r\n    let a = normalizeColor(r) || null,\r\n      p = a && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(a) ? a : \"#666666\",\r\n      g = escapeHtml(String(t || \"\")),\r\n      f = o ? escapeHtml(String(o)) : \"\";\r\n\r\n    // Determine high-level content type (issue vs pull request) and state\r\n    const content =\r\n      (value && value.title && value.title.content) ||\r\n      (value && value.raw && value.raw.itemContent) ||\r\n      (item && item.content) ||\r\n      null;\r\n\r\n    let isPullRequest = false;\r\n    let isDraft = false;\r\n    let isClosed = false;\r\n    let isMerged = false;\r\n    let isBlocked = false;\r\n\r\n    let parentIsDoneByStatus = false;\r\n    try {\r\n      if (content && typeof content.__typename === \"string\") {\r\n        const tname = String(content.__typename).toLowerCase();\r\n        if (tname.includes(\"pullrequest\")) isPullRequest = true;\r\n      }\r\n      if (!isPullRequest && content && typeof content.state === \"string\") {\r\n        const st = String(content.state).toUpperCase();\r\n        if (st === \"CLOSED\") isClosed = true;\r\n        if (st === \"MERGED\") isMerged = true;\r\n      }\r\n      if (isPullRequest) {\r\n        if (typeof (content as any).isDraft === \"boolean\") {\r\n          isDraft = !!(content as any).isDraft;\r\n        }\r\n        const st =\r\n          (content as any).state &&\r\n          String((content as any).state).toUpperCase();\r\n        if (st === \"CLOSED\") isClosed = true;\r\n        if ((content as any).merged) isMerged = true;\r\n      }\r\n      const completedNames = [\"done\", \"closed\", \"completed\", \"finished\"];\r\n      // Canonical blocked state from GraphQL Issue dependencies\r\n      try {\r\n        const deps =\r\n          content && (content as any).issueDependenciesSummary\r\n            ? (content as any).issueDependenciesSummary\r\n            : null;\r\n        const blockedByCount =\r\n          deps && typeof deps.blockedBy === \"number\" ? deps.blockedBy : 0;\r\n        isBlocked = blockedByCount > 0;\r\n      } catch (_) {\r\n        isBlocked = false;\r\n      }\r\n\r\n      let hasDoneFromStatus = false;\r\n      if (Array.isArray(item && item.fieldValues)) {\r\n        const statusFv = (item.fieldValues as any[]).find((fv: any) => {\r\n          if (!fv || fv.type !== \"single_select\") return false;\r\n          const fname =\r\n            (fv.raw && fv.raw.field && fv.raw.field.name) ||\r\n            fv.fieldName ||\r\n            (fv.field && fv.field.name) ||\r\n            \"\";\r\n          return String(fname || \"\").toLowerCase() === \"status\";\r\n        });\r\n        if (statusFv && statusFv.option && statusFv.option.name) {\r\n          const optNameLower = String(statusFv.option.name).toLowerCase();\r\n          if (completedNames.includes(optNameLower)) {\r\n            hasDoneFromStatus = true;\r\n          }\r\n        }\r\n      }\r\n      // Treat issues/PRs as effectively closed when status or labels indicate \"done\"-like states\r\n      const hasDoneLabel = !!(\r\n        content &&\r\n        content.labels &&\r\n        Array.isArray(content.labels.nodes) &&\r\n        content.labels.nodes.some((l: any) =>\r\n          completedNames.includes(String((l && l.name) || \"\").toLowerCase()),\r\n        )\r\n      );\r\n\r\n      if (hasDoneFromStatus || hasDoneLabel) {\r\n        // Do not override \"merged\" (PRs still show merge icon),\r\n        // but otherwise consider this effectively closed for icon purposes.\r\n        if (!isMerged) {\r\n          isClosed = true;\r\n        }\r\n      }\r\n    } catch (e) {}\r\n\r\n    // Choose base icon based on type/state\r\n    let iconName = \"issue-opened\";\r\n    if (isPullRequest) {\r\n      if (isMerged) iconName = \"git-merge\";\r\n      else if (isClosed) iconName = \"git-pull-request-closed\";\r\n      else if (isDraft) iconName = \"git-pull-request-draft\";\r\n      else iconName = \"git-pull-request\";\r\n    } else {\r\n      if (isClosed) iconName = \"issue-closed\";\r\n      else if (isDraft) iconName = \"issue-draft\";\r\n      else iconName = \"issue-opened\";\r\n    }\r\n\r\n    const baseIcon = getIconSvg(iconName as any, {\r\n      size: 14,\r\n      className: \"field-icon title-icon\",\r\n      fill: p,\r\n    });\r\n\r\n    const blockedIcon = isBlocked\r\n      ? getIconSvg(\"blocked\" as any, {\r\n          size: 9,\r\n          className: \"field-icon blocked-icon\",\r\n          fill: \"#dc3545\",\r\n        })\r\n      : \"\";\r\n\r\n    // Create tooltip with full title and number\r\n    const tooltipText = f ? `${t} #${o}` : t;\r\n\r\n    const safeUrl = escapeHtml(String(l || \"\"));\r\n    const safeTooltip = escapeHtml(tooltipText);\r\n\r\n    // When we have a URL, render as an actual anchor so that the tests can\r\n    // assert on href/target attributes. We keep data-gh-open for in-webview\r\n    // click handling while also supporting native browser semantics.\r\n    if (safeUrl) {\r\n      return (\r\n        '<a href=\"' +\r\n        safeUrl +\r\n        '\" data-gh-open=\"' +\r\n        safeUrl +\r\n        '\" title=\"' +\r\n        safeTooltip +\r\n        '\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"cursor:pointer;color:inherit;text-decoration:none;display:inline-flex;align-items:center;gap:8px;width:100%;\">' +\r\n        \"<span style='position:relative;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0'>\" +\r\n        baseIcon +\r\n        (blockedIcon\r\n          ? \"<span class='blocked-overlay' style='position:absolute;right:-3px;bottom:-3px;width:14px;height:14px;border-radius:999px;background:var(--vscode-editor-background);display:flex;align-items:center;justify-content:center;box-sizing:border-box;'>\" +\r\n            blockedIcon +\r\n            \"</span>\"\r\n          : \"\") +\r\n        \"</span>\" +\r\n        '<span style=\"flex:1;min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block\">' +\r\n        g +\r\n        \"</span>\" +\r\n        (f\r\n          ? '<span style=\"flex:none;margin-left:6px;color:var(--vscode-descriptionForeground);white-space:nowrap\">#' +\r\n            f +\r\n            \"</span>\"\r\n          : \"\") +\r\n        \"</a>\"\r\n      );\r\n    }\r\n\r\n    // Fallback when there is no URL: keep the non-link wrapper with tooltip.\r\n    return (\r\n      '<span title=\"' +\r\n      safeTooltip +\r\n      '\" style=\"color:inherit;display:inline-flex;align-items:center;gap:8px;width:100%;\">' +\r\n      \"<span style='position:relative;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0'>\" +\r\n      baseIcon +\r\n      (blockedIcon\r\n        ? \"<span class='blocked-overlay' style='position:absolute;right:-3px;bottom:-3px;width:14px;height:14px;border-radius:999px;background:var(--vscode-editor-background);display:flex;align-items:center;justify-content:center;box-sizing:border-box;'>\" +\r\n          blockedIcon +\r\n          \"</span>\"\r\n        : \"\") +\r\n      \"</span>\" +\r\n      '<span style=\"flex:1;min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block\">' +\r\n      g +\r\n      \"</span>\" +\r\n      (f\r\n        ? '<span style=\"flex:none;margin-left:6px;color:var(--vscode-descriptionForeground);white-space:nowrap\">#' +\r\n          f +\r\n          \"</span>\"\r\n        : \"\") +\r\n      \"</span>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class TextRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    return (\r\n      \"<div>\" +\r\n      escapeHtml((value && value.text) != null ? value.text : \"\") +\r\n      \"</div>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class NumberRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    let t =\r\n      value.number !== void 0 && value.number !== null\r\n        ? String(value.number)\r\n        : \"\";\r\n    return (\r\n      '<div style=\"text-align:right;font-variant-numeric:tabular-nums\">' +\r\n      escapeHtml(t) +\r\n      \"</div>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class DateRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    let t = value.date || value.startDate || value.dueOn || null;\r\n    if (!t) return \"<div></div>\";\r\n    try {\r\n      let o = new Date(t);\r\n      if (isNaN(o.getTime())) return \"<div>\" + escapeHtml(String(t)) + \"</div>\";\r\n      let l = o.toLocaleDateString(\"en-US\", {\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n        year: \"numeric\",\r\n      });\r\n      return \"<div>\" + escapeHtml(l) + \"</div>\";\r\n    } catch (e) {\r\n      return \"<div>\" + escapeHtml(String(t)) + \"</div>\";\r\n    }\r\n  }\r\n}\r\n\r\nexport class SingleSelectRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    let n =\r\n      (value && value.option && value.option.name) ||\r\n      (value && value.name) ||\r\n      \"\";\r\n    if (!n) return \"<div></div>\";\r\n    let c =\r\n      (value && value.option && (value.option.color || value.option.id)) ||\r\n      (value && value.color) ||\r\n      null;\r\n    // Match visual style of label field pills\r\n    let p = normalizeColor(c) || null,\r\n      hasHex = !!(p && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(p)),\r\n      border = p || \"#999999\",\r\n      bg = (hasHex && addAlpha(p, 0.12)) || \"rgba(0,0,0,0.06)\",\r\n      fg = p || \"#333333\";\r\n    return (\r\n      \"<span style='display:inline-block;padding:2px 8px;margin-right:6px;border-radius:999px;border:1px solid \" +\r\n      escapeHtml(border) +\r\n      \";background:\" +\r\n      escapeHtml(bg) +\r\n      \";color:\" +\r\n      escapeHtml(fg) +\r\n      \";font-size:12px;line-height:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis'>\" +\r\n      escapeHtml(n) +\r\n      \"</span>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class IterationRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    let i = value.iteration || value;\r\n    if (!i || !i.title) return \"<div></div>\";\r\n    // Use same pill design as labels/single-select fields\r\n    const name = String(i.title || \"\");\r\n    const rawColor = i.color || i.colour || null;\r\n    let p = normalizeColor(rawColor) || null,\r\n      hasHex = !!(p && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(p)),\r\n      border = p || \"#999999\",\r\n      bg = (hasHex && addAlpha(p, 0.12)) || \"rgba(0,0,0,0.06)\",\r\n      // Ensure text color matches the pill border color\r\n      fg = border;\r\n    return (\r\n      \"<span style='display:inline-block;padding:2px 8px;margin-right:6px;border-radius:999px;border:1px solid \" +\r\n      escapeHtml(border) +\r\n      \";background:\" +\r\n      escapeHtml(bg) +\r\n      \";color:\" +\r\n      escapeHtml(fg) +\r\n      \";font-size:12px;line-height:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis'>\" +\r\n      escapeHtml(name) +\r\n      \"</span>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class RepositoryRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    const r = value && (value.repository || value);\r\n    if (!r) return \"<div></div>\";\r\n\r\n    const name =\r\n      (r && (r.nameWithOwner || r.full_name || r.name || r.id || \"\")) || \"\";\r\n\r\n    if (!name) return \"<div></div>\";\r\n\r\n    // Extract URL from repository object\r\n    const url =\r\n      (r &&\r\n        (r.url ||\r\n          r.html_url ||\r\n          (r.nameWithOwner && `https://github.com/${r.nameWithOwner}`))) ||\r\n      \"\";\r\n\r\n    const icon = getIconSvg(\"repo\", {\r\n      size: 16,\r\n      className: \"field-icon\",\r\n      ariaLabel: \"Repository\",\r\n    });\r\n\r\n    // If we have a URL, make it clickable via data-gh-open\r\n    if (url) {\r\n      // Create tooltip with name and URL separated by a dash for better HTML rendering\r\n      const tooltip = name + \" - \" + url;\r\n      return (\r\n        '<div data-gh-open=\"' +\r\n        escapeHtml(url) +\r\n        '\" title=\"' +\r\n        escapeHtml(tooltip) +\r\n        '\" style=\"display:flex;align-items:center;gap:6px;cursor:pointer\">' +\r\n        icon +\r\n        \"<span>\" +\r\n        escapeHtml(String(name)) +\r\n        \"</span></div>\"\r\n      );\r\n    }\r\n\r\n    // Fallback: no URL, just display the name\r\n    return (\r\n      '<div style=\"display:flex;align-items:center;gap:6px\">' +\r\n      icon +\r\n      \"<span>\" +\r\n      escapeHtml(String(name)) +\r\n      \"</span></div>\"\r\n    );\r\n  }\r\n}\r\n\r\n// Helper for contrast color (duplicated from utils to avoid circular deps if utils imports this, but utils is safe)\r\n// Removed local getContrastColor since we import it.\r\n\r\nexport class LabelsRenderer implements CellRendererStrategy {\r\n  render(value: any, field: any, item: any, allItems: any): string {\r\n    return (\r\n      \"<div>\" +\r\n      (value.labels || [])\r\n        .map((o: any) => {\r\n          let l = escapeHtml(o.name || \"\"),\r\n            r =\r\n              (item &&\r\n                ((item.content &&\r\n                  item.content.repository &&\r\n                  item.content.repository.nameWithOwner) ||\r\n                  (item.repository && item.repository.nameWithOwner))) ||\r\n              (value.raw &&\r\n                value.raw.itemContent &&\r\n                value.raw.itemContent.repository &&\r\n                value.raw.itemContent.repository.nameWithOwner) ||\r\n              null,\r\n            a = o.color || o.colour || null;\r\n          if (field && field.repoOptions && r && field.repoOptions[r]) {\r\n            let k = field.repoOptions[r].find(\r\n              (L: any) => L && L.name === o.name,\r\n            );\r\n            k && (a = k.color || k.colour || a);\r\n          }\r\n          let p = normalizeColor(a) || null,\r\n            g = !!(p && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(p)),\r\n            f = p || \"#999999\",\r\n            h = (g && addAlpha(p, 0.12)) || \"rgba(0,0,0,0.06)\",\r\n            w = p || \"#333333\";\r\n          return (\r\n            \"<span style='display:inline-block;padding:2px 8px;margin-right:6px;border-radius:999px;border:1px solid \" +\r\n            escapeHtml(f) +\r\n            \";background:\" +\r\n            escapeHtml(h) +\r\n            \";color:\" +\r\n            escapeHtml(w) +\r\n            \";font-size:12px;line-height:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis'>\" +\r\n            l +\r\n            \"</span>\"\r\n          );\r\n        })\r\n        .join(\"\") +\r\n      \"</div>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class PullRequestRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    const prs = value.pullRequests || [];\r\n    if (!prs || prs.length === 0) return \"\";\r\n    let out =\r\n      \"<div style='display:flex;flex-wrap:wrap;gap:6px;align-items:center'>\";\r\n    for (let i = 0; i < prs.length; i++) {\r\n      let p = prs[i];\r\n      let num = escapeHtml(String((p && p.number) || \"\"));\r\n      let titleText = escapeHtml((p && p.title) || \"\");\r\n      let url = escapeHtml((p && p.url) || \"\");\r\n      let rawColor =\r\n        (p && (p.state_color || p.color || p.colour || p.state)) || null;\r\n      let normColor = normalizeColor(rawColor) || null;\r\n      let hasHex = !!(\r\n        normColor && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(normColor)\r\n      );\r\n      let border = normColor || \"#999999\";\r\n      let bg = (hasHex && addAlpha(normColor, 0.12)) || \"rgba(0,0,0,0.06)\";\r\n      let fg = getContrastColor(normColor) || \"#333333\";\r\n      const isDraft = !!(p && (p as any).isDraft);\r\n      const state = (p && p.state && String(p.state).toUpperCase()) || \"\";\r\n      const isMerged = !!(p && p.merged);\r\n      const isClosed = !isMerged && state === \"CLOSED\";\r\n\r\n      let iconName = \"git-pull-request\";\r\n      if (isMerged) iconName = \"git-merge\";\r\n      else if (isClosed) iconName = \"git-pull-request-closed\";\r\n      else if (isDraft) iconName = \"git-pull-request-draft\";\r\n\r\n      const baseIcon = getIconSvg(iconName as any, {\r\n        size: 12,\r\n        className: \"field-icon pr-icon\",\r\n        fill: normColor || \"#666\",\r\n      });\r\n\r\n      // Blocked heuristic for PR: label named \"blocked\"\r\n      const hasBlockedLabel = !!(\r\n        p &&\r\n        Array.isArray(p.labels) &&\r\n        p.labels.some(\r\n          (l: any) =>\r\n            l &&\r\n            typeof l.name === \"string\" &&\r\n            String(l.name).toLowerCase() === \"blocked\",\r\n        )\r\n      );\r\n\r\n      const blockedIcon = hasBlockedLabel\r\n        ? getIconSvg(\"blocked\" as any, {\r\n            size: 8,\r\n            className: \"field-icon blocked-icon\",\r\n            fill: \"#dc3545\",\r\n          })\r\n        : \"\";\r\n\r\n      // Create tooltip with number and title\r\n      const tooltip = titleText\r\n        ? escapeHtml(`#${p.number} ${p.title}`)\r\n        : escapeHtml(`#${p.number}`);\r\n\r\n      out +=\r\n        \"<a href='\" +\r\n        url +\r\n        \"' title='\" +\r\n        tooltip +\r\n        \"' target='_blank' rel='noopener noreferrer' style='cursor:pointer;text-decoration:none;color:inherit'>\" +\r\n        \"<span style='display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid \" +\r\n        escapeHtml(border) +\r\n        \";background:\" +\r\n        escapeHtml(bg) +\r\n        \";color:\" +\r\n        escapeHtml(fg) +\r\n        \";font-size:12px;line-height:18px;overflow:hidden;box-sizing:border-box;max-width:160px'>\" +\r\n        \"<span style='position:relative;display:inline-flex;align-items:center;justify-content:center'>\" +\r\n        baseIcon +\r\n        (blockedIcon\r\n          ? \"<span class='blocked-overlay' style='position:absolute;right:-3px;bottom:-3px;width:13px;height:13px;border-radius:999px;background:var(--vscode-editor-background);display:flex;align-items:center;justify-content:center;box-sizing:border-box;'>\" +\r\n            blockedIcon +\r\n            \"</span>\"\r\n          : \"\") +\r\n        \"</span>\" +\r\n        \"<span style='flex:1 1 auto;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap'>#\" +\r\n        num +\r\n        \"</span></span></a>\";\r\n    }\r\n    out += \"</div>\";\r\n    return out;\r\n  }\r\n}\r\n\r\nexport class IssueRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    return (value.issues || [])\r\n      .map((t: any) => {\r\n        const tooltip = t.title\r\n          ? escapeHtml(`#${t.number} ${t.title}`)\r\n          : escapeHtml(`#${t.number}`);\r\n        return (\r\n          \"<a href='\" +\r\n          escapeHtml(t.url || \"\") +\r\n          \"' target='_blank' rel='noopener noreferrer' title='\" +\r\n          tooltip +\r\n          \"' style='display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap'>#\" +\r\n          escapeHtml(String(t.number || \"\")) +\r\n          \" \" +\r\n          escapeHtml(t.title || \"\") +\r\n          \"</a>\"\r\n        );\r\n      })\r\n      .join(\"<br/>\");\r\n  }\r\n}\r\n\r\nexport class AssigneesRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    const assignees = value.assignees || [];\r\n    if (!assignees || assignees.length === 0) return \"<div></div>\";\r\n\r\n    // Helper to build a GitHub profile URL for an assignee\r\n    const getProfileUrl = (g: any): string => {\r\n      const login = g && (g.login || g.name || \"\");\r\n      const direct = (g && (g.url || g.html_url)) || \"\";\r\n      if (direct) return String(direct);\r\n      if (login) return `https://github.com/${login}`;\r\n      return \"\";\r\n    };\r\n\r\n    const avatarHtml = assignees\r\n      .slice(0, 3)\r\n      .map((g: any, index: number) => {\r\n        const avatarUrl = escapeHtml(g.avatarUrl || g.avatar || \"\");\r\n        const offset = index === 0 ? \"0px\" : index === 1 ? \"-8px\" : \"-14px\";\r\n        const zIndex = Math.max(1, 3 - index);\r\n        const login = g.login || g.name || \"\";\r\n        const initials = escapeHtml(\r\n          (g.name || g.login || \"\")\r\n            .split(\" \")\r\n            .map((part: any) => part[0] || \"\")\r\n            .join(\"\")\r\n            .toUpperCase()\r\n            .slice(0, 2),\r\n        );\r\n        const profileUrl = escapeHtml(getProfileUrl(g));\r\n\r\n        const commonStyle =\r\n          \"display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:50%;border:2px solid var(--vscode-editor-background);margin-left:\" +\r\n          offset +\r\n          \";vertical-align:middle;position:relative;z-index:\" +\r\n          zIndex +\r\n          \";\";\r\n\r\n        if (avatarUrl) {\r\n          return (\r\n            \"<span title='\" +\r\n            escapeHtml(login || \"\") +\r\n            \"' data-gh-open='\" +\r\n            profileUrl +\r\n            \"' style='\" +\r\n            commonStyle +\r\n            \"overflow:hidden;background-size:cover;background-position:center;background-image:url(\" +\r\n            avatarUrl +\r\n            \");'></span>\"\r\n          );\r\n        }\r\n\r\n        return (\r\n          \"<span title='\" +\r\n          escapeHtml(login || \"\") +\r\n          \"' data-gh-open='\" +\r\n          profileUrl +\r\n          \"' style='\" +\r\n          commonStyle +\r\n          \"background:#777;color:#fff;font-size:11px;'>\" +\r\n          initials +\r\n          \"</span>\"\r\n        );\r\n      })\r\n      .join(\"\");\r\n\r\n    const names = assignees.map((g: any) => g.login || g.name || \"\");\r\n    let summary = \"\";\r\n    if (names.length === 1) summary = names[0];\r\n    else if (names.length === 2) summary = names[0] + \" and \" + names[1];\r\n    else summary = names.slice(0, -1).join(\", \") + \" and \" + names.slice(-1)[0];\r\n\r\n    // Use the first assignee as a primary profile target when clicking the\r\n    // text summary area. Individual avatars already have their own targets.\r\n    const primaryProfileUrl = escapeHtml(getProfileUrl(assignees[0]));\r\n\r\n    return (\r\n      \"<div style='display:flex;align-items:center;gap:8px'>\" +\r\n      \"<span style='display:flex;align-items:center'>\" +\r\n      \"<span style='display:inline-block;vertical-align:middle;height:20px;line-height:20px;margin-right:8px;'>\" +\r\n      avatarHtml +\r\n      \"</span>\" +\r\n      \"</span>\" +\r\n      \"<span data-gh-open='\" +\r\n      primaryProfileUrl +\r\n      \"' style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer'>\" +\r\n      escapeHtml(summary) +\r\n      \"</span></div>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class RequestedReviewersRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    const reviewers = value.reviewers || [];\r\n    if (!reviewers || reviewers.length === 0) return \"<div></div>\";\r\n\r\n    const parts = reviewers.map((r: any) => {\r\n      const login = r.login || r.name || r.kind || \"\";\r\n      const display = escapeHtml(login);\r\n      const direct = (r && (r.url || r.html_url)) || \"\";\r\n      const url = direct || (login ? `https://github.com/${login}` : \"\");\r\n      const safeUrl = escapeHtml(url);\r\n\r\n      if (!url) {\r\n        return display;\r\n      }\r\n\r\n      return (\r\n        \"<a href='\" +\r\n        safeUrl +\r\n        \"' target='_blank' rel='noopener noreferrer' data-gh-open='\" +\r\n        safeUrl +\r\n        \"' style='text-decoration:none;color:inherit'>\" +\r\n        display +\r\n        \"</a>\"\r\n      );\r\n    });\r\n\r\n    return \"<div>\" + parts.join(\", \") + \"</div>\";\r\n  }\r\n}\r\n\r\nexport class MilestoneRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    return (\r\n      \"<div>\" +\r\n      escapeHtml((value.milestone && value.milestone.title) || \"\") +\r\n      \"</div>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class SubIssuesProgressRenderer implements CellRendererStrategy {\r\n  render(value: any): string {\r\n    try {\r\n      if (!value || value.total == null || Number(value.total) <= 0) return \"\";\r\n      const totalCount = Math.max(0, Math.floor(Number(value.total) || 0));\r\n      const doneCount = Math.max(0, Math.floor(Number(value.done || 0)));\r\n      if (totalCount === 0) return \"\";\r\n      let pct = null;\r\n      if (value.percent !== void 0 && value.percent !== null)\r\n        pct = Number(value.percent);\r\n      else pct = Math.round((doneCount / totalCount) * 100);\r\n      if (pct == null || !isFinite(pct)) return \"\";\r\n      pct = Math.max(0, Math.min(100, pct));\r\n\r\n      // Create tooltip with detailed progress information\r\n      const tooltip = escapeHtml(\r\n        `${doneCount} of ${totalCount} sub-issues complete (${pct}%)`,\r\n      );\r\n\r\n      const barHtml =\r\n        \"<div class='sub-issues-progress' title='\" +\r\n        tooltip +\r\n        \"' style='display:flex;align-items:center;gap:8px;width:100%;'>\" +\r\n        \"<div class='sub-issues-progress-count' style='min-width:44px;text-align:left;font-variant-numeric:tabular-nums;color:var(--vscode-descriptionForeground)'>\" +\r\n        escapeHtml(String(doneCount) + \"/\" + String(totalCount)) +\r\n        \"</div>\" +\r\n        \"<div class='sub-issues-progress-bar' style='flex:1;min-width:0'>\" +\r\n        \"<div style='width:100%;height:12px;border-radius:6px;border:1px solid var(--vscode-focusBorder);overflow:hidden;background:transparent;box-sizing:border-box'>\" +\r\n        \"<div style='height:100%;width:\" +\r\n        String(pct) +\r\n        \"%;background:var(--vscode-focusBorder)'></div>\" +\r\n        \"</div>\" +\r\n        \"</div>\" +\r\n        \"<div class='sub-issues-progress-pct' style='min-width:44px;text-align:right;font-variant-numeric:tabular-nums;color:var(--vscode-descriptionForeground)'>\" +\r\n        escapeHtml(String(pct) + \"%\") +\r\n        \"</div>\" +\r\n        \"</div>\";\r\n      return barHtml;\r\n    } catch (e) {\r\n      return \"\";\r\n    }\r\n  }\r\n}\r\n\r\nexport class ParentIssueRenderer implements CellRendererStrategy {\r\n  render(value: any, field: any, item: any, allItems: any): string {\r\n    const completedNames = [\"done\", \"closed\", \"completed\", \"finished\"];\r\n    let parentIsDoneByStatus = false;\r\n\r\n    let t =\r\n        (value &&\r\n          (value.parent ||\r\n            value.parentIssue ||\r\n            value.issue ||\r\n            value.option ||\r\n            value.item ||\r\n            value.value)) ||\r\n        (value &&\r\n          value.raw &&\r\n          (value.raw.parent || value.raw.itemContent || value.raw.item)) ||\r\n        null,\r\n      o =\r\n        (t &&\r\n          (t.number || t.id || (t.raw && t.raw.number)) &&\r\n          (t.number || (t.raw && t.raw.number))) ||\r\n        \"\",\r\n      l =\r\n        (t &&\r\n          (t.title || t.name || (t.raw && t.raw.title)) &&\r\n          (t.title || t.name || (t.raw && t.raw.title))) ||\r\n        \"\",\r\n      r =\r\n        (t &&\r\n          (t.url || t.html_url || (t.raw && t.raw.url)) &&\r\n          (t.url || t.html_url || (t.raw && t.raw.url))) ||\r\n        \"\",\r\n      a = escapeHtml(String(l || \"\")),\r\n      p = o ? escapeHtml(String(o)) : \"\",\r\n      g = escapeHtml(String(r || \"\")),\r\n      f = null;\r\n    try {\r\n      var itemsList = Array.isArray(allItems) ? allItems : allItems || [];\r\n      if (Array.isArray(itemsList) && itemsList.length > 0 && (o || t)) {\r\n        let B =\r\n            (t &&\r\n              t.repository &&\r\n              (t.repository.nameWithOwner || t.repository.name)) ||\r\n            (t &&\r\n              t.content &&\r\n              t.content.repository &&\r\n              t.content.repository.nameWithOwner) ||\r\n            null,\r\n          O: string[] = [];\r\n        (o && O.push(String(o)),\r\n          t &&\r\n            (t.id || (t.raw && t.raw.id)) &&\r\n            O.push(String(t.id || (t.raw && t.raw.id))),\r\n          t &&\r\n            (t.url || (t.raw && t.raw.url)) &&\r\n            O.push(String(t.url || (t.raw && t.raw.url))),\r\n          t && (t.title || t.name) && O.push(String(t.title || t.name)));\r\n        let $ = itemsList.find((A) => {\r\n          let d = (A && (A.content || (A.raw && A.raw.itemContent))) || null;\r\n          if (!d) return !1;\r\n          let M = [];\r\n          if (\r\n            (d.number && M.push(String(d.number)),\r\n            d.id && M.push(String(d.id)),\r\n            d.url && M.push(String(d.url)),\r\n            d.title && M.push(String(d.title)),\r\n            d.name && M.push(String(d.name)),\r\n            d.raw && d.raw.number && M.push(String(d.raw.number)),\r\n            d.raw && d.raw.id && M.push(String(d.raw.id)),\r\n            d.raw && d.raw.url && M.push(String(d.raw.url)),\r\n            B)\r\n          ) {\r\n            let V =\r\n              (d.repository &&\r\n                (d.repository.nameWithOwner || d.repository.name)) ||\r\n              null;\r\n            if (V && String(V) !== String(B)) return !1;\r\n          }\r\n          for (let V = 0; V < O.length; V++)\r\n            for (let X = 0; X < M.length; X++)\r\n              if (O[V] && M[X] && String(O[V]) === String(M[X])) return !0;\r\n          return !1;\r\n        });\r\n        if ($ && Array.isArray($.fieldValues)) {\r\n          let A = $.fieldValues.find(\r\n            (d: any) =>\r\n              d &&\r\n              d.type === \"single_select\" &&\r\n              ((d.raw &&\r\n                d.raw.field &&\r\n                String(d.raw.field.name || \"\").toLowerCase() === \"status\") ||\r\n                (d.fieldName &&\r\n                  String(d.fieldName || \"\").toLowerCase() === \"status\") ||\r\n                (d.field &&\r\n                  d.field.name &&\r\n                  String(d.field.name || \"\").toLowerCase() === \"status\")),\r\n          );\r\n          if (A) {\r\n            f =\r\n              (A.option && (A.option.color || A.option.id || A.option.name)) ||\r\n              (A.raw && A.raw.color) ||\r\n              null;\r\n\r\n            // If the parent issue's Status option is a completed-like state,\r\n            // treat it as closed for icon purposes.\r\n            if (A.option && A.option.name) {\r\n              const optNameLower = String(A.option.name).toLowerCase();\r\n              if (completedNames.includes(optNameLower)) {\r\n                parentIsDoneByStatus = true;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {}\r\n    f ||\r\n      (f =\r\n        (t &&\r\n          ((t.option && (t.option.color || t.option.id || t.option.name)) ||\r\n            t.color ||\r\n            t.colour)) ||\r\n        null);\r\n    let h = normalizeColor(f) || null,\r\n      w = !!(h && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(h)),\r\n      x = h || \"#999999\",\r\n      k = (w && addAlpha(h, 0.12)) || \"rgba(0,0,0,0.06)\",\r\n      L = getContrastColor(h) || \"#333333\";\r\n\r\n    // Determine icon for parent issue based on state and blocked heuristics\r\n    let isClosed = false;\r\n    let isDraft = false;\r\n    let isBlocked = false;\r\n    try {\r\n      const state =\r\n        (t && t.state && String(t.state).toUpperCase()) ||\r\n        (t &&\r\n          t.parent &&\r\n          t.parent.state &&\r\n          String(t.parent.state).toUpperCase()) ||\r\n        \"\";\r\n      if (state === \"CLOSED\") isClosed = true;\r\n\r\n      const hasBlockedLabel = !!(\r\n        t &&\r\n        Array.isArray(t.labels) &&\r\n        t.labels.some(\r\n          (l: any) =>\r\n            l &&\r\n            typeof l.name === \"string\" &&\r\n            String(l.name).toLowerCase() === \"blocked\",\r\n        )\r\n      );\r\n      isBlocked = hasBlockedLabel;\r\n\r\n      // Treat parent issue as effectively closed when status or labels indicate\r\n      // \"done\"-like states, mirroring the TitleRenderer heuristics.\r\n      const hasDoneLabel = !!(\r\n        t &&\r\n        Array.isArray(t.labels) &&\r\n        t.labels.some((l: any) =>\r\n          completedNames.includes(String((l && l.name) || \"\").toLowerCase()),\r\n        )\r\n      );\r\n\r\n      if (hasDoneLabel || parentIsDoneByStatus) {\r\n        isClosed = true;\r\n      }\r\n    } catch (e) {}\r\n\r\n    let parentIconName = \"issue-opened\";\r\n    if (isClosed) parentIconName = \"issue-closed\";\r\n    else if (isDraft) parentIconName = \"issue-draft\";\r\n\r\n    const parentIcon = getIconSvg(parentIconName as any, {\r\n      size: 14,\r\n      className: \"field-icon parent-issue-icon\",\r\n      fill: h || \"#666\",\r\n    });\r\n\r\n    const blockedIcon = isBlocked\r\n      ? getIconSvg(\"blocked\" as any, {\r\n          size: 9,\r\n          className: \"field-icon blocked-icon\",\r\n          fill: \"#dc3545\",\r\n        })\r\n      : \"\";\r\n\r\n    let q =\r\n      \"<span style='display:block;width:100%;box-sizing:border-box'>\" +\r\n      \"<div style='display:inline-flex;align-items:center;gap:8px;padding:4px 10px;border:1px solid \" +\r\n      escapeHtml(x) +\r\n      \";border-radius:999px;color:\" +\r\n      escapeHtml(L) +\r\n      \";background:\" +\r\n      escapeHtml(k) +\r\n      \";font-size:12px;line-height:18px;overflow:hidden;box-sizing:border-box;width:100%'>\" +\r\n      \"<span style='position:relative;display:inline-flex;align-items:center;justify-content:center'>\" +\r\n      parentIcon +\r\n      (blockedIcon\r\n        ? \"<span class='blocked-overlay' style='position:absolute;right:-3px;bottom:-3px;width:14px;height:14px;border-radius:999px;background:var(--vscode-editor-background);display:flex;align-items:center;justify-content:center;box-sizing:border-box;'>\" +\r\n          blockedIcon +\r\n          \"</span>\"\r\n        : \"\") +\r\n      \"</span>\" +\r\n      \"<span class='parent-issue-title' style='flex:1;min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block'>\" +\r\n      a +\r\n      \"</span>\" +\r\n      (p\r\n        ? \"<span style='margin-left:6px;color:var(--vscode-descriptionForeground);white-space:nowrap'>#\" +\r\n          p +\r\n          \"</span>\"\r\n        : \"\") +\r\n      \"</div></span>\";\r\n    const parentWrapper =\r\n      \"<span data-gh-open='\" +\r\n      (g || \"\") +\r\n      \"' class='parent-issue-wrapper' style='display:block;width:100%;cursor:\" +\r\n      (g ? \"pointer\" : \"default\") +\r\n      \"'>\";\r\n    return g ? parentWrapper + q + \"</span>\" : q;\r\n  }\r\n}\r\n", "import {\r\n  CellRendererStrategy,\r\n  TitleRenderer,\r\n  TextRenderer,\r\n  NumberRenderer,\r\n  DateRenderer,\r\n  SingleSelectRenderer,\r\n  IterationRenderer,\r\n  RepositoryRenderer,\r\n  LabelsRenderer,\r\n  PullRequestRenderer,\r\n  IssueRenderer,\r\n  AssigneesRenderer,\r\n  RequestedReviewersRenderer,\r\n  MilestoneRenderer,\r\n  SubIssuesProgressRenderer,\r\n  ParentIssueRenderer,\r\n} from \"./strategies\";\r\n\r\nconst strategies: Record<string, CellRendererStrategy> = {\r\n  title: new TitleRenderer(),\r\n  text: new TextRenderer(),\r\n  number: new NumberRenderer(),\r\n  date: new DateRenderer(),\r\n  single_select: new SingleSelectRenderer(),\r\n  iteration: new IterationRenderer(),\r\n  repository: new RepositoryRenderer(),\r\n  labels: new LabelsRenderer(),\r\n  pull_request: new PullRequestRenderer(),\r\n  issue: new IssueRenderer(),\r\n  assignees: new AssigneesRenderer(),\r\n  reviewers: new RequestedReviewersRenderer(),\r\n  milestone: new MilestoneRenderer(),\r\n  sub_issues_progress: new SubIssuesProgressRenderer(),\r\n  parent_issue: new ParentIssueRenderer(),\r\n  linked_pull_requests: new PullRequestRenderer(),\r\n  tracks: new IssueRenderer(),\r\n};\r\n\r\nexport function renderCell(e: any, n: any, s: any, allItems: any) {\r\n  if (!e) return \"\";\r\n  try {\r\n    const strategy = strategies[e.type];\r\n    if (strategy) {\r\n      return strategy.render(e, n, s, allItems);\r\n    }\r\n    return \"\";\r\n  } catch (err) {\r\n    console.error(\"Error rendering cell\", err);\r\n    return \"\";\r\n  }\r\n}\r\n", "export function setLoadingState(container: HTMLElement, titleText: string) {\r\n  container.innerHTML =\r\n    '<div class=\"title\">' +\r\n    titleText +\r\n    '</div><div class=\"loading\"><em>Loading...</em></div>';\r\n}\r\n\r\nexport function setErrorState(\r\n  container: HTMLElement,\r\n  titleText: string,\r\n  error: string,\r\n) {\r\n  container.innerHTML =\r\n    '<div class=\"title\">' +\r\n    titleText +\r\n    '</div><div style=\"color:var(--vscode-editor-foreground)\">' +\r\n    error +\r\n    \"</div>\";\r\n}\r\n\r\nexport function createLoadMoreButton(onClick: () => void): HTMLButtonElement {\r\n  const btn = document.createElement(\"button\");\r\n  btn.type = \"button\";\r\n  btn.textContent = \"Load more\";\r\n  btn.style.marginLeft = \"8px\";\r\n  btn.style.border = \"1px solid var(--vscode-editorWidget-border)\";\r\n  btn.addEventListener(\"click\", () => {\r\n    onClick();\r\n    btn.disabled = true;\r\n    btn.textContent = \"Loading...\";\r\n  });\r\n  return btn;\r\n}\r\n\r\nexport function clearElement(element: HTMLElement) {\r\n  while (element.firstChild) {\r\n    element.removeChild(element.firstChild);\r\n  }\r\n}\r\n\r\nexport function toggleClass(\r\n  element: HTMLElement,\r\n  className: string,\r\n  force?: boolean,\r\n) {\r\n  element.classList.toggle(className, force);\r\n}\r\n", "/// <reference path=\"./global.d.ts\" />\r\nimport { logDebug } from \"./utils/logger\";\r\nimport {\r\n  setLoadingState,\r\n  setErrorState,\r\n  createLoadMoreButton,\r\n} from \"./utils/domUtils\";\r\n\r\nexport { logDebug, setLoadingState, setErrorState, createLoadMoreButton };\r\n\r\n/**\r\n * Initializes the filter bar using the shared filterBarHelper.\r\n * Returns the barApi if successful, or null.\r\n */\r\nexport function initFilterBar(\r\n  container: HTMLElement,\r\n  viewKey: string,\r\n  options: {\r\n    suffix?: string;\r\n    step?: number;\r\n    effFilter?: string;\r\n    onLoadMore?: () => void;\r\n    onSave?: (filter: any) => void;\r\n    onDiscard?: () => void;\r\n  },\r\n): any {\r\n  if (\r\n    window.filterBarHelper &&\r\n    typeof window.filterBarHelper.create === \"function\"\r\n  ) {\r\n    try {\r\n      return window.filterBarHelper.create({\r\n        parent: container,\r\n        suffix: options.suffix || viewKey,\r\n        effFilter:\r\n          typeof options.effFilter === \"string\" ? options.effFilter : undefined,\r\n        viewKey: viewKey,\r\n        step: options.step || 50,\r\n        onLoadMore: options.onLoadMore,\r\n        onSave: options.onSave,\r\n        onDiscard: options.onDiscard,\r\n      });\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Toggles visibility of elements based on matched IDs from the filter.\r\n */\r\nexport function applyFilterVisibility(\r\n  root: HTMLElement | Document,\r\n  selector: string,\r\n  matchedIds: Set<string>,\r\n  displayStyle: string = \"block\",\r\n) {\r\n  try {\r\n    const elements = Array.from(root.querySelectorAll(selector));\r\n    for (let i = 0; i < elements.length; i++) {\r\n      try {\r\n        const el = elements[i] as HTMLElement;\r\n        const id = el.getAttribute(\"data-gh-item-id\");\r\n        el.style.display = matchedIds.has(String(id)) ? displayStyle : \"none\";\r\n      } catch (e) {}\r\n    }\r\n  } catch (e) {}\r\n}\r\n", "import type { FieldConfig } from \"../../../lib/types\";\r\n\r\nexport interface SortConfig {\r\n  fieldId: string;\r\n  direction: \"ASC\" | \"DESC\";\r\n  secondary?: {\r\n    fieldId: string;\r\n    direction: \"ASC\" | \"DESC\";\r\n  };\r\n}\r\n\r\n/**\r\n * Parse sortByFields from GitHub GraphQL response into SortConfig\r\n */\r\nexport function parseSortByFields(sortByFields: any): SortConfig | null {\r\n  if (!sortByFields || !sortByFields.nodes || sortByFields.nodes.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const primary = sortByFields.nodes[0];\r\n  if (!primary || !primary.field) {\r\n    return null;\r\n  }\r\n\r\n  const config: SortConfig = {\r\n    fieldId: primary.field.id || primary.field.name,\r\n    direction: primary.direction || \"ASC\",\r\n  };\r\n\r\n  // Add secondary sort if available\r\n  if (sortByFields.nodes.length > 1) {\r\n    const secondary = sortByFields.nodes[1];\r\n    if (secondary && secondary.field) {\r\n      config.secondary = {\r\n        fieldId: secondary.field.id || secondary.field.name,\r\n        direction: secondary.direction || \"ASC\",\r\n      };\r\n    }\r\n  }\r\n\r\n  return config;\r\n}\r\n\r\n/**\r\n * Sort items array based on sort configuration\r\n */\r\nexport function sortItems(\r\n  items: any[],\r\n  fields: FieldConfig[],\r\n  sortConfig: SortConfig,\r\n): any[] {\r\n  if (!sortConfig || items.length === 0) {\r\n    return items;\r\n  }\r\n\r\n  const field = fields.find(\r\n    (f) => f.id === sortConfig.fieldId || f.name === sortConfig.fieldId,\r\n  );\r\n  if (!field) {\r\n    return items;\r\n  }\r\n\r\n  // Create a copy to avoid mutating original\r\n  const sorted = [...items];\r\n\r\n  sorted.sort((a, b) => {\r\n    // Primary sort\r\n    const primaryResult = compareFieldValues(a, b, field, sortConfig.direction);\r\n\r\n    // If equal and secondary sort exists, use secondary\r\n    if (primaryResult === 0 && sortConfig.secondary) {\r\n      const secondaryField = fields.find(\r\n        (f) =>\r\n          f.id === sortConfig.secondary!.fieldId ||\r\n          f.name === sortConfig.secondary!.fieldId,\r\n      );\r\n      if (secondaryField) {\r\n        return compareFieldValues(\r\n          a,\r\n          b,\r\n          secondaryField,\r\n          sortConfig.secondary.direction,\r\n        );\r\n      }\r\n    }\r\n\r\n    return primaryResult;\r\n  });\r\n\r\n  return sorted;\r\n}\r\n\r\n/**\r\n * Compare two items by a specific field\r\n */\r\nexport function compareFieldValues(\r\n  a: any,\r\n  b: any,\r\n  field: FieldConfig,\r\n  direction: \"ASC\" | \"DESC\",\r\n): number {\r\n  // Find field values for both items\r\n  const aValue = getFieldValue(a, field);\r\n  const bValue = getFieldValue(b, field);\r\n\r\n  // Handle null/undefined\r\n  if (aValue === null && bValue === null) return 0;\r\n  if (aValue === null) return direction === \"ASC\" ? 1 : -1;\r\n  if (bValue === null) return direction === \"ASC\" ? -1 : 1;\r\n\r\n  let result = 0;\r\n  const dataType = (field.dataType || \"\").toLowerCase();\r\n\r\n  switch (dataType) {\r\n    case \"text\":\r\n    case \"title\":\r\n      result = compareText(aValue, bValue);\r\n      break;\r\n\r\n    case \"number\":\r\n      result = compareNumber(aValue, bValue);\r\n      break;\r\n\r\n    case \"date\":\r\n      result = compareDate(aValue, bValue);\r\n      break;\r\n\r\n    case \"single_select\":\r\n      result = compareSingleSelect(aValue, bValue, field);\r\n      break;\r\n\r\n    case \"iteration\":\r\n      result = compareIteration(aValue, bValue);\r\n      break;\r\n\r\n    case \"labels\":\r\n      result = compareLabels(aValue, bValue);\r\n      break;\r\n\r\n    case \"assignees\":\r\n    case \"repository\":\r\n    case \"milestone\":\r\n    case \"issue_type\":\r\n    case \"parent_issue\":\r\n    case \"tracked_by\":\r\n    case \"tracks\":\r\n    case \"reviewers\":\r\n      result = compareText(aValue, bValue);\r\n      break;\r\n\r\n    case \"linked_pull_requests\":\r\n    case \"sub_issues_progress\":\r\n      result = compareNumber(aValue, bValue);\r\n      break;\r\n\r\n    default:\r\n      // For unsupported data types, do not apply custom sorting\r\n      // and treat items as equal so their relative order is preserved.\r\n      result = 0;\r\n  }\r\n\r\n  return direction === \"ASC\" ? result : -result;\r\n}\r\n\r\n/**\r\n * Extract field value from item\r\n */\r\nfunction getFieldValue(item: any, field: FieldConfig): any {\r\n  const fieldValue = item.fieldValues?.find(\r\n    (fv: any) => fv.fieldId === field.id || fv.fieldName === field.name,\r\n  );\r\n\r\n  if (!fieldValue) return null;\r\n\r\n  const dataType = (field.dataType || \"\").toLowerCase();\r\n\r\n  switch (dataType) {\r\n    case \"text\": {\r\n      // Normal text fields use .text, but some Title-like fields may be\r\n      // mis-typed as TEXT while still carrying a structured title object.\r\n      if (fieldValue.text != null) return fieldValue.text;\r\n      return extractTitleLikeString(fieldValue, item);\r\n    }\r\n\r\n    case \"title\": {\r\n      // Title fields store a structured object; prefer a human-friendly string\r\n      return extractTitleLikeString(fieldValue, item);\r\n    }\r\n\r\n    case \"number\":\r\n      return fieldValue.number !== undefined ? fieldValue.number : null;\r\n\r\n    case \"date\":\r\n      return (\r\n        fieldValue.date || fieldValue.startDate || fieldValue.dueOn || null\r\n      );\r\n\r\n    case \"single_select\":\r\n      return fieldValue.option || fieldValue;\r\n\r\n    case \"iteration\":\r\n      return fieldValue;\r\n\r\n    case \"labels\":\r\n      return fieldValue.labels || [];\r\n\r\n    case \"assignees\": {\r\n      const list = fieldValue.assignees;\r\n      if (Array.isArray(list) && list.length > 0) {\r\n        const first = list[0];\r\n        return first.login || first.name || null;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    case \"repository\": {\r\n      const repo = fieldValue.repository;\r\n      if (!repo) return null;\r\n      return (\r\n        repo.nameWithOwner || repo.name || repo.full_name || repo.id || null\r\n      );\r\n    }\r\n\r\n    case \"milestone\": {\r\n      const m = fieldValue.milestone;\r\n      if (!m) return null;\r\n      // Prefer due date when present (ISO date strings sort lexicographically),\r\n      // otherwise fall back to title/name.\r\n      return m.dueOn || m.title || m.name || null;\r\n    }\r\n\r\n    case \"issue_type\": {\r\n      if (fieldValue.text) return fieldValue.text;\r\n      if (fieldValue.option) {\r\n        return fieldValue.option.name || fieldValue.option.title || null;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    case \"parent_issue\": {\r\n      const parent = fieldValue.parent;\r\n      if (!parent) return null;\r\n      if (parent.title) return parent.title;\r\n      if (typeof parent.number === \"number\") return String(parent.number);\r\n      return parent.id || null;\r\n    }\r\n\r\n    case \"linked_pull_requests\": {\r\n      const prs = fieldValue.pullRequests;\r\n      if (Array.isArray(prs) && prs.length > 0) {\r\n        const first = prs[0];\r\n        if (typeof first.number === \"number\") return first.number;\r\n        return first.title || null;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    case \"reviewers\": {\r\n      const list = fieldValue.reviewers;\r\n      if (Array.isArray(list) && list.length > 0) {\r\n        const first = list[0];\r\n        return first.login || first.name || first.id || null;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    case \"sub_issues_progress\": {\r\n      if (typeof fieldValue.percent === \"number\") return fieldValue.percent;\r\n      if (\r\n        typeof fieldValue.done === \"number\" &&\r\n        typeof fieldValue.total === \"number\" &&\r\n        fieldValue.total > 0\r\n      ) {\r\n        return (fieldValue.done / fieldValue.total) * 100;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    case \"tracked_by\":\r\n    case \"tracks\": {\r\n      const issues = fieldValue.issues;\r\n      if (Array.isArray(issues) && issues.length > 0) {\r\n        const first = issues[0];\r\n        if (first.title) return first.title;\r\n        if (typeof first.number === \"number\") return String(first.number);\r\n        return first.id || null;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    default:\r\n      return fieldValue;\r\n  }\r\n}\r\n\r\nfunction extractTitleLikeString(fieldValue: any, item: any): string | null {\r\n  if (!fieldValue) return null;\r\n\r\n  // Prefer the underlying raw node's text when present\r\n  const rawNode =\r\n    (fieldValue.title && fieldValue.title.raw) || fieldValue.raw || null;\r\n  if (rawNode && typeof rawNode.text === \"string\" && rawNode.text.trim()) {\r\n    return rawNode.text;\r\n  }\r\n\r\n  // Then look at the content object which often carries title/name\r\n  const content =\r\n    (fieldValue.title && fieldValue.title.content) ||\r\n    fieldValue.content ||\r\n    (rawNode && rawNode.itemContent) ||\r\n    (item && item.content) ||\r\n    null;\r\n\r\n  if (content) {\r\n    if (typeof content === \"string\" && content.trim()) {\r\n      return content;\r\n    }\r\n    if (typeof content.title === \"string\" && content.title.trim()) {\r\n      return content.title;\r\n    }\r\n    if (typeof content.name === \"string\" && content.name.trim()) {\r\n      return content.name;\r\n    }\r\n  }\r\n\r\n  // Fallbacks: occasionally a plain text field is reused\r\n  if (typeof fieldValue.text === \"string\" && fieldValue.text.trim()) {\r\n    return fieldValue.text;\r\n  }\r\n  if (rawNode && typeof rawNode.title === \"string\" && rawNode.title.trim()) {\r\n    return rawNode.title;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Compare text values\r\n */\r\nfunction compareText(a: any, b: any): number {\r\n  const aStr = String(a || \"\").toLowerCase();\r\n  const bStr = String(b || \"\").toLowerCase();\r\n  return aStr.localeCompare(bStr);\r\n}\r\n\r\n/**\r\n * Compare number values\r\n */\r\nfunction compareNumber(a: any, b: any): number {\r\n  const aNum = typeof a === \"number\" ? a : parseFloat(a);\r\n  const bNum = typeof b === \"number\" ? b : parseFloat(b);\r\n\r\n  if (isNaN(aNum) && isNaN(bNum)) return 0;\r\n  if (isNaN(aNum)) return 1;\r\n  if (isNaN(bNum)) return -1;\r\n\r\n  return aNum - bNum;\r\n}\r\n\r\n/**\r\n * Compare date values\r\n */\r\nfunction compareDate(a: any, b: any): number {\r\n  const aDate = new Date(a);\r\n  const bDate = new Date(b);\r\n\r\n  if (isNaN(aDate.getTime()) && isNaN(bDate.getTime())) return 0;\r\n  if (isNaN(aDate.getTime())) return 1;\r\n  if (isNaN(bDate.getTime())) return -1;\r\n\r\n  return aDate.getTime() - bDate.getTime();\r\n}\r\n\r\n/**\r\n * Compare single select values by option order\r\n */\r\nfunction compareSingleSelect(a: any, b: any, field: FieldConfig): number {\r\n  const aOption = a.option || a;\r\n  const bOption = b.option || b;\r\n\r\n  if (!aOption || !bOption) {\r\n    return compareText(aOption?.name || \"\", bOption?.name || \"\");\r\n  }\r\n\r\n  // If field has options array, sort by position in array\r\n  if (field.options && Array.isArray(field.options)) {\r\n    const aIndex = field.options.findIndex(\r\n      (opt: any) => opt.id === aOption.id || opt.name === aOption.name,\r\n    );\r\n    const bIndex = field.options.findIndex(\r\n      (opt: any) => opt.id === bOption.id || opt.name === bOption.name,\r\n    );\r\n\r\n    if (aIndex !== -1 && bIndex !== -1) {\r\n      return aIndex - bIndex;\r\n    }\r\n  }\r\n\r\n  // Fallback to name comparison\r\n  return compareText(aOption.name, bOption.name);\r\n}\r\n\r\n/**\r\n * Compare iteration values by start date\r\n */\r\nfunction compareIteration(a: any, b: any): number {\r\n  const aDate = a.startDate || a.iteration?.startDate;\r\n  const bDate = b.startDate || b.iteration?.startDate;\r\n\r\n  if (!aDate && !bDate) {\r\n    // Sort by title if no dates\r\n    return compareText(\r\n      a.title || a.iteration?.title,\r\n      b.title || b.iteration?.title,\r\n    );\r\n  }\r\n\r\n  return compareDate(aDate, bDate);\r\n}\r\n\r\n/**\r\n * Compare labels by first label name\r\n */\r\nfunction compareLabels(a: any, b: any): number {\r\n  const aLabels = Array.isArray(a) ? a : [];\r\n  const bLabels = Array.isArray(b) ? b : [];\r\n\r\n  if (aLabels.length === 0 && bLabels.length === 0) return 0;\r\n  if (aLabels.length === 0) return 1;\r\n  if (bLabels.length === 0) return -1;\r\n\r\n  return compareText(aLabels[0].name, bLabels[0].name);\r\n}\r\n", "/**\r\n * Slice Panel Component\r\n * Shows unique values for a field with counts, allowing quick filtering\r\n */\r\n\r\nimport { normalizeColor, escapeHtml } from \"../utils\";\r\n\r\nexport class SlicePanel {\r\n  private container: HTMLElement;\r\n  private field: any;\r\n  private items: any[];\r\n  private panelElement: HTMLElement | null = null;\r\n  private onValueSelectCallback?: (value: any) => void;\r\n  private onFieldChangeCallback?: (field: any) => void;\r\n  private allFields: any[];\r\n\r\n  constructor(\r\n    container: HTMLElement,\r\n    field: any,\r\n    items: any[],\r\n    allFields?: any[],\r\n  ) {\r\n    this.container = container;\r\n    this.field = field;\r\n    this.items = items;\r\n    this.allFields = allFields || [];\r\n  }\r\n\r\n  /**\r\n   * Render the slice panel\r\n   */\r\n  public render(): void {\r\n    this.close(); // Close any existing panel\r\n\r\n    // Create panel\r\n    this.panelElement = document.createElement(\"div\");\r\n    this.panelElement.className = \"slice-panel\";\r\n    this.panelElement.style.position = \"relative\";\r\n    this.panelElement.style.float = \"left\";\r\n    // Restore persisted width if available\r\n    try {\r\n      const stored = localStorage.getItem(\"ghProjects.slicePanel.width\");\r\n      if (stored) this.panelElement.style.width = stored;\r\n      else this.panelElement.style.width = \"280px\";\r\n    } catch (e) {\r\n      this.panelElement.style.width = \"280px\";\r\n    }\r\n    this.panelElement.style.marginRight = \"12px\";\r\n    this.panelElement.style.background = \"var(--vscode-sideBar-background)\";\r\n    this.panelElement.style.border = \"1px solid var(--vscode-sideBar-border)\";\r\n    this.panelElement.style.borderRadius = \"6px\";\r\n    this.panelElement.style.display = \"flex\";\r\n    this.panelElement.style.flexDirection = \"column\";\r\n    this.panelElement.style.overflow = \"hidden\";\r\n    this.panelElement.style.maxHeight = \"600px\";\r\n\r\n    // Temporary debug overlay: shows last resolved parent metadata and progress\r\n    const debugOverlay = document.createElement(\"pre\");\r\n    debugOverlay.className = \"slice-panel-debug-overlay\";\r\n    debugOverlay.style.position = \"absolute\";\r\n    debugOverlay.style.left = \"8px\";\r\n    debugOverlay.style.bottom = \"8px\";\r\n    debugOverlay.style.right = \"8px\";\r\n    debugOverlay.style.maxHeight = \"120px\";\r\n    debugOverlay.style.overflow = \"auto\";\r\n    debugOverlay.style.background = \"rgba(0,0,0,0.6)\";\r\n    debugOverlay.style.color = \"white\";\r\n    debugOverlay.style.fontSize = \"11px\";\r\n    debugOverlay.style.padding = \"8px\";\r\n    debugOverlay.style.borderRadius = \"6px\";\r\n    debugOverlay.style.zIndex = \"200\";\r\n    debugOverlay.style.display = \"none\"; // hidden by default\r\n    debugOverlay.title = \"SlicePanel debug (click to show/hide)\";\r\n    debugOverlay.addEventListener(\"click\", () => {\r\n      debugOverlay.style.display =\r\n        debugOverlay.style.display === \"none\" ? \"block\" : \"none\";\r\n    });\r\n    this.panelElement.appendChild(debugOverlay);\r\n\r\n    // Add resizer on the right edge to allow adjusting panel width\r\n    const resizer = document.createElement(\"div\");\r\n    resizer.className = \"slice-panel-resizer\";\r\n    resizer.style.position = \"absolute\";\r\n    resizer.style.top = \"0\";\r\n    resizer.style.right = \"0\";\r\n    resizer.style.bottom = \"0\";\r\n    resizer.style.width = \"6px\";\r\n    resizer.style.cursor = \"col-resize\";\r\n    resizer.style.zIndex = \"100\";\r\n    this.panelElement.appendChild(resizer);\r\n\r\n    let startX: number | null = null;\r\n    let startWidth: number | null = null;\r\n\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      if (startX == null || startWidth == null) return;\r\n      const dx = e.pageX - startX;\r\n      const newW = Math.max(160, startWidth + dx);\r\n      this.panelElement!.style.width = newW + \"px\";\r\n    };\r\n\r\n    const onMouseUp = () => {\r\n      if (startX == null) return;\r\n      document.removeEventListener(\"mousemove\", onMouseMove);\r\n      document.removeEventListener(\"mouseup\", onMouseUp);\r\n      try {\r\n        localStorage.setItem(\r\n          \"ghProjects.slicePanel.width\",\r\n          this.panelElement!.style.width,\r\n        );\r\n      } catch (e) {}\r\n      startX = null;\r\n      startWidth = null;\r\n    };\r\n\r\n    resizer.addEventListener(\"mousedown\", (ev: MouseEvent) => {\r\n      ev.preventDefault();\r\n      startX = ev.pageX;\r\n      startWidth = this.panelElement ? this.panelElement.offsetWidth : 280;\r\n      document.addEventListener(\"mousemove\", onMouseMove);\r\n      document.addEventListener(\"mouseup\", onMouseUp);\r\n    });\r\n\r\n    // Header with dropdown\r\n    const header = document.createElement(\"div\");\r\n    header.style.padding = \"12px\";\r\n    header.style.borderBottom = \"1px solid var(--vscode-sideBar-border)\";\r\n    header.style.display = \"flex\";\r\n    header.style.flexDirection = \"column\";\r\n    header.style.gap = \"8px\";\r\n\r\n    const headerTop = document.createElement(\"div\");\r\n    headerTop.style.display = \"flex\";\r\n    headerTop.style.alignItems = \"center\";\r\n    headerTop.style.gap = \"8px\";\r\n\r\n    const sliceLabel = document.createElement(\"span\");\r\n    sliceLabel.textContent = \"Slice by\";\r\n    sliceLabel.style.fontSize = \"11px\";\r\n    sliceLabel.style.fontWeight = \"600\";\r\n    sliceLabel.style.color = \"var(--vscode-descriptionForeground)\";\r\n    sliceLabel.style.textTransform = \"uppercase\";\r\n    sliceLabel.style.letterSpacing = \"0.5px\";\r\n    headerTop.appendChild(sliceLabel);\r\n\r\n    // Field dropdown/button\r\n    const fieldButton = document.createElement(\"button\");\r\n    fieldButton.textContent = this.field.name;\r\n    fieldButton.style.flex = \"1\";\r\n    fieldButton.style.padding = \"6px 12px\";\r\n    fieldButton.style.background = \"var(--vscode-button-secondaryBackground)\";\r\n    fieldButton.style.color = \"var(--vscode-button-secondaryForeground)\";\r\n    fieldButton.style.border = \"1px solid var(--vscode-button-border)\";\r\n    fieldButton.style.borderRadius = \"4px\";\r\n    fieldButton.style.cursor = \"pointer\";\r\n    fieldButton.style.fontSize = \"13px\";\r\n    fieldButton.style.fontWeight = \"500\";\r\n    fieldButton.style.textAlign = \"left\";\r\n    fieldButton.style.display = \"flex\";\r\n    fieldButton.style.justifyContent = \"space-between\";\r\n    fieldButton.style.alignItems = \"center\";\r\n\r\n    // Add dropdown arrow\r\n    const arrow = document.createElement(\"span\");\r\n    arrow.textContent = \"\u25BC\";\r\n    arrow.style.fontSize = \"10px\";\r\n    arrow.style.marginLeft = \"auto\";\r\n    fieldButton.appendChild(arrow);\r\n\r\n    // Add dropdown menu on click\r\n    fieldButton.addEventListener(\"click\", (e) => {\r\n      e.stopPropagation();\r\n      this.showFieldDropdown(fieldButton);\r\n    });\r\n\r\n    headerTop.appendChild(fieldButton);\r\n    header.appendChild(headerTop);\r\n\r\n    this.panelElement.appendChild(header);\r\n\r\n    // Content\r\n    const content = document.createElement(\"div\");\r\n    content.style.flex = \"1\";\r\n    content.style.overflow = \"auto\";\r\n    content.style.padding = \"8px\";\r\n\r\n    this.renderValues(content);\r\n\r\n    this.panelElement.appendChild(content);\r\n    this.container.appendChild(this.panelElement);\r\n  }\r\n\r\n  /**\r\n   * Show dropdown menu to select a different field\r\n   */\r\n  private showFieldDropdown(anchorButton: HTMLElement, anchorRectOverride?: DOMRect): void {\r\n    // Get sliceable fields\r\n    const sliceableTypes = new Set([\r\n      \"assignees\",\r\n      \"single_select\",\r\n      \"parent_issue\",\r\n      \"iteration\",\r\n      \"number\",\r\n      \"date\",\r\n      \"milestone\",\r\n      \"repository\",\r\n      \"labels\",\r\n      \"text\",\r\n      \"single_line_text\",\r\n    ]);\r\n\r\n    const sliceableFields = this.allFields.filter((f) => {\r\n      const dataType = (f.dataType || \"\").toLowerCase();\r\n      return sliceableTypes.has(dataType);\r\n    });\r\n\r\n    if (sliceableFields.length === 0) return;\r\n\r\n    // Create dropdown\r\n    const dropdown = document.createElement(\"div\");\r\n    dropdown.style.position = \"absolute\";\r\n    const rect = anchorRectOverride ? anchorRectOverride : anchorButton.getBoundingClientRect();\r\n    if (anchorRectOverride) {\r\n      // Accessed from ActiveTabMenu: position to the right\r\n      dropdown.style.top = `${rect.top}px`;\r\n      dropdown.style.left = `${rect.right + 4}px`;\r\n    } else {\r\n      // Accessed from sidepanel: position below\r\n      dropdown.style.top = `${rect.bottom + 4}px`;\r\n      dropdown.style.left = `${rect.left}px`;\r\n    }\r\n    dropdown.style.minWidth = `${anchorButton.offsetWidth}px`;\r\n    dropdown.style.background = \"var(--vscode-dropdown-background)\";\r\n    dropdown.style.border = \"1px solid var(--vscode-dropdown-border)\";\r\n    dropdown.style.borderRadius = \"4px\";\r\n    dropdown.style.boxShadow = \"0 4px 8px rgba(0,0,0,0.2)\";\r\n    dropdown.style.zIndex = \"1000\";\r\n    dropdown.style.maxHeight = \"300px\";\r\n    dropdown.style.overflowY = \"auto\";\r\n\r\n    sliceableFields.forEach((field) => {\r\n      const item = document.createElement(\"div\");\r\n      item.style.display = \"flex\";\r\n      item.style.alignItems = \"center\";\r\n\r\n      // Checkmark span (fixed width for alignment)\r\n      const checkSpan = document.createElement(\"span\");\r\n      checkSpan.style.display = \"inline-block\";\r\n      checkSpan.style.width = \"14px\";\r\n      checkSpan.style.marginRight = \"8px\";\r\n      checkSpan.style.textAlign = \"center\";\r\n      checkSpan.textContent = field.id === this.field.id ? \"\u2713\" : \"\";\r\n      checkSpan.style.color = \"var(--vscode-menu-selectionForeground)\";\r\n      item.appendChild(checkSpan);\r\n\r\n      // Icon for field type\r\n      const iconSpan = document.createElement(\"span\");\r\n      iconSpan.style.display = \"inline-flex\";\r\n      iconSpan.style.alignItems = \"center\";\r\n      iconSpan.style.justifyContent = \"center\";\r\n      iconSpan.style.width = \"18px\";\r\n      iconSpan.style.marginRight = \"8px\";\r\n      iconSpan.innerHTML = this.getIconForDataType(\r\n        (field.dataType || \"\").toString().toLowerCase(),\r\n      );\r\n      item.appendChild(iconSpan);\r\n\r\n      const labelSpan = document.createElement(\"span\");\r\n      labelSpan.textContent = field.name;\r\n      item.appendChild(labelSpan);\r\n      item.style.padding = \"8px 12px\";\r\n      item.style.cursor = \"pointer\";\r\n      item.style.fontSize = \"13px\";\r\n      item.style.color = \"var(--vscode-dropdown-foreground)\";\r\n\r\n      if (field.id === this.field.id) {\r\n        item.style.background = \"var(--vscode-list-activeSelectionBackground)\";\r\n        item.style.color = \"var(--vscode-list-activeSelectionForeground)\";\r\n      }\r\n\r\n      item.addEventListener(\"mouseenter\", () => {\r\n        if (field.id !== this.field.id) {\r\n          item.style.background = \"var(--vscode-list-hoverBackground)\";\r\n        }\r\n      });\r\n\r\n      item.addEventListener(\"mouseleave\", () => {\r\n        if (field.id !== this.field.id) {\r\n          item.style.background = \"transparent\";\r\n        }\r\n      });\r\n\r\n      item.addEventListener(\"click\", () => {\r\n        this.field = field;\r\n        // Update checkmarks and styles in the dropdown\r\n        const items = dropdown.querySelectorAll('div');\r\n        sliceableFields.forEach((f, idx) => {\r\n          const itemEl = items[idx] as HTMLElement;\r\n          if (!itemEl) return;\r\n          const checkSpanEl = itemEl.querySelector('span:first-child') as HTMLElement;\r\n          if (f.id === this.field.id) {\r\n            checkSpanEl.textContent = '\u2713';\r\n            itemEl.style.background = 'var(--vscode-list-activeSelectionBackground)';\r\n            itemEl.style.color = 'var(--vscode-list-activeSelectionForeground)';\r\n          } else {\r\n            checkSpanEl.textContent = '';\r\n            itemEl.style.background = 'transparent';\r\n            itemEl.style.color = 'var(--vscode-dropdown-foreground)';\r\n          }\r\n        });\r\n        this.render();\r\n        if (this.onFieldChangeCallback) {\r\n          this.onFieldChangeCallback(field);\r\n        }\r\n        // Refresh the menu info\r\n        try { if ((window as any).__sliceMenuRefresh) (window as any).__sliceMenuRefresh(); } catch (e) { }\r\n      });\r\n\r\n      dropdown.appendChild(item);\r\n    });\r\n\r\n    // Backdrop to close dropdown\r\n    const backdrop = document.createElement(\"div\");\r\n    backdrop.style.position = \"fixed\";\r\n    backdrop.style.top = \"0\";\r\n    backdrop.style.left = \"0\";\r\n    backdrop.style.right = \"0\";\r\n    backdrop.style.bottom = \"0\";\r\n    backdrop.style.zIndex = \"999\";\r\n\r\n    backdrop.addEventListener(\"click\", () => {\r\n      dropdown.remove();\r\n      backdrop.remove();\r\n    });\r\n\r\n    document.body.appendChild(backdrop);\r\n    document.body.appendChild(dropdown);\r\n  }\r\n\r\n  /**\r\n   * Public helper: open the field dropdown. If `anchorRect` is provided the dropdown\r\n   * will be positioned using that rect (useful when opening from an external menu).\r\n   */\r\n  public openFieldDropdown(anchorRect?: DOMRect): void {\r\n    try {\r\n      if (!this.panelElement) return;\r\n      const btn = this.panelElement.querySelector('button');\r\n      if (!btn) return;\r\n      // call internal method with optional rect override\r\n      this.showFieldDropdown(btn as HTMLElement, anchorRect);\r\n    } catch (e) { }\r\n  }\r\n\r\n  /**\r\n   * Return inline SVG HTML for a given dataType using the icon registry.\r\n   */\r\n  private getIconForDataType(dataType: string): string {\r\n    // Use the icon registry if available (shared with FieldsMenu)\r\n    if (\r\n      typeof (window as any).getIconNameForDataType === \"function\" &&\r\n      typeof (window as any).getIconSvg === \"function\"\r\n    ) {\r\n      const iconName = (window as any).getIconNameForDataType(dataType);\r\n      return (window as any).getIconSvg(iconName);\r\n    }\r\n\r\n    // Fallback: empty span\r\n    return \"<span></span>\";\r\n  }\r\n\r\n  /**\r\n   * Render the list of unique values with counts\r\n   */\r\n  private renderValues(container: HTMLElement): void {\r\n    // Get unique values and their counts\r\n    const valueCounts = this.getValueCounts();\r\n\r\n    if (valueCounts.size === 0) {\r\n      const empty = document.createElement(\"div\");\r\n      empty.textContent = \"No values\";\r\n      empty.style.padding = \"8px\";\r\n      empty.style.color = \"var(--vscode-descriptionForeground)\";\r\n      container.appendChild(empty);\r\n      return;\r\n    }\r\n\r\n    // Sort by count (descending)\r\n    const sorted = Array.from(valueCounts.entries()).sort(\r\n      (a, b) => b[1].count - a[1].count,\r\n    );\r\n\r\n    // Helper: resolve parent item and compute progress (done/total/pct)\r\n    const resolveParentProgress = (parentMeta: any) => {\r\n      const result: any = {\r\n        resolved: null,\r\n        statusColor: null,\r\n        number: null,\r\n        title: null,\r\n        done: 0,\r\n        total: 0,\r\n        pct: 0,\r\n      };\r\n      if (!parentMeta) return result;\r\n\r\n      // Build identifier list from parentMeta\r\n      const identifiers: string[] = [];\r\n      if (parentMeta.number) identifiers.push(String(parentMeta.number));\r\n      if (parentMeta.id) identifiers.push(String(parentMeta.id));\r\n      if (parentMeta.url) identifiers.push(String(parentMeta.url));\r\n      if (parentMeta.title) identifiers.push(String(parentMeta.title));\r\n\r\n      // Try to find a matching item in this.items (same logic as grouping header resolution)\r\n      const found = this.items.find((A: any) => {\r\n        const d = (A && (A.content || (A.raw && A.raw.itemContent))) || null;\r\n        if (!d) return false;\r\n        const M: string[] = [];\r\n        if (d.number) M.push(String(d.number));\r\n        if (d.id) M.push(String(d.id));\r\n        if (d.url) M.push(String(d.url));\r\n        if (d.title) M.push(String(d.title));\r\n        if (d.name) M.push(String(d.name));\r\n        if (d.raw && d.raw.number) M.push(String(d.raw.number));\r\n        if (d.raw && d.raw.id) M.push(String(d.raw.id));\r\n        if (d.raw && d.raw.url) M.push(String(d.raw.url));\r\n        for (let o of identifiers) {\r\n          for (let m of M) {\r\n            if (o && m && String(o) === String(m)) return true;\r\n          }\r\n        }\r\n        return false;\r\n      });\r\n\r\n      if (!found) return result; // single strategy: only use resolved item in snapshot\r\n\r\n      result.resolved = found;\r\n      const content =\r\n        found.content || (found.raw && found.raw.itemContent) || null;\r\n      result.title =\r\n        content && (content.title || content.name)\r\n          ? content.title || content.name\r\n          : found.title || found.name || null;\r\n      result.number =\r\n        content && content.number\r\n          ? String(content.number)\r\n          : found.number || found.id || null;\r\n\r\n      // Determine status color from single_select field in parent (if present)\r\n      if (Array.isArray(found.fieldValues)) {\r\n        const statusFV = found.fieldValues.find(\r\n          (v: any) =>\r\n            v && v.type === \"single_select\" && v.option && v.option.name,\r\n        );\r\n        if (statusFV && statusFV.option) {\r\n          try {\r\n            const c =\r\n              statusFV.option.color ||\r\n              statusFV.option.id ||\r\n              statusFV.option.name ||\r\n              null;\r\n            result.statusColor = normalizeColor(c) || null;\r\n          } catch (e) {}\r\n        }\r\n\r\n        // Try to read aggregate progress field (sub_issues_progress or synthesized with total/done)\r\n        const agg = found.fieldValues.find(\r\n          (v: any) =>\r\n            v &&\r\n            (v.type === \"sub_issues_progress\" ||\r\n              (v.total != null && v.done != null)),\r\n        );\r\n        if (agg && agg.total != null) {\r\n          result.total = Number(agg.total || 0);\r\n          result.done = Number(agg.done || 0);\r\n          result.pct =\r\n            result.total > 0\r\n              ? Math.round((result.done / result.total) * 100)\r\n              : 0;\r\n        }\r\n      }\r\n\r\n      return result;\r\n    };\r\n\r\n    // Render each value with grouping-style presentation\r\n    sorted.forEach(([key, { value, count, rawValue }]) => {\r\n      const item = document.createElement(\"div\");\r\n      item.className = \"slice-value-item\";\r\n      item.style.padding = \"10px 12px\";\r\n      item.style.cursor = \"pointer\";\r\n      item.style.borderRadius = \"4px\";\r\n      item.style.marginBottom = \"4px\";\r\n      item.style.display = \"flex\";\r\n      item.style.alignItems = \"center\";\r\n      item.style.gap = \"8px\";\r\n      item.style.transition = \"background-color 0.15s ease\";\r\n\r\n      const dataType = (this.field.dataType || \"\").toLowerCase();\r\n\r\n      // Normalize parent meta for this iteration so both visual and label rendering use the same source\r\n      let parentMetaForIteration: any = null;\r\n      if (dataType === \"parent_issue\" && rawValue) {\r\n        parentMetaForIteration =\r\n          rawValue.parent ||\r\n          rawValue.parentIssue ||\r\n          rawValue.issue ||\r\n          rawValue.item ||\r\n          rawValue.value ||\r\n          rawValue;\r\n      }\r\n\r\n      // Left visual area: avatar / color dot / repo icon\r\n      const leftVisual = document.createElement(\"div\");\r\n      leftVisual.style.display = \"flex\";\r\n      leftVisual.style.alignItems = \"center\";\r\n      leftVisual.style.gap = \"8px\";\r\n      leftVisual.style.flex = \"0 0 auto\";\r\n\r\n      // Helper: create a color dot\r\n      const makeColorDot = (c: string | null) => {\r\n        const dot = document.createElement(\"span\");\r\n        dot.style.display = \"inline-block\";\r\n        dot.style.width = \"12px\";\r\n        dot.style.height = \"12px\";\r\n        dot.style.borderRadius = \"50%\";\r\n        dot.style.flexShrink = \"0\";\r\n        dot.style.backgroundColor = c || \"var(--vscode-descriptionForeground)\";\r\n        return dot;\r\n      };\r\n\r\n      let visualAppended = false;\r\n\r\n      // Assignees: rawValue may be an individual assignee object (from getValueCounts)\r\n      if (dataType === \"assignees\" && rawValue) {\r\n        const a = rawValue;\r\n        const avatarUrl =\r\n          a && (a.avatarUrl || a.avatar || a.imageUrl || a.avatar_url);\r\n        if (avatarUrl) {\r\n          const avatarEl = document.createElement(\"span\");\r\n          avatarEl.innerHTML =\r\n            '<span title=\"' +\r\n            escapeHtml(a.login || a.name || a.id || \"\") +\r\n            '\" style=\"display:inline-block;width:20px;height:20px;border-radius:50%;overflow:hidden;background-size:cover;background-position:center;background-image:url(' +\r\n            escapeHtml(avatarUrl) +\r\n            ');border:2px solid var(--vscode-editor-background)\"></span>';\r\n          leftVisual.appendChild(avatarEl);\r\n          visualAppended = true;\r\n        } else {\r\n          // fallback color dot\r\n          leftVisual.appendChild(makeColorDot(null));\r\n          visualAppended = true;\r\n        }\r\n      }\r\n\r\n      // Repository: show repo icon\r\n      if (!visualAppended && dataType === \"repository\") {\r\n        const repoIcon = document.createElement(\"span\");\r\n        repoIcon.innerHTML =\r\n          '<svg width=\"14\" height=\"14\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style=\"flex-shrink:0;color:var(--vscode-icon-foreground)\"><path fill=\"currentColor\" d=\"M2 2.5A1.5 1.5 0 0 1 3.5 1h9A1.5 1.5 0 0 1 14 2.5v11A1.5 1.5 0 0 1 12.5 15h-9A1.5 1.5 0 0 1 2 13.5v-11zM3.5 2A.5.5 0 0 0 3 2.5V4h10V2.5a.5.5 0 0 0-.5-.5h-9z\"/></svg>';\r\n        leftVisual.appendChild(repoIcon);\r\n        visualAppended = true;\r\n      }\r\n\r\n      // Parent issue: try to extract parent title and show a color dot (use resolved parent status color if possible)\r\n      if (!visualAppended && dataType === \"parent_issue\") {\r\n        const prog = parentMetaForIteration\r\n          ? resolveParentProgress(parentMetaForIteration)\r\n          : null;\r\n        // Prefer status color from resolved parent progress, then try parentMeta.option/color fields\r\n        let dotColor = prog && prog.statusColor ? prog.statusColor : null;\r\n        if (!dotColor && parentMetaForIteration) {\r\n          dotColor =\r\n            normalizeColor(\r\n              parentMetaForIteration.color ||\r\n                (parentMetaForIteration.option &&\r\n                  parentMetaForIteration.option.color) ||\r\n                parentMetaForIteration.statusColor ||\r\n                parentMetaForIteration.status?.color,\r\n            ) || null;\r\n        }\r\n\r\n        if (\r\n          parentMetaForIteration &&\r\n          (parentMetaForIteration.title ||\r\n            parentMetaForIteration.name ||\r\n            parentMetaForIteration.number ||\r\n            (prog && (prog.title || prog.number)))\r\n        ) {\r\n          const pd = makeColorDot(dotColor);\r\n          leftVisual.appendChild(pd);\r\n          visualAppended = true;\r\n        }\r\n      }\r\n\r\n      // Labels: ensure label color dot comes from label metadata\r\n      if (!visualAppended && dataType === \"labels\" && rawValue) {\r\n        // rawValue here is the individual label object\r\n        const lab = rawValue;\r\n        const colorCandidate =\r\n          lab && (lab.color || lab.colorName || lab.hex || lab.name);\r\n        const normalized = normalizeColor(colorCandidate);\r\n        leftVisual.appendChild(makeColorDot(normalized));\r\n        visualAppended = true;\r\n      }\r\n\r\n      // If still no specialized visual, fall back to normalized color from options/iterations\r\n      if (!visualAppended) {\r\n        let colorVal: any = null;\r\n        if (dataType === \"single_select\" && rawValue && rawValue.option) {\r\n          colorVal =\r\n            rawValue.option.color || rawValue.option.name || rawValue.option.id;\r\n        }\r\n        // If repository/parent/iteration/milestone provide color directly, prefer it\r\n        if (!colorVal && rawValue && (rawValue.color || rawValue.colorName)) {\r\n          colorVal = rawValue.color || rawValue.colorName;\r\n        }\r\n        if (!colorVal && Array.isArray(this.field.options)) {\r\n          try {\r\n            const found = (this.field.options || []).find(\r\n              (o: any) =>\r\n                String(o.name) === String(key) ||\r\n                String(o.id) ===\r\n                  String(\r\n                    rawValue &&\r\n                      (rawValue.optionId ||\r\n                        (rawValue.option && rawValue.option.id)),\r\n                  ),\r\n            );\r\n            if (found) colorVal = found.color || found.name || found.id;\r\n          } catch (e) {}\r\n        }\r\n        if (\r\n          !colorVal &&\r\n          this.field &&\r\n          this.field.configuration &&\r\n          Array.isArray(this.field.configuration.iterations)\r\n        ) {\r\n          try {\r\n            const iter = (this.field.configuration.iterations || []).find(\r\n              (it: any) =>\r\n                String(it.title) === String(key) ||\r\n                String(it.id) ===\r\n                  String(\r\n                    rawValue &&\r\n                      (rawValue.iterationId ||\r\n                        (rawValue.iteration && rawValue.iteration.id)),\r\n                  ),\r\n            );\r\n            if (iter)\r\n              colorVal = iter.color || iter.name || iter.title || iter.id;\r\n          } catch (e) {}\r\n        }\r\n        const normalized = normalizeColor(colorVal);\r\n        leftVisual.appendChild(makeColorDot(normalized));\r\n      }\r\n\r\n      item.appendChild(leftVisual);\r\n\r\n      // Label column\r\n      const labelColumn = document.createElement(\"div\");\r\n      labelColumn.style.flex = \"1\";\r\n      labelColumn.style.display = \"flex\";\r\n      labelColumn.style.flexDirection = \"column\";\r\n      labelColumn.style.minWidth = \"0\";\r\n\r\n      // For parent_issue we render a custom header below (avoid duplicating the generic label)\r\n      let label: HTMLElement | null = null;\r\n      if (dataType !== \"parent_issue\") {\r\n        label = document.createElement(\"span\");\r\n        label.textContent = key;\r\n        label.style.fontSize = \"13px\";\r\n        label.style.fontWeight = \"500\";\r\n        // Allow wrapping to next line instead of overflowing\r\n        label.style.whiteSpace = \"normal\";\r\n        label.style.wordBreak = \"break-word\";\r\n        label.style.overflow = \"hidden\";\r\n        labelColumn.appendChild(label);\r\n      }\r\n\r\n      // Add description for single_select\r\n      if (dataType === \"single_select\") {\r\n        // Prefer metadata description from field.options if available, else rawValue.option.description\r\n        let descText: string | null = null;\r\n        try {\r\n          if (rawValue && rawValue.option && rawValue.option.description)\r\n            descText = rawValue.option.description;\r\n          else if (Array.isArray(this.field.options)) {\r\n            const found = (this.field.options || []).find(\r\n              (o: any) =>\r\n                String(o.name) === String(key) ||\r\n                String(o.id) ===\r\n                  String(\r\n                    rawValue &&\r\n                      (rawValue.optionId ||\r\n                        (rawValue.option && rawValue.option.id)),\r\n                  ),\r\n            );\r\n            if (found && found.description) descText = found.description;\r\n          }\r\n        } catch (e) {}\r\n\r\n        if (descText) {\r\n          const desc = document.createElement(\"span\");\r\n          desc.textContent = descText;\r\n          desc.style.fontSize = \"11px\";\r\n          desc.style.color = \"var(--vscode-descriptionForeground)\";\r\n          desc.style.whiteSpace = \"normal\";\r\n          desc.style.wordBreak = \"break-word\";\r\n          desc.style.overflow = \"hidden\";\r\n          desc.style.maxHeight = \"3.6em\";\r\n          labelColumn.appendChild(desc);\r\n        }\r\n      }\r\n\r\n      // For parent_issue, show title snippet if available\r\n      if (dataType === \"parent_issue\" && rawValue) {\r\n        const p =\r\n          parentMetaForIteration ||\r\n          rawValue.parent ||\r\n          rawValue.parentIssue ||\r\n          rawValue.issue ||\r\n          rawValue.item ||\r\n          rawValue.value ||\r\n          null;\r\n        const prog = resolveParentProgress(p);\r\n        // Title + number\r\n        const titleText = prog.title || (p && (p.title || p.name)) || key;\r\n        const titleEl = document.createElement(\"div\");\r\n        titleEl.style.display = \"flex\";\r\n        titleEl.style.gap = \"8px\";\r\n        titleEl.style.alignItems = \"baseline\";\r\n        const tspan = document.createElement(\"span\");\r\n        // Append number inline into the title text so it appears immediately after the title\r\n        const displayedTitle = String(titleText).slice(0, 120);\r\n        tspan.textContent = prog.number\r\n          ? `${displayedTitle} #${String(prog.number)}`\r\n          : displayedTitle;\r\n        tspan.style.fontSize = \"13px\";\r\n        tspan.style.fontWeight = \"600\";\r\n        tspan.style.whiteSpace = \"normal\";\r\n        tspan.style.wordBreak = \"break-word\";\r\n        titleEl.appendChild(tspan);\r\n        labelColumn.appendChild(titleEl);\r\n\r\n        // Progress summary and bar\r\n        if (prog.total && prog.total > 0) {\r\n          const summary = document.createElement(\"div\");\r\n          summary.style.display = \"flex\";\r\n          summary.style.alignItems = \"center\";\r\n          summary.style.gap = \"8px\";\r\n          summary.style.marginTop = \"6px\";\r\n\r\n          const doneText = document.createElement(\"div\");\r\n          doneText.textContent = `${prog.done}/${prog.total}`;\r\n          doneText.style.color = \"var(--vscode-descriptionForeground)\";\r\n          doneText.style.fontSize = \"12px\";\r\n          doneText.style.fontVariantNumeric = \"tabular-nums\";\r\n          summary.appendChild(doneText);\r\n\r\n          const bar = document.createElement(\"div\");\r\n          bar.style.display = \"inline-block\";\r\n          bar.style.width = \"120px\";\r\n          bar.style.height = \"10px\";\r\n          bar.style.background = \"transparent\";\r\n          bar.style.border = \"1px solid var(--vscode-focusBorder)\";\r\n          bar.style.borderRadius = \"6px\";\r\n          bar.style.overflow = \"hidden\";\r\n          const fill = document.createElement(\"div\");\r\n          fill.style.height = \"100%\";\r\n          fill.style.width = String(prog.pct) + \"%\";\r\n          fill.style.background = \"var(--vscode-focusBorder)\";\r\n          bar.appendChild(fill);\r\n          summary.appendChild(bar);\r\n\r\n          labelColumn.appendChild(summary);\r\n        }\r\n      }\r\n\r\n      // Iteration: show date range if available\r\n      if (dataType === \"iteration\") {\r\n        try {\r\n          // rawValue may be an FV with iteration object, or we can look up field.configuration.iterations\r\n          const iterObj =\r\n            (rawValue &&\r\n              (rawValue.iteration || rawValue.configuration || rawValue)) ||\r\n            null;\r\n          let iterCandidate: any = null;\r\n          if (\r\n            iterObj &&\r\n            iterObj.startDate &&\r\n            (iterObj.duration || iterObj.length)\r\n          ) {\r\n            iterCandidate = iterObj;\r\n          } else if (\r\n            this.field &&\r\n            this.field.configuration &&\r\n            Array.isArray(this.field.configuration.iterations)\r\n          ) {\r\n            const found = (this.field.configuration.iterations || []).find(\r\n              (it: any) =>\r\n                String(it.title || it.name) === String(key) ||\r\n                String(it.id) ===\r\n                  String(\r\n                    rawValue &&\r\n                      (rawValue.iterationId ||\r\n                        (rawValue.iteration && rawValue.iteration.id)),\r\n                  ),\r\n            );\r\n            if (found) iterCandidate = found;\r\n          }\r\n\r\n          if (iterCandidate) {\r\n            const start = iterCandidate.startDate || iterCandidate.start;\r\n            const duration =\r\n              iterCandidate.duration ||\r\n              iterCandidate.length ||\r\n              iterCandidate.days;\r\n            if (start && duration) {\r\n              const s = new Date(start);\r\n              const e = new Date(\r\n                s.getTime() + Number(duration || 0) * 24 * 60 * 60 * 1000,\r\n              );\r\n              const sStr = s.toLocaleDateString(\"en-US\", {\r\n                month: \"short\",\r\n                day: \"numeric\",\r\n              });\r\n              const eStr = e.toLocaleDateString(\"en-US\", {\r\n                month: \"short\",\r\n                day: \"numeric\",\r\n              });\r\n              const rangeEl = document.createElement(\"div\");\r\n              rangeEl.textContent = `${sStr} \u2014 ${eStr}`;\r\n              rangeEl.style.fontSize = \"11px\";\r\n              rangeEl.style.color = \"var(--vscode-descriptionForeground)\";\r\n              rangeEl.style.marginTop = \"4px\";\r\n              labelColumn.appendChild(rangeEl);\r\n            }\r\n          }\r\n        } catch (e) {}\r\n      }\r\n\r\n      item.appendChild(labelColumn);\r\n\r\n      // Count circle (like grouping)\r\n      const countCircle = document.createElement(\"span\");\r\n      countCircle.style.display = \"inline-flex\";\r\n      countCircle.style.alignItems = \"center\";\r\n      countCircle.style.justifyContent = \"center\";\r\n      countCircle.style.minWidth = \"24px\";\r\n      countCircle.style.height = \"24px\";\r\n      countCircle.style.borderRadius = \"50%\";\r\n      countCircle.style.background = \"var(--vscode-input-background)\";\r\n      countCircle.style.border = \"1px solid var(--vscode-panel-border)\";\r\n      countCircle.style.color = \"var(--vscode-foreground)\";\r\n      countCircle.style.fontSize = \"12px\";\r\n      countCircle.style.fontWeight = \"600\";\r\n      countCircle.style.padding = \"0 6px\";\r\n      countCircle.style.boxSizing = \"border-box\";\r\n      countCircle.textContent = String(count);\r\n\r\n      item.appendChild(countCircle);\r\n\r\n      // Hover effect\r\n      item.addEventListener(\"mouseenter\", () => {\r\n        item.style.background = \"var(--vscode-list-hoverBackground)\";\r\n      });\r\n\r\n      item.addEventListener(\"mouseleave\", () => {\r\n        item.style.background = \"transparent\";\r\n      });\r\n\r\n      // Click handler\r\n      item.addEventListener(\"click\", () => {\r\n        if (this.onValueSelectCallback) {\r\n          this.onValueSelectCallback(value);\r\n        }\r\n      });\r\n\r\n      container.appendChild(item);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get unique values and their counts\r\n   */\r\n  private getValueCounts(): Map<\r\n    string,\r\n    { value: any; count: number; rawValue: any }\r\n  > {\r\n    const counts = new Map<\r\n      string,\r\n      { value: any; count: number; rawValue: any }\r\n    >();\r\n\r\n    const dataType = (this.field.dataType || \"\").toLowerCase();\r\n\r\n    this.items.forEach((item) => {\r\n      const fv = item.fieldValues?.find(\r\n        (f: any) =>\r\n          f.fieldId === this.field.id || f.fieldName === this.field.name,\r\n      );\r\n      if (!fv) {\r\n        const key = \"(empty)\";\r\n        const existing = counts.get(key);\r\n        if (existing) existing.count++;\r\n        else counts.set(key, { value: null, count: 1, rawValue: null });\r\n        return;\r\n      }\r\n\r\n      // Handle multi-value fields (labels, assignees)\r\n      if (dataType === \"labels\") {\r\n        // GitHub sometimes nests labels under .labels.nodes or .labels\r\n        const labelsArr =\r\n          fv.labels && Array.isArray(fv.labels.nodes)\r\n            ? fv.labels.nodes\r\n            : Array.isArray(fv.labels)\r\n              ? fv.labels\r\n              : null;\r\n        if (Array.isArray(labelsArr) && labelsArr.length > 0) {\r\n          labelsArr.forEach((lab: any) => {\r\n            const name =\r\n              lab && (lab.name || lab.title)\r\n                ? String(lab.name || lab.title)\r\n                : \"(empty)\";\r\n            const key = this.formatValue(name);\r\n            const existing = counts.get(key);\r\n            if (existing) existing.count++;\r\n            else counts.set(key, { value: name, count: 1, rawValue: lab });\r\n          });\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (dataType === \"assignees\") {\r\n        const ass = fv.assignees || (fv.assignee ? [fv.assignee] : null);\r\n        if (Array.isArray(ass) && ass.length > 0) {\r\n          ass.forEach((a: any) => {\r\n            const name = String(a.login || a.name || a.id || \"(unknown)\");\r\n            const key = this.formatValue(name);\r\n            const existing = counts.get(key);\r\n            if (existing) existing.count++;\r\n            else counts.set(key, { value: a, count: 1, rawValue: a });\r\n          });\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Single-value fields and other complex types\r\n      let value: any = null;\r\n      let rawValue: any = null;\r\n\r\n      try {\r\n        if (dataType === \"single_select\") {\r\n          value = fv.option?.name || fv.name || fv.value;\r\n          rawValue = fv;\r\n        } else if (dataType === \"iteration\") {\r\n          value = fv.iteration?.title || fv.title || fv.value;\r\n          rawValue = fv;\r\n        } else if (dataType === \"parent_issue\") {\r\n          const p =\r\n            fv.parent ||\r\n            fv.parentIssue ||\r\n            fv.issue ||\r\n            fv.item ||\r\n            fv.value ||\r\n            null;\r\n          if (p) value = p.title || p.name || p.number || p.id || p.url || null;\r\n          rawValue = p || fv;\r\n        } else if (dataType === \"milestone\") {\r\n          value = fv.milestone?.title || fv.milestone?.name || fv.value || null;\r\n          rawValue = fv.milestone || fv;\r\n        } else if (dataType === \"repository\") {\r\n          value =\r\n            fv.repository?.nameWithOwner ||\r\n            fv.repository?.full_name ||\r\n            fv.repository?.name ||\r\n            fv.value ||\r\n            null;\r\n          rawValue = fv.repository || fv;\r\n        } else if (dataType === \"number\") {\r\n          value = fv.number != null ? fv.number : fv.value;\r\n          rawValue = fv;\r\n        } else if (dataType === \"date\") {\r\n          value = fv.date || fv.value || null;\r\n          rawValue = fv;\r\n        } else {\r\n          // fallback: text, title, other simple values\r\n          value = fv.text || fv.title || fv.value || null;\r\n          rawValue = fv;\r\n        }\r\n      } catch (e) {\r\n        value = fv.text || fv.title || fv.value || null;\r\n        rawValue = fv;\r\n      }\r\n\r\n      const key =\r\n        value === null || value === undefined || value === \"\"\r\n          ? \"(empty)\"\r\n          : this.formatValue(value);\r\n      const existing = counts.get(key);\r\n      if (existing) existing.count++;\r\n      else counts.set(key, { value, count: 1, rawValue });\r\n    });\r\n\r\n    return counts;\r\n  }\r\n\r\n  /**\r\n   * Extract value from field value object\r\n   */\r\n  private extractValue(fieldValue: any): any {\r\n    // Deprecated: primary logic moved into getValueCounts which handles multi-value types.\r\n    const dataType = (this.field.dataType || \"\").toLowerCase();\r\n    if (!fieldValue) return null;\r\n    if (dataType === \"single_select\")\r\n      return fieldValue.option?.name || fieldValue.name || fieldValue.value;\r\n    if (dataType === \"iteration\")\r\n      return (\r\n        fieldValue.iteration?.title || fieldValue.title || fieldValue.value\r\n      );\r\n    if (dataType === \"assignees\")\r\n      return fieldValue.assignees || fieldValue.assignee || null;\r\n    if (dataType === \"labels\") return fieldValue.labels || null;\r\n    if (dataType === \"parent_issue\")\r\n      return (\r\n        fieldValue.parent ||\r\n        fieldValue.parentIssue ||\r\n        fieldValue.issue ||\r\n        fieldValue.item ||\r\n        fieldValue.value ||\r\n        null\r\n      );\r\n    if (dataType === \"milestone\")\r\n      return fieldValue.milestone || fieldValue.value || null;\r\n    if (dataType === \"repository\")\r\n      return fieldValue.repository || fieldValue.value || null;\r\n    if (dataType === \"number\")\r\n      return fieldValue.number != null ? fieldValue.number : fieldValue.value;\r\n    if (dataType === \"date\") return fieldValue.date || fieldValue.value || null;\r\n    return fieldValue.text || fieldValue.title || fieldValue.value || null;\r\n  }\r\n\r\n  /**\r\n   * Format value for display\r\n   */\r\n  private formatValue(value: any): string {\r\n    if (value === null || value === undefined) {\r\n      return \"(empty)\";\r\n    }\r\n    return String(value);\r\n  }\r\n\r\n  /**\r\n   * Register callback for value selection\r\n   */\r\n  public onValueSelect(callback: (value: any) => void): void {\r\n    this.onValueSelectCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Register callback for field change\r\n   */\r\n  public onFieldChange(callback: (field: any) => void): void {\r\n    this.onFieldChangeCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Close and remove the panel\r\n   */\r\n  public close(): void {\r\n    if (this.panelElement) {\r\n      this.panelElement.remove();\r\n      this.panelElement = null;\r\n    }\r\n  }\r\n}\r\n", "export interface MenuItem {\r\n  id?: string;\r\n  label: string;\r\n  info?: string;\r\n  forceChevron?: boolean;\r\n  iconName?: string; // optional icon rendered to the left\r\n  onClick?: (anchor?: HTMLElement, anchorRect?: DOMRect) => any;\r\n  children?: MenuItem[];\r\n}\r\n\r\nexport interface ActiveTabMenuOptions {\r\n  anchorElement: HTMLElement;\r\n  items: MenuItem[] | (() => MenuItem[]);\r\n}\r\n\r\nimport MenuManager from './menuManager';\r\n\r\nexport class ActiveTabMenu {\r\n  private anchorElement: HTMLElement;\r\n  private itemsSource: MenuItem[] | (() => MenuItem[]);\r\n  private buttonEl: HTMLElement | null = null;\r\n  private menuEl: HTMLElement | null = null;\r\n  private backdropEl: HTMLElement | null = null;\r\n  private openSubmenuEl: HTMLElement | null = null;\r\n  // Optional refresh callback for externally created submenus (e.g., FieldsMenu instances)\r\n  private externalSubmenuRefresh: (() => void) | null = null;\r\n\r\n  constructor(options: ActiveTabMenuOptions) {\r\n    this.anchorElement = options.anchorElement;\r\n    this.itemsSource = options.items || [];\r\n    this.attachButton();\r\n  }\r\n\r\n  private attachButton() {\r\n    // Create small button to the right of the anchor element\r\n    const btn = document.createElement(\"button\");\r\n    btn.className = \"active-tab-menu-button\";\r\n    btn.type = \"button\";\r\n    btn.title = \"Open view menu\";\r\n    btn.style.border = \"none\";\r\n    btn.style.background = \"transparent\";\r\n    btn.style.padding = \"0 4px\";\r\n    btn.style.marginLeft = \"8px\";\r\n    btn.style.cursor = \"pointer\";\r\n    btn.style.display = \"inline-flex\";\r\n    btn.style.alignItems = \"center\";\r\n\r\n    // Match the icon color to the anchor text color\r\n    try {\r\n      const computed = window.getComputedStyle(this.anchorElement);\r\n      if (computed && computed.color) {\r\n        btn.style.color = computed.color;\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n\r\n    const iconSpan = document.createElement(\"span\");\r\n    iconSpan.style.display = \"inline-flex\";\r\n    iconSpan.style.alignItems = \"center\";\r\n    iconSpan.style.justifyContent = \"center\";\r\n    iconSpan.style.height = \"16px\";\r\n    iconSpan.style.width = \"16px\";\r\n    iconSpan.style.lineHeight = \"1\";\r\n    // Use global icon registry helper if available\r\n    iconSpan.innerHTML = (window as any).getIconSvg?.(\"triangle-down\") || \"\";\r\n    // Ensure svg inherits the current color\r\n    const svgs = iconSpan.querySelectorAll(\"svg\");\r\n    svgs.forEach((s) => s.setAttribute(\"fill\", \"currentColor\"));\r\n\r\n    btn.appendChild(iconSpan);\r\n    btn.addEventListener(\"click\", (e) => {\r\n      e.stopPropagation();\r\n      this.toggle();\r\n    });\r\n\r\n    this.buttonEl = btn;\r\n\r\n    // Insert button after the anchor element\r\n    if (this.anchorElement.parentElement) {\r\n      this.anchorElement.parentElement.insertBefore(btn, this.anchorElement.nextSibling);\r\n    }\r\n  }\r\n\r\n  public toggle() {\r\n    if (this.menuEl) {\r\n      this.hide();\r\n    } else {\r\n      this.show();\r\n    }\r\n  }\r\n\r\n  public show() {\r\n    // Close any other open menus before showing\r\n    try { MenuManager.closeAll(); } catch (e) { }\r\n    this.hide();\r\n\r\n    // backdrop to close when clicking outside\r\n    this.backdropEl = document.createElement(\"div\");\r\n    this.backdropEl.style.position = \"fixed\";\r\n    this.backdropEl.style.top = \"0\";\r\n    this.backdropEl.style.left = \"0\";\r\n    this.backdropEl.style.right = \"0\";\r\n    this.backdropEl.style.bottom = \"0\";\r\n    this.backdropEl.style.zIndex = \"998\";\r\n    this.backdropEl.addEventListener(\"click\", () => this.hide());\r\n    this.backdropEl.dataset.menuType = 'active-tab-menu';\r\n    document.body.appendChild(this.backdropEl);\r\n\r\n    this.menuEl = document.createElement(\"div\");\r\n    this.menuEl.className = \"active-tab-menu\";\r\n    this.menuEl.dataset.menuType = 'active-tab-menu';\r\n    this.menuEl.style.position = \"absolute\";\r\n    this.menuEl.style.background = \"var(--vscode-menu-background)\";\r\n    this.menuEl.style.border = \"1px solid var(--vscode-menu-border)\";\r\n    this.menuEl.style.borderRadius = \"4px\";\r\n    this.menuEl.style.boxShadow = \"0 2px 8px rgba(0,0,0,0.15)\";\r\n    this.menuEl.style.width = \"320px\";\r\n    this.menuEl.style.padding = \"4px 0\";\r\n    this.menuEl.style.zIndex = \"1000\";\r\n    this.menuEl.style.fontSize = \"13px\";\r\n\r\n    document.body.appendChild(this.menuEl);\r\n    const items = typeof this.itemsSource === 'function' ? this.itemsSource() : this.itemsSource;\r\n    this.buildMenu(this.menuEl, items);\r\n\r\n    const rect = (this.buttonEl || this.anchorElement).getBoundingClientRect();\r\n    const menuRect = this.menuEl.getBoundingClientRect();\r\n    const margin = 8;\r\n    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n    const vh = window.innerHeight || document.documentElement.clientHeight;\r\n\r\n    let top = rect.bottom + margin;\r\n    if (rect.bottom + menuRect.height + margin > vh) {\r\n      if (rect.top - menuRect.height - margin >= 0) {\r\n        top = rect.top - menuRect.height - margin;\r\n      } else {\r\n        top = Math.max(margin, Math.min(vh - menuRect.height - margin, rect.bottom + margin));\r\n      }\r\n    }\r\n\r\n      try { MenuManager.register(this.menuEl, this.refresh.bind(this)); } catch (e) { }\r\n    let left = rect.left;\r\n    if (rect.left + menuRect.width + margin > vw) {\r\n      left = Math.max(margin, rect.right - menuRect.width);\r\n    }\r\n    left = Math.max(margin, Math.min(left, vw - menuRect.width - margin));\r\n\r\n    this.menuEl.style.top = `${Math.round(top)}px`;\r\n    this.menuEl.style.left = `${Math.round(left)}px`;\r\n  }\r\n\r\n  public hide() {\r\n    if (this.menuEl) {\r\n      this.menuEl.remove();\r\n      this.menuEl = null;\r\n    }\r\n    if (this.backdropEl) {\r\n      this.backdropEl.remove();\r\n      this.backdropEl = null;\r\n    }\r\n    this.closeOpenSubmenu();\r\n  }\r\n\r\n  // Refresh the menu content while it's open (for live updates)\r\n  public refresh() {\r\n    if (this.menuEl) {\r\n      this.menuEl.innerHTML = '';\r\n      const items = typeof this.itemsSource === 'function' ? this.itemsSource() : this.itemsSource;\r\n      this.buildMenu(this.menuEl, items);\r\n      // If an external submenu provided a refresh callback, invoke it so it can update too\r\n      try { if (this.externalSubmenuRefresh) this.externalSubmenuRefresh(); } catch (e) { }\r\n    }\r\n  }\r\n\r\n  // Remove all DOM elements created by this instance (button + menus)\r\n  public destroy() {\r\n    try {\r\n      this.hide();\r\n    } catch (e) { }\r\n    if (this.buttonEl) {\r\n      try {\r\n        this.buttonEl.remove();\r\n      } catch (e) { }\r\n      this.buttonEl = null;\r\n    }\r\n  }\r\n\r\n  private buildMenu(container: HTMLElement, items: MenuItem[]) {\r\n    // (removed top separator - not needed visually)\r\n\r\n    // If this menu is attached to a view tab, render a compact view-generator selector\r\n    try {\r\n      const tabEl = this.anchorElement && this.anchorElement.parentElement ? (this.anchorElement.parentElement as HTMLElement) : null;\r\n      const viewKey = tabEl ? tabEl.getAttribute('data-viewkey') : null;\r\n      if (viewKey) {\r\n        const sel = document.createElement('div');\r\n        sel.style.display = 'flex';\r\n        sel.style.gap = '8px';\r\n        sel.style.padding = '6px 12px';\r\n        sel.style.justifyContent = 'center';\r\n        sel.style.alignItems = 'center';\r\n\r\n        const currentLayout = tabEl ? tabEl.getAttribute('data-layout') : null;\r\n\r\n        const makeOption = (layout: string, icon: string, label: string) => {\r\n          const opt = document.createElement('div');\r\n          opt.style.display = 'inline-flex';\r\n          opt.style.alignItems = 'center';\r\n          opt.style.gap = '8px';\r\n          opt.style.padding = '6px 10px';\r\n          opt.style.borderRadius = '6px';\r\n          opt.style.cursor = 'pointer';\r\n          opt.style.fontWeight = '500';\r\n          opt.style.color = 'var(--vscode-menu-foreground)';\r\n          // If this option matches the current layout, mark it with the same\r\n          // background used by table/column headers for visual consistency.\r\n          if (currentLayout && currentLayout === layout) {\r\n            opt.style.background = 'var(--vscode-sideBar-background)';\r\n            opt.style.color = 'var(--vscode-foreground)';\r\n            opt.style.fontWeight = '600';\r\n          }\r\n          opt.onmouseenter = () => { opt.style.background = 'var(--vscode-menu-selectionBackground)'; opt.style.color = 'var(--vscode-menu-selectionForeground)'; };\r\n          opt.onmouseleave = () => { opt.style.background = 'transparent'; opt.style.color = 'var(--vscode-menu-foreground)'; };\r\n\r\n          const iconSpan = document.createElement('span');\r\n          iconSpan.style.display = 'inline-flex';\r\n          iconSpan.style.alignItems = 'center';\r\n          iconSpan.style.justifyContent = 'center';\r\n          iconSpan.style.width = '16px';\r\n          iconSpan.style.height = '16px';\r\n          iconSpan.innerHTML = (window as any).getIconSvg ? (window as any).getIconSvg(icon) : '';\r\n          try { iconSpan.querySelectorAll && iconSpan.querySelectorAll('svg').forEach((s: any) => s.setAttribute('fill', 'currentColor')); } catch (e) { }\r\n\r\n          const lbl = document.createElement('span');\r\n          lbl.style.fontSize = '13px';\r\n          lbl.textContent = label;\r\n\r\n          opt.appendChild(iconSpan);\r\n          opt.appendChild(lbl);\r\n\r\n          opt.addEventListener('click', (ev) => {\r\n            ev.stopPropagation();\r\n            try {\r\n              // Update in-memory project view layout so the inline showTab logic picks it up\r\n              try {\r\n                const pd = (window as any).__PROJECT_DATA__ || (window as any).__project_data__;\r\n                if (pd && Array.isArray(pd.views)) {\r\n                  const idx = parseInt(String(viewKey).split('-')[1]);\r\n                  if (!isNaN(idx) && pd.views[idx]) pd.views[idx].layout = layout;\r\n                }\r\n              } catch (e) { }\r\n\r\n              // Update the tab DOM attribute/icon and re-click the tab to re-render\r\n              try {\r\n                if (tabEl) {\r\n                  tabEl.setAttribute('data-layout', layout);\r\n                  const iconWrapper = tabEl.querySelector('.tab-icon');\r\n                  if (iconWrapper) {\r\n                    const iconName = layout === 'table' ? 'table' : (layout === 'board' ? 'project' : 'roadmap');\r\n                    iconWrapper.innerHTML = (window as any).getIconSvg ? (window as any).getIconSvg(iconName) : '';\r\n                  }\r\n                  // Trigger a click to cause the tab's fetcher to run (inline script showTab handler)\r\n                  try { (tabEl as HTMLElement).click(); } catch (e) { }\r\n                }\r\n              } catch (e) { }\r\n\r\n              // Close the ActiveTabMenu after changing\r\n              try { this.hide(); } catch (e) { }\r\n            } catch (e) { }\r\n          });\r\n\r\n          return opt;\r\n        };\r\n\r\n        sel.appendChild(makeOption('table', 'table', 'Table'));\r\n        sel.appendChild(makeOption('board', 'project', 'Board'));\r\n        sel.appendChild(makeOption('roadmap', 'roadmap', 'Roadmap'));\r\n\r\n        container.appendChild(sel);\r\n      }\r\n    } catch (e) { }\r\n\r\n    // Add a bottom separator after selector / before actual items\r\n    try {\r\n      const midLine = document.createElement('div');\r\n      midLine.style.height = '1px';\r\n      midLine.style.background = 'var(--vscode-panel-border)';\r\n      midLine.style.margin = '6px 0';\r\n      container.appendChild(midLine);\r\n    } catch (e) { }\r\n\r\n    items.forEach((item) => {\r\n      const row = document.createElement(\"div\");\r\n      row.className = \"active-tab-menu-item\";\r\n      row.style.display = \"flex\";\r\n      row.style.alignItems = \"center\";\r\n      row.style.padding = \"6px 12px\";\r\n      row.style.cursor = \"pointer\";\r\n      row.style.color = \"var(--vscode-menu-foreground)\";\r\n\r\n      // Left icon (if any)\r\n      if (item.iconName && (window as any).getIconSvg) {\r\n        const leftIcon = document.createElement('span');\r\n        leftIcon.style.display = 'inline-flex';\r\n        leftIcon.style.alignItems = 'center';\r\n        leftIcon.style.justifyContent = 'center';\r\n        leftIcon.style.marginRight = '8px';\r\n        leftIcon.innerHTML = (window as any).getIconSvg(item.iconName) || '';\r\n        // make sure svg inherits color\r\n        try { leftIcon.querySelectorAll && leftIcon.querySelectorAll('svg').forEach(s => s.setAttribute('fill', 'currentColor')); } catch (e) { }\r\n        row.appendChild(leftIcon);\r\n      }\r\n\r\n      const labelEl = document.createElement(\"div\");\r\n      labelEl.style.flex = \"1\";\r\n      labelEl.style.minWidth = \"0\";\r\n      labelEl.style.overflow = \"hidden\";\r\n      labelEl.style.whiteSpace = \"nowrap\";\r\n      labelEl.style.textOverflow = \"ellipsis\";\r\n      labelEl.style.marginRight = \"8px\";\r\n\r\n      if (item.info) {\r\n        const b = document.createElement(\"span\");\r\n        b.style.fontWeight = \"600\";\r\n        b.textContent = item.label + \": \";\r\n        labelEl.appendChild(b);\r\n\r\n        const i = document.createElement(\"span\");\r\n        i.style.opacity = \"0.7\";\r\n        i.textContent = item.info;\r\n        labelEl.appendChild(i);\r\n      } else {\r\n        labelEl.style.fontWeight = \"500\";\r\n        labelEl.textContent = item.label;\r\n      }\r\n      row.appendChild(labelEl);\r\n\r\n      if ((item.children && item.children.length) || item.forceChevron) {\r\n        const arrow = document.createElement(\"span\");\r\n        arrow.innerHTML = (window as any).getIconSvg?.(\"chevron-right\") || \"\u203A\";\r\n        arrow.style.marginLeft = \"auto\";\r\n        arrow.style.flex = \"0 0 auto\";\r\n        arrow.style.opacity = \"0.7\";\r\n        row.appendChild(arrow);\r\n\r\n        if (item.children && item.children.length) {\r\n          row.addEventListener(\"mouseenter\", (e) => {\r\n            this.openSubmenuForRow(row, item.children!);\r\n          });\r\n          row.addEventListener(\"mouseleave\", (e) => {\r\n            // submenu will be handled\r\n          });\r\n        }\r\n      }\r\n\r\n      if (item.children && item.children.length) {\r\n        // handled above\r\n        } else {\r\n        row.addEventListener(\"click\", (ev) => {\r\n          try { ev.stopPropagation(); } catch (e) { }\r\n          try {\r\n            // Close any hover-opened submenu and external dropdowns before invoking click handler\r\n            try { this.closeOpenSubmenu(); } catch (e) { }\r\n            try { document.querySelectorAll('.roadmap-dropdown-menu').forEach((n) => (n as HTMLElement).remove()); } catch (e) { }\r\n            const rect = row.getBoundingClientRect();\r\n            const res: any = item.onClick ? item.onClick(row, rect) : undefined;\r\n            // If handler returns a Promise, wait for it. If it resolves to true, keep parent open.\r\n            if (res && typeof res.then === \"function\") {\r\n              res\r\n                .then((keepOpen: any) => {\r\n                  if (!keepOpen) this.hide();\r\n                })\r\n                .catch(() => this.hide());\r\n            } else {\r\n              // If handler returned truthy true, keep open; otherwise close\r\n              if (!res) this.hide();\r\n            }\r\n          } catch (err) {\r\n            try {\r\n              this.hide();\r\n            } catch (e) { }\r\n          }\r\n        });\r\n      }\r\n\r\n      row.addEventListener(\"mouseenter\", () => {\r\n        row.style.background = \"var(--vscode-menu-selectionBackground)\";\r\n        row.style.color = \"var(--vscode-menu-selectionForeground)\";\r\n      });\r\n      row.addEventListener(\"mouseleave\", () => {\r\n        row.style.background = \"transparent\";\r\n        row.style.color = \"var(--vscode-menu-foreground)\";\r\n      });\r\n\r\n      container.appendChild(row);\r\n    });\r\n  }\r\n\r\n  private openSubmenuForRow(row: HTMLElement, children: MenuItem[]) {\r\n    // close any existing submenu\r\n    this.closeOpenSubmenu();\r\n\r\n    if (!this.menuEl) return;\r\n\r\n    const submenu = document.createElement(\"div\");\r\n    submenu.className = \"active-tab-submenu\";\r\n    submenu.style.position = \"absolute\";\r\n    submenu.style.background = \"var(--vscode-menu-background)\";\r\n    submenu.style.border = \"1px solid var(--vscode-menu-border)\";\r\n    submenu.style.borderRadius = \"4px\";\r\n    submenu.style.boxShadow = \"0 2px 8px rgba(0,0,0,0.15)\";\r\n    submenu.style.minWidth = \"160px\";\r\n    submenu.style.padding = \"4px 0\";\r\n    submenu.style.zIndex = \"1001\";\r\n    submenu.style.fontSize = \"13px\";\r\n\r\n    document.body.appendChild(submenu);\r\n    this.buildMenu(submenu, children);\r\n\r\n    const parentRect = row.getBoundingClientRect();\r\n    const submenuRect = submenu.getBoundingClientRect();\r\n    const menuRect = this.menuEl.getBoundingClientRect();\r\n    const vw = window.innerWidth || document.documentElement.clientWidth;\r\n    const vh = window.innerHeight || document.documentElement.clientHeight;\r\n    const margin = 4;\r\n\r\n    // Position to the right of the parent row\r\n    let top = parentRect.top;\r\n    if (top + submenuRect.height > vh) {\r\n      top = Math.max(margin, Math.min(vh - submenuRect.height - margin, top));\r\n    }\r\n\r\n    // Remove any externally created dropdowns so only this submenu shows\r\n    try { document.querySelectorAll('.roadmap-dropdown-menu').forEach(n => (n as HTMLElement).remove()); } catch (e) { }\r\n\r\n    // Anchor submenu to the option row's right edge so submenus align with the row\r\n    let left = parentRect.right + 4;\r\n    // If would overflow viewport, try open to the left of the parent row\r\n    if (left + submenuRect.width > vw) {\r\n      left = parentRect.left - submenuRect.width - 4;\r\n      // If still overflows, fall back to positioning against the parent menu\r\n      if (left < margin) {\r\n        left = Math.max(margin, Math.min(menuRect.right + 4, vw - submenuRect.width - margin));\r\n      }\r\n    }\r\n\r\n    submenu.style.top = `${Math.round(top)}px`;\r\n    submenu.style.left = `${Math.round(left)}px`;\r\n\r\n    this.openSubmenuEl = submenu;\r\n\r\n    // close submenu when mouse leaves it and parent menu\r\n    submenu.addEventListener(\"mouseleave\", () => {\r\n      // small timeout to allow entering a nested submenu\r\n      setTimeout(() => {\r\n        if (this.openSubmenuEl === submenu) {\r\n          this.closeOpenSubmenu();\r\n        }\r\n      }, 150);\r\n    });\r\n  }\r\n\r\n  private closeOpenSubmenu() {\r\n    if (this.openSubmenuEl) {\r\n      this.openSubmenuEl.remove();\r\n      this.openSubmenuEl = null;\r\n      this.externalSubmenuRefresh = null;\r\n    }\r\n  }\r\n\r\n  // Allow external submenus (created by other components) to be registered so\r\n  // the ActiveTabMenu can close or refresh them when needed.\r\n  public registerExternalSubmenu(el: HTMLElement | null, refreshFn?: () => void) {\r\n    try {\r\n      // Close any existing submenu first\r\n      this.closeOpenSubmenu();\r\n    } catch (e) { }\r\n    if (el) {\r\n      this.openSubmenuEl = el;\r\n      this.externalSubmenuRefresh = refreshFn || null;\r\n      try { MenuManager.register(el, refreshFn || null); } catch (e) { }\r\n    }\r\n  }\r\n}\r\n\r\nexport default ActiveTabMenu;\r\n", "import ActiveTabMenu from './ActiveTabMenu';\r\n\r\nfunction initOnce() {\r\n  const tabsContainer = document.getElementById('tabs-container');\r\n  if (!tabsContainer) return;\r\n\r\n  let currentLabel: HTMLElement | null = null;\r\n  const tabsContainerEl = tabsContainer as HTMLElement;\r\n\r\n  function removeMenuFromLabel(label: HTMLElement | null) {\r\n    if (!label) return;\r\n    const inst = (label as any).__activeTabMenu as ActiveTabMenu | undefined;\r\n    if (inst && typeof inst.destroy === 'function') {\r\n      try {\r\n        inst.destroy();\r\n      } catch (e) { }\r\n    }\r\n    try {\r\n      // remove any attached event listener for roadmap date changes\r\n      const listener = (label as any).__activeTabMenuDateListener as any;\r\n      if (listener) {\r\n        try { window.removeEventListener('roadmap:dateFieldsChanged', listener); } catch (e) { }\r\n        try { window.removeEventListener('roadmap:zoomChanged', listener); } catch (e) { }\r\n      }\r\n    } catch (e) { }\r\n    try { delete (label as any).__activeTabMenu; delete (label as any).__activeTabMenuDateListener; } catch (e) { }\r\n  }\r\n\r\n  function attachMenuToActive() {\r\n    // Find the currently active tab with data-layout (only view tabs should have menus)\r\n    const activeTab = tabsContainerEl.querySelector('.tab.active') as HTMLElement | null;\r\n    if (!activeTab) {\r\n      // no active tab -> remove existing\r\n      removeMenuFromLabel(currentLabel);\r\n      currentLabel = null;\r\n      return;\r\n    }\r\n    const layout = activeTab.getAttribute('data-layout');\r\n    if (!layout) {\r\n      // active tab is not a view tab\r\n      removeMenuFromLabel(currentLabel);\r\n      currentLabel = null;\r\n      return;\r\n    }\r\n\r\n    const label = activeTab.querySelector('.tab-label') as HTMLElement | null;\r\n    if (!label) return;\r\n\r\n    // If a menu is already attached to this label, mark it as current and skip\r\n    if ((label as any).__activeTabMenu) {\r\n      currentLabel = label;\r\n      return; // already attached\r\n    }\r\n\r\n    // remove previous\r\n    removeMenuFromLabel(currentLabel);\r\n\r\n    // create new menu for active label\r\n    const viewKey = activeTab.getAttribute('data-viewkey') || null;\r\n\r\n    const getItems = () => {\r\n      const vsLocal = viewKey && (window as any).__viewStates ? (window as any).__viewStates[viewKey] : null;\r\n\r\n      // Calculate fields info\r\n      let fieldsInfo = \"\";\r\n      if (vsLocal && vsLocal.fields) {\r\n        const visibleSet = new Set(Array.from(vsLocal.visibleFieldIds || [] as any));\r\n        const names = (vsLocal.fields as any[])\r\n          .filter((f: any) => visibleSet.has(String(f.id)))\r\n          .map((f: any) => f.name);\r\n        fieldsInfo = names.join(\", \");\r\n      }\r\n\r\n      // Calculate group info\r\n      let groupInfo = \"\";\r\n      if (vsLocal && vsLocal.current) {\r\n        groupInfo = vsLocal.current;\r\n      }\r\n\r\n      // Calculate column info (board only)\r\n      let columnInfo = \"\";\r\n      if (vsLocal && vsLocal.currentColumn) {\r\n        columnInfo = vsLocal.currentColumn;\r\n      }\r\n\r\n      const items: any[] = [];\r\n\r\n      // Fields - only for table and board layouts\r\n      if (layout === 'table' || layout === 'board') {\r\n        items.push({\r\n          label: 'Fields',\r\n          info: fieldsInfo,\r\n          forceChevron: true,\r\n          iconName: 'note',\r\n          onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n            // Lazy-load the FieldsMenu component\r\n            return import('./FieldsMenu')\r\n              .then(({ FieldsMenu }) => {\r\n                try {\r\n                  // Close any open submenu in the parent ActiveTabMenu\r\n                  try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                  const fields = (vsLocal && vsLocal.fields) || [];\r\n                  const visible = new Set<string>(\r\n                    vsLocal && vsLocal.visibleFieldIds\r\n                      ? Array.from(vsLocal.visibleFieldIds).map((x: any) => String(x))\r\n                      : []\r\n                  );\r\n                  const menu = new FieldsMenu({\r\n                    fields: (fields || []).map((f: any) => ({\r\n                      id: String(f.id),\r\n                      name: f.name,\r\n                      iconClass: f.iconClass,\r\n                      dataType: f.dataType,\r\n                      locked: f.name === \"Title\"\r\n                    })),\r\n                    visibleFieldIds: visible as unknown as Set<string>,\r\n                    onToggleVisibility: (fieldId: string, visibleFlag: boolean) => {\r\n                      try {\r\n                        if (vsLocal && typeof vsLocal.onToggleVisibility === 'function') {\r\n                          vsLocal.onToggleVisibility(String(fieldId), visibleFlag);\r\n                        }\r\n                        // Refresh parent menu to show updated info\r\n                        setTimeout(() => {\r\n                          const parentMenu = (label as any).__activeTabMenu;\r\n                          if (parentMenu && typeof parentMenu.refresh === 'function') {\r\n                            parentMenu.refresh();\r\n                          }\r\n                        }, 50);\r\n                      } catch (e) { }\r\n                    },\r\n                  });\r\n                  const created = menu.show((anchor as HTMLElement) || (label as HTMLElement), anchorRect as DOMRect | undefined);\r\n                  try {\r\n                    const parentMenuInst = (label as any).__activeTabMenu;\r\n                    if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function' && created && (created.el as HTMLElement)) {\r\n                      try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                    }\r\n                  } catch (e) { }\r\n                } catch (e) { }\r\n                return true;\r\n              })\r\n              .catch(() => false);\r\n          },\r\n        });\r\n      }\r\n\r\n      // (Table/board Field sum is added after Sort-by so it appears later)\r\n\r\n      // Column by - only for board layout\r\n      if (layout === 'board') {\r\n        items.push({\r\n          label: 'Column by',\r\n          info: columnInfo,\r\n          forceChevron: true,\r\n          iconName: 'columns',\r\n          onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n            // Lazy-load GroupByMenu for column selection (reuse same component)\r\n            return import('./GroupByMenu')\r\n              .then(({ default: GroupByMenu }) => {\r\n                try {\r\n                  // Close any open submenu in the parent ActiveTabMenu\r\n                  try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                  const fields = (vsLocal && vsLocal.fields) || [];\r\n                  // Only single_select and iteration fields for columns\r\n                  const columnFields = (fields || []).filter((f: any) => {\r\n                    const raw = String((f.dataType || f.type || '')).toLowerCase();\r\n                    return raw === 'single_select' || raw.includes('iteration');\r\n                  });\r\n                  const menu = new GroupByMenu({\r\n                    title: 'Column by',\r\n                    fields: (columnFields || []).map((f: any) => ({ id: String(f.id), name: f.name, iconClass: f.iconClass, dataType: f.dataType })),\r\n                    items: vsLocal && vsLocal.items ? vsLocal.items : [],\r\n                    current: vsLocal && vsLocal.currentColumn ? vsLocal.currentColumn : null,\r\n                    onSelect: (fieldName: string | null) => {\r\n                      try {\r\n                        if (vsLocal && typeof vsLocal.onSetColumnBy === 'function') {\r\n                          vsLocal.onSetColumnBy(fieldName);\r\n                        }\r\n                        // Refresh parent menu to show updated info\r\n                        setTimeout(() => {\r\n                          const parentMenu = (label as any).__activeTabMenu;\r\n                          if (parentMenu && typeof parentMenu.refresh === 'function') {\r\n                            parentMenu.refresh();\r\n                          }\r\n                        }, 50);\r\n                      } catch (e) { }\r\n                    },\r\n                  });\r\n                  const created = menu.show((anchor as HTMLElement) || (label as HTMLElement), anchorRect as DOMRect | undefined);\r\n                  try {\r\n                    const parentMenuInst = (label as any).__activeTabMenu;\r\n                    if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function' && created && (created.el as HTMLElement)) {\r\n                      try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                    }\r\n                  } catch (e) { }\r\n                } catch (e) { }\r\n                return true;\r\n              })\r\n              .catch(() => false);\r\n          },\r\n        });\r\n      }\r\n\r\n      \r\n\r\n      // Group by / Swimlanes - available for all views (3rd option)\r\n      items.push({\r\n        label: layout === 'board' ? 'Swimlanes' : 'Group by',\r\n        info: groupInfo,\r\n        forceChevron: true,\r\n        iconName: 'rows',\r\n        onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n          // Lazy-load GroupByMenu\r\n          return import('./GroupByMenu')\r\n            .then(({ default: GroupByMenu }) => {\r\n              try {\r\n                // Close any open submenu in the parent ActiveTabMenu\r\n                try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                const fields = (vsLocal && vsLocal.fields) || [];\r\n                const groupable = (fields || []).filter((f: any) => {\r\n                  const raw = String((f.dataType || f.type || f.name || '')).toLowerCase();\r\n                  if (raw.includes('assign') || raw.includes('assignee')) return true;\r\n                  if (raw.includes('repo') || raw.includes('repository')) return true;\r\n                  if (raw.includes('parent')) return true;\r\n                  if (raw.includes('num') || raw.includes('number') || raw.includes('numeric')) return true;\r\n                  if (raw.includes('iteration')) return true;\r\n                  if (raw.includes('single') && raw.includes('select')) return true;\r\n                  if (raw.includes('milestone')) return true;\r\n                  if (raw.includes('date')) return true;\r\n                  if (raw.includes('text')) return true;\r\n                  return false;\r\n                });\r\n                const menu = new GroupByMenu({\r\n                  title: layout === 'board' ? 'Swimlanes' : 'Group by',\r\n                  fields: (groupable || []).map((f: any) => ({ id: String(f.id), name: f.name, iconClass: f.iconClass, dataType: f.dataType })),\r\n                  items: vsLocal && vsLocal.items ? vsLocal.items : [],\r\n                  current: vsLocal && (vsLocal.current || vsLocal.currentGrouping) ? (vsLocal.current || vsLocal.currentGrouping) : null,\r\n                  onSelect: (fieldName: string | null) => {\r\n                    try {\r\n                      if (vsLocal && typeof vsLocal.onSetGroupBy === 'function') {\r\n                        vsLocal.onSetGroupBy(fieldName);\r\n                      }\r\n                      // Refresh parent menu to show updated info\r\n                      setTimeout(() => {\r\n                        const parentMenu = (label as any).__activeTabMenu;\r\n                        if (parentMenu && typeof parentMenu.refresh === 'function') {\r\n                          parentMenu.refresh();\r\n                        }\r\n                      }, 50);\r\n                    } catch (e) { }\r\n                  },\r\n                });\r\n                  const created = menu.show((anchor as HTMLElement) || (label as HTMLElement), anchorRect as DOMRect | undefined);\r\n                  try {\r\n                    const parentMenuInst = (label as any).__activeTabMenu;\r\n                    if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function' && created && (created.el as HTMLElement)) {\r\n                      try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                    }\r\n                  } catch (e) { }\r\n              } catch (e) { }\r\n              return true;\r\n            })\r\n            .catch(() => false);\r\n        },\r\n      });\r\n\r\n      // Markers - only for roadmap layout (4th option)\r\n      if (layout === 'roadmap') {\r\n        // Build info text showing currently active markers (Milestones + selected fields)\r\n        let markersInfo = '';\r\n        try {\r\n          const roadmapRenderer = vsLocal && vsLocal.roadmapRenderer;\r\n          if (roadmapRenderer && typeof roadmapRenderer.getActiveMarkers === 'function') {\r\n            const active = roadmapRenderer.getActiveMarkers();\r\n            if (Array.isArray(active) && active.length > 0) {\r\n              const names = active.map((id: any) => {\r\n                if (String(id) === 'milestones') return 'Milestones';\r\n                const f = (vsLocal && vsLocal.fields) ? (vsLocal.fields as any[]).find((ff: any) => String(ff.id) === String(id) || ff.name === id) : null;\r\n                return f ? f.name : String(id);\r\n              });\r\n              markersInfo = names.join(', ');\r\n            } else {\r\n              markersInfo = 'None';\r\n            }\r\n          }\r\n        } catch (e) { }\r\n\r\n        items.push({\r\n          label: 'Markers',\r\n          info: markersInfo,\r\n          forceChevron: true,\r\n          iconName: 'location',\r\n          onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n            try {\r\n              // Use the RoadmapRenderer's showMarkersMenu directly\r\n              const roadmapRenderer = vsLocal && vsLocal.roadmapRenderer;\r\n              if (roadmapRenderer && typeof roadmapRenderer.showMarkersMenu === 'function') {\r\n                // Close any existing dropdowns/submenus so only one is open\r\n                try { document.querySelectorAll('.roadmap-dropdown-menu').forEach((n) => (n as HTMLElement).remove()); } catch (e) { }\r\n                try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                // Create a synthetic MouseEvent with currentTarget (prefer the option row `anchor`)\r\n                // If an `anchorRect` was provided use a lightweight object with a `getBoundingClientRect`\r\n                // so the roadmap menu can re-position itself even if the original row DOM node is later removed.\r\n                const syntheticEvent = {\r\n                  currentTarget: anchorRect ? ({ getBoundingClientRect: () => anchorRect } as unknown as HTMLElement) : (anchor || label)\r\n                } as unknown as MouseEvent;\r\n                try {\r\n                  const created = roadmapRenderer.showMarkersMenu(syntheticEvent);\r\n                  const parentMenuInst = (label as any).__activeTabMenu;\r\n                  if (created && created.el && parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function') {\r\n                    try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                  }\r\n                } catch (e) { }\r\n              }\r\n            } catch (e) { }\r\n            return true;\r\n          },\r\n        });\r\n      }\r\n\r\n      // Sort by - available for table/board/roadmap (placed after Markers)\r\n      if (layout === 'table' || layout === 'board' || layout === 'roadmap') {\r\n        // Normalize sort info so invalid values (like a project id) show as 'None'\r\n        let sortInfo = 'None';\r\n        let sortCurrent: string | null = null;\r\n        try {\r\n          const cur = vsLocal && (vsLocal.currentSort || vsLocal.currentSortName);\r\n          if (cur) {\r\n            if (typeof cur === 'string') {\r\n              const f = (vsLocal && vsLocal.fields ? (vsLocal.fields as any[]) : []).find((ff: any) => String(ff.id) === String(cur) || ff.name === cur);\r\n              if (f) { sortInfo = f.name || String(f.id); sortCurrent = String(f.id); }\r\n              else { sortInfo = 'None'; sortCurrent = null; }\r\n            } else if (typeof cur === 'object' && cur.fieldId) {\r\n              const f = (vsLocal && vsLocal.fields ? (vsLocal.fields as any[]) : []).find((ff: any) => String(ff.id) === String(cur.fieldId));\r\n              if (f) { sortInfo = f.name || String(f.id); sortCurrent = String(f.id); }\r\n              else { sortInfo = 'None'; sortCurrent = null; }\r\n            } else {\r\n              sortInfo = 'None'; sortCurrent = null;\r\n            }\r\n          } else {\r\n            sortInfo = 'None'; sortCurrent = null;\r\n          }\r\n        } catch (e) { sortInfo = 'None'; sortCurrent = null; }\r\n\r\n        items.push({\r\n          label: 'Sort by',\r\n          info: sortInfo,\r\n          forceChevron: true,\r\n          iconName: 'arrow-up-down',\r\n          onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n            return import('./SortByMenu')\r\n              .then(({ SortByMenu }) => {\r\n                try {\r\n                  // Close any open submenu in the parent ActiveTabMenu\r\n                  try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                  const fields = (vsLocal && vsLocal.fields) || [];\r\n                  const menu = new SortByMenu({\r\n                    fields: (fields || []).map((f: any) => ({ id: String(f.id), name: f.name, iconClass: f.iconClass, dataType: f.dataType })),\r\n                    current: sortCurrent,\r\n                    onSelect: (fieldId: string | null) => {\r\n                      try {\r\n                        if (vsLocal && typeof vsLocal.onSetSort === 'function') {\r\n                          vsLocal.onSetSort(fieldId);\r\n                        }\r\n                        setTimeout(() => {\r\n                          const parentMenu = (label as any).__activeTabMenu;\r\n                          if (parentMenu && typeof parentMenu.refresh === 'function') {\r\n                            parentMenu.refresh();\r\n                          }\r\n                        }, 50);\r\n                      } catch (e) { }\r\n                    }\r\n                  });\r\n                  const created = menu.show((anchor as HTMLElement) || (label as HTMLElement), anchorRect as DOMRect | undefined);\r\n                  try {\r\n                    const parentMenuInst = (label as any).__activeTabMenu;\r\n                    if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function' && created && (created.el as HTMLElement)) {\r\n                      try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                    }\r\n                  } catch (e) { }\r\n                } catch (e) { }\r\n                return true;\r\n              })\r\n              .catch(() => false);\r\n          },\r\n        });\r\n      }\r\n\r\n      // Insert Field sum for table/board immediately after Sort-by (so it's later in the list)\r\n      if (layout === 'table' || layout === 'board') {\r\n        try {\r\n          // Compute info text from current selection\r\n          let fdInfo = '';\r\n          try {\r\n            const cur = (vsLocal && (vsLocal.groupDivisors || null));\r\n            if (Array.isArray(cur) && cur.length > 0) {\r\n              const fields = (vsLocal && vsLocal.fields) || [];\r\n              const names = cur.map((id: any) => {\r\n                if (String(id) === '__count__') return 'Count';\r\n                const f = (fields || []).find((ff: any) => String(ff.id) === String(id) || ff.name === id);\r\n                return f ? f.name : String(id);\r\n              });\r\n              fdInfo = names.join(', ');\r\n            } else if (cur === null) fdInfo = 'None';\r\n          } catch (e) { }\r\n\r\n          items.push({\r\n            label: 'Field sum',\r\n            info: fdInfo,\r\n            forceChevron: true,\r\n            iconName: 'number',\r\n            onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n              return import('./FieldSumMenu')\r\n                .then(({ default: FieldSumMenu, FieldSumMenu: FieldSumMenuClass }) => {\r\n                  try {\r\n                    try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                    const fields = (vsLocal && vsLocal.fields) || [];\r\n                    const current = (vsLocal && (vsLocal.groupDivisors || [])) || [];\r\n                    const menu = new (FieldSumMenuClass || FieldSumMenu)({\r\n                      fields: (fields || []).map((f: any) => ({ id: String(f.id), name: f.name, dataType: f.dataType })),\r\n                      current: Array.isArray(current) ? current : [],\r\n                      title: 'Field sum',\r\n                      onChange: (selected: string[]) => {\r\n                        try {\r\n                          if (vsLocal && typeof vsLocal.onSetGroupDivisors === 'function') {\r\n                            vsLocal.onSetGroupDivisors(selected && selected.length ? selected : null);\r\n                          }\r\n                          setTimeout(() => {\r\n                            const parentMenu = (label as any).__activeTabMenu;\r\n                            if (parentMenu && typeof parentMenu.refresh === 'function') parentMenu.refresh();\r\n                          }, 50);\r\n                        } catch (e) { }\r\n                      }\r\n                    });\r\n                    const created = menu.show((anchor as HTMLElement) || (label as HTMLElement), anchorRect as DOMRect | undefined);\r\n                    try {\r\n                      const parentMenuInst = (label as any).__activeTabMenu;\r\n                      if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function' && created && (created.el as HTMLElement)) {\r\n                        try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                      }\r\n                    } catch (e) { }\r\n                  } catch (e) { }\r\n                  return true;\r\n                })\r\n                .catch(() => false);\r\n            }\r\n          });\r\n        } catch (e) { }\r\n      }\r\n\r\n      // Date - only for roadmap layout (placed after Sort by)\r\n      if (layout === 'roadmap') {\r\n        // Build info text from roadmap renderer's selected start/end fields\r\n        let dateInfo = '';\r\n        try {\r\n          const roadmapRenderer = vsLocal && vsLocal.roadmapRenderer;\r\n          if (roadmapRenderer) {\r\n            const startId = (roadmapRenderer as any).startDateFieldId || (roadmapRenderer as any).startDateField || null;\r\n            const endId = (roadmapRenderer as any).endDateFieldId || (roadmapRenderer as any).endDateField || null;\r\n            const fields = (vsLocal && vsLocal.fields) || [];\r\n            const startName = startId ? (fields as any[]).find((f: any) => String(f.id) === String(startId))?.name : null;\r\n            const endName = endId ? (fields as any[]).find((f: any) => String(f.id) === String(endId))?.name : null;\r\n            if (startName && endName) {\r\n              dateInfo = startName === endName ? startName : `${startName} & ${endName}`;\r\n            } else if (startName) {\r\n              dateInfo = startName;\r\n            } else if (endName) {\r\n              dateInfo = endName;\r\n            }\r\n          }\r\n        } catch (e) { /* ignore */ }\r\n\r\n        items.push({\r\n          label: 'Date',\r\n          info: dateInfo,\r\n          forceChevron: true,\r\n          iconName: 'calendar',\r\n          onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n            try {\r\n              const roadmapRenderer = vsLocal && vsLocal.roadmapRenderer;\r\n              if (roadmapRenderer && typeof roadmapRenderer.showDateFieldsMenu === 'function') {\r\n                // Close any existing dropdowns/submenus so only one is open\r\n                try { document.querySelectorAll('.roadmap-dropdown-menu').forEach((n) => (n as HTMLElement).remove()); } catch (e) { }\r\n                try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                // Prefer the option row `anchor` as the anchor so submenu aligns to the row\r\n                const parentMenuEl = (label as any).__activeTabMenu && (label as any).__activeTabMenu.menuEl ? (label as any).__activeTabMenu.menuEl as HTMLElement : undefined;\r\n                const syntheticEvent = {\r\n                  currentTarget: anchorRect ? ({ getBoundingClientRect: () => anchorRect } as unknown as HTMLElement) : (anchor || parentMenuEl || label)\r\n                } as unknown as MouseEvent;\r\n                try {\r\n                  const created = roadmapRenderer.showDateFieldsMenu(syntheticEvent);\r\n                  const parentMenuInst = (label as any).__activeTabMenu;\r\n                  if (created && created.el && parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function') {\r\n                    try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                  }\r\n                } catch (e) { }\r\n              }\r\n            } catch (e) { }\r\n            return true;\r\n          },\r\n        });\r\n        // Zoom level - only for roadmap layout (placed after Date)\r\n        try {\r\n          let zoomInfo = '';\r\n          const roadmapRenderer = vsLocal && vsLocal.roadmapRenderer;\r\n          if (roadmapRenderer) {\r\n            const zl = (roadmapRenderer as any).zoomLevel || 'month';\r\n            zoomInfo = zl.charAt(0).toUpperCase() + zl.slice(1);\r\n          }\r\n          items.push({\r\n            label: 'Zoom level',\r\n            info: zoomInfo,\r\n            forceChevron: true,\r\n            iconName: 'zoom-in',\r\n            onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n              try {\r\n                const roadmapRenderer = vsLocal && vsLocal.roadmapRenderer;\r\n                if (roadmapRenderer && typeof roadmapRenderer.showZoomMenu === 'function') {\r\n                  // Close existing dropdowns/submenus\r\n                  try { document.querySelectorAll('.roadmap-dropdown-menu').forEach((n) => (n as HTMLElement).remove()); } catch (e) { }\r\n                  try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                  const parentMenuEl = (label as any).__activeTabMenu && (label as any).__activeTabMenu.menuEl ? (label as any).__activeTabMenu.menuEl as HTMLElement : undefined;\r\n                  const syntheticEvent = {\r\n                    currentTarget: anchorRect ? ({ getBoundingClientRect: () => anchorRect } as unknown as HTMLElement) : (anchor || parentMenuEl || label)\r\n                  } as unknown as MouseEvent;\r\n                  try {\r\n                    const created = roadmapRenderer.showZoomMenu(syntheticEvent);\r\n                    const parentMenuInst = (label as any).__activeTabMenu;\r\n                    if (created && created.el && parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function') {\r\n                      try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                    } else {\r\n                      // Fallback: some views render the slice panel directly into the\r\n                      // view container instead of returning it. Detect that DOM node\r\n                      // and register it so the ActiveTabMenu can manage it like other submenus.\r\n                      try {\r\n                        const el = document.querySelector('.slice-panel') as HTMLElement | null;\r\n                        if (el && parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function') {\r\n                          try { parentMenuInst.registerExternalSubmenu(el, () => { /* no-op */ }); } catch (e) { }\r\n                        }\r\n                      } catch (e) { }\r\n                    }\r\n                  } catch (e) { }\r\n                }\r\n              } catch (e) { }\r\n              return true;\r\n            }\r\n          });\r\n          } catch (e) { }\r\n\r\n          // Field sum - allow toggling count and numeric fields for group divisors (roadmap: placed after Zoom)\r\n          try {\r\n            let fdInfo = '';\r\n            try {\r\n              const cur = (vsLocal && (vsLocal.groupDivisors || null));\r\n              if (Array.isArray(cur) && cur.length > 0) {\r\n                const fields = (vsLocal && vsLocal.fields) || [];\r\n                const names = cur.map((id: any) => {\r\n                  if (String(id) === '__count__') return 'Count';\r\n                  const f = (fields || []).find((ff: any) => String(ff.id) === String(id) || ff.name === id);\r\n                  return f ? f.name : String(id);\r\n                });\r\n                fdInfo = names.join(', ');\r\n              } else if (cur === null) fdInfo = 'None';\r\n            } catch (e) { }\r\n\r\n            items.push({\r\n              label: 'Field sum',\r\n              info: fdInfo,\r\n              forceChevron: true,\r\n              iconName: 'number',\r\n              onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n                return import('./FieldSumMenu')\r\n                  .then(({ default: FieldSumMenu, FieldSumMenu: FieldSumMenuClass }) => {\r\n                    try {\r\n                      try { (label as any).__activeTabMenu && (label as any).__activeTabMenu.closeOpenSubmenu && (label as any).__activeTabMenu.closeOpenSubmenu(); } catch (e) { }\r\n                      const fields = (vsLocal && vsLocal.fields) || [];\r\n                      const current = (vsLocal && (vsLocal.groupDivisors || [])) || [];\r\n                      const menu = new (FieldSumMenuClass || FieldSumMenu)({\r\n                        fields: (fields || []).map((f: any) => ({ id: String(f.id), name: f.name, dataType: f.dataType })),\r\n                        current: Array.isArray(current) ? current : [],\r\n                        title: 'Field sum',\r\n                        onChange: (selected: string[]) => {\r\n                          try {\r\n                            if (vsLocal && typeof vsLocal.onSetGroupDivisors === 'function') {\r\n                              vsLocal.onSetGroupDivisors(selected && selected.length ? selected : null);\r\n                            }\r\n                            setTimeout(() => {\r\n                              const parentMenu = (label as any).__activeTabMenu;\r\n                              if (parentMenu && typeof parentMenu.refresh === 'function') parentMenu.refresh();\r\n                            }, 50);\r\n                          } catch (e) { }\r\n                        }\r\n                      });\r\n                      const created = menu.show((anchor as HTMLElement) || (label as HTMLElement), anchorRect as DOMRect | undefined);\r\n                      try {\r\n                        const parentMenuInst = (label as any).__activeTabMenu;\r\n                        if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function' && created && (created.el as HTMLElement)) {\r\n                          try { parentMenuInst.registerExternalSubmenu(created.el as HTMLElement, created.refresh); } catch (e) { }\r\n                        }\r\n                      } catch (e) { }\r\n                    } catch (e) { }\r\n                    return true;\r\n                  })\r\n                  .catch(() => false);\r\n              }\r\n            });\r\n          } catch (e) { }\r\n\r\n        }\r\n\r\n      // Slice by - available for table/board/roadmap (last option)\r\n      try {\r\n        let sliceInfo = '';\r\n        try {\r\n          // vsLocal may expose a currentSlice or currentSliceField property\r\n          const cs = vsLocal && (vsLocal.currentSlice || vsLocal.currentSliceField || vsLocal.slice || null);\r\n          if (cs) {\r\n            if (typeof cs === 'string') sliceInfo = cs;\r\n            else if (cs && typeof cs === 'object') sliceInfo = cs.name || String(cs.fieldId || cs.id || '');\r\n          } else {\r\n            // try to read persisted slice from localStorage for table views\r\n            if (viewKey) {\r\n              try {\r\n                const stored = localStorage.getItem(`ghProjects.table.${viewKey}.slice`);\r\n                if (stored) {\r\n                  const parsed = JSON.parse(stored);\r\n                  if (parsed && parsed.fieldId) sliceInfo = String(parsed.fieldId);\r\n                }\r\n              } catch (e) { }\r\n            }\r\n          }\r\n        } catch (e) { }\r\n\r\n        if (layout === 'table' || layout === 'board' || layout === 'roadmap') {\r\n          items.push({\r\n            label: 'Slice by',\r\n            info: sliceInfo || 'None',\r\n            forceChevron: true,\r\n            iconName: 'sliceby',\r\n            onClick: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n              try {\r\n                // Prefer a view-provided API to show the slice UI. If the view returns\r\n                // a created element we register it as an external submenu so the\r\n                // ActiveTabMenu can manage closing/refresh like other menus.\r\n                // Note: For slice, the el is the persistent panel in the view, not a removable submenu,\r\n                // so we don't register it to avoid it being removed when the menu closes.\r\n                if (vsLocal && typeof vsLocal.showSlicePanel === 'function') {\r\n                  try {\r\n                    // Set a global refresh function for the slice menu to update info\r\n                    (window as any).__sliceMenuRefresh = () => {\r\n                      const parentMenuInst = (label as any).__activeTabMenu;\r\n                      if (parentMenuInst && typeof parentMenuInst.refresh === 'function') {\r\n                        parentMenuInst.refresh();\r\n                      }\r\n                    };\r\n                    const created = vsLocal.showSlicePanel(anchor, anchorRect);\r\n                    // Don't register the slice panel as it should remain in the view\r\n                    // The dropdown opened by showSlicePanel is handled separately\r\n                  } catch (e) { }\r\n                  return true;\r\n                }\r\n\r\n                // Fallback: if view exposes onSetSlice, try selecting the first sliceable field\r\n                try {\r\n                  const fields = (vsLocal && vsLocal.fields) || [];\r\n                  const sliceableTypes = new Set(['assignees','single_select','parent_issue','iteration','number','date','milestone','repository','labels','text','single_line_text']);\r\n                  const candidate = (fields || []).find((f: any) => sliceableTypes.has(String((f.dataType || '').toLowerCase())));\r\n                  if (candidate) {\r\n                    try {\r\n                      if (vsLocal && typeof vsLocal.onSetSlice === 'function') {\r\n                        vsLocal.onSetSlice(candidate.id || candidate.name || candidate);\r\n                        return true;\r\n                      }\r\n                    } catch (e) { }\r\n                  }\r\n                } catch (e) { }\r\n                  } catch (e) { }\r\n                  // Also create a small floating placeholder submenu on the right\r\n                  // side of the active menu row so the parent ActiveTabMenu treats\r\n                  // the Slice option like other dropdowns visually.\r\n                  try {\r\n                    const rect = anchorRect || (anchor && anchor.getBoundingClientRect && anchor.getBoundingClientRect());\r\n                    if (rect) {\r\n                      // Remove any existing placeholder\r\n                      try { document.querySelectorAll('.active-tab-slice-placeholder').forEach(n => n.remove()); } catch (e) { }\r\n                      const ph = document.createElement('div');\r\n                      ph.className = 'active-tab-slice-placeholder';\r\n                      ph.style.position = 'absolute';\r\n                      ph.style.top = (Math.round(rect.top)) + 'px';\r\n                      ph.style.left = (Math.round(rect.right) + 8) + 'px';\r\n                      ph.style.width = '8px';\r\n                      ph.style.height = '8px';\r\n                      ph.style.zIndex = '1001';\r\n                      ph.style.pointerEvents = 'none';\r\n                      document.body.appendChild(ph);\r\n                      try { const parentMenuInst = (label as any).__activeTabMenu; if (parentMenuInst && typeof parentMenuInst.registerExternalSubmenu === 'function') parentMenuInst.registerExternalSubmenu(ph as HTMLElement, () => { /* no-op */ }); } catch (e) { }\r\n                    }\r\n                  } catch (e) { }\r\n                  return true;\r\n            },\r\n          });\r\n        }\r\n      } catch (e) { }\r\n\r\n      return items;\r\n\r\n      };\r\n\r\n    try {\r\n      const menu = new ActiveTabMenu({ anchorElement: label, items: getItems });\r\n      (label as any).__activeTabMenu = menu;\r\n      // listen for roadmap date field changes so the menu's Date info can refresh\r\n      const dateListener = () => {\r\n        try {\r\n          const parentMenu = (label as any).__activeTabMenu;\r\n          if (parentMenu && typeof parentMenu.refresh === 'function') parentMenu.refresh();\r\n        } catch (e) { }\r\n      };\r\n      try {\r\n        window.addEventListener('roadmap:dateFieldsChanged', dateListener);\r\n        window.addEventListener('roadmap:zoomChanged', dateListener);\r\n        window.addEventListener('roadmap:markersChanged', dateListener);\r\n        (label as any).__activeTabMenuDateListener = dateListener;\r\n      } catch (e) { }\r\n      currentLabel = label;\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n  // Update on initial load\r\n  attachMenuToActive();\r\n\r\n  // Listen for clicks on tabs to update active attachment\r\n  tabsContainerEl.addEventListener('click', () => setTimeout(attachMenuToActive, 0));\r\n\r\n  // Observe class changes and added/removed tabs\r\n  const mo = new MutationObserver((mutations) => {\r\n    for (const m of mutations) {\r\n      if (m.type === 'attributes') {\r\n        // attribute change may indicate active class change\r\n        attachMenuToActive();\r\n      }\r\n      for (const n of Array.from(m.addedNodes || [])) {\r\n        if (n.nodeType === 1) attachMenuToActive();\r\n      }\r\n    }\r\n  });\r\n  mo.observe(tabsContainerEl, { childList: true, subtree: true, attributes: true, attributeFilter: ['class'] });\r\n}\r\n// Prevent multiple initializations when this module is imported multiple times\r\nif (!(window as any).__activeTabMenusInitialized) {\r\n  (window as any).__activeTabMenusInitialized = true;\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', initOnce);\r\n  } else {\r\n    setTimeout(initOnce, 0);\r\n  }\r\n}\r\n\r\nexport default initOnce;\r\n", "import { RoadmapRenderer } from \"./renderers/RoadmapRenderer\";\r\nimport {\r\n  setLoadingState,\r\n  setErrorState,\r\n  logDebug,\r\n  initFilterBar,\r\n} from \"./viewFetcherUtils\";\r\nimport { parseSortByFields, sortItems } from \"./utils/tableSorting\";\r\nimport type { SortConfig } from \"./utils/tableSorting\";\r\nimport { SlicePanel } from \"./components/SlicePanel\";\r\nimport type { Item, NormalizedValue, FieldConfig } from \"../../lib/types\";\r\n\r\n/// <reference path=\"./global.d.ts\" />\r\n\r\n// Initialize active tab menus only when view fetchers are loaded\r\nimport \"./components/initActiveTabMenus\";\r\n\r\nwindow.roadmapViewFetcher = function (\r\n  view: any,\r\n  container: HTMLElement,\r\n  viewKey: any,\r\n) {\r\n  const viewName =\r\n    view && (view.name || view.id) ? view.name || view.id : \"Roadmap View\";\r\n  try {\r\n    setLoadingState(container, viewName);\r\n  } catch (e) { }\r\n\r\n  // Local persistent state for overrides\r\n  // undefined = no override, null = no grouping (None), string = specific grouping\r\n  let unsavedGrouping: string | null | undefined = undefined;\r\n  let unsavedHiddenFields: Set<string> | null = null;\r\n  let unsavedGroupDivisors: string[] | null | undefined = undefined;\r\n  let unsavedSort: SortConfig | null | undefined = undefined;\r\n  // Track unsaved slice changes\r\n  let unsavedSlice: { fieldId: string; value: any } | null = null;\r\n  let activeSlicePanel: any = null;\r\n\r\n  let lastPayload: any = null;\r\n  let lastEffectiveFilter: string | undefined = undefined;\r\n\r\n  function render(payload: any, effectiveFilter?: string) {\r\n    lastPayload = payload;\r\n    if (effectiveFilter !== undefined) lastEffectiveFilter = effectiveFilter;\r\n    else effectiveFilter = lastEffectiveFilter;\r\n\r\n    const snapshot = payload || {};\r\n    const items = snapshot.items || [];\r\n    const fields = snapshot.fields || []; // Currently visible fields from server\r\n    const allFields = snapshot.allFields || fields;\r\n\r\n    const existingSlicePanel = container.querySelector('.slice-panel');\r\n    container.innerHTML = \"\";\r\n    if (existingSlicePanel) {\r\n      try { container.appendChild(existingSlicePanel); } catch (e) { }\r\n    }\r\n    container.style.height = \"100%\";\r\n    container.style.display = \"flex\";\r\n    container.style.flexDirection = \"column\";\r\n\r\n    // 1. Init Filter Bar (Save/Discard logic)\r\n    // We attach it to a header container\r\n    const headerContainer = document.createElement(\"div\");\r\n    headerContainer.style.flex = \"0 0 auto\";\r\n    headerContainer.appendChild(document.createElement(\"div\"));\r\n\r\n    // We pass the parent, initFilterBar will append filter bar\r\n    let barApi = initFilterBar(headerContainer, viewKey, {\r\n      suffix: viewKey,\r\n      onSave: (newFilter: any) => {\r\n        let dirty = false;\r\n        // Save Grouping\r\n        if (unsavedGrouping !== undefined) {\r\n          if ((window as any).__APP_MESSAGING__) {\r\n            (window as any).__APP_MESSAGING__.postMessage({\r\n              command: \"setViewGrouping\",\r\n              viewKey: viewKey,\r\n              grouping: unsavedGrouping, // can be null\r\n            });\r\n          }\r\n          unsavedGrouping = undefined;\r\n          dirty = true;\r\n        }\r\n        // Save Hidden Fields\r\n        if (unsavedHiddenFields !== null) {\r\n          const hiddenArr = Array.from(unsavedHiddenFields);\r\n          if ((window as any).__APP_MESSAGING__) {\r\n            (window as any).__APP_MESSAGING__.postMessage({\r\n              command: \"setViewHiddenFields\",\r\n              viewKey: viewKey,\r\n              hiddenFields: hiddenArr,\r\n            });\r\n          }\r\n          try {\r\n            const key = viewKey ? `ghProjects.table.${viewKey}.hiddenFields` : null;\r\n            if (key) localStorage.setItem(key, JSON.stringify(hiddenArr));\r\n          } catch (e) { }\r\n          unsavedHiddenFields = null;\r\n          dirty = true;\r\n        }\r\n\r\n        // Save Group Divisors\r\n        if (unsavedGroupDivisors !== undefined) {\r\n          if ((window as any).__APP_MESSAGING__) {\r\n            (window as any).__APP_MESSAGING__.postMessage({\r\n              command: \"setViewGroupDivisors\",\r\n              viewKey: viewKey,\r\n              groupDivisors: unsavedGroupDivisors,\r\n            });\r\n          }\r\n          try {\r\n            const key = viewKey ? `ghProjects.roadmap.${viewKey}.groupDivisors` : null;\r\n            if (key) {\r\n              if (unsavedGroupDivisors === null) localStorage.removeItem(key);\r\n              else localStorage.setItem(key, JSON.stringify(unsavedGroupDivisors));\r\n            }\r\n          } catch (e) { }\r\n          unsavedGroupDivisors = undefined;\r\n          dirty = true;\r\n        }\r\n\r\n        // Save slice if changed\r\n        if (unsavedSlice !== null) {\r\n          try {\r\n            if ((window as any).__APP_MESSAGING__ && typeof (window as any).__APP_MESSAGING__.postMessage === 'function') {\r\n              (window as any).__APP_MESSAGING__.postMessage({ command: 'setViewSlice', viewKey: viewKey, slice: unsavedSlice });\r\n            }\r\n          } catch (e) { }\r\n          try { const key = viewKey ? `ghProjects.table.${viewKey}.slice` : null; if (key) localStorage.setItem(key, JSON.stringify(unsavedSlice)); } catch (e) { }\r\n          unsavedSlice = null;\r\n          dirty = true;\r\n        }\r\n\r\n        if (dirty) {\r\n          // Request Refresh\r\n          if ((window as any).__APP_MESSAGING__) {\r\n            (window as any).__APP_MESSAGING__.postMessage({\r\n              command: \"requestFields\",\r\n              viewKey: viewKey,\r\n            });\r\n          }\r\n        }\r\n      },\r\n      onDiscard: () => {\r\n        if (unsavedGrouping !== undefined || unsavedHiddenFields !== null || unsavedGroupDivisors !== undefined || unsavedSlice !== null) {\r\n          unsavedGrouping = undefined;\r\n          unsavedHiddenFields = null;\r\n          unsavedGroupDivisors = undefined;\r\n          unsavedSlice = null;\r\n          try { if (activeSlicePanel && typeof activeSlicePanel.close === 'function') activeSlicePanel.close(); activeSlicePanel = null; } catch (e) { }\r\n          // Re-render\r\n          if (lastPayload) render(lastPayload, lastEffectiveFilter);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (effectiveFilter && barApi && barApi.setEffectiveFilter) {\r\n      barApi.setEffectiveFilter(effectiveFilter);\r\n    }\r\n\r\n    // Force Enable Buttons if dirty\r\n    if (barApi && (unsavedGrouping !== undefined || unsavedHiddenFields !== null)) {\r\n      try {\r\n        if (barApi.saveBtn) { barApi.saveBtn.disabled = false; barApi.saveBtn.style.opacity = \"1\"; barApi.saveBtn.style.cursor = \"pointer\"; }\r\n        if (barApi.discardBtn) { barApi.discardBtn.disabled = false; barApi.discardBtn.style.opacity = \"1\"; barApi.discardBtn.style.cursor = \"pointer\"; }\r\n      } catch (e) { }\r\n    }\r\n\r\n    container.appendChild(headerContainer);\r\n\r\n    // 2. Prepare Data (Overrides)\r\n    let modifiedSnapshot = { ...snapshot };\r\n\r\n    // Grouping Override\r\n    if (unsavedGrouping !== undefined) {\r\n      modifiedSnapshot.details = { ...(snapshot.details || {}) };\r\n      modifiedSnapshot.details.groupByFields = { ...(modifiedSnapshot.details.groupByFields || {}) };\r\n\r\n      if (unsavedGrouping === null) {\r\n        modifiedSnapshot.details.groupByFields.nodes = [];\r\n      } else {\r\n        const gField = allFields.find((f: any) => f.name === unsavedGrouping);\r\n        if (gField) {\r\n          modifiedSnapshot.details.groupByFields.nodes = [gField];\r\n        }\r\n      }\r\n    }\r\n\r\n    // Visible Fields Override\r\n    let visibleFieldIds: Set<string>;\r\n\r\n    if (unsavedHiddenFields !== null) {\r\n      visibleFieldIds = new Set();\r\n      // visible = allFields - hidden\r\n      allFields.forEach((f: any) => {\r\n        if (!unsavedHiddenFields!.has(String(f.id))) {\r\n          visibleFieldIds.add(String(f.id));\r\n        }\r\n      });\r\n    } else {\r\n      visibleFieldIds = new Set(fields.map((f: any) => String(f.id)));\r\n    }\r\n\r\n    // Callbacks for RoadmapRenderer\r\n    const handleFilter = (filter: string) => {\r\n      if (barApi && barApi.inputEl) {\r\n        const current = String(barApi.inputEl.value || \"\").trim();\r\n        let newFilter = current ? `${current} ${filter}` : filter;\r\n        barApi.inputEl.value = newFilter;\r\n        barApi.inputEl.dispatchEvent(new Event(\"input\", { bubbles: true }));\r\n      }\r\n    };\r\n\r\n    const handleAction = (action: string, item: any, args: any) => {\r\n      if (action === \"open-menu\" && args) {\r\n        // Simple context menu\r\n        const ex = document.querySelectorAll(\".board-context-menu\");\r\n        ex.forEach((e) => e.remove());\r\n\r\n        const menu = document.createElement(\"div\");\r\n        menu.className = \"board-context-menu\";\r\n        menu.style.position = \"fixed\";\r\n        const x = Math.min(args.x, window.innerWidth - 180);\r\n        const y = Math.min(args.y, window.innerHeight - 150);\r\n        menu.style.left = x + \"px\";\r\n        menu.style.top = y + \"px\";\r\n        menu.style.background = \"var(--vscode-menu-background)\";\r\n        menu.style.color = \"var(--vscode-menu-foreground)\";\r\n        menu.style.border = \"1px solid var(--vscode-menu-border)\";\r\n        menu.style.borderRadius = \"4px\";\r\n        menu.style.zIndex = \"1000\";\r\n        menu.style.padding = \"4px 0\";\r\n\r\n        const addItem = (text: string, onClick: () => void) => {\r\n          const el = document.createElement(\"div\");\r\n          el.style.padding = \"4px 8px\";\r\n          el.style.cursor = \"pointer\";\r\n          el.textContent = text;\r\n          el.addEventListener(\"click\", (e) => {\r\n            e.stopPropagation();\r\n            menu.remove();\r\n            onClick();\r\n          });\r\n          el.addEventListener(\"mouseenter\", () => el.style.background = \"var(--vscode-menu-selectionBackground)\");\r\n          el.addEventListener(\"mouseleave\", () => el.style.background = \"transparent\");\r\n          menu.appendChild(el);\r\n        };\r\n\r\n        addItem(\"Open issue\", () => {\r\n          const url = item.content?.url || item.url || (item.raw && item.raw.itemContent && item.raw.itemContent.url);\r\n          if (url && (window as any).__APP_MESSAGING__) {\r\n            (window as any).__APP_MESSAGING__.postMessage({ command: \"openUrl\", url });\r\n          }\r\n        });\r\n\r\n        document.body.appendChild(menu);\r\n        const close = () => { menu.remove(); document.removeEventListener(\"click\", close); };\r\n        setTimeout(() => document.addEventListener(\"click\", close), 0);\r\n      }\r\n    };\r\n\r\n    // 3. Render Roadmap\r\n    const roadmapContainer = document.createElement(\"div\");\r\n    roadmapContainer.style.flex = \"1 1 auto\";\r\n    roadmapContainer.style.overflow = \"hidden\";\r\n\r\n    const contentWrapper = document.createElement(\"div\");\r\n    contentWrapper.style.flex = \"1 1 auto\";\r\n    contentWrapper.style.display = \"flex\";\r\n    contentWrapper.style.overflow = \"hidden\";\r\n    contentWrapper.appendChild(roadmapContainer);\r\n    container.appendChild(contentWrapper);\r\n\r\n    function repositionSlicePanel() {\r\n      try {\r\n        const sliceEl = container.querySelector('.slice-panel') as HTMLElement | null;\r\n        if (sliceEl) {\r\n          // Move sliceEl to contentWrapper before roadmapContainer\r\n          if (contentWrapper && roadmapContainer) {\r\n            contentWrapper.insertBefore(sliceEl, roadmapContainer);\r\n            // Set contentWrapper to flex row for side-by-side layout\r\n            contentWrapper.style.flexDirection = \"row\";\r\n            sliceEl.style.float = \"none\";\r\n            sliceEl.style.display = \"flex\";\r\n            sliceEl.style.flex = \"0 0 auto\";\r\n          } else {\r\n            // Fallback: insert as first child of contentWrapper\r\n            if (contentWrapper) {\r\n              contentWrapper.insertBefore(sliceEl, contentWrapper.firstElementChild);\r\n              contentWrapper.style.flexDirection = \"row\";\r\n            }\r\n          }\r\n        }\r\n      } catch (e) { }\r\n    }\r\n\r\n    // Determine sorting (respecting unsaved override and stored override)\r\n    let sortConfig: SortConfig | null = null;\r\n    if (unsavedSort !== undefined) {\r\n      sortConfig = unsavedSort || null;\r\n    } else if (viewKey) {\r\n      try {\r\n        const stored = localStorage.getItem(`ghProjects.table.${viewKey}.sortConfig`);\r\n        if (stored) sortConfig = JSON.parse(stored);\r\n      } catch (e) { }\r\n    }\r\n    if (!sortConfig) {\r\n      sortConfig = parseSortByFields(modifiedSnapshot.details?.sortByFields);\r\n    }\r\n\r\n    let displayItems = items;\r\n    if (sortConfig) {\r\n      displayItems = sortItems(items, allFields, sortConfig);\r\n    }\r\n\r\n    // Apply slice filtering\r\n    if (unsavedSlice) {\r\n      displayItems = displayItems.filter((item: Item) => {\r\n            const fv = item.fieldValues.find((f: any) => String(f.fieldId) === String(unsavedSlice!.fieldId));\r\n        // Handle different field types\r\n        const field = allFields.find((f: FieldConfig) => f.id === unsavedSlice!.fieldId);\r\n        const dataType = field ? (field.dataType || field.type || '').toLowerCase() : '';\r\n\r\n        // Extract value from NormalizedValue\r\n        let val = null;\r\n        if (!fv) {\r\n          // No field value found\r\n          val = null;\r\n        } else {\r\n          if ((fv as any).text !== undefined) val = (fv as any).text;\r\n          else if ((fv as any).title !== undefined) val = (fv as any).title;\r\n          else if ((fv as any).number !== undefined) val = (fv as any).number;\r\n          else if ((fv as any).date !== undefined) val = (fv as any).date;\r\n          else if ((fv as any).option) val = (fv as any).option.name;\r\n          else if ((fv as any).iteration) val = (fv as any).iteration.title;\r\n          else if ((fv as any).assignees) val = (fv as any).assignees;\r\n          else if ((fv as any).labels) val = (fv as any).labels;\r\n          else if (dataType === 'parent_issue') {\r\n            const p = (fv as any).parent || (fv as any).parentIssue || (fv as any).issue || (fv as any).item || (fv as any).value || null;\r\n            if (p) val = p.title || p.name || p.number || p.id || p.url || null;\r\n          }\r\n          else if (dataType === 'milestone') {\r\n            val = (fv as any).milestone?.title || (fv as any).milestone?.name || (fv as any).value || null;\r\n          }\r\n          else if (dataType === 'repository') {\r\n            val = (fv as any).repository?.nameWithOwner || (fv as any).repository?.full_name || (fv as any).repository?.name || (fv as any).value || null;\r\n          }\r\n          else val = (fv as any).value; // fallback\r\n        }\r\n\r\n        if (unsavedSlice!.value === null) {\r\n          // For null slice value, show items that have no value for this field\r\n          if (dataType === 'assignees' || dataType === 'labels') {\r\n            return !val || (Array.isArray(val) && val.length === 0);\r\n          } else {\r\n            return val === null || val === undefined;\r\n          }\r\n        }\r\n        if (dataType === 'assignees' || dataType === 'labels') {\r\n          if (!Array.isArray(val)) return false;\r\n          if (dataType === 'assignees') {\r\n            // For assignees, val is array of objects, slice value is object\r\n            return val.some((assignee: any) => \r\n              assignee && (assignee.login === unsavedSlice!.value?.login || assignee.id === unsavedSlice!.value?.id)\r\n            );\r\n          } else if (dataType === 'labels') {\r\n            // For labels, val is array of objects, slice value is string (name)\r\n            return val.some((label: any) => \r\n              label && (label.name === unsavedSlice!.value || label.id === unsavedSlice!.value)\r\n            );\r\n          }\r\n        } else {\r\n          return val === unsavedSlice!.value;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Determine effective group divisors (unsaved override -> localStorage -> payload.details)\r\n    let effectiveGroupDivisors: string[] | null = null;\r\n    try {\r\n      if (unsavedGroupDivisors !== undefined) {\r\n        effectiveGroupDivisors = unsavedGroupDivisors === null ? null : (unsavedGroupDivisors || null);\r\n      } else if (viewKey) {\r\n        try { const stored = localStorage.getItem(`ghProjects.roadmap.${viewKey}.groupDivisors`); if (stored) effectiveGroupDivisors = JSON.parse(stored); } catch (e) { }\r\n      }\r\n      try {\r\n        const maybe = (modifiedSnapshot as any).details && (modifiedSnapshot as any).details.groupDivisors && Array.isArray((modifiedSnapshot as any).details.groupDivisors.nodes) ? (modifiedSnapshot as any).details.groupDivisors.nodes.map((n: any) => String(n.id || n.name)) : null;\r\n        if (effectiveGroupDivisors === null && maybe) effectiveGroupDivisors = maybe;\r\n      } catch (e) { }\r\n    } catch (e) { }\r\n\r\n    const renderer = new RoadmapRenderer(\r\n      displayItems,\r\n      allFields,\r\n      Array.from(visibleFieldIds),\r\n      handleFilter,\r\n      handleAction,\r\n      effectiveGroupDivisors,\r\n    );\r\n    // Passing modifiedSnapshot to renderRoadmap ensures it uses overwritten grouping\r\n    renderer.renderRoadmap(roadmapContainer, modifiedSnapshot);\r\n\r\n    // Reposition slice panel if present\r\n    repositionSlicePanel();\r\n\r\n    // 4. Update __viewStates for Menus\r\n    // Identify current grouping field for menu\r\n    let currentGroupingName: string | null = null;\r\n    const gbNodes = modifiedSnapshot.details?.groupByFields?.nodes;\r\n    if (gbNodes && gbNodes.length > 0) {\r\n      currentGroupingName = gbNodes[0].name || null;\r\n    }\r\n\r\n    try {\r\n      (window as any).__viewStates = (window as any).__viewStates || {};\r\n      (window as any).__viewStates[viewKey] = {\r\n        fields: allFields,\r\n        items: items,\r\n        visibleFieldIds: visibleFieldIds,\r\n        // Exposed for menu:\r\n        current: currentGroupingName,\r\n        // Expose RoadmapRenderer for Markers menu\r\n        roadmapRenderer: renderer,\r\n        // Expose current sort and allow sort changes\r\n        currentSort: (() => {\r\n          try {\r\n            let effective: SortConfig | null = null;\r\n            if (unsavedSort !== undefined) effective = unsavedSort || null;\r\n            else if (viewKey) {\r\n              try { const stored = localStorage.getItem(`ghProjects.table.${viewKey}.sortConfig`); if (stored) effective = JSON.parse(stored); } catch (e) { }\r\n            }\r\n            if (!effective) effective = parseSortByFields(modifiedSnapshot.details?.sortByFields);\r\n            if (effective && effective.fieldId) {\r\n              const sf = allFields.find((f: any) => String(f.id) === String(effective!.fieldId));\r\n              return sf ? sf.name : effective!.fieldId;\r\n            }\r\n          } catch (e) { }\r\n          return null;\r\n        })(),\r\n        onSetSort: (fieldId: string | null) => {\r\n          try {\r\n            if (fieldId === null) unsavedSort = null;\r\n            else unsavedSort = { fieldId: String(fieldId), direction: 'ASC' } as SortConfig;\r\n            if (lastPayload) render(lastPayload, lastEffectiveFilter);\r\n          } catch (e) { }\r\n        },\r\n\r\n        // Slice handling\r\n        onSetSlice: (fieldId: string | null) => {\r\n          try { unsavedSlice = fieldId ? { fieldId, value: null } : null; if (lastPayload) render(lastPayload, lastEffectiveFilter); } catch (e) { }\r\n        },\r\n        showSlicePanel: (anchor?: HTMLElement, anchorRect?: DOMRect) => {\r\n          try {\r\n            try { if (activeSlicePanel && typeof activeSlicePanel.close === 'function') activeSlicePanel.close(); activeSlicePanel = null; } catch (e) { }\r\n            // Clean up any leftover slice panels\r\n            try { const existing = container.querySelector('.slice-panel'); if (existing) existing.remove(); } catch (e) { }\r\n            const sliceableTypes = new Set(['assignees','single_select','parent_issue','iteration','number','date','milestone','repository','labels','text','single_line_text']);\r\n            let field: any = null;\r\n            try { const sid = unsavedSlice ? String(unsavedSlice.fieldId) : null; if (sid) field = allFields.find((f: any) => String(f.id) === sid); } catch (e) { }\r\n            if (!field) field = (allFields || []).find((f: any) => sliceableTypes.has(String((f.dataType || '').toLowerCase())));\r\n            if (!field) return;\r\n            try {\r\n              activeSlicePanel = new SlicePanel(container, field, items || [], allFields || []);\r\n              activeSlicePanel.render();\r\n              try {\r\n                console.debug && console.debug(\"[roadmapViewFetcher] created activeSlicePanel, parent:\", container && container.className, \"sliceElExists:\", !!container.querySelector('.slice-panel'));\r\n              } catch (e) { }\r\n              // Reposition the slice panel immediately after creation\r\n              repositionSlicePanel();\r\n              activeSlicePanel.onValueSelect((value: any) => {\r\n                try { unsavedSlice = { fieldId: field.id, value }; if (lastPayload) render(lastPayload, lastEffectiveFilter); } catch (e) { }\r\n              });\r\n              activeSlicePanel.onFieldChange((newField: any) => {\r\n                try { activeSlicePanel && activeSlicePanel.close && activeSlicePanel.close(); activeSlicePanel = null; unsavedSlice = null; if (newField) { unsavedSlice = { fieldId: newField.id, value: null }; (window as any).__viewStates[viewKey] && (window as any).__viewStates[viewKey].showSlicePanel && (window as any).__viewStates[viewKey].showSlicePanel(); } } catch (e) { }\r\n              });\r\n            } catch (e) { }\r\n\r\n            // Try to position the slice panel as a left column for roadmap views.\r\n            // The panel will be repositioned after rendering by the repositioning logic below.\r\n            // For now, just ensure it's in the container.\r\n            try {\r\n              const el = container.querySelector('.slice-panel') as HTMLElement | null;\r\n              if (el && !container.contains(el)) {\r\n                container.insertBefore(el, container.firstChild);\r\n              }\r\n            } catch (e) { }\r\n            // If caller provided an anchorRect (from the ActiveTabMenu) open the\r\n            // field dropdown anchored to that rect so the menu lines up visually.\r\n            try { if (anchorRect && activeSlicePanel && typeof activeSlicePanel.openFieldDropdown === 'function') activeSlicePanel.openFieldDropdown(anchorRect); } catch (e) { }\r\n            // Return created element so callers can register external submenu\r\n            try { const el = (activeSlicePanel as any) && (activeSlicePanel as any).panelElement ? (activeSlicePanel as any).panelElement as HTMLElement : null; if (el) return { el, refresh: () => { try { /* no-op */ } catch (e) {} } }; } catch (e) { }\r\n            return null;\r\n          } catch (e) { }\r\n        },\r\n        get currentSlice() { try { const sid = unsavedSlice ? String(unsavedSlice.fieldId) : null; if (sid) { const f = (allFields || []).find((ff: any) => String(ff.id) === sid); return f ? f.name : sid; } if (viewKey) { try { const stored = localStorage.getItem(`ghProjects.table.${viewKey}.slice`); if (stored) { const parsed = JSON.parse(stored); if (parsed && parsed.fieldId) { const f = (allFields || []).find((ff: any) => String(ff.id) === String(parsed.fieldId)); return f ? f.name : String(parsed.fieldId); } } } catch (e) { } } } catch (e) { } return null; },\r\n\r\n        onToggleVisibility: (fieldId: string, visible: boolean) => {\r\n          const id = String(fieldId);\r\n          if (unsavedHiddenFields === null) {\r\n            unsavedHiddenFields = new Set<string>();\r\n            // Init with currently hidden if using partial fields in snapshot?\r\n            // Logic: allFields - fields is currently hidden (approximately)\r\n            // But we have visibleFieldIds from above.\r\n            // The logic in boardViewFetcher:\r\n            // unsavedHiddenFields = new Set(); allFields.forEach f => if (!visibleSet.has(f.id)) add.\r\n            const visibleSet = new Set(fields.map((f: any) => String(f.id)));\r\n            allFields.forEach((f: any) => {\r\n              if (!visibleSet.has(String(f.id))) unsavedHiddenFields!.add(String(f.id));\r\n            });\r\n          }\r\n\r\n          if (visible) unsavedHiddenFields.delete(id);\r\n          else unsavedHiddenFields.add(id);\r\n\r\n          if (lastPayload) render(lastPayload, lastEffectiveFilter);\r\n        },\r\n        onSetGroupBy: (fieldName: string | null) => {\r\n          unsavedGrouping = fieldName;\r\n          if (lastPayload) render(lastPayload, lastEffectiveFilter);\r\n        }\r\n        ,\r\n        groupDivisors: (() => {\r\n          try {\r\n            if (unsavedGroupDivisors !== undefined) return unsavedGroupDivisors;\r\n            if (viewKey) {\r\n              try {\r\n                const stored = localStorage.getItem(`ghProjects.roadmap.${viewKey}.groupDivisors`);\r\n                if (stored) return JSON.parse(stored);\r\n              } catch (e) { }\r\n            }\r\n          } catch (e) { }\r\n          return null;\r\n        })(),\r\n        onSetGroupDivisors: (ids: string[] | null) => {\r\n          unsavedGroupDivisors = ids === null ? null : Array.isArray(ids) ? ids : [String(ids)];\r\n          if (lastPayload) render(lastPayload, lastEffectiveFilter);\r\n        }\r\n      };\r\n    } catch (e) { }\r\n  }\r\n\r\n  function onMessage(ev: MessageEvent) {\r\n    const msg = ev && ev.data ? ev.data : ev;\r\n    try {\r\n      if (msg && msg.command === \"fields\") {\r\n        if (msg.viewKey && viewKey && String(msg.viewKey) !== String(viewKey))\r\n          return;\r\n        if (msg.error) {\r\n          setErrorState(container, viewName, String(msg.error));\r\n        } else {\r\n          render(msg.payload, msg.effectiveFilter);\r\n        }\r\n      }\r\n    } catch (e) { }\r\n    try {\r\n      // Debug: output structure after reposition attempt\r\n      try {\r\n        const sliceNow = container.querySelector('.slice-panel');\r\n        const splitNow = container.querySelector('.roadmap-split-pane');\r\n        console.debug && console.debug('[roadmapViewFetcher] post-reposition: slicePresent=', !!sliceNow, 'sliceParent=', sliceNow ? sliceNow.parentElement && sliceNow.parentElement.className : null, 'splitPanePresent=', !!splitNow);\r\n      } catch (e) { }\r\n    } catch (e) { }\r\n  }\r\n\r\n  try {\r\n    (window as any).__APP_MESSAGING__.onMessage(onMessage);\r\n  } catch (e) {\r\n    window.addEventListener(\"message\", onMessage);\r\n  }\r\n\r\n  // Initial Request\r\n  if ((window as any).__APP_MESSAGING__) {\r\n    (window as any).__APP_MESSAGING__.postMessage({\r\n      command: \"requestFields\",\r\n      viewKey: viewKey,\r\n    });\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": ["GroupDataService", "init_GroupDataService", "__esmMin", "items", "field", "options", "dType", "groups", "opt", "unassigned", "item", "index", "fv", "v", "placed", "matchId", "matchName", "group", "g", "map", "unassignedFallback", "val", "p", "a", "displayVal", "lines", "key", "groupsArr", "FieldsMenu_exports", "__export", "FieldsMenu", "FieldsMenu_default", "init_FieldsMenu", "__esmMin", "options", "anchorElement", "anchorRect", "n", "rect", "menuRect", "margin", "vw", "vh", "top", "left", "finalTop", "title", "icon", "label", "newField", "visible", "f", "hidden", "text", "h", "r", "field", "row", "c", "s", "iconHtml", "newVisible", "dataType", "iconName", "GroupByMenu_exports", "__export", "GroupByMenu", "GroupByMenu_default", "init_GroupByMenu", "__esmMin", "init_GroupDataService", "options", "anchor", "anchorRect", "title", "noneRow", "noneCheck", "noneLabel", "candidateFields", "f", "groups", "GroupDataService", "r", "check", "currentVal", "left", "dt", "iconName", "s", "label", "rectAnchor", "mrect", "vw", "vh", "margin", "top", "maxTop", "SortByMenu_exports", "__export", "SortByMenu", "SortByMenu_default", "getIconSvg", "iconName", "size", "getIconNameForDataType", "dataType", "init_SortByMenu", "__esmMin", "options", "anchor", "anchorRect", "title", "f", "isActive", "id", "label", "row", "check", "iconEl", "s", "labelEl", "rectAnchor", "mrect", "vw", "vh", "margin", "top", "maxTop", "left", "FieldSumMenu_exports", "__export", "FieldSumMenu", "FieldSumMenu_default", "init_FieldSumMenu", "__esmMin", "options", "anchor", "anchorRect", "title", "addRow", "id", "label", "icon", "selected", "check", "left", "s", "lbl", "ev", "cur", "currentSet", "f", "dt", "rect", "menuRect", "vw", "vh", "_MenuManager", "el", "type", "nodes", "n", "menuEl", "refreshFn", "fn", "MenuManager", "menuManager_default", "init_GroupDataService", "escapeHtml", "s", "normalizeColor", "color", "n", "b", "u", "addAlpha", "alpha", "S", "v", "C", "getContrastColor", "createEl", "tag", "renderColorDot", "option", "colorDot", "normalizeColor", "renderNameSpan", "groupingField", "nameSpan", "name", "renderCountPill", "count", "countPill", "color", "addAlpha", "renderNumericFieldSum", "field", "itemsArr", "fieldId", "sum", "gi", "it", "fv", "v", "num", "el", "createEl", "extractParentFromItem", "it", "groupingField", "candidates", "cvs", "pfv", "v", "renderParentProgress", "group", "allItems", "parentMeta", "firstRaw", "first", "identifiers", "pushIf", "found", "A", "d", "M", "tryPush", "x", "o", "m", "done", "total", "itemsList", "isDoneByHeuristics", "content", "state", "percentFV", "gi", "pct", "progWrapper", "createEl", "bar", "fill", "renderIterationElement", "opt", "iterText", "start", "duration", "s", "days", "e", "sStr", "eStr", "iterEl", "getIconSvg", "iconName", "size", "buildGroupHeaderElement", "fields", "options", "groupingFieldDef", "f", "header", "toggleSpan", "colorDot", "renderColorDot", "nameSpan", "renderNameSpan", "effectiveDivisors", "vs", "countPill", "renderCountPill", "numericFields", "sel", "nf", "el", "renderNumericFieldSum", "avatarUrl", "fv", "match", "a", "avatarEl", "escapeHtml", "parentEl", "ICON_DEFINITIONS", "getIconSvg", "name", "options", "icon", "size", "className", "fill", "viewBox", "ariaHidden", "ariaLabel", "escapeHtml", "title", "innerContent", "escapeHtml", "text", "getIconNameForDataType", "dataType", "TitleRenderer", "value", "field", "item", "allItems", "t", "o", "l", "w", "x", "a", "normalizeColor", "p", "g", "escapeHtml", "f", "content", "isPullRequest", "isDraft", "isClosed", "isMerged", "isBlocked", "parentIsDoneByStatus", "st", "completedNames", "deps", "hasDoneFromStatus", "statusFv", "fv", "fname", "optNameLower", "hasDoneLabel", "iconName", "baseIcon", "getIconSvg", "blockedIcon", "tooltipText", "safeUrl", "safeTooltip", "TextRenderer", "NumberRenderer", "DateRenderer", "SingleSelectRenderer", "n", "c", "hasHex", "border", "bg", "addAlpha", "fg", "IterationRenderer", "i", "name", "rawColor", "RepositoryRenderer", "r", "url", "icon", "tooltip", "LabelsRenderer", "k", "L", "h", "PullRequestRenderer", "prs", "out", "num", "titleText", "normColor", "getContrastColor", "state", "IssueRenderer", "AssigneesRenderer", "assignees", "getProfileUrl", "login", "direct", "avatarHtml", "index", "avatarUrl", "offset", "zIndex", "initials", "part", "profileUrl", "commonStyle", "names", "summary", "primaryProfileUrl", "RequestedReviewersRenderer", "reviewers", "display", "MilestoneRenderer", "SubIssuesProgressRenderer", "totalCount", "doneCount", "pct", "ParentIssueRenderer", "itemsList", "O", "$", "A", "d", "M", "V", "X", "parentIconName", "parentIcon", "q", "parentWrapper", "strategies", "TitleRenderer", "TextRenderer", "NumberRenderer", "DateRenderer", "SingleSelectRenderer", "IterationRenderer", "RepositoryRenderer", "LabelsRenderer", "PullRequestRenderer", "IssueRenderer", "AssigneesRenderer", "RequestedReviewersRenderer", "MilestoneRenderer", "SubIssuesProgressRenderer", "ParentIssueRenderer", "renderCell", "e", "n", "s", "allItems", "strategy", "err", "RoadmapRenderer", "items", "allFields", "visibleFieldIds", "onFilter", "onAction", "groupDivisors", "fields", "visibleIds", "markers", "markerId", "active", "m", "fieldId", "container", "snapshot", "controlHeader", "splitPane", "listContainer", "listHeader", "listView", "timelineContainer", "gridHeader", "gridView", "groupByFields", "groupingField", "f", "itemsToRender", "sortField", "isDateType", "a", "b", "valA", "valB", "v", "groups", "GroupDataService", "it", "idx", "iterOrDateFields", "type", "startField", "endField", "style", "header", "leftLabel", "spacer", "btnStyleBase", "createControlBtn", "label", "icon", "onClick", "hasDropdown", "btn", "iconSvg", "getIconSvg", "dropdownSvg", "tools", "e", "zoomLabel", "todayBtn", "today", "start", "todayOffset", "navGroup", "prevBtn", "nextBtn", "options", "getIconNameForDataType", "id", "iterAndDateFields", "menu", "renderSection", "title", "currentId", "onSelect", "isLast", "item", "typeArr", "suffix", "rect", "anchorRect", "menuRect", "vw", "left", "divider", "anchor", "getAnchorRectOrFallback", "clientRects", "anc", "closer", "ev", "menuManager_default", "opt", "isSelected", "r", "vw2", "activeIds", "multi", "check", "dates", "d", "gridContent", "end", "futureMonths", "totalWidth", "headerScroll", "gridLines", "iter", "mStart", "mEnd", "mStartOffset", "mWidth", "line", "rowHeight", "globalIndex", "group", "groupId", "isCollapsed", "listGroupHeader", "buildGroupHeaderElement", "toggle", "gridGroupHeader", "gi", "listRow", "rowNum", "contentWrapper", "titleField", "titleFv", "assigneesField", "assigneesFv", "renderCell", "gridRow", "iStart", "iEnd", "startOffset", "duration", "barWidth", "bar", "iStartStr", "iEndStr", "stickyContent", "avatarOnlyRenderer", "fv", "field", "html", "tmp", "avatarEl", "addItemRow", "plusIcon", "gridAddRow", "date", "i", "s", "diff", "matchedIds", "el", "markerLine", "nub", "milestoneField", "milestones", "offset", "diamond", "circle", "uniqueDates", "dateStr", "triangle", "setLoadingState", "container", "titleText", "setErrorState", "error", "initFilterBar", "container", "viewKey", "options", "parseSortByFields", "sortByFields", "primary", "config", "secondary", "sortItems", "items", "fields", "sortConfig", "field", "f", "sorted", "a", "b", "primaryResult", "compareFieldValues", "secondaryField", "direction", "aValue", "getFieldValue", "bValue", "result", "compareText", "compareNumber", "compareDate", "compareSingleSelect", "compareIteration", "compareLabels", "item", "fieldValue", "fv", "extractTitleLikeString", "list", "first", "repo", "m", "parent", "prs", "issues", "rawNode", "content", "aStr", "bStr", "aNum", "bNum", "aDate", "bDate", "aOption", "bOption", "aIndex", "opt", "bIndex", "aLabels", "bLabels", "SlicePanel", "container", "field", "items", "allFields", "stored", "debugOverlay", "resizer", "startX", "startWidth", "onMouseMove", "e", "dx", "newW", "onMouseUp", "ev", "header", "headerTop", "sliceLabel", "fieldButton", "arrow", "content", "anchorButton", "anchorRectOverride", "sliceableTypes", "sliceableFields", "f", "dataType", "dropdown", "rect", "item", "checkSpan", "iconSpan", "labelSpan", "idx", "itemEl", "checkSpanEl", "backdrop", "anchorRect", "btn", "iconName", "valueCounts", "empty", "sorted", "a", "b", "resolveParentProgress", "parentMeta", "result", "identifiers", "found", "A", "d", "M", "o", "m", "statusFV", "v", "normalizeColor", "agg", "key", "value", "count", "rawValue", "parentMetaForIteration", "leftVisual", "makeColorDot", "c", "dot", "visualAppended", "avatarUrl", "avatarEl", "escapeHtml", "repoIcon", "prog", "dotColor", "pd", "lab", "colorCandidate", "normalized", "colorVal", "iter", "it", "labelColumn", "label", "descText", "desc", "p", "titleText", "titleEl", "tspan", "displayedTitle", "summary", "doneText", "bar", "fill", "iterObj", "iterCandidate", "start", "duration", "s", "sStr", "eStr", "rangeEl", "countCircle", "counts", "fv", "existing", "labelsArr", "name", "ass", "fieldValue", "callback", "ActiveTabMenu", "options", "btn", "computed", "iconSpan", "s", "e", "menuManager_default", "items", "rect", "menuRect", "margin", "vw", "vh", "top", "left", "container", "tabEl", "viewKey", "sel", "currentLayout", "makeOption", "layout", "icon", "label", "opt", "lbl", "ev", "pd", "idx", "iconWrapper", "iconName", "midLine", "item", "row", "leftIcon", "labelEl", "b", "i", "arrow", "n", "res", "keepOpen", "children", "submenu", "parentRect", "submenuRect", "el", "refreshFn", "ActiveTabMenu_default", "initOnce", "tabsContainer", "currentLabel", "tabsContainerEl", "removeMenuFromLabel", "label", "inst", "listener", "attachMenuToActive", "activeTab", "layout", "viewKey", "getItems", "vsLocal", "fieldsInfo", "visibleSet", "f", "groupInfo", "columnInfo", "items", "anchor", "anchorRect", "FieldsMenu", "fields", "visible", "x", "created", "fieldId", "visibleFlag", "parentMenu", "parentMenuInst", "GroupByMenu", "columnFields", "raw", "fieldName", "groupable", "markersInfo", "roadmapRenderer", "active", "id", "ff", "n", "syntheticEvent", "sortInfo", "sortCurrent", "cur", "SortByMenu", "fdInfo", "FieldSumMenu", "FieldSumMenuClass", "current", "selected", "dateInfo", "startId", "endId", "startName", "endName", "parentMenuEl", "zoomInfo", "zl", "el", "sliceInfo", "cs", "stored", "parsed", "sliceableTypes", "candidate", "rect", "ph", "menu", "ActiveTabMenu_default", "dateListener", "mutations", "m", "view", "container", "viewKey", "viewName", "setLoadingState", "unsavedGrouping", "unsavedHiddenFields", "unsavedGroupDivisors", "unsavedSort", "unsavedSlice", "activeSlicePanel", "lastPayload", "lastEffectiveFilter", "render", "payload", "effectiveFilter", "snapshot", "items", "fields", "allFields", "existingSlicePanel", "headerContainer", "barApi", "initFilterBar", "newFilter", "dirty", "hiddenArr", "key", "modifiedSnapshot", "gField", "f", "visibleFieldIds", "handleFilter", "filter", "current", "handleAction", "action", "item", "args", "e", "menu", "x", "y", "text", "onClick", "el", "url", "close", "roadmapContainer", "contentWrapper", "repositionSlicePanel", "sliceEl", "sortConfig", "stored", "parseSortByFields", "displayItems", "sortItems", "fv", "field", "dataType", "val", "p", "assignee", "label", "effectiveGroupDivisors", "maybe", "n", "renderer", "RoadmapRenderer", "currentGroupingName", "gbNodes", "effective", "sf", "fieldId", "anchor", "anchorRect", "existing", "sliceableTypes", "sid", "SlicePanel", "value", "newField", "ff", "parsed", "visible", "id", "visibleSet", "fieldName", "ids", "onMessage", "ev", "msg", "setErrorState", "sliceNow", "splitNow"]
}
