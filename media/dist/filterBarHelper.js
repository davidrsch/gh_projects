"use strict";(()=>{function O(u,G,M){try{let a=function(s){try{let e=/^(-?\d+(?:\.\d+)?)\.\.(-?\d+(?:\.\d+)?)$/,o=/^(<=|>=|<|>|=|==)?\s*(-?\d+(?:\.\d+)?)$/,p=e.exec(s);if(p)return{type:"range",min:Number(p[1]),max:Number(p[2])};if(p=o.exec(s),p)return{type:"comp",op:p[1]||"=",val:Number(p[2])}}catch{}return null},m=function(s){return String(s||"").replace(/[-/\\^$+?.()|[\]{}]/g,"\\$&")};var q=a,P=m;let N=String(u||"").trim();if(!N.toLowerCase())return G.map(s=>String(s&&(s.id||s.raw&&s.raw.id)));let A={};try{for(let s=0;s<M.length;s++){let e=M[s];e&&(e.name&&(A[String(e.name).toLowerCase()]=s),e.id&&(A[String(e.id).toLowerCase()]=s))}}catch{}let L={},k=/(\-?\w+):"([^"]+)"|(\-?\w+):(\S+)/g,S,_=N;for(;(S=k.exec(N))!==null;){let s=(S[1]||S[3]||"").toLowerCase(),e=S[2]||S[4]||"";if(!s)continue;let o=[];try{S[2]?o.push(String(e).toLowerCase()):String(e).split(",").map(p=>String(p||"").trim()).filter(p=>p.length>0).forEach(p=>o.push(String(p).toLowerCase()))}catch{o.push(String(e||"").toLowerCase())}L[s]=L[s]||[],L[s]=L[s].concat(o),_=_.replace(S[0]," ")}let E=_.split(/\s+/).map(s=>String(s||"").trim()).filter(s=>s.length>0).map(s=>s.toLowerCase()),x=[];for(let s=0;s<G.length;s++){let e=G[s],o=[];try{let d=e&&e.content?e.content:e&&e.raw&&e.raw.itemContent||{};d&&(d.title&&o.push(String(d.title)),d.name&&o.push(String(d.name)),d.number&&o.push(String(d.number)),d.url&&o.push(String(d.url)));let v=Array.isArray(e.fieldValues)?e.fieldValues:[];for(let C=0;C<v.length;C++){let i=v[C];if(i)try{i.type==="single_select"?i.option&&i.option.name&&o.push(String(i.option.name)):i.type==="labels"||i.type==="label"?(i.labels||[]).forEach(w=>w&&o.push(String(w.name||w))):i.type==="text"?i.text&&o.push(String(i.text)):i.type==="number"?i.number!==void 0&&o.push(String(i.number)):i.type==="issue"||i.type==="parent_issue"?(i.parent&&i.parent.title&&o.push(String(i.parent.title)),i.parent&&i.parent.number&&o.push(String(i.parent.number))):i.type==="pull_request"?i.pullRequests&&Array.isArray(i.pullRequests.nodes)&&i.pullRequests.nodes.forEach(w=>{w&&w.title&&o.push(String(w.title)),w&&w.number&&o.push(String(w.number))}):i&&i.raw&&o.push(JSON.stringify(i.raw))}catch{}}}catch{}let p=o.join(" \0 ").toLowerCase(),g=!0;for(let d in L){if(!L.hasOwnProperty(d))continue;let v=L[d]||[],C=d&&String(d).startsWith("-"),i=C?String(d).slice(1):d;for(let w=0;w<v.length;w++){let c=v[w],y=!1;try{if(i==="type"&&(e&&e.content&&(e.content.__typename||e.content.type)||e&&e.raw&&e.raw.__typename||e&&e.type||"").toString().toLowerCase().indexOf(c)!==-1&&(y=!0),!y&&i==="is"&&(e&&e.content&&e.content.state||e&&e.state||e&&e.raw&&e.raw.state||"").toString().toLowerCase().indexOf(c)!==-1&&(y=!0),!y&&i==="repo"&&(e&&e.content&&e.content.repository&&e.content.repository.nameWithOwner||e&&e.repository&&e.repository.nameWithOwner||e&&e.raw&&e.raw.itemContent&&e.raw.itemContent.repository&&e.raw.itemContent.repository.nameWithOwner||"").toString().toLowerCase().indexOf(c)!==-1&&(y=!0),!y&&(i==="has"||i==="no")){let t=String(c||"").toLowerCase(),n=A[t];if(n!=null){let r=e&&Array.isArray(e.fieldValues)&&e.fieldValues[n]||null,f=r&&(r.type==="labels"?r.labels&&r.labels.length>0:r.type==="text"?String(r.text||"").length>0:r.type==="number"?r.number!==void 0&&r.number!==null:!!(r&&(r.option||r.raw||r.parent||r.pullRequests)));i==="has"?y=!!f:y=!f}else y=p.indexOf(t)!==-1}if(!y&&A[i]!==void 0){let t=A[i],n=e&&Array.isArray(e.fieldValues)&&e.fieldValues[t]||null;if(n){let r=a(c);if(r&&(M[t]&&String(M[t].dataType||M[t].type||"").toUpperCase()==="NUMBER"||n.type==="number")){let f=null;try{n.type==="number"&&typeof n.number=="number"?f=Number(n.number):n.raw&&n.raw.value!==void 0?f=Number(n.raw.value):n.raw&&n.raw.number!==void 0&&(f=Number(n.raw.number))}catch{}if(f!==null&&!isNaN(f))if(r.type==="comp"){let l=r.op||"=",h=Number(r.val);l===">"?y=f>h:l===">="?y=f>=h:l==="<"?y=f<h:l==="<="?y=f<=h:y=f===h}else r.type==="range"&&(y=f>=Number(r.min)&&f<=Number(r.max))}else{let f=function(l){try{if(!l)return"";if(l.type==="single_select")return String(l.option&&l.option.name||"").toLowerCase();if(l.type==="labels"||l.type==="label")return(l.labels||[]).map(h=>String(h&&(h.name||h)||"")).join(" ").toLowerCase();if(l.type==="text")return String(l.text||"").toLowerCase();if(l.type==="number")return String(l.number||"").toLowerCase();if(l.type==="issue"||l.type==="parent_issue")return String(l.parent&&l.parent.title||"").toLowerCase();if(l.type==="pull_request")return(l.pullRequests&&Array.isArray(l.pullRequests.nodes)?l.pullRequests.nodes.map(h=>String(h.title||h.number||"")).join(" "):"").toLowerCase();if(l&&l.raw)return JSON.stringify(l.raw).toLowerCase()}catch{}return""}(n);if(c.indexOf("*")!==-1)try{new RegExp(m(c).replace(/\\\*/g,".*"),"i").test(f)&&(y=!0)}catch{}else f.indexOf(c)!==-1&&(y=!0)}}}if(!y)if(c.indexOf("*")!==-1)try{new RegExp(m(c).replace(/\\\*/g,".*"),"i").test(p)&&(y=!0)}catch{}else p.indexOf(c)!==-1&&(y=!0)}catch{}if(C){if(y){g=!1;break}}else if(!y){g=!1;break}}if(!g)break}if(g){for(let d=0;d<E.length;d++){let v=E[d];if(v){if(v.indexOf("*")!==-1)try{if(!new RegExp(m(v).replace(/\\\*/g,".*"),"i").test(p)){g=!1;break}}catch{g=!1;break}else if(p.indexOf(v)===-1){g=!1;break}}}g&&x.push(String(e&&(e.id||e.raw&&e.raw.id)))}}return x}catch{return G.map(b=>String(b&&(b.id||b.raw&&b.raw.id)))}}function W(u){try{let s=function(t){try{m.textContent=String(t);let n=!!(String(a.value||"").trim()||String(b||"").trim()||t);m.style.display=n?"":"none"}catch{}},d=function(){try{let n=String(a.value||"")!==String(b||"")||!!(k&&k());e.disabled=!n,o.disabled=!n;try{e.style.opacity=n?"1":"0.5",e.style.cursor=n?"pointer":"default",o.style.opacity=n?"1":"0.5",o.style.cursor=n?"pointer":"default";let r=!!(String(a.value||"").trim()||String(b||"").trim());m.style.display=r?"":"none"}catch{}}catch{}},y=function(t){try{let n=String(t||"").trim().toLowerCase();if(!n){c.style.display="none";return}let r=v.filter(f=>String(f||"").toLowerCase().includes(n));if(!r||r.length===0){c.style.display="none";return}c.innerHTML="";for(let f=0;f<Math.min(r.length,50);f++){let l=r[f],h=document.createElement("div");h.textContent=String(l),h.style.padding="6px 8px",h.style.cursor="pointer",h.style.whiteSpace="nowrap",h.style.overflow="hidden",h.style.textOverflow="ellipsis",h.addEventListener("mousedown",function(F){F.preventDefault();try{let I=String(a.value||"").split(/\s+/);I[I.length-1]=String(l);let B=I.join(" ").trim();try{a.value=B}catch{}try{a.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{typeof u.onChange=="function"&&u.onChange(B)}catch{}try{a.focus()}catch{}}catch{}}),c.appendChild(h)}c.style.display="block"}catch{try{c.style.display="none"}catch{}}};var G=s,M=d,q=y;let P=u&&u.parent?u.parent:document.body,N=u&&u.suffix?String(u.suffix):"",b=typeof(u&&u.effFilter)=="string"?u.effFilter:"",A=u&&u.viewKey?u.viewKey:null,L=u&&u.step?Number(u.step):30,k=u&&u.layoutChangedGetter||function(){return!1},S=document.createElement("div");S.style.display="flex",S.style.justifyContent="space-between",S.style.alignItems="center",S.style.marginBottom="8px";let _=document.createElement("div");_.style.display="flex",_.style.alignItems="center",_.style.gap="8px",_.style.flex="1 1 auto",_.style.minWidth="0";let E=document.createElement("div");E.style.position="relative",E.style.flex="1 1 0",E.style.minWidth="0";let a=document.createElement("input");a.type="text",a.placeholder="Filter items...",a.style.padding="6px 36px 6px 8px",a.style.border="1px solid var(--vscode-editorWidget-border)",a.style.borderRadius="0px",a.style.width="100%",a.style.boxSizing="border-box",a.style.background="var(--vscode-input-background)",a.style.color="var(--vscode-input-foreground)",a.style.outline="none",a.setAttribute("data-filter-input",N||"");let m=document.createElement("span");m.setAttribute("data-filter-count",N||""),m.style.position="absolute",m.style.right="44px",m.style.top="50%",m.style.transform="translateY(-50%)",m.style.color="var(--vscode-descriptionForeground)",m.style.fontSize="12px",m.style.display="none";let x=document.createElement("button");x.type="button",x.textContent="\u2715",x.title="Clear filter",x.style.position="absolute",x.style.right="8px",x.style.top="50%",x.style.transform="translateY(-50%)",x.style.border="none",x.style.background="transparent",x.style.cursor="pointer",E.appendChild(a),E.appendChild(m),E.appendChild(x);let e=document.createElement("button");e.type="button",e.textContent="Save",e.style.padding="6px 8px",e.style.border="none",e.style.borderRadius="0px",e.style.background="var(--vscode-button-background, #2ea44f)",e.style.color="var(--vscode-button-foreground, #ffffff)",e.style.minHeight="28px",e.style.lineHeight="16px",e.disabled=!0;let o=document.createElement("button");o.type="button",o.textContent="Discard",o.style.padding="6px 8px",o.style.border="1px solid var(--vscode-editorWidget-border)",o.style.borderRadius="0px",o.style.background="transparent",o.style.color="var(--vscode-button-foreground)",o.style.minHeight="28px",o.style.lineHeight="16px",o.disabled=!0,_.appendChild(E),_.appendChild(o),_.appendChild(e);let p=document.createElement("div"),g=document.createElement("button");g.type="button",g.textContent="Load more",g.style.marginLeft="8px",g.style.border="1px solid var(--vscode-editorWidget-border)",g.style.borderRadius="0px",g.style.background="transparent",g.style.color="var(--vscode-button-foreground)",g.style.minHeight="28px",g.style.lineHeight="16px",p.appendChild(g),S.appendChild(_),S.appendChild(p),P.appendChild(S),a.addEventListener("input",d);let v=[],C=[],i=[],w=[],c=document.createElement("div");c.style.position="absolute",c.style.left="0",c.style.right="0",c.style.top="100%",c.style.zIndex="40",c.style.background="var(--vscode-editor-background)",c.style.border="1px solid var(--vscode-editorWidget-border)",c.style.display="none",c.style.maxHeight="240px",c.style.overflow="auto",c.style.boxSizing="border-box",E.appendChild(c),a.addEventListener("input",function(){try{let n=String(a.value||"").split(/\s+/).pop()||"";y(n)}catch{}}),a.addEventListener("input",function(){try{let t=String(a.value||""),n=new Set(O(t,C,i));try{window.__APP_MESSAGING__&&typeof window.__APP_MESSAGING__.postMessage=="function"&&window.__APP_MESSAGING__.postMessage({command:"debugLog",level:"debug",viewKey:A,message:"filterInput",data:{filter:t,matched:n.size,original:C.length}})}catch{}try{typeof s=="function"&&s(n.size)}catch{}for(let r=0;r<w.length;r++)try{w[r](n,t)}catch{}}catch{}}),a.addEventListener("blur",function(){setTimeout(()=>{try{c.style.display="none"}catch{}},150)}),x.addEventListener("click",function(){try{a.value="";try{a.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{typeof u.onChange=="function"&&u.onChange("")}catch{}}catch{}}),e.addEventListener("click",function(){try{try{window.__APP_MESSAGING__&&typeof window.__APP_MESSAGING__.postMessage=="function"&&window.__APP_MESSAGING__.postMessage({command:"setViewFilter",viewKey:A,filter:a.value})}catch{}if(b=String(a.value||""),typeof u.onSave=="function")try{u.onSave(b)}catch{}try{d()}catch{}}catch{}}),o.addEventListener("click",function(){try{try{window.__APP_MESSAGING__&&typeof window.__APP_MESSAGING__.postMessage=="function"&&window.__APP_MESSAGING__.postMessage({command:"discardViewFilter",viewKey:A})}catch{}if(typeof u.onDiscard=="function")try{u.onDiscard()}catch{}try{d()}catch{}}catch{}}),g.addEventListener("click",function(){try{if(typeof u.onLoadMore=="function")return u.onLoadMore();try{window.__APP_MESSAGING__&&typeof window.__APP_MESSAGING__.postMessage=="function"&&window.__APP_MESSAGING__.postMessage({command:"requestFields",first:L,viewKey:A})}catch{}}catch{}});try{a.value=typeof b=="string"?b:""}catch{}return d(),{headerEl:S,setCount:function(t){try{m.textContent=String(t);let n=!!(String(a.value||"").trim()||String(b||"").trim()||t);m.style.display=n?"":"none"}catch{}},setEffectiveFilter:function(t){try{b=typeof t=="string"?t:String(t||""),a.value=b,d()}catch{}},setCandidates:function(t){try{v=Array.isArray(t)?t.map(r=>String(r||"")):[];let n=String(a.value||"").split(/\s+/).pop()||"";n&&y(n)}catch{}},setLoadState:function(t,n){try{g.disabled=!t,g.textContent=n||(t?"Load more":"All loaded")}catch{}},focusInput:function(){try{a.focus()}catch{}},inputEl:a,saveBtn:e,discardBtn:o,clearBtn:x,registerItems:function(t,n){try{C=Array.isArray(t)?t.slice():[],i=n&&Array.isArray(n.fields)?n.fields:[];try{s(C.length)}catch{}}catch{}},onFilterChange:function(t){try{typeof t=="function"&&w.push(t)}catch{}}}}catch{return null}}window.filterBarHelper={create:W};})();
//# sourceMappingURL=filterBarHelper.js.map
