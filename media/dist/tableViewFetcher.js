"use strict";(()=>{function p(n){return n?String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function H(n){if(!n)return null;let e=String(n).trim();if(/^#?[0-9a-f]{3}$/i.test(e)||/^#?[0-9a-f]{6}$/i.test(e)||/^#?[0-9a-f]{8}$/i.test(e)){let r=e[0]==="#"?e.slice(1):e;return"#"+(r.length===8?r.substring(0,6):r)}let t={GRAY:"#848d97",RED:"#f85149",ORANGE:"#db6d28",YELLOW:"#d29922",GREEN:"#3fb950",BLUE:"#2f81f7",PURPLE:"#a371f7",PINK:"#db61a2",BLACK:"#000000",WHITE:"#ffffff"},i=e.toUpperCase();return t[i]||null}function R(n,e){if(!n)return null;let t=n.replace("#",""),i=r=>parseInt(r,16);if(t.length===3){let r=i(t[0]+t[0]),s=i(t[1]+t[1]),o=i(t[2]+t[2]);return"rgba("+r+","+s+","+o+","+e+")"}if(t.length===6||t.length===8){let r=t.length===8?t.substring(0,6):t,s=i(t.substring(0,2)),o=i(r.substring(2,4)),d=i(r.substring(4,6));return"rgba("+s+","+o+","+d+","+e+")"}return null}function J(n){if(!n)return"#333333";let e=n.replace("#",""),t=o=>parseInt(o,16),i,r,s;if(e.length===3)i=t(e[0]+e[0]),r=t(e[1]+e[1]),s=t(e[2]+e[2]);else if(e.length===6||e.length===8){let o=e.length===8?e.substring(0,6):e;i=t(o.substring(0,2)),r=t(o.substring(2,4)),s=t(o.substring(4,6))}else return"#333333";return .2126*(i/255)+.7152*(r/255)+.0722*(s/255)>.6?"#111111":"#ffffff"}function X(n,e,t,i){var r,s,o,d,a,c,C,v,S,b,E,f,k,W,A;if(!n)return"";try{switch(n.type){case"title":{let l=n&&n.title&&(n.title.raw&&n.title.raw.text||n.title.content&&(n.title.content.title||n.title.content.name)||typeof n.title=="string"&&n.title)||n&&n.content&&(n.content.title||n.content.name)||n&&n.raw&&n.raw.text||"",m=n&&n.title&&n.title.content&&n.title.content.number||n&&n.raw&&n.raw.itemContent&&n.raw.itemContent.number||t&&t.content&&t.content.number||"",h=n&&n.title&&n.title.content&&n.title.content.url||n&&n.raw&&n.raw.itemContent&&n.raw.itemContent.url||t&&t.content&&t.content.url||"",y=null;if(t&&Array.isArray(t.fieldValues)){let x=t.fieldValues.find(w=>w&&w.type==="single_select"&&(w.raw&&w.raw.field&&String(w.raw.field.name||"").toLowerCase()==="status"||w.fieldName&&String(w.fieldName||"").toLowerCase()==="status"||w.field&&w.field.name&&String(w.field.name||"").toLowerCase()==="status"));x&&(y=x.option&&(x.option.color||x.option.id||x.option.name)||x.raw&&x.raw.color||null)}let u=H(y)||null,M=u&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(u)?u:"#666666",F=p(String(l||"")),L=m?p(String(m)):"";return'<a href="'+p(String(h||""))+'" target="_blank" rel="noopener noreferrer" style="text-decoration:none;color:inherit;display:inline-flex;align-items:center;gap:8px;width:100%;"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;color:'+p(M)+'"><circle cx="8" cy="8" r="6" fill="currentColor" /></svg><span style="flex:1;min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block">'+F+"</span>"+(L?'<span style="flex:none;margin-left:6px;color:var(--vscode-descriptionForeground);white-space:nowrap">#'+L+"</span>":"")+"</a>"}case"text":return"<div>"+p((r=n.text)!=null?r:"")+"</div>";case"number":{let l=n.number!==void 0&&n.number!==null?String(n.number):"";return'<div style="text-align:right;font-variant-numeric:tabular-nums">'+p(l)+"</div>"}case"date":{let l=(d=(o=(s=n.date)!=null?s:n.startDate)!=null?o:n.dueOn)!=null?d:null;if(!l)return"<div></div>";try{let m=new Date(l);if(isNaN(m.getTime()))return"<div>"+p(String(l))+"</div>";let h=m.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return"<div>"+p(h)+"</div>"}catch{return"<div>"+p(String(l))+"</div>"}}case"single_select":{let l=p((c=(a=n.option)==null?void 0:a.name)!=null?c:""),m=null;if(e&&Array.isArray(e.options)){let L=e.options.find(x=>x.id&&n.option&&n.option.id&&x.id===n.option.id||x.name&&n.option&&n.option.name&&x.name===n.option.name);L&&(m=(v=(C=L.color)!=null?C:L.id)!=null?v:null)}let h=H(m)||null,y=!!(h&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(h)),u=h||"#999999",M=y&&R(h,.12)||"rgba(0,0,0,0.06)",F=h||"#333333";return'<span style="display:block;width:100%;box-sizing:border-box"><div style="display:inline-flex;align-items:center;padding:2px 8px;border:1px solid '+p(u)+";border-radius:999px;color:"+p(F)+";background:"+p(M)+';font-size:12px;line-height:18px;overflow:hidden;box-sizing:border-box;width:100%"><span style="flex:1 1 auto;min-width:0;max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+l+"</span></div></span>"}case"labels":return"<div>"+(n.labels||[]).map(l=>{let m=p(l.name||""),h=t&&(t.content&&t.content.repository&&t.content.repository.nameWithOwner||t.repository&&t.repository.nameWithOwner)||n.raw&&n.raw.itemContent&&n.raw.itemContent.repository&&n.raw.itemContent.repository.nameWithOwner||null,y=l.color||l.colour||null;if(e&&e.repoOptions&&h&&e.repoOptions[h]){let w=e.repoOptions[h].find(N=>N&&N.name===l.name);w&&(y=w.color||w.colour||y)}let u=H(y)||null,M=!!(u&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(u)),F=u||"#999999",L=M&&R(u,.12)||"rgba(0,0,0,0.06)",x=u||"#333333";return'<span style="display:inline-block;padding:2px 8px;margin-right:6px;border-radius:999px;border:1px solid '+p(F)+";background:"+p(L)+";color:"+p(x)+';font-size:12px;line-height:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+m+"</span>"}).join("")+"</div>";case"repository":{let l=p((b=(S=n.repository)==null?void 0:S.nameWithOwner)!=null?b:"");return'<a href="'+p(((E=n.repository)==null?void 0:E.url)||((f=n.repository)==null?void 0:f.html_url)||"")+'" target="_blank" rel="noopener noreferrer" style="text-decoration:none;color:inherit;display:inline-flex;align-items:center;gap:8px"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;color:var(--vscode-icon-foreground)"><path fill="currentColor" d="M2 2.5A1.5 1.5 0 0 1 3.5 1h9A1.5 1.5 0 0 1 14 2.5v11A1.5 1.5 0 0 1 12.5 15h-9A1.5 1.5 0 0 1 2 13.5v-11zM3.5 2A.5.5 0 0 0 3 2.5V4h10V2.5a.5.5 0 0 0-.5-.5h-9z"/></svg><span>'+l+"</span></a>"}case"pull_request":{let l=n.pullRequests||[];return function(){var m=n.pullRequests||[];if(!m||m.length===0)return"";for(var h='<div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center">',y=0;y<m.length;y++){var u=m[y],M=p(String(u&&u.number||"")),F=p(u&&u.title||""),L=p(u&&u.url||""),x=u&&(u.state_color||u.color||u.colour||u.state)||null,w=H(x)||null,N=!!(w&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(w)),j=w||"#999999",q=N&&R(w,.12)||"rgba(0,0,0,0.06)",D=J(w)||"#333333";h+='<a href="'+L+'" target="_blank" rel="noopener noreferrer" style="text-decoration:none;color:inherit"><span title="'+F+'" style="display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid '+p(j)+";background:"+p(q)+";color:"+p(D)+';font-size:12px;line-height:18px;overflow:hidden;box-sizing:border-box;max-width:160px"><svg width="12" height="12" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;color:'+p(w||"#666")+'"><circle cx="8" cy="8" r="6" fill="currentColor" /></svg><span style="flex:1 1 auto;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">#'+M+"</span></span></a>"}return h+="</div>",h}()}case"issue":return(n.issues||[]).map(l=>'<a href="'+p(l.url||"")+'" target="_blank" rel="noopener noreferrer">#'+p(String(l.number||""))+" "+p(l.title||"")+"</a>").join("<br/>");case"assignees":{let l=n.assignees||[];if(l.length===0)return"<div></div>";let m=l.slice(0,3).map((u,M)=>{let F=p(u.avatarUrl||u.avatar||""),L=M===0?"0px":M===1?"-8px":"-14px",x=Math.max(1,3-M);if(F)return'<span title="'+p(u.login||u.name||"")+'" style="display:inline-block;width:20px;height:20px;border-radius:50%;overflow:hidden;background-size:cover;background-position:center;background-image:url('+F+");border:2px solid var(--vscode-editor-background);margin-left:"+L+";vertical-align:middle;position:relative;z-index:"+x+'"></span>';let w=p((u.name||u.login||"").split(" ").map(N=>N[0]||"").join("").toUpperCase().slice(0,2));return'<span title="'+p(u.login||u.name||"")+'" style="display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:50%;background:#777;color:#fff;font-size:11px;border:2px solid var(--vscode-editor-background);margin-left:'+L+";vertical-align:middle;position:relative;z-index:"+x+'">'+w+"</span>"}).join(""),h=l.map(u=>u.login||u.name||""),y="";return h.length===1?y=h[0]:h.length===2?y=h[0]+" and "+h[1]:y=h.slice(0,-1).join(", ")+" and "+h.slice(-1)[0],'<div style="display:flex;align-items:center;gap:8px"><span style="display:flex;align-items:center">'+('<span style="display:inline-block;vertical-align:middle;height:20px;line-height:20px;margin-right:8px;">'+m+"</span>")+'</span><span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p(y)+"</span></div>"}case"requested_reviewers":return"<div>"+p((n.reviewers||[]).map(l=>l.login||l.name||l.kind||"").join(", "))+"</div>";case"iteration":{let l=p((k=n.title)!=null?k:""),m=H("GRAY")||null,h=!!(m&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(m)),y=m||"#999999",u=h&&R(m,.12)||"rgba(0,0,0,0.06)",M=m||"#333333";return'<div style="display:inline-block;padding:2px 8px;border:1px solid '+p(y)+";border-radius:999px;color:"+p(M)+";background:"+p(u)+';font-size:12px;line-height:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+l+"</div>"}case"parent_issue":{let l=n&&(n.parent||n.parentIssue||n.issue||n.option||n.item||n.value)||n&&n.raw&&(n.raw.parent||n.raw.itemContent||n.raw.item)||null,m=l&&(l.number||l.id||l.raw&&l.raw.number)&&(l.number||l.raw&&l.raw.number)||"",h=l&&(l.title||l.name||l.raw&&l.raw.title)&&(l.title||l.name||l.raw&&l.raw.title)||"",y=l&&(l.url||l.html_url||l.raw&&l.raw.url)&&(l.url||l.html_url||l.raw&&l.raw.url)||"",u=p(String(h||"")),M=m?p(String(m)):"",F=p(String(y||"")),L=null;try{var O=Array.isArray(i)?i:i||[];if(Array.isArray(O)&&O.length>0&&(m||l)){let K=l&&l.repository&&(l.repository.nameWithOwner||l.repository.name)||l&&l.content&&l.content.repository&&l.content.repository.nameWithOwner||null,z=[];m&&z.push(String(m)),l&&(l.id||l.raw&&l.raw.id)&&z.push(String(l.id||l.raw&&l.raw.id)),l&&(l.url||l.raw&&l.raw.url)&&z.push(String(l.url||l.raw&&l.raw.url)),l&&(l.title||l.name)&&z.push(String(l.title||l.name));let U=O.find(I=>{let g=I&&(I.content||I.raw&&I.raw.itemContent)||null;if(!g)return!1;let T=[];if(g.number&&T.push(String(g.number)),g.id&&T.push(String(g.id)),g.url&&T.push(String(g.url)),g.title&&T.push(String(g.title)),g.name&&T.push(String(g.name)),g.raw&&g.raw.number&&T.push(String(g.raw.number)),g.raw&&g.raw.id&&T.push(String(g.raw.id)),g.raw&&g.raw.url&&T.push(String(g.raw.url)),K){let B=g.repository&&(g.repository.nameWithOwner||g.repository.name)||null;if(B&&String(B)!==String(K))return!1}for(let B=0;B<z.length;B++)for(let $=0;$<T.length;$++)if(z[B]&&T[$]&&String(z[B])===String(T[$]))return!0;return!1});if(U&&Array.isArray(U.fieldValues)){let I=U.fieldValues.find(g=>g&&g.type==="single_select"&&(g.raw&&g.raw.field&&String(g.raw.field.name||"").toLowerCase()==="status"||g.fieldName&&String(g.fieldName||"").toLowerCase()==="status"||g.field&&g.field.name&&String(g.field.name||"").toLowerCase()==="status"));I&&(L=I.option&&(I.option.color||I.option.id||I.option.name)||I.raw&&I.raw.color||null)}}}catch{}L||(L=l&&(l.option&&(l.option.color||l.option.id||l.option.name)||l.color||l.colour)||null);let x=H(L)||null,w=!!(x&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(x)),N=x||"#999999",j=w&&R(x,.12)||"rgba(0,0,0,0.06)",q=J(x)||"#333333",D='<span style="display:block;width:100%;box-sizing:border-box"><div style="display:inline-flex;align-items:center;gap:8px;padding:4px 10px;border:1px solid '+p(N)+";border-radius:999px;color:"+p(q)+";background:"+p(j)+';font-size:12px;line-height:18px;overflow:hidden;box-sizing:border-box;width:100%"><svg width="14" height="14" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;color:'+p(x||"#666")+'"><circle cx="8" cy="8" r="6" fill="currentColor" /></svg><span style="flex:1;min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block">'+u+"</span>"+(M?'<span style="margin-left:6px;color:var(--vscode-descriptionForeground);white-space:nowrap">#'+M+"</span>":"")+"</div></span>";return F?'<span data-gh-open="'+F+'" style="display:block;width:100%;cursor:pointer">'+D+"</span>":D}case"milestone":return"<div>"+p((A=(W=n.milestone)==null?void 0:W.title)!=null?A:"")+"</div>";case"sub_issues_progress":try{if(!n||n.total==null||Number(n.total)<=0)return"";let l=Math.max(0,Math.floor(Number(n.total)||0)),m=Math.max(0,Math.floor(Number(n.done||0)));if(l===0)return"";let h=null;if(n.percent!==void 0&&n.percent!==null?h=Number(n.percent):h=Math.round(m/l*100),h==null||!isFinite(h))return"";h=Math.max(0,Math.min(100,h));let y=[];for(let u=0;u<l;u++)u<m?y.push('<div style="flex:1;height:12px;border-radius:4px;background:var(--vscode-focusBorder)"></div>'):y.push('<div style="flex:1;height:12px;border-radius:4px;border:1px solid var(--vscode-focusBorder);background:transparent"></div>');return'<div style="display:flex;align-items:center;gap:8px"><div style="flex:1;min-width:0;display:flex;gap:4px;align-items:center">'+y.join("")+'</div><div style="min-width:44px;text-align:right;font-variant-numeric:tabular-nums;color:var(--vscode-descriptionForeground)">'+p(String(h)+"%")+"</div></div>"}catch{return""}case"missing":return"";default:return"<div>"+p(n&&n.raw&&n.raw.__typename?String(n.raw.__typename):JSON.stringify(n).slice(0,200))+"</div>"}}catch{return""}}var _=class{constructor(e,t){this.menuElement=null;this.backdropElement=null;this.field=e,this.options=t}show(e){this.hide(),this.backdropElement=document.createElement("div"),this.backdropElement.style.position="fixed",this.backdropElement.style.top="0",this.backdropElement.style.left="0",this.backdropElement.style.right="0",this.backdropElement.style.bottom="0",this.backdropElement.style.zIndex="999",this.backdropElement.addEventListener("click",()=>this.hide()),document.body.appendChild(this.backdropElement),this.menuElement=document.createElement("div"),this.menuElement.className="column-header-menu",this.menuElement.style.position="absolute",this.menuElement.style.background="var(--vscode-menu-background)",this.menuElement.style.border="1px solid var(--vscode-menu-border)",this.menuElement.style.borderRadius="4px",this.menuElement.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)",this.menuElement.style.minWidth="180px",this.menuElement.style.padding="4px 0",this.menuElement.style.zIndex="1000",this.menuElement.style.fontSize="13px";let t=e.getBoundingClientRect();this.menuElement.style.top=`${t.bottom+4}px`,this.menuElement.style.left=`${t.left}px`,this.buildMenuItems(),document.body.appendChild(this.menuElement)}hide(){this.menuElement&&(this.menuElement.remove(),this.menuElement=null),this.backdropElement&&(this.backdropElement.remove(),this.backdropElement=null)}buildMenuItems(){this.menuElement&&(this.addMenuItem("Select column",null,{isHeader:!0}),this.addSeparator(),this.addMenuItem("Sort ascending \u2191",()=>{this.options.onSort?.("ASC"),this.hide()},{icon:"\u2191"}),this.addMenuItem("Sort descending \u2193",()=>{this.options.onSort?.("DESC"),this.hide()},{icon:"\u2193"}),this.addSeparator(),this.options.canGroup&&this.addMenuItem("Group by values",()=>{this.options.onGroup?.(),this.hide()}),this.options.canSlice&&this.addMenuItem("Slice by values",()=>{this.options.onSlice?.(),this.hide()}),this.options.canFilter&&this.addMenuItem("Filter by values...",()=>{this.options.onFilter?.(),this.hide()}),(this.options.canGroup||this.options.canSlice||this.options.canFilter)&&this.addSeparator(),this.addMenuItem("Hide field",()=>{this.options.onHide?.(),this.hide()}),this.addSeparator(),this.addMenuItem("Move left \u2190",()=>{this.options.onMove?.("left"),this.hide()},{icon:"\u2190"}),this.addMenuItem("Move right \u2192",()=>{this.options.onMove?.("right"),this.hide()},{icon:"\u2192"}))}addMenuItem(e,t,i){if(!this.menuElement)return;let r=document.createElement("div");r.className="menu-item",r.textContent=e,i?.isHeader?(r.style.padding="6px 12px",r.style.fontWeight="600",r.style.color="var(--vscode-descriptionForeground)",r.style.fontSize="11px",r.style.textTransform="uppercase",r.style.cursor="default"):(r.style.padding="6px 12px",r.style.cursor="pointer",r.style.color="var(--vscode-menu-foreground)",t&&(r.addEventListener("mouseenter",()=>{r.style.background="var(--vscode-menu-selectionBackground)",r.style.color="var(--vscode-menu-selectionForeground)"}),r.addEventListener("mouseleave",()=>{r.style.background="transparent",r.style.color="var(--vscode-menu-foreground)"}),r.addEventListener("click",t))),this.menuElement.appendChild(r)}addSeparator(){if(!this.menuElement)return;let e=document.createElement("div");e.style.height="1px",e.style.background="var(--vscode-menu-separatorBackground)",e.style.margin="4px 0",this.menuElement.appendChild(e)}};var V=class{constructor(e,t,i){this.panelElement=null;this.container=e,this.field=t,this.items=i}render(){this.close(),this.panelElement=document.createElement("div"),this.panelElement.className="slice-panel",this.panelElement.style.position="relative",this.panelElement.style.float="left",this.panelElement.style.width="250px",this.panelElement.style.marginRight="12px",this.panelElement.style.background="var(--vscode-sideBar-background)",this.panelElement.style.border="1px solid var(--vscode-sideBar-border)",this.panelElement.style.borderRadius="4px",this.panelElement.style.display="flex",this.panelElement.style.flexDirection="column",this.panelElement.style.overflow="hidden",this.panelElement.style.maxHeight="600px";let e=document.createElement("div");e.style.padding="12px",e.style.borderBottom="1px solid var(--vscode-sideBar-border)",e.style.display="flex",e.style.justifyContent="space-between",e.style.alignItems="center";let t=document.createElement("div");t.textContent=`Slice by ${this.field.name}`,t.style.fontWeight="600",e.appendChild(t);let i=document.createElement("button");i.textContent="\xD7",i.style.background="transparent",i.style.border="none",i.style.fontSize="24px",i.style.cursor="pointer",i.style.color="var(--vscode-foreground)",i.addEventListener("click",()=>this.close()),e.appendChild(i),this.panelElement.appendChild(e);let r=document.createElement("div");r.style.flex="1",r.style.overflow="auto",r.style.padding="8px",this.renderValues(r),this.panelElement.appendChild(r),this.container.appendChild(this.panelElement)}renderValues(e){let t=this.getValueCounts();if(t.size===0){let r=document.createElement("div");r.textContent="No values",r.style.padding="8px",r.style.color="var(--vscode-descriptionForeground)",e.appendChild(r);return}Array.from(t.entries()).sort((r,s)=>s[1]-r[1]).forEach(([r,s])=>{let o=document.createElement("div");o.className="slice-value-item",o.style.padding="8px 12px",o.style.cursor="pointer",o.style.borderRadius="4px",o.style.marginBottom="4px",o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center";let d=document.createElement("span");d.textContent=this.formatValue(r),d.style.flex="1";let a=document.createElement("span");a.textContent=String(s),a.style.background="var(--vscode-badge-background)",a.style.color="var(--vscode-badge-foreground)",a.style.padding="2px 6px",a.style.borderRadius="10px",a.style.fontSize="11px",o.appendChild(d),o.appendChild(a),o.addEventListener("mouseenter",()=>{o.style.background="var(--vscode-list-hoverBackground)"}),o.addEventListener("mouseleave",()=>{o.style.background="transparent"}),o.addEventListener("click",()=>{this.onValueSelectCallback&&this.onValueSelectCallback(r)}),e.appendChild(o)})}getValueCounts(){let e=new Map;return this.items.forEach(t=>{let i=t.fieldValues?.find(r=>r.fieldId===this.field.id||r.fieldName===this.field.name);if(i){let r=this.extractValue(i),s=String(r||"(empty)");e.set(s,(e.get(s)||0)+1)}else e.set("(empty)",(e.get("(empty)")||0)+1)}),e}extractValue(e){switch((this.field.dataType||"").toLowerCase()){case"text":case"title":return e.text||e.title;case"number":return e.number;case"date":return e.date;case"single_select":return e.option?.name||e.name;case"iteration":return e.title||e.iteration?.title;default:return e.text||e.value||null}}formatValue(e){return e==null?"(empty)":String(e)}onValueSelect(e){this.onValueSelectCallback=e}close(){this.panelElement&&(this.panelElement.remove(),this.panelElement=null)}};var P=class{constructor(e,t,i,r={}){this.activeMenu=null;this.activeSlicePanel=null;this.container=e,this.allFields=t,this.options=r,this.items=i;let s=this.loadHiddenFields(),o=r.hiddenFields||[];this.hiddenFieldIds=new Set([...s,...o]),this.fields=this.allFields.filter(d=>!this.hiddenFieldIds.has(d.id)),this.applyFieldOrder()}render(){this.container.innerHTML="";let e=document.createElement("div");e.style.overflowX="auto",e.style.overflowY="auto",e.style.width="100%",e.style.display="block",e.style.height="100%";let t=document.createElement("table");t.style.borderCollapse="separate",t.style.borderSpacing="0",t.style.tableLayout="fixed",t.style.width="max-content",this.renderColGroup(t),this.renderHeader(t),this.renderBody(t),e.appendChild(t),this.container.appendChild(e),this.setupResizers(t)}renderColGroup(e){let t=document.createElement("colgroup"),i=document.createElement("col");i.style.width="40px",t.appendChild(i);for(let s of this.fields){let o=document.createElement("col");o.style.width="150px",t.appendChild(o)}let r=document.createElement("col");r.style.width="50px",t.appendChild(r),e.appendChild(t)}renderHeader(e){let t=document.createElement("thead");t.style.background="var(--vscode-editor-background)",t.style.position="sticky",t.style.top="0",t.style.zIndex="10";let i=document.createElement("tr"),r=document.createElement("th");r.textContent="#",this.styleHeaderCell(r),i.appendChild(r);for(let d of this.fields){let a=document.createElement("th"),c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="space-between",c.style.width="100%",c.style.gap="4px";let C=document.createElement("span"),v=d.name||d.id||"";if(this.options.sortConfig?.fieldId===d.id){let k=this.options.sortConfig?.direction==="ASC"?" \u2191":" \u2193";v+=k}C.textContent=v,C.style.flex="1",C.style.overflow="hidden",C.style.textOverflow="ellipsis",C.style.whiteSpace="nowrap";let S=d.name?.toLowerCase()===this.options.groupingFieldName?.toLowerCase(),b=!1,E=document.createElement("span");if(E.style.display="flex",E.style.alignItems="center",E.style.gap="2px",S||b){let k=document.createElement("span");k.textContent="\u25BC",k.style.fontSize="10px",k.style.color="var(--vscode-foreground)",k.style.opacity="0.7",k.title=S?"Grouped by this field":"Sliced by this field",E.appendChild(k)}let f=document.createElement("button");f.textContent="\u22EE",f.style.background="transparent",f.style.border="none",f.style.cursor="pointer",f.style.fontSize="16px",f.style.padding="2px 4px",f.style.color="var(--vscode-foreground)",f.style.opacity="0.6",f.style.borderRadius="3px",f.title=`${d.name} options`,f.addEventListener("mouseenter",()=>{f.style.opacity="1",f.style.background="var(--vscode-toolbar-hoverBackground)"}),f.addEventListener("mouseleave",()=>{f.style.opacity="0.6",f.style.background="transparent"}),f.addEventListener("click",k=>{k.stopPropagation(),this.showHeaderMenu(k,d,a)}),c.appendChild(C),(S||b)&&c.appendChild(E),c.appendChild(f),a.appendChild(c),a.addEventListener("mouseenter",()=>{a.style.background="var(--vscode-list-hoverBackground)"}),a.addEventListener("mouseleave",()=>{a.style.background="var(--vscode-editor-background)"}),this.styleHeaderCell(a),i.appendChild(a)}let s=document.createElement("th"),o=document.createElement("button");o.textContent="+",o.style.background="transparent",o.style.border="none",o.style.cursor="pointer",o.style.fontSize="18px",o.style.fontWeight="bold",o.style.color="var(--vscode-foreground)",o.style.width="100%",o.style.height="100%",o.title="Show hidden fields",o.addEventListener("click",()=>this.showHiddenFieldsMenu(o)),s.appendChild(o),this.styleHeaderCell(s),s.style.textAlign="center",s.style.width="50px",i.appendChild(s),t.appendChild(i),e.appendChild(t)}styleHeaderCell(e){e.style.padding="6px",e.style.textAlign="left",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.borderRight="1px solid var(--vscode-editorGroup-border)",e.style.borderBottom="1px solid var(--vscode-editorGroup-border)",e.style.position="sticky",e.style.top="0",e.style.zIndex="11",e.style.background="var(--vscode-editor-background)",e.style.height="32px",e.style.boxSizing="border-box"}renderBody(e){let t=document.createElement("tbody"),i=this.getGroupingField();i?this.renderGroupedRows(t,i):this.renderFlatRows(t,this.items),e.appendChild(t)}getGroupingField(){return this.options.groupingFieldName?this.fields.find(e=>e.name&&e.name.toLowerCase()===this.options.groupingFieldName?.toLowerCase()||e.id&&e.id===this.options.groupingFieldName):null}renderFlatRows(e,t){t.forEach((i,r)=>{let s=this.createRow(i,r);e.appendChild(s)})}renderGroupedRows(e,t){let i=this.groupItems(this.items,t);for(let r of i){let s=document.createElement("tr"),o=document.createElement("td");o.colSpan=this.fields.length+1,o.style.padding="8px",o.style.background="var(--vscode-editor-background)",o.style.fontWeight="600",o.style.borderTop="1px solid var(--vscode-editorGroup-border)",o.style.borderBottom="1px solid var(--vscode-editorGroup-border)",o.style.position="sticky",o.style.top="32px",o.style.zIndex="9",o.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)";let d=document.createElement("div");d.style.display="flex",d.style.alignItems="center",d.style.gap="8px";let a=document.createElement("vscode-button");a.setAttribute("appearance","icon"),a.textContent="-",a.style.width="20px",a.style.height="20px",a.style.cursor="pointer";let c=document.createElement("div");c.style.width="12px",c.style.height="12px",c.style.borderRadius="50%",c.style.backgroundColor=H(r.option.color)||"gray";let C=document.createElement("span");C.textContent=r.option.name||r.option.title||"Unassigned";let v=document.createElement("vscode-badge");v.textContent=String(r.items.length),d.appendChild(a),d.appendChild(c),d.appendChild(C),d.appendChild(v),o.appendChild(d),s.appendChild(o),e.appendChild(s);let S=[];r.items.forEach(b=>{let E=this.createRow(b.item,b.index);E.classList.add("group-row-"+r.option.id),e.appendChild(E),S.push(E)}),a.addEventListener("click",()=>{let b=a.textContent==="+";a.textContent=b?"-":"+",S.forEach(E=>{E.style.display=b?"table-row":"none"})})}}groupItems(e,t){let i=[],r=(t.dataType||"").toLowerCase();r==="single_select"?i=t.options||[]:r==="iteration"&&(i=t.configuration&&t.configuration.iterations||[]);let s=i.map(d=>({option:d,items:[]})),o=[];return e.forEach((d,a)=>{let c=d.fieldValues.find(v=>v.fieldId===t.id||v.fieldName===t.name),C=!1;if(c){let v=null,S=null;if(r==="single_select"?(v=c.optionId||c.option&&c.option.id,S=c.name||c.option&&c.option.name):r==="iteration"&&(v=c.iterationId||c.iteration&&c.iteration.id||c.id,S=c.title||c.iteration&&c.iteration.title),v||S){let b=s.find(E=>v&&E.option.id===v||S&&(E.option.name===S||E.option.title===S));b&&(b.items.push({item:d,index:a}),C=!0)}}C||o.push({item:d,index:a})}),o.length>0&&s.push({option:{name:"Unassigned",title:"Unassigned",color:"GRAY"},items:o}),s.filter(d=>d.items.length>0)}createRow(e,t){let i=document.createElement("tr");i.setAttribute("data-gh-item-id",e.id);let r=document.createElement("td");r.textContent=String(t+1),this.styleCell(r),i.appendChild(r);for(let s of this.fields){let o=document.createElement("td");this.styleCell(o);let d=e.fieldValues.find(a=>a.fieldId===s.id||a.fieldName===s.name);d&&(o.innerHTML=X(d,s,e,this.items)),i.appendChild(o)}return i}styleCell(e){e.style.padding="6px",e.style.borderRight="1px solid var(--vscode-editorGroup-border)",e.style.borderBottom="1px solid var(--vscode-editorGroup-border)",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.textOverflow="ellipsis"}showHeaderMenu(e,t,i){e.stopPropagation(),this.activeMenu&&this.activeMenu.hide();let r=(t.dataType||"").toLowerCase(),s=["single_select","iteration"].includes(r),o=(t.name?.toLowerCase()||"")!=="title";this.activeMenu=new _(t,{canGroup:s,canSlice:o,canFilter:!1,onSort:d=>this.handleSort(t,d),onGroup:()=>this.handleGroup(t),onSlice:()=>this.handleSlice(t),onHide:()=>this.hideField(t.id),onMove:d=>this.handleMove(t,d)}),this.activeMenu.show(i)}showHiddenFieldsMenu(e){this.activeMenu&&this.activeMenu.hide();let t=this.allFields.filter(a=>this.hiddenFieldIds.has(a.id));if(t.length===0){let a=document.createElement("div");a.textContent="No hidden fields",a.style.position="absolute",a.style.background="var(--vscode-menu-background)",a.style.border="1px solid var(--vscode-menu-border)",a.style.borderRadius="4px",a.style.padding="12px",a.style.fontSize="13px",a.style.color="var(--vscode-descriptionForeground)",a.style.zIndex="1000";let c=e.getBoundingClientRect();a.style.top=`${c.bottom+4}px`,a.style.left=`${c.left}px`,document.body.appendChild(a),setTimeout(()=>a.remove(),2e3);return}let i=document.createElement("div");i.style.position="absolute",i.style.background="var(--vscode-menu-background)",i.style.border="1px solid var(--vscode-menu-border)",i.style.borderRadius="4px",i.style.padding="4px 0",i.style.minWidth="180px",i.style.zIndex="1000",i.style.fontSize="13px";let r=e.getBoundingClientRect();i.style.top=`${r.bottom+4}px`,i.style.left=`${r.left}px`;let s=document.createElement("div");s.textContent="Show field",s.style.padding="6px 12px",s.style.fontWeight="600",s.style.color="var(--vscode-descriptionForeground)",s.style.fontSize="11px",s.style.textTransform="uppercase",i.appendChild(s);let o=document.createElement("div");o.style.height="1px",o.style.background="var(--vscode-menu-separatorBackground)",o.style.margin="4px 0",i.appendChild(o),t.forEach(a=>{let c=document.createElement("div");c.textContent=a.name||a.id,c.style.padding="6px 12px",c.style.cursor="pointer",c.style.color="var(--vscode-menu-foreground)",c.addEventListener("mouseenter",()=>{c.style.background="var(--vscode-menu-selectionBackground)",c.style.color="var(--vscode-menu-selectionForeground)"}),c.addEventListener("mouseleave",()=>{c.style.background="transparent",c.style.color="var(--vscode-menu-foreground)"}),c.addEventListener("click",()=>{this.showField(a.id),i.remove(),d.remove()}),i.appendChild(c)});let d=document.createElement("div");d.style.position="fixed",d.style.top="0",d.style.left="0",d.style.right="0",d.style.bottom="0",d.style.zIndex="999",d.addEventListener("click",()=>{i.remove(),d.remove()}),document.body.appendChild(d),document.body.appendChild(i)}handleSort(e,t){let i={fieldId:e.id,direction:t};this.saveSortConfig(i),this.options.onSortChange&&this.options.onSortChange(i)}handleGroup(e){this.options.onGroupChange&&e.name&&this.options.onGroupChange(e.name)}handleSlice(e){this.activeSlicePanel&&(this.activeSlicePanel.close(),this.activeSlicePanel=null),this.activeSlicePanel=new V(this.container,e,this.items),this.activeSlicePanel.render();let t=this.container.querySelector("table");if(t){let i=this.container.querySelector(".slice-panel");i&&this.container.insertBefore(i,t)}this.activeSlicePanel.onValueSelect(i=>{console.log(`Filter by ${e.name}:`,i)}),this.options.onSliceChange&&this.options.onSliceChange(e)}hideField(e){this.hiddenFieldIds.add(e),this.saveHiddenFields(),this.fields=this.allFields.filter(t=>!this.hiddenFieldIds.has(t.id)),this.render()}showField(e){this.hiddenFieldIds.delete(e),this.saveHiddenFields(),this.fields=this.allFields.filter(t=>!this.hiddenFieldIds.has(t.id)),this.render()}handleMove(e,t){let i=this.fields.findIndex(r=>r.id===e.id);t==="left"&&i>0?[this.fields[i],this.fields[i-1]]=[this.fields[i-1],this.fields[i]]:t==="right"&&i<this.fields.length-1&&([this.fields[i],this.fields[i+1]]=[this.fields[i+1],this.fields[i]]),this.saveFieldOrder(),this.render()}getStorageKey(e){return this.options.viewKey?`ghProjects.table.${this.options.viewKey}.${e}`:""}loadHiddenFields(){let e=this.getStorageKey("hiddenFields");if(!e)return[];try{let t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch{return[]}}saveHiddenFields(){let e=this.getStorageKey("hiddenFields");e&&localStorage.setItem(e,JSON.stringify(Array.from(this.hiddenFieldIds)))}saveSortConfig(e){let t=this.getStorageKey("sortConfig");t&&localStorage.setItem(t,JSON.stringify(e))}saveFieldOrder(){let e=this.getStorageKey("fieldOrder");if(!e)return;let t=this.fields.map(i=>i.id);localStorage.setItem(e,JSON.stringify(t))}applyFieldOrder(){let e=this.getStorageKey("fieldOrder");if(e)try{let t=localStorage.getItem(e);if(!t)return;let i=JSON.parse(t),r=[];for(let s of i){let o=this.fields.find(d=>d.id===s);o&&r.push(o)}for(let s of this.fields)r.find(o=>o.id===s.id)||r.push(s);this.fields=r}catch{}}setupResizers(e){e.querySelectorAll("th").forEach((i,r)=>{if(r===0)return;let s=document.createElement("div");s.className="column-resizer",s.style.position="absolute",s.style.top="0",s.style.right="0",s.style.width="4px",s.style.height="100%",s.style.cursor="col-resize",s.style.userSelect="none",s.style.zIndex="100",s.addEventListener("mouseenter",()=>{s.style.background="var(--vscode-focusBorder)"}),s.addEventListener("mouseleave",()=>{s.style.background="transparent"});let o=0,d=0;s.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation(),o=a.pageX,d=i.offsetWidth;let c=v=>{let S=Math.max(50,d+(v.pageX-o));i.style.width=`${S}px`,i.style.minWidth=`${S}px`,i.style.maxWidth=`${S}px`},C=()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",C);let v=r-1;v>=0&&v<this.fields.length&&this.saveColumnWidth(this.fields[v].id,i.offsetWidth)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",C)}),i.style.position="relative",i.appendChild(s)}),this.restoreColumnWidths(e)}saveColumnWidth(e,t){let i=this.getStorageKey("columnWidths");if(i)try{let r=localStorage.getItem(i),s=r?JSON.parse(r):{};s[e]=t,localStorage.setItem(i,JSON.stringify(s))}catch{}}restoreColumnWidths(e){let t=this.getStorageKey("columnWidths");if(t)try{let i=localStorage.getItem(t);if(!i)return;let r=JSON.parse(i),s=e.querySelectorAll("th");this.fields.forEach((o,d)=>{let a=r[o.id];if(a){let c=s[d+1];c&&(c.style.width=`${a}px`,c.style.minWidth=`${a}px`,c.style.maxWidth=`${a}px`)}})}catch{}}};function Y(n,e){n.innerHTML='<div class="title">'+e+'</div><div class="loading"><em>Loading...</em></div>'}function Q(n,e,t){n.innerHTML='<div class="title">'+e+'</div><div style="color:var(--vscode-editor-foreground)">'+t+"</div>"}function Z(n){let e=document.createElement("button");return e.type="button",e.textContent="Load more",e.style.marginLeft="8px",e.style.border="1px solid var(--vscode-editorWidget-border)",e.addEventListener("click",()=>{n(),e.disabled=!0,e.textContent="Loading..."}),e}function ee(n,e,t){if(window.filterBarHelper&&typeof window.filterBarHelper.create=="function")try{return window.filterBarHelper.create({parent:n,suffix:t.suffix||e,effFilter:void 0,viewKey:e,step:t.step||50,onLoadMore:t.onLoadMore})}catch{return null}return null}function ie(n){if(!n||!n.nodes||n.nodes.length===0)return null;let e=n.nodes[0];if(!e||!e.field)return null;let t={fieldId:e.field.id||e.field.name,direction:e.direction||"ASC"};if(n.nodes.length>1){let i=n.nodes[1];i&&i.field&&(t.secondary={fieldId:i.field.id||i.field.name,direction:i.direction||"ASC"})}return t}function re(n,e,t){if(!t||n.length===0)return n;let i=e.find(s=>s.id===t.fieldId||s.name===t.fieldId);if(!i)return n;let r=[...n];return r.sort((s,o)=>{let d=te(s,o,i,t.direction);if(d===0&&t.secondary){let a=e.find(c=>c.id===t.secondary.fieldId||c.name===t.secondary.fieldId);if(a)return te(s,o,a,t.secondary.direction)}return d}),r}function te(n,e,t,i){let r=ne(n,t),s=ne(e,t);if(r===null&&s===null)return 0;if(r===null)return i==="ASC"?1:-1;if(s===null)return i==="ASC"?-1:1;let o=0;switch((t.dataType||"").toLowerCase()){case"text":case"title":o=G(r,s);break;case"number":o=le(r,s);break;case"date":o=oe(r,s);break;case"single_select":o=se(r,s,t);break;case"iteration":o=ae(r,s);break;case"labels":o=de(r,s);break;default:o=String(r).localeCompare(String(s))}return i==="ASC"?o:-o}function ne(n,e){let t=n.fieldValues?.find(r=>r.fieldId===e.id||r.fieldName===e.name);if(!t)return null;switch((e.dataType||"").toLowerCase()){case"text":case"title":return t.text||t.title||null;case"number":return t.number!==void 0?t.number:null;case"date":return t.date||t.startDate||t.dueOn||null;case"single_select":return t.option||t;case"iteration":return t;case"labels":return t.labels||[];default:return t}}function G(n,e){let t=String(n||"").toLowerCase(),i=String(e||"").toLowerCase();return t.localeCompare(i)}function le(n,e){let t=typeof n=="number"?n:parseFloat(n),i=typeof e=="number"?e:parseFloat(e);return isNaN(t)&&isNaN(i)?0:isNaN(t)?1:isNaN(i)?-1:t-i}function oe(n,e){let t=new Date(n),i=new Date(e);return isNaN(t.getTime())&&isNaN(i.getTime())?0:isNaN(t.getTime())?1:isNaN(i.getTime())?-1:t.getTime()-i.getTime()}function se(n,e,t){let i=n.option||n,r=e.option||e;if(!i||!r)return G(i?.name||"",r?.name||"");if(t.options&&Array.isArray(t.options)){let s=t.options.findIndex(d=>d.id===i.id||d.name===i.name),o=t.options.findIndex(d=>d.id===r.id||d.name===r.name);if(s!==-1&&o!==-1)return s-o}return G(i.name,r.name)}function ae(n,e){let t=n.startDate||n.iteration?.startDate,i=e.startDate||e.iteration?.startDate;return!t&&!i?G(n.title||n.iteration?.title,e.title||e.iteration?.title):oe(t,i)}function de(n,e){let t=Array.isArray(n)?n:[],i=Array.isArray(e)?e:[];return t.length===0&&i.length===0?0:t.length===0?1:i.length===0?-1:G(t[0].name,i[0].name)}window.tableViewFetcher=function(n,e,t){let i=n&&(n.name||n.id)?n.name||n.id:"Table View";try{Y(e,i)}catch{}let r=30;function s(a){let c=a||{},C=c.fields||[],v=c.items||[],S=v.slice(0,r);e.innerHTML="",e.style.margin="0",e.style.padding="0",e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e.style.overflow="hidden";let b=document.createElement("div");b.style.flex="0 0 auto",b.style.background="var(--vscode-editor-background)",b.style.zIndex="20",b.style.position="relative",b.style.display="flex",b.style.justifyContent="space-between",b.style.alignItems="center",b.style.width="100%";let E=document.createElement("div");E.style.flex="1 1 auto",E.style.marginRight="8px",b.appendChild(E);let f=ee(E,t,{suffix:t?String(t).split(":").pop():"",step:r,onLoadMore:()=>{r+=30,d()}});if(f)typeof f.setLoadState=="function"&&f.setLoadState(v.length<r,v.length>=r?"Load more":"All loaded"),typeof f.registerItems=="function"&&f.registerItems(v,{fields:C});else{let m=document.createElement("div");m.className="title",m.textContent=i,m.style.padding="8px",b.appendChild(m);let h=document.createElement("div");if(h.style.padding="8px",v.length>r){let y=Z(()=>{r+=30,d()});h.appendChild(y)}else{let y=document.createElement("span");y.textContent="All loaded",y.style.color="var(--vscode-descriptionForeground)",h.appendChild(y)}b.appendChild(h)}e.appendChild(b);let k=document.createElement("div");k.style.flex="1 1 auto",k.style.overflow="hidden",k.style.position="relative",e.appendChild(k);let W=ce(c),A=ie(c.details?.sortByFields);if(t)try{let m=localStorage.getItem(`ghProjects.table.${t}.sortConfig`);m&&(A=JSON.parse(m))}catch{}let O=S;A&&(O=re(S,C,A)),new P(k,C,O,{groupingFieldName:W||void 0,sortConfig:A,viewKey:t,onSortChange:()=>d(),onGroupChange:m=>{t&&localStorage.setItem(`ghProjects.table.${t}.groupingField`,m),d()}}).render(),f&&typeof f.onFilterChange=="function"&&f.onFilterChange(m=>{k.querySelectorAll("tr[data-gh-item-id]").forEach(y=>{let u=y.getAttribute("data-gh-item-id");u&&m.has(u)?y.style.display="table-row":y.style.display="none"})})}function o(a){let c=a&&a.data?a.data:a;try{if(c&&c.command==="fields"){if(c.viewKey&&t&&String(c.viewKey)!==String(t))return;c.error?Q(e,i,String(c.error)):s(c.payload)}}catch{}}function d(){try{window.vscodeApi&&typeof window.vscodeApi.postMessage=="function"&&window.vscodeApi.postMessage({command:"requestFields",first:r,viewKey:t})}catch{}}window.addEventListener("message",o),d()};function ce(n){try{if(n&&n.details){let e=n.details.verticalGroupByFields&&n.details.verticalGroupByFields.nodes,t=n.details.groupByFields&&n.details.groupByFields.nodes;if(e&&e.length>0)return e[0].name||null;if(t&&t.length>0)return t[0].name||null}}catch{}return null}})();
//# sourceMappingURL=tableViewFetcher.js.map
